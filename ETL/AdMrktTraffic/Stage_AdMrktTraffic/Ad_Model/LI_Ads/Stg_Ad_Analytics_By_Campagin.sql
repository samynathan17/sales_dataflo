{% set results = get_column_values_from_query("select * from " ~ var('V_DB') ~ "." ~ var('V_Entity_Schema')~ "." ~ var('V_Mkt')~ " where DATASOURCE_TYPE = 'LI_ADS' and READY_TO_PROCESS = 'TRUE'", "ENTITY_DATASORUCE_NAME||'#'||DATASOURCE_TYPE")%}

{% if not var("enable_SF_source") %}
{{
    config(
        enabled=false
    )
}}
{% endif %}

{% for V_SF_Schema in results %}


{% if V_SF_Schema != 'X' %} 
{% set schema_nm,entity_typ = V_SF_Schema.split('#') %}
{% else %}
{% set entity_typ = 'X' %}
{% endif %}

 {% if  entity_typ == 'LI_ADS'  %} 
      
  select
        {{ dbt_utils.surrogate_key('CAMPAIGN_ID','DAY') }}  AS ID,
       LEAD_GENERATION_MAIL_CONTACT_INFO_SHARES,
VIDEO_COMPLETIONS,
VIRAL_EXTERNAL_WEBSITE_POST_CLICK_CONVERSIONS,
VIRAL_FULL_SCREEN_PLAYS,
VIRAL_SHARES,
AD_UNIT_CLICKS,
VIRAL_CARD_CLICKS,
EXTERNAL_WEBSITE_POST_CLICK_CONVERSIONS,
VIRAL_IMPRESSIONS,
EXTERNAL_WEBSITE_CONVERSIONS,
CONVERSION_VALUE_IN_LOCAL_CURRENCY,
VIRAL_VIDEO_FIRST_QUARTILE_COMPLETIONS,
CAMPAIGN_ID,
VIRAL_TOTAL_ENGAGEMENTS,
OPENS,
OTHER_ENGAGEMENTS,
VIRAL_VIDEO_VIEWS,
CARD_IMPRESSIONS,
CLICKS,
VIRAL_COMMENTS,
COMMENTS,
TEXT_URL_CLICKS,
TOTAL_ENGAGEMENTS,
VIDEO_MIDPOINT_COMPLETIONS,
VIRAL_EXTERNAL_WEBSITE_POST_VIEW_CONVERSIONS,
ACTION_CLICKS,
EXTERNAL_WEBSITE_POST_VIEW_CONVERSIONS,
VIRAL_FOLLOWS,
VIRAL_OTHER_ENGAGEMENTS,
COST_IN_USD,
DAY,
VIRAL_ONE_CLICK_LEAD_FORM_OPENS,
VIDEO_STARTS,
VIRAL_LIKES,
VIDEO_THIRD_QUARTILE_COMPLETIONS,
VIRAL_LANDING_PAGE_CLICKS,
COMMENT_LIKES,
COMPANY_PAGE_CLICKS,
IMPRESSIONS,
COST_IN_LOCAL_CURRENCY,
FOLLOWS,
LEAD_GENERATION_MAIL_INTERESTED_CLICKS,
VIRAL_CARD_IMPRESSIONS,
SHARES,
VIRAL_VIDEO_STARTS,
ONE_CLICK_LEAD_FORM_OPENS,
LANDING_PAGE_CLICKS,
VIRAL_VIDEO_COMPLETIONS,
CARD_CLICKS,
VIRAL_COMPANY_PAGE_CLICKS,
VIRAL_VIDEO_MIDPOINT_COMPLETIONS,
FULL_SCREEN_PLAYS,
VIDEO_FIRST_QUARTILE_COMPLETIONS,
VIRAL_VIDEO_THIRD_QUARTILE_COMPLETIONS,
VIDEO_VIEWS,
VIRAL_CLICKS,
VIRAL_COMMENT_LIKES,
APPROXIMATE_UNIQUE_IMPRESSIONS,
VIRAL_EXTERNAL_WEBSITE_CONVERSIONS,
VIRAL_ONE_CLICK_LEADS,
LIKES,
ONE_CLICK_LEADS,
        '{{ schema_nm }}' as Source_type,
        'D_BASIC_AD_ACTIONS_STG_LOAD' AS DW_SESSION_NM,
        {{ dbt_utils.current_timestamp() }} AS DW_INS_UPD_DTS 
    FROM {{ schema_nm }}. AD_ANALYTICS_BY_CAMPAIGN
          {% if not loop.last %}
            UNION ALL
        {% endif %} 
        {% elif  entity_typ == 'X'  %} 
         select
        NULL AS LEAD_GENERATION_MAIL_CONTACT_INFO_SHARES,
NULL AS VIDEO_COMPLETIONS,
NULL AS VIRAL_EXTERNAL_WEBSITE_POST_CLICK_CONVERSIONS,
NULL AS VIRAL_FULL_SCREEN_PLAYS,
NULL AS VIRAL_SHARES,
NULL AS AD_UNIT_CLICKS,
NULL AS VIRAL_CARD_CLICKS,
NULL AS EXTERNAL_WEBSITE_POST_CLICK_CONVERSIONS,
NULL AS VIRAL_IMPRESSIONS,
NULL AS EXTERNAL_WEBSITE_CONVERSIONS,
NULL AS CONVERSION_VALUE_IN_LOCAL_CURRENCY,
NULL AS VIRAL_VIDEO_FIRST_QUARTILE_COMPLETIONS,
NULL AS CAMPAIGN_ID,
NULL AS VIRAL_TOTAL_ENGAGEMENTS,
NULL AS OPENS,
NULL AS OTHER_ENGAGEMENTS,
NULL AS VIRAL_VIDEO_VIEWS,
NULL AS CARD_IMPRESSIONS,
NULL AS CLICKS,
NULL AS VIRAL_COMMENTS,
NULL AS COMMENTS,
NULL AS TEXT_URL_CLICKS,
NULL AS TOTAL_ENGAGEMENTS,
NULL AS VIDEO_MIDPOINT_COMPLETIONS,
NULL AS VIRAL_EXTERNAL_WEBSITE_POST_VIEW_CONVERSIONS,
NULL AS ACTION_CLICKS,
NULL AS EXTERNAL_WEBSITE_POST_VIEW_CONVERSIONS,
NULL AS VIRAL_FOLLOWS,
NULL AS VIRAL_OTHER_ENGAGEMENTS,
NULL AS COST_IN_USD,
NULL AS DAY,
NULL AS VIRAL_ONE_CLICK_LEAD_FORM_OPENS,
NULL AS VIDEO_STARTS,
NULL AS VIRAL_LIKES,
NULL AS VIDEO_THIRD_QUARTILE_COMPLETIONS,
NULL AS VIRAL_LANDING_PAGE_CLICKS,
NULL AS COMMENT_LIKES,
NULL AS COMPANY_PAGE_CLICKS,
NULL AS IMPRESSIONS,
NULL AS COST_IN_LOCAL_CURRENCY,
NULL AS FOLLOWS,
NULL AS LEAD_GENERATION_MAIL_INTERESTED_CLICKS,
NULL AS VIRAL_CARD_IMPRESSIONS,
NULL AS SHARES,
NULL AS VIRAL_VIDEO_STARTS,
NULL AS ONE_CLICK_LEAD_FORM_OPENS,
NULL AS LANDING_PAGE_CLICKS,
NULL AS VIRAL_VIDEO_COMPLETIONS,
NULL AS CARD_CLICKS,
NULL AS VIRAL_COMPANY_PAGE_CLICKS,
NULL AS VIRAL_VIDEO_MIDPOINT_COMPLETIONS,
NULL AS FULL_SCREEN_PLAYS,
NULL AS VIDEO_FIRST_QUARTILE_COMPLETIONS,
NULL AS VIRAL_VIDEO_THIRD_QUARTILE_COMPLETIONS,
NULL AS VIDEO_VIEWS,
NULL AS VIRAL_CLICKS,
NULL AS VIRAL_COMMENT_LIKES,
NULL AS APPROXIMATE_UNIQUE_IMPRESSIONS,
NULL AS VIRAL_EXTERNAL_WEBSITE_CONVERSIONS,
NULL AS VIRAL_ONE_CLICK_LEADS,
NULL AS LIKES,
NULL AS ONE_CLICK_LEADS,

        '{{ schema_nm }}' as Source_type,
        'D_BASIC_AD_ACTIONS_STG_LOAD' AS DW_SESSION_NM,
        {{ dbt_utils.current_timestamp() }} AS DW_INS_UPD_DTS 
    FROM dual     

    {% endif %}
{% endfor %}