2020-12-01 19:27:58.653072 (MainThread): Done resetting log handlers.
2020-12-01 19:27:58.653112 (MainThread): Received response from rpc task.
2020-12-01 19:27:58.653139 (MainThread): Updating status to Paused
2020-12-01 19:28:48.568516 (MainThread): Caught sighup
2020-12-01 19:28:48.707756 (MainThread): Updating status to Ready
2020-12-01 19:28:48.708875 (MainThread): ignoring not number metric _dd1.sr.eausr:None, 59 additional messages skipped
2020-12-01 19:28:48.709757 (MainThread): writing 2 spans (enabled:True), 35 additional messages skipped
2020-12-01 19:28:48.709849 (MainThread): 
      name postgres.query
        id 4354801820486737540
  trace_id 14380734752318403748
 parent_id None
   service defaultdb
  resource SELECT "develop_request"."id", "develop_request"."user_id", "develop_request"."status", "develop_request"."environment_id", "develop_request"."project_id", "develop_request"."account_id", "develop_request"."status_message", "develop_request"."dbt_version", "develop_request"."container_version", "develop_request"."created_at", "develop_request"."updated_at", "develop_request"."last_request_at", "develop_request"."environment_setup_started_at", "develop_request"."profile_setup_started_at", "develop_request"."deps_setup_started_at", "develop_request"."running_at", "develop_request"."ready_at", "develop_request"."stopping_at", "develop_request"."stopped_at" FROM "develop_request" WHERE "develop_request"."id" = %s FOR UPDATE
      type sql
     start 1606850928.708677
       end 1606850928.7096741
  duration 0.000997s
     error 0
      tags 
           django.db.alias:default
           django.db.vendor:postgresql
           runtime-id:effd176b76e4423c802d73d161102125, 65 additional messages skipped
2020-12-01 19:28:48.718145 (MainThread): Kicking off rpc task.
2020-12-01 19:28:48.718204 (MainThread): dbt client called with ['--partial-parse', 'rpc', '--profile', 'user']
2020-12-01 19:28:48.720277 (MainThread): Setting up log handlers...
2020-12-01 19:28:48.734065 (MainThread): Running with dbt=0.18.1
2020-12-01 19:28:48.859251 (MainThread): reported 15 traces in 0.01347s, 2 additional messages skipped
2020-12-01 19:28:48.861124 (MainThread): initialized RateSampler, sample 100% of traces, 107 additional messages skipped
2020-12-01 19:28:48.974990 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.rpc.server.RPCServerTask'>, debug=False, defer=None, exclude=None, host='0.0.0.0', log_cache_events=False, log_format='default', models=None, partial_parse=True, port=8580, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='rpc', write_json=True)
2020-12-01 19:28:49.014053 (Thread-1): Parsing macros/adapters.sql
2020-12-01 19:28:49.026697 (MainThread): Tracking: tracking
2020-12-01 19:28:49.027029 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafae57a080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafae57a390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafb7489668>]}
2020-12-01 19:28:49.027525 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=13
2020-12-01 19:28:49.038377 (MainThread): Supported methods: ['cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'status', 'test']
2020-12-01 19:28:49.039033 (MainThread): Send requests to http://localhost:8580/jsonrpc
2020-12-01 19:28:49.058355 (Thread-1): Parsing macros/catalog.sql
2020-12-01 19:28:49.060775 (Thread-1): Parsing macros/materializations/table.sql
2020-12-01 19:28:49.065066 (Thread-1): Parsing macros/materializations/merge.sql
2020-12-01 19:28:49.067296 (Thread-1): Parsing macros/materializations/view.sql
2020-12-01 19:28:49.068983 (Thread-1): Parsing macros/materializations/incremental.sql
2020-12-01 19:28:49.080601 (Thread-1): Parsing macros/core.sql
2020-12-01 19:28:49.084675 (Thread-1): Parsing macros/adapters/common.sql
2020-12-01 19:28:49.131420 (Thread-1): Parsing macros/materializations/helpers.sql
2020-12-01 19:28:49.132339 (Thread-2): handling status request
2020-12-01 19:28:49.142838 (Thread-2): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafae529320>]}
2020-12-01 19:28:49.145186 (Thread-2): sending response (<Response 184 bytes [200 OK]>) to 10.0.46.83
2020-12-01 19:28:49.146054 (Thread-1): Parsing macros/materializations/table/table.sql
2020-12-01 19:28:49.154145 (Thread-1): Parsing macros/materializations/seed/seed.sql
2020-12-01 19:28:49.179125 (Thread-1): Parsing macros/materializations/view/view.sql
2020-12-01 19:28:49.186105 (Thread-1): Parsing macros/materializations/view/create_or_replace_view.sql
2020-12-01 19:28:49.191714 (Thread-1): Parsing macros/materializations/incremental/helpers.sql
2020-12-01 19:28:49.193785 (Thread-1): Parsing macros/materializations/incremental/incremental.sql
2020-12-01 19:28:49.200555 (Thread-1): Parsing macros/materializations/common/merge.sql
2020-12-01 19:28:49.215870 (Thread-1): Parsing macros/materializations/snapshot/strategies.sql
2020-12-01 19:28:49.234555 (Thread-1): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-12-01 19:28:49.236599 (Thread-1): Parsing macros/materializations/snapshot/snapshot.sql
2020-12-01 19:28:49.266708 (Thread-1): Parsing macros/schema_tests/relationships.sql
2020-12-01 19:28:49.268960 (Thread-1): Parsing macros/schema_tests/not_null.sql
2020-12-01 19:28:49.270690 (Thread-1): Parsing macros/schema_tests/unique.sql
2020-12-01 19:28:49.272617 (Thread-1): Parsing macros/schema_tests/accepted_values.sql
2020-12-01 19:28:49.275689 (Thread-1): Parsing macros/etc/get_custom_database.sql
2020-12-01 19:28:49.278123 (Thread-1): Parsing macros/etc/query.sql
2020-12-01 19:28:49.279678 (Thread-1): Parsing macros/etc/datetime.sql
2020-12-01 19:28:49.290995 (Thread-1): Parsing macros/etc/get_custom_alias.sql
2020-12-01 19:28:49.292199 (Thread-1): Parsing macros/etc/is_incremental.sql
2020-12-01 19:28:49.294028 (Thread-1): Parsing macros/etc/get_custom_schema.sql
2020-12-01 19:28:49.482629 (Thread-1): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 5 unused configuration paths:
- models.sales_dataflo.sources
- models.sales_dataflo.utils
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-01 19:28:50.760767 (Thread-3): handling status request
2020-12-01 19:28:50.761299 (Thread-3): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafae52ff28>]}
2020-12-01 19:28:50.765368 (Thread-3): sending response (<Response 8626 bytes [200 OK]>) to 10.0.0.33
2020-12-01 19:29:29.841336 (MainThread): writing 1 spans (enabled:True), 40 additional messages skipped
2020-12-01 19:29:29.843475 (MainThread): 
      name jinja2.compile
        id 930718444618762044
  trace_id 14943530180692338813
 parent_id None
   service None
  resource <memory>
      type template
     start 1606850969.840595
       end 1606850969.841143
  duration 0.000548s
     error 0
      tags 
           jinja2.template_name:<memory>
           runtime-id:effd176b76e4423c802d73d161102125, 45 additional messages skipped
2020-12-01 19:29:29.890947 (AgentWriter): reported 29 traces in 0.01343s, 1 additional messages skipped
2020-12-01 19:29:29.891333 (AgentWriter): initialized RateSampler, sample 100% of traces, 71 additional messages skipped
2020-12-01 19:29:29.956312 (Thread-4): Got an acceptable cached parse result
2020-12-01 19:29:30.174456 (Thread-4): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 5 unused configuration paths:
- models.sales_dataflo.sources
- models.sales_dataflo.utils
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-01 19:29:30.649480 (Thread-5): handling status request
2020-12-01 19:29:30.650004 (Thread-5): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafac3470b8>]}
2020-12-01 19:29:30.651228 (Thread-5): sending response (<Response 1006 bytes [200 OK]>) to 10.0.0.33
2020-12-01 19:30:01.444004 (MainThread): writing 1 spans (enabled:True), 34 additional messages skipped
2020-12-01 19:30:01.445718 (MainThread): 
      name jinja2.compile
        id 7332160024367895183
  trace_id 7735522505568914666
 parent_id None
   service None
  resource <memory>
      type template
     start 1606851001.443288
       end 1606851001.443845
  duration 0.000557s
     error 0
      tags 
           jinja2.template_name:<memory>
           runtime-id:effd176b76e4423c802d73d161102125, 34 additional messages skipped
2020-12-01 19:30:01.536169 (Thread-6): Got an acceptable cached parse result
2020-12-01 19:30:01.873076 (Thread-6): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 5 unused configuration paths:
- models.sales_dataflo.sources
- models.sales_dataflo.utils
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-01 19:30:01.908408 (AgentWriter): reported 35 traces in 0.00371s, 1 additional messages skipped
2020-12-01 19:30:01.908662 (AgentWriter): initialized RateSampler, sample 100% of traces, 71 additional messages skipped
2020-12-01 19:30:01.984747 (Thread-7): handling status request
2020-12-01 19:30:01.985254 (Thread-7): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafac2c3d68>]}
2020-12-01 19:30:01.986493 (Thread-7): sending response (<Response 1006 bytes [200 OK]>) to 10.0.32.89
2020-12-01 19:30:40.814854 (Thread-8): Got an acceptable cached parse result
2020-12-01 19:30:41.036753 (Thread-8): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 5 unused configuration paths:
- models.sales_dataflo.sources
- models.sales_dataflo.utils
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-01 19:30:41.464246 (Thread-9): handling status request
2020-12-01 19:30:41.464760 (Thread-9): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafae526be0>]}
2020-12-01 19:30:41.465833 (Thread-9): sending response (<Response 1006 bytes [200 OK]>) to 10.0.0.33
2020-12-01 19:31:37.067952 (MainThread): writing 1 spans (enabled:True), 69 additional messages skipped
2020-12-01 19:31:37.069612 (MainThread): 
      name jinja2.compile
        id 15729929225509464032
  trace_id 9107864195970620825
 parent_id None
   service None
  resource <memory>
      type template
     start 1606851097.067204
       end 1606851097.067786
  duration 0.000582s
     error 0
      tags 
           jinja2.template_name:<memory>
           runtime-id:effd176b76e4423c802d73d161102125, 69 additional messages skipped
2020-12-01 19:31:37.178626 (Thread-10): Got an acceptable cached parse result
2020-12-01 19:31:37.399763 (Thread-10): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 5 unused configuration paths:
- models.sales_dataflo.sources
- models.sales_dataflo.utils
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-01 19:31:37.757571 (Thread-11): handling status request
2020-12-01 19:31:37.758108 (Thread-11): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafac24b4e0>]}
2020-12-01 19:31:37.759446 (Thread-11): sending response (<Response 1008 bytes [200 OK]>) to 10.0.32.89
2020-12-01 19:31:37.945098 (AgentWriter): reported 35 traces in 0.00433s, 1 additional messages skipped
2020-12-01 19:31:37.945350 (AgentWriter): initialized RateSampler, sample 100% of traces, 71 additional messages skipped
2020-12-01 19:32:09.659863 (MainThread): writing 1 spans (enabled:True), 34 additional messages skipped
2020-12-01 19:32:09.660077 (MainThread): 
      name jinja2.compile
        id 1557040572398816810
  trace_id 2149106761442553000
 parent_id None
   service None
  resource <memory>
      type template
     start 1606851129.65914
       end 1606851129.659702
  duration 0.000562s
     error 0
      tags 
           jinja2.template_name:<memory>
           runtime-id:effd176b76e4423c802d73d161102125, 34 additional messages skipped
2020-12-01 19:32:09.750917 (Thread-12): Got an acceptable cached parse result
2020-12-01 19:32:09.960897 (Thread-12): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 5 unused configuration paths:
- models.sales_dataflo.sources
- models.sales_dataflo.utils
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-01 19:32:09.962275 (AgentWriter): reported 35 traces in 0.00749s
2020-12-01 19:32:09.962513 (AgentWriter): initialized RateSampler, sample 100% of traces, 35 additional messages skipped
2020-12-01 19:32:10.270827 (Thread-13): handling status request
2020-12-01 19:32:10.271449 (Thread-13): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafac24e1d0>]}
2020-12-01 19:32:10.272558 (Thread-13): sending response (<Response 1008 bytes [200 OK]>) to 10.0.13.243
2020-12-01 19:35:57.981419 (MainThread): writing 1 spans (enabled:True), 34 additional messages skipped
2020-12-01 19:35:57.983001 (MainThread): 
      name jinja2.compile
        id 11351918738814580801
  trace_id 11258930085214455674
 parent_id None
   service None
  resource <memory>
      type template
     start 1606851357.980704
       end 1606851357.981255
  duration 0.000551s
     error 0
      tags 
           jinja2.template_name:<memory>
           runtime-id:effd176b76e4423c802d73d161102125, 34 additional messages skipped
2020-12-01 19:35:57.996232 (AgentWriter): reported 9 traces in 0.00441s
2020-12-01 19:35:58.006770 (AgentWriter): initialized RateSampler, sample 100% of traces, 35 additional messages skipped
2020-12-01 19:35:58.074809 (Thread-14): Got an acceptable cached parse result
2020-12-01 19:35:58.306367 (Thread-14): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 5 unused configuration paths:
- models.sales_dataflo.sources
- models.sales_dataflo.utils
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-01 19:35:59.478549 (Thread-15): handling status request
2020-12-01 19:35:59.479052 (Thread-15): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafae4f8710>]}
2020-12-01 19:35:59.480239 (Thread-15): sending response (<Response 1008 bytes [200 OK]>) to 10.0.33.229
2020-12-01 19:36:40.620995 (MainThread): writing 1 spans (enabled:True), 34 additional messages skipped
2020-12-01 19:36:40.621213 (MainThread): 
      name jinja2.compile
        id 6911917737352698955
  trace_id 4686613698933055477
 parent_id None
   service None
  resource <memory>
      type template
     start 1606851400.620237
       end 1606851400.620814
  duration 0.000577s
     error 0
      tags 
           jinja2.template_name:<memory>
           runtime-id:effd176b76e4423c802d73d161102125, 34 additional messages skipped
2020-12-01 19:36:40.711568 (Thread-16): Got an acceptable cached parse result
2020-12-01 19:36:40.880566 (Thread-16): Acquiring new snowflake connection "model.sales_dataflo.stg_sf_opportunity".
2020-12-01 19:36:41.032496 (AgentWriter): reported 39 traces in 0.00446s, 1 additional messages skipped
2020-12-01 19:36:41.032750 (AgentWriter): initialized RateSampler, sample 100% of traces, 71 additional messages skipped
2020-12-01 19:36:41.076279 (Thread-16): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 4 unused configuration paths:
- models.sales_dataflo.utils
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-01 19:36:41.399060 (Thread-17): handling status request
2020-12-01 19:36:41.399592 (Thread-17): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafae4e1710>]}
2020-12-01 19:36:41.400803 (Thread-17): sending response (<Response 1285 bytes [200 OK]>) to 10.0.3.206
2020-12-01 19:37:15.267257 (MainThread): writing 1 spans (enabled:True), 38 additional messages skipped
2020-12-01 19:37:15.267503 (MainThread): 
      name jinja2.compile
        id 5719334915567732222
  trace_id 6595321459047390654
 parent_id None
   service None
  resource <memory>
      type template
     start 1606851435.266523
       end 1606851435.267062
  duration 0.000539s
     error 0
      tags 
           jinja2.template_name:<memory>
           runtime-id:effd176b76e4423c802d73d161102125, 38 additional messages skipped
2020-12-01 19:37:15.302525 (MainThread): Connection 'model.sales_dataflo.stg_sf_opportunity' was properly closed.
2020-12-01 19:37:15.360037 (Thread-18): Got an acceptable cached parse result
2020-12-01 19:37:15.406182 (Thread-18): Acquiring new snowflake connection "model.sales_dataflo.stg_sf_opportunity".
2020-12-01 19:37:15.597947 (Thread-18): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 4 unused configuration paths:
- models.sales_dataflo.utils
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-01 19:37:15.798229 (Thread-19): handling status request
2020-12-01 19:37:15.798826 (Thread-19): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf9ff51940>]}
2020-12-01 19:37:15.800049 (Thread-19): sending response (<Response 1285 bytes [200 OK]>) to 10.0.13.243
2020-12-01 19:37:16.042145 (AgentWriter): reported 37 traces in 0.00458s
2020-12-01 19:37:16.042486 (AgentWriter): initialized RateSampler, sample 100% of traces, 35 additional messages skipped
2020-12-01 19:44:34.067185 (MainThread): writing 1 spans (enabled:True), 36 additional messages skipped
2020-12-01 19:44:34.068907 (MainThread): 
      name jinja2.compile
        id 13296402122252250689
  trace_id 4873118763189855971
 parent_id None
   service None
  resource <memory>
      type template
     start 1606851874.0664341
       end 1606851874.0670002
  duration 0.000566s
     error 0
      tags 
           jinja2.template_name:<memory>
           runtime-id:effd176b76e4423c802d73d161102125, 36 additional messages skipped
2020-12-01 19:44:34.104605 (MainThread): Connection 'model.sales_dataflo.stg_sf_opportunity' was properly closed.
2020-12-01 19:44:34.107421 (AgentWriter): reported 29 traces in 0.00753s
2020-12-01 19:44:34.108792 (AgentWriter): initialized RateSampler, sample 100% of traces, 35 additional messages skipped
2020-12-01 19:44:34.145130 (Thread-20): For key sales_dataflo, hash mismatch (FileHash(name='sha256', checksum='d0e9e3d3548a240cfa5689df23bd17a37a1ce26bf7a4cef08b4fec324471c8c6') -> FileHash(name='sha256', checksum='f069788450fdb0b15f11db2385aea1a6fb099c460068410e9fd4e1f6c8fea9bf')), cache invalidated
2020-12-01 19:44:34.147456 (Thread-20): Parsing macros/adapters.sql
2020-12-01 19:44:34.179399 (Thread-20): Parsing macros/catalog.sql
2020-12-01 19:44:34.181699 (Thread-20): Parsing macros/materializations/table.sql
2020-12-01 19:44:34.186104 (Thread-20): Parsing macros/materializations/merge.sql
2020-12-01 19:44:34.188394 (Thread-20): Parsing macros/materializations/view.sql
2020-12-01 19:44:34.190064 (Thread-20): Parsing macros/materializations/incremental.sql
2020-12-01 19:44:34.201285 (Thread-20): Parsing macros/core.sql
2020-12-01 19:44:34.205632 (Thread-20): Parsing macros/adapters/common.sql
2020-12-01 19:44:34.252303 (Thread-20): Parsing macros/materializations/helpers.sql
2020-12-01 19:44:34.262119 (Thread-20): Parsing macros/materializations/table/table.sql
2020-12-01 19:44:34.269947 (Thread-20): Parsing macros/materializations/seed/seed.sql
2020-12-01 19:44:34.292131 (Thread-20): Parsing macros/materializations/view/view.sql
2020-12-01 19:44:34.298889 (Thread-20): Parsing macros/materializations/view/create_or_replace_view.sql
2020-12-01 19:44:34.304311 (Thread-20): Parsing macros/materializations/incremental/helpers.sql
2020-12-01 19:44:34.306400 (Thread-20): Parsing macros/materializations/incremental/incremental.sql
2020-12-01 19:44:34.313190 (Thread-20): Parsing macros/materializations/common/merge.sql
2020-12-01 19:44:34.328139 (Thread-20): Parsing macros/materializations/snapshot/strategies.sql
2020-12-01 19:44:34.346009 (Thread-20): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-12-01 19:44:34.348200 (Thread-20): Parsing macros/materializations/snapshot/snapshot.sql
2020-12-01 19:44:34.378539 (Thread-20): Parsing macros/schema_tests/relationships.sql
2020-12-01 19:44:34.380811 (Thread-20): Parsing macros/schema_tests/not_null.sql
2020-12-01 19:44:34.382574 (Thread-20): Parsing macros/schema_tests/unique.sql
2020-12-01 19:44:34.384490 (Thread-20): Parsing macros/schema_tests/accepted_values.sql
2020-12-01 19:44:34.387451 (Thread-20): Parsing macros/etc/get_custom_database.sql
2020-12-01 19:44:34.389311 (Thread-20): Parsing macros/etc/query.sql
2020-12-01 19:44:34.390486 (Thread-20): Parsing macros/etc/datetime.sql
2020-12-01 19:44:34.400168 (Thread-20): Parsing macros/etc/get_custom_alias.sql
2020-12-01 19:44:34.401275 (Thread-20): Parsing macros/etc/is_incremental.sql
2020-12-01 19:44:34.403049 (Thread-20): Parsing macros/etc/get_custom_schema.sql
2020-12-01 19:44:34.421280 (Thread-20): For key sales_dataflo, hash mismatch (FileHash(name='sha256', checksum='d0e9e3d3548a240cfa5689df23bd17a37a1ce26bf7a4cef08b4fec324471c8c6') -> FileHash(name='sha256', checksum='f069788450fdb0b15f11db2385aea1a6fb099c460068410e9fd4e1f6c8fea9bf')), cache invalidated
2020-12-01 19:44:34.470236 (Thread-20): Acquiring new snowflake connection "model.sales_dataflo.stg_sf_opportunity".
2020-12-01 19:44:34.696997 (Thread-20): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 4 unused configuration paths:
- models.sales_dataflo.utils
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-01 19:44:35.568119 (Thread-21): handling status request
2020-12-01 19:44:35.568667 (Thread-21): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafac20af28>]}
2020-12-01 19:44:35.572898 (Thread-21): sending response (<Response 9940 bytes [200 OK]>) to 10.0.46.83
2020-12-01 19:44:38.495472 (MainThread): Connection 'model.sales_dataflo.stg_sf_opportunity' was properly closed.
2020-12-01 19:44:38.554054 (Thread-22): Got an acceptable cached parse result
2020-12-01 19:44:38.763890 (Thread-22): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 4 unused configuration paths:
- models.sales_dataflo.utils
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-01 19:44:39.154096 (Thread-23): handling status request
2020-12-01 19:44:39.154648 (Thread-23): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf9feb9668>]}
2020-12-01 19:44:39.155771 (Thread-23): sending response (<Response 976 bytes [200 OK]>) to 10.0.23.23
2020-12-01 19:45:33.317962 (MainThread): writing 1 spans (enabled:True), 71 additional messages skipped
2020-12-01 19:45:33.318187 (MainThread): 
      name jinja2.compile
        id 14011775794017890506
  trace_id 4984977436730754560
 parent_id None
   service None
  resource <memory>
      type template
     start 1606851933.3172328
       end 1606851933.3177779
  duration 0.000545s
     error 0
      tags 
           jinja2.template_name:<memory>
           runtime-id:effd176b76e4423c802d73d161102125, 71 additional messages skipped
2020-12-01 19:45:33.408243 (Thread-24): Got an acceptable cached parse result
2020-12-01 19:45:33.454138 (Thread-24): Acquiring new snowflake connection "model.sales_dataflo.stg_sf_opportunity".
2020-12-01 19:45:33.770720 (Thread-24): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 4 unused configuration paths:
- models.sales_dataflo.utils
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-01 19:45:33.902819 (Thread-25): handling status request
2020-12-01 19:45:33.903539 (Thread-25): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafac3aa0b8>]}
2020-12-01 19:45:33.905236 (Thread-25): sending response (<Response 1285 bytes [200 OK]>) to 10.0.32.89
2020-12-01 19:45:34.137703 (AgentWriter): reported 37 traces in 0.00494s, 2 additional messages skipped
2020-12-01 19:45:34.137948 (AgentWriter): initialized RateSampler, sample 100% of traces, 107 additional messages skipped
2020-12-01 19:45:56.493512 (MainThread): Connection 'model.sales_dataflo.stg_sf_opportunity' was properly closed.
2020-12-01 19:45:56.562832 (Thread-26): Got an acceptable cached parse result
2020-12-01 19:45:56.782650 (Thread-26): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 4 unused configuration paths:
- models.sales_dataflo.utils
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-01 19:45:57.011090 (Thread-27): handling status request
2020-12-01 19:45:57.011856 (Thread-27): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafcbbebd30>]}
2020-12-01 19:45:57.013461 (Thread-27): sending response (<Response 976 bytes [200 OK]>) to 10.0.37.169
2020-12-01 19:46:06.933965 (Thread-28): handling status request
2020-12-01 19:46:06.934482 (Thread-28): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafcbbf4128>]}
2020-12-01 19:46:06.935544 (Thread-28): sending response (<Response 976 bytes [200 OK]>) to 10.0.23.23
2020-12-01 19:46:06.937723 (Thread-29): handling status request
2020-12-01 19:46:06.938075 (Thread-29): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafae56f4a8>]}
2020-12-01 19:46:06.938978 (Thread-29): sending response (<Response 976 bytes [200 OK]>) to 10.0.0.33
2020-12-01 19:46:07.500714 (Thread-30): handling deps request
2020-12-01 19:46:07.501231 (Thread-30): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafac3204e0>]}
2020-12-01 19:46:07.516618 (Thread-30): writing 1 spans (enabled:True), 75 additional messages skipped
2020-12-01 19:46:07.516933 (Thread-30): 
      name jinja2.compile
        id 32217320854292451
  trace_id 9452705692850829066
 parent_id None
   service None
  resource <memory>
      type template
     start 1606851967.515886
       end 1606851967.51641
  duration 0.000524s
     error 0
      tags 
           jinja2.template_name:<memory>
           runtime-id:effd176b76e4423c802d73d161102125, 75 additional messages skipped
2020-12-01 19:46:07.630502 (Thread-30): sending response (<Response 137 bytes [200 OK]>) to 10.0.33.129
2020-12-01 19:46:08.152600 (AgentWriter): reported 33 traces in 0.00521s, 1 additional messages skipped
2020-12-01 19:46:08.152983 (AgentWriter): initialized RateSampler, sample 100% of traces, 71 additional messages skipped
2020-12-01 19:46:08.173587 (Thread-31): handling poll request
2020-12-01 19:46:08.174217 (Thread-31): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafb74aee48>]}
2020-12-01 19:46:08.178219 (Thread-31): Checking header 'user-agent' tracing in whitelist set(), 44 additional messages skipped
2020-12-01 19:46:08.321615 (Thread-31): sending response (<Response 285 bytes [200 OK]>) to 10.0.23.23
2020-12-01 19:46:08.879792 (MainThread): Set downloads directory='/tmp/dbt-downloads-m__xgp9h'
2020-12-01 19:46:08.884730 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/index.json
2020-12-01 19:46:09.015948 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/index.json 200
2020-12-01 19:46:09.016662 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json
2020-12-01 19:46:09.059862 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json 200
2020-12-01 19:46:09.074817 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils/0.6.2.json
2020-12-01 19:46:09.121752 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils/0.6.2.json 200
2020-12-01 19:46:09.127532 (MainThread): Executing "git clone --depth 1 https://github.com/calogica/dbt-date.git 06ab8684953e1cb64a1b0912f6b386ba"
2020-12-01 19:46:09.433395 (MainThread): STDOUT: "b''"
2020-12-01 19:46:09.433675 (MainThread): STDERR: "b"Cloning into '06ab8684953e1cb64a1b0912f6b386ba'...\n""
2020-12-01 19:46:09.434060 (MainThread): Pulling new dependency 06ab8684953e1cb64a1b0912f6b386ba.
2020-12-01 19:46:09.434162 (MainThread): Executing "git rev-parse HEAD"
2020-12-01 19:46:09.441441 (MainThread): STDOUT: "b'62396e983be55ecad46259c97a816ba90be8b68f\n'"
2020-12-01 19:46:09.441711 (MainThread): STDERR: "b''"
2020-12-01 19:46:09.441804 (MainThread):   Checking out branch 0.2.1.
2020-12-01 19:46:09.441863 (MainThread): Executing "git remote set-branches origin 0.2.1"
2020-12-01 19:46:09.449291 (MainThread): STDOUT: "b''"
2020-12-01 19:46:09.449508 (MainThread): STDERR: "b''"
2020-12-01 19:46:09.449604 (MainThread): Executing "git fetch --tags --depth 1 origin 0.2.1"
2020-12-01 19:46:09.740848 (MainThread): STDOUT: "b''"
2020-12-01 19:46:09.741093 (MainThread): STDERR: "b'From https://github.com/calogica/dbt-date\n * tag               0.2.1      -> FETCH_HEAD\n * [new tag]         0.1        -> 0.1\n * [new tag]         0.1.1      -> 0.1.1\n * [new tag]         0.1.2      -> 0.1.2\n * [new tag]         0.1.3      -> 0.1.3\n * [new tag]         0.1.4      -> 0.1.4\n * [new tag]         0.2.0      -> 0.2.0\n * [new tag]         0.2.1      -> 0.2.1\n * [new tag]         v0.1.1     -> v0.1.1\n'"
2020-12-01 19:46:09.741184 (MainThread): Executing "git tag --list"
2020-12-01 19:46:09.746881 (MainThread): STDOUT: "b'0.1\n0.1.1\n0.1.2\n0.1.3\n0.1.4\n0.2.0\n0.2.1\n0.2.2\nv0.1.1\n'"
2020-12-01 19:46:09.747210 (MainThread): STDERR: "b''"
2020-12-01 19:46:09.747372 (MainThread): Executing "git reset --hard tags/0.2.1"
2020-12-01 19:46:09.756736 (MainThread): STDOUT: "b'HEAD is now at 5f24102 Merge pull request #6 from calogica/feature/add-dynamic-date-support-to-get_base_dates\n'"
2020-12-01 19:46:09.757017 (MainThread): STDERR: "b''"
2020-12-01 19:46:09.757127 (MainThread): Executing "git rev-parse HEAD"
2020-12-01 19:46:09.763200 (MainThread): STDOUT: "b'5f24102cde7f163ca0548bd5da5473ac186c036c\n'"
2020-12-01 19:46:09.763493 (MainThread): STDERR: "b''"
2020-12-01 19:46:09.763586 (MainThread):   Checked out at 5f24102.
2020-12-01 19:46:09.807356 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json
2020-12-01 19:46:09.860962 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json 200
2020-12-01 19:46:09.875562 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils/0.6.2.json
2020-12-01 19:46:09.920200 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils/0.6.2.json 200
2020-12-01 19:46:09.921847 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json
2020-12-01 19:46:09.971028 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json 200
2020-12-01 19:46:09.980674 (Thread-32): handling poll request
2020-12-01 19:46:09.981406 (Thread-32): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafb7805048>]}
2020-12-01 19:46:09.987343 (Thread-32): sending response (<Response 11563 bytes [200 OK]>) to 10.0.23.19
2020-12-01 19:46:09.986692 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils/0.6.2.json
2020-12-01 19:46:10.031040 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils/0.6.2.json 200
2020-12-01 19:46:10.031889 (MainThread): Executing "git clone --depth 1 https://github.com/calogica/dbt-date.git 06ab8684953e1cb64a1b0912f6b386ba"
2020-12-01 19:46:10.037243 (MainThread): STDOUT: "b''"
2020-12-01 19:46:10.037493 (MainThread): STDERR: "b"fatal: destination path '06ab8684953e1cb64a1b0912f6b386ba' already exists and is not an empty directory.\n""
2020-12-01 19:46:10.037550 (MainThread): command return code=128
2020-12-01 19:46:10.037997 (MainThread): Updating existing dependency 06ab8684953e1cb64a1b0912f6b386ba.
2020-12-01 19:46:10.038086 (MainThread): Executing "git rev-parse HEAD"
2020-12-01 19:46:10.043544 (MainThread): STDOUT: "b'5f24102cde7f163ca0548bd5da5473ac186c036c\n'"
2020-12-01 19:46:10.043794 (MainThread): STDERR: "b''"
2020-12-01 19:46:10.043887 (MainThread):   Checking out branch 0.2.1.
2020-12-01 19:46:10.043943 (MainThread): Executing "git remote set-branches origin 0.2.1"
2020-12-01 19:46:10.050418 (MainThread): STDOUT: "b''"
2020-12-01 19:46:10.050751 (MainThread): STDERR: "b''"
2020-12-01 19:46:10.050880 (MainThread): Executing "git fetch --tags --depth 1 origin 0.2.1"
2020-12-01 19:46:10.319638 (MainThread): STDOUT: "b''"
2020-12-01 19:46:10.319914 (MainThread): STDERR: "b'From https://github.com/calogica/dbt-date\n * tag               0.2.1      -> FETCH_HEAD\n'"
2020-12-01 19:46:10.320001 (MainThread): Executing "git tag --list"
2020-12-01 19:46:10.325932 (MainThread): STDOUT: "b'0.1\n0.1.1\n0.1.2\n0.1.3\n0.1.4\n0.2.0\n0.2.1\n0.2.2\nv0.1.1\n'"
2020-12-01 19:46:10.326184 (MainThread): STDERR: "b''"
2020-12-01 19:46:10.326274 (MainThread): Executing "git reset --hard tags/0.2.1"
2020-12-01 19:46:10.334307 (MainThread): STDOUT: "b'HEAD is now at 5f24102 Merge pull request #6 from calogica/feature/add-dynamic-date-support-to-get_base_dates\n'"
2020-12-01 19:46:10.334559 (MainThread): STDERR: "b''"
2020-12-01 19:46:10.334652 (MainThread): Executing "git rev-parse HEAD"
2020-12-01 19:46:10.339354 (MainThread): STDOUT: "b'5f24102cde7f163ca0548bd5da5473ac186c036c\n'"
2020-12-01 19:46:10.339550 (MainThread): STDERR: "b''"
2020-12-01 19:46:10.339632 (MainThread):   Already at 5f24102, nothing to do.
2020-12-01 19:46:10.357641 (MainThread): Installing fishtown-analytics/dbt_utils@0.6.2
2020-12-01 19:46:11.893145 (Thread-33): handling poll request
2020-12-01 19:46:11.893653 (Thread-33): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafb7489c88>]}
2020-12-01 19:46:11.897643 (Thread-33): sending response (<Response 8258 bytes [200 OK]>) to 10.0.7.35
2020-12-01 19:46:13.636708 (Thread-34): handling poll request
2020-12-01 19:46:13.637234 (Thread-34): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafac2fd5c0>]}
2020-12-01 19:46:13.638254 (Thread-34): sending response (<Response 285 bytes [200 OK]>) to 10.0.0.33
2020-12-01 19:46:15.319793 (Thread-35): handling poll request
2020-12-01 19:46:15.320326 (Thread-35): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafac2fda58>]}
2020-12-01 19:46:15.321323 (Thread-35): sending response (<Response 285 bytes [200 OK]>) to 10.0.13.243
2020-12-01 19:46:16.644397 (MainThread):   Installed from version 0.6.2

2020-12-01 19:46:16.644650 (MainThread): Sending event: {'category': 'dbt', 'action': 'package', 'label': '6e969ae4-4e38-4836-9c88-818db6d3ba7d', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f95ae1694a8>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f95ada296a0>]}
2020-12-01 19:46:16.644915 (MainThread): Installing https://github.com/calogica/dbt-date.git@0.2.1
2020-12-01 19:46:16.646807 (MainThread): Executing "git clone --depth 1 https://github.com/calogica/dbt-date.git 06ab8684953e1cb64a1b0912f6b386ba"
2020-12-01 19:46:16.652743 (MainThread): STDOUT: "b''"
2020-12-01 19:46:16.653081 (MainThread): STDERR: "b"fatal: destination path '06ab8684953e1cb64a1b0912f6b386ba' already exists and is not an empty directory.\n""
2020-12-01 19:46:16.653174 (MainThread): command return code=128
2020-12-01 19:46:16.653374 (MainThread): Updating existing dependency 06ab8684953e1cb64a1b0912f6b386ba.
2020-12-01 19:46:16.653465 (MainThread): Executing "git rev-parse HEAD"
2020-12-01 19:46:16.659249 (MainThread): STDOUT: "b'5f24102cde7f163ca0548bd5da5473ac186c036c\n'"
2020-12-01 19:46:16.659546 (MainThread): STDERR: "b''"
2020-12-01 19:46:16.659659 (MainThread):   Checking out branch 0.2.1.
2020-12-01 19:46:16.659743 (MainThread): Executing "git remote set-branches origin 0.2.1"
2020-12-01 19:46:16.665476 (MainThread): STDOUT: "b''"
2020-12-01 19:46:16.665667 (MainThread): STDERR: "b''"
2020-12-01 19:46:16.665742 (MainThread): Executing "git fetch --tags --depth 1 origin 0.2.1"
2020-12-01 19:46:16.912696 (Thread-36): handling poll request
2020-12-01 19:46:16.913188 (Thread-36): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafac2fdcc0>]}
2020-12-01 19:46:16.915984 (Thread-36): sending response (<Response 5022 bytes [200 OK]>) to 10.0.18.40
2020-12-01 19:46:17.094390 (MainThread): STDOUT: "b''"
2020-12-01 19:46:17.094634 (MainThread): STDERR: "b'From https://github.com/calogica/dbt-date\n * tag               0.2.1      -> FETCH_HEAD\n'"
2020-12-01 19:46:17.094719 (MainThread): Executing "git tag --list"
2020-12-01 19:46:17.100554 (MainThread): STDOUT: "b'0.1\n0.1.1\n0.1.2\n0.1.3\n0.1.4\n0.2.0\n0.2.1\n0.2.2\nv0.1.1\n'"
2020-12-01 19:46:17.100805 (MainThread): STDERR: "b''"
2020-12-01 19:46:17.100896 (MainThread): Executing "git reset --hard tags/0.2.1"
2020-12-01 19:46:17.107842 (MainThread): STDOUT: "b'HEAD is now at 5f24102 Merge pull request #6 from calogica/feature/add-dynamic-date-support-to-get_base_dates\n'"
2020-12-01 19:46:17.108051 (MainThread): STDERR: "b''"
2020-12-01 19:46:17.108148 (MainThread): Executing "git rev-parse HEAD"
2020-12-01 19:46:17.113872 (MainThread): STDOUT: "b'5f24102cde7f163ca0548bd5da5473ac186c036c\n'"
2020-12-01 19:46:17.114123 (MainThread): STDERR: "b''"
2020-12-01 19:46:17.114211 (MainThread):   Already at 5f24102, nothing to do.
2020-12-01 19:46:18.608316 (Thread-37): handling poll request
2020-12-01 19:46:18.608812 (Thread-37): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafae4f7eb8>]}
2020-12-01 19:46:18.611071 (Thread-37): sending response (<Response 3667 bytes [200 OK]>) to 10.0.33.129
2020-12-01 19:46:20.435898 (Thread-38): handling poll request
2020-12-01 19:46:20.436417 (Thread-38): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafac1eb710>]}
2020-12-01 19:46:20.437501 (Thread-38): sending response (<Response 286 bytes [200 OK]>) to 10.0.0.33
2020-12-01 19:46:21.963619 (Thread-39): handling poll request
2020-12-01 19:46:21.964156 (Thread-39): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafac368240>]}
2020-12-01 19:46:21.965209 (Thread-39): sending response (<Response 286 bytes [200 OK]>) to 10.0.16.234
2020-12-01 19:46:22.830523 (MainThread):   Installed from revision 0.2.1

2020-12-01 19:46:22.830849 (MainThread): Sending event: {'category': 'dbt', 'action': 'package', 'label': '6e969ae4-4e38-4836-9c88-818db6d3ba7d', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f95ada29ac8>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f95ada29080>]}
2020-12-01 19:46:23.186678 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): project hash mismatch: values missing, cache invalidated: {'dbt_date', 'dbt_utils'}
2020-12-01 19:46:23.189049 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/adapters.sql
2020-12-01 19:46:23.220234 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/catalog.sql
2020-12-01 19:46:23.222482 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/materializations/table.sql
2020-12-01 19:46:23.226750 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/materializations/merge.sql
2020-12-01 19:46:23.228979 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/materializations/view.sql
2020-12-01 19:46:23.230597 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/materializations/incremental.sql
2020-12-01 19:46:23.241439 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/core.sql
2020-12-01 19:46:23.245471 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/adapters/common.sql
2020-12-01 19:46:23.290952 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/materializations/helpers.sql
2020-12-01 19:46:23.300969 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/materializations/table/table.sql
2020-12-01 19:46:23.308516 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/materializations/seed/seed.sql
2020-12-01 19:46:23.332273 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/materializations/view/view.sql
2020-12-01 19:46:23.340379 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/materializations/view/create_or_replace_view.sql
2020-12-01 19:46:23.345858 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/materializations/incremental/helpers.sql
2020-12-01 19:46:23.347963 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/materializations/incremental/incremental.sql
2020-12-01 19:46:23.354816 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/materializations/common/merge.sql
2020-12-01 19:46:23.369932 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/materializations/snapshot/strategies.sql
2020-12-01 19:46:23.387978 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-12-01 19:46:23.390016 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/materializations/snapshot/snapshot.sql
2020-12-01 19:46:23.420158 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/schema_tests/relationships.sql
2020-12-01 19:46:23.422460 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/schema_tests/not_null.sql
2020-12-01 19:46:23.424236 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/schema_tests/unique.sql
2020-12-01 19:46:23.426089 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/schema_tests/accepted_values.sql
2020-12-01 19:46:23.429003 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/etc/get_custom_database.sql
2020-12-01 19:46:23.430793 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/etc/query.sql
2020-12-01 19:46:23.431986 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/etc/datetime.sql
2020-12-01 19:46:23.442233 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/etc/get_custom_alias.sql
2020-12-01 19:46:23.443360 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/etc/is_incremental.sql
2020-12-01 19:46:23.445122 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/etc/get_custom_schema.sql
2020-12-01 19:46:23.497437 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/logger/pretty_time.sql
2020-12-01 19:46:23.503891 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/logger/log_info.sql
2020-12-01 19:46:23.510283 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/logger/pretty_log_format.sql
2020-12-01 19:46:23.516888 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/sql/pivot.sql
2020-12-01 19:46:23.527391 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/sql/star.sql
2020-12-01 19:46:23.538311 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/sql/surrogate_key.sql
2020-12-01 19:46:23.546718 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/sql/get_query_results_as_dict.sql
2020-12-01 19:46:23.553789 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/sql/get_column_values.sql
2020-12-01 19:46:23.563579 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/sql/groupby.sql
2020-12-01 19:46:23.570366 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/sql/get_tables_by_pattern_sql.sql
2020-12-01 19:46:23.582535 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/sql/nullcheck_table.sql
2020-12-01 19:46:23.589442 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/sql/get_tables_by_prefix_sql.sql
2020-12-01 19:46:23.596258 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/sql/get_relations_by_pattern.sql
2020-12-01 19:46:23.604977 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/sql/get_relations_by_prefix.sql
2020-12-01 19:46:23.613148 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/sql/safe_add.sql
2020-12-01 19:46:23.619661 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/sql/unpivot.sql
2020-12-01 19:46:23.632510 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/sql/generate_series.sql
2020-12-01 19:46:23.641443 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/sql/nullcheck.sql
2020-12-01 19:46:23.647716 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/sql/union.sql
2020-12-01 19:46:23.664827 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/materializations/insert_by_period_materialization.sql
2020-12-01 19:46:23.696886 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/web/get_url_parameter.sql
2020-12-01 19:46:23.702972 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/web/get_url_path.sql
2020-12-01 19:46:23.710625 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/web/get_url_host.sql
2020-12-01 19:46:23.717741 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/datetime/date_spine.sql
2020-12-01 19:46:23.728431 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/schema_tests/expression_is_true.sql
2020-12-01 19:46:23.734724 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/schema_tests/not_constant.sql
2020-12-01 19:46:23.741235 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/schema_tests/at_least_one.sql
2020-12-01 19:46:23.747314 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/schema_tests/equality.sql
2020-12-01 19:46:23.757135 (Thread-40): handling poll request
2020-12-01 19:46:23.757444 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/schema_tests/test_not_null_where.sql
2020-12-01 19:46:23.757917 (Thread-40): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf9ffa7a58>]}
2020-12-01 19:46:23.760864 (Thread-40): sending response (<Response 1095 bytes [200 OK]>) to 10.0.6.210
2020-12-01 19:46:23.764613 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/schema_tests/equal_rowcount.sql
2020-12-01 19:46:23.771435 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/schema_tests/test_unique_where.sql
2020-12-01 19:46:23.778561 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2020-12-01 19:46:23.791527 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/schema_tests/relationships_where.sql
2020-12-01 19:46:23.799200 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/schema_tests/unique_combination_of_columns.sql
2020-12-01 19:46:23.807934 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/schema_tests/recency.sql
2020-12-01 19:46:23.814679 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/schema_tests/cardinality_equality.sql
2020-12-01 19:46:23.822036 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/geo/haversine_distance.sql
2020-12-01 19:46:23.828612 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/cross_db_utils/split_part.sql
2020-12-01 19:46:23.836032 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/cross_db_utils/length.sql
2020-12-01 19:46:23.842414 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/cross_db_utils/current_timestamp.sql
2020-12-01 19:46:23.851730 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2020-12-01 19:46:23.859391 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/cross_db_utils/right.sql
2020-12-01 19:46:23.867599 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/cross_db_utils/hash.sql
2020-12-01 19:46:23.874845 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/cross_db_utils/replace.sql
2020-12-01 19:46:23.882740 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/cross_db_utils/concat.sql
2020-12-01 19:46:23.891522 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/cross_db_utils/_is_relation.sql
2020-12-01 19:46:23.898162 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/cross_db_utils/identifier.sql
2020-12-01 19:46:23.905634 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/cross_db_utils/datediff.sql
2020-12-01 19:46:23.922288 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/cross_db_utils/dateadd.sql
2020-12-01 19:46:23.930273 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/cross_db_utils/datatypes.sql
2020-12-01 19:46:23.944166 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/cross_db_utils/position.sql
2020-12-01 19:46:23.951246 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/cross_db_utils/literal.sql
2020-12-01 19:46:23.957847 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/cross_db_utils/_is_ephemeral.sql
2020-12-01 19:46:23.965026 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/cross_db_utils/width_bucket.sql
2020-12-01 19:46:23.977846 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/cross_db_utils/date_trunc.sql
2020-12-01 19:46:23.985564 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/cross_db_utils/except.sql
2020-12-01 19:46:23.991751 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/cross_db_utils/safe_cast.sql
2020-12-01 19:46:23.999341 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/cross_db_utils/last_day.sql
2020-12-01 19:46:24.007533 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/cross_db_utils/intersect.sql
2020-12-01 19:46:24.025605 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/get_date_dimension.sql
2020-12-01 19:46:24.043310 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/get_base_dates.sql
2020-12-01 19:46:24.051526 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/calendar_date/n_weeks_ago.sql
2020-12-01 19:46:24.057262 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/calendar_date/to_unixtimestamp.sql
2020-12-01 19:46:24.063464 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/calendar_date/yesterday.sql
2020-12-01 19:46:24.069394 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/calendar_date/month_name.sql
2020-12-01 19:46:24.076912 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/calendar_date/day_name.sql
2020-12-01 19:46:24.084286 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/calendar_date/_get_utils_namespaces.sql
2020-12-01 19:46:24.089864 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/calendar_date/date_part.sql
2020-12-01 19:46:24.096405 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/calendar_date/n_days_ago.sql
2020-12-01 19:46:24.102159 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/calendar_date/now.sql
2020-12-01 19:46:24.107806 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/calendar_date/n_months_ago.sql
2020-12-01 19:46:24.113751 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/calendar_date/this_week.sql
2020-12-01 19:46:24.119486 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/calendar_date/convert_timezone.sql
2020-12-01 19:46:24.127456 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/calendar_date/periods_since.sql
2020-12-01 19:46:24.133143 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/calendar_date/n_months_away.sql
2020-12-01 19:46:24.138915 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/calendar_date/n_days_away.sql
2020-12-01 19:46:24.144367 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/calendar_date/last_week.sql
2020-12-01 19:46:24.149534 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/calendar_date/n_weeks_away.sql
2020-12-01 19:46:24.155326 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/calendar_date/tomorrow.sql
2020-12-01 19:46:24.161047 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/calendar_date/today.sql
2020-12-01 19:46:24.166478 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/fiscal_date/get_fiscal_periods.sql
2020-12-01 19:46:24.173077 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Parsing macros/fiscal_date/get_fiscal_year_dates.sql
2020-12-01 19:46:24.198585 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): project hash mismatch: values missing, cache invalidated: {'dbt_date', 'dbt_utils'}
2020-12-01 19:46:24.253842 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Acquiring new snowflake connection "model.sales_dataflo.stg_sf_opportunity".
2020-12-01 19:46:24.631365 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Acquiring new snowflake connection "model.dbt_date.dim_date_fiscal".
2020-12-01 19:46:24.670350 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Acquiring new snowflake connection "model.dbt_date.dim_date".
2020-12-01 19:46:24.693972 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): Acquiring new snowflake connection "model.dbt_date.dates".
2020-12-01 19:46:24.948228 (c153c120-8e7c-4347-bea6-3a69de633eba-handler-deps): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 4 unused configuration paths:
- models.sales_dataflo.utils
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-01 19:46:25.283352 (Thread-41): handling poll request
2020-12-01 19:46:25.283877 (Thread-41): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafac1b1a90>]}
2020-12-01 19:46:25.285041 (Thread-41): sending response (<Response 311 bytes [200 OK]>) to 10.0.18.40
2020-12-01 19:46:26.161886 (Thread-42): handling status request
2020-12-01 19:46:26.162414 (Thread-42): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafac1b1cf8>]}
2020-12-01 19:46:26.175546 (Thread-42): sending response (<Response 28366 bytes [200 OK]>) to 10.0.13.243
2020-12-01 19:46:42.227114 (Thread-43): handling status request
2020-12-01 19:46:42.227705 (Thread-43): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafb7474cf8>]}
2020-12-01 19:46:42.238196 (Thread-43): sending response (<Response 28366 bytes [200 OK]>) to 10.0.18.40
2020-12-01 19:46:42.812163 (Thread-44): handling run_sql request
2020-12-01 19:46:42.812721 (Thread-44): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafb74a92b0>]}
2020-12-01 19:46:42.815513 (Thread-44): Connection 'model.dbt_date.dates' was properly closed.
2020-12-01 19:46:44.014343 (Thread-44): sending response (<Response 137 bytes [200 OK]>) to 10.0.13.243
2020-12-01 19:46:44.044701 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-01 19:46:44.086984 (MainThread): Found 1 model, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-01 19:46:44.087601 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-01 19:46:44.087749 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-01 19:46:44.115140 (Thread-1): finished collecting timing info
2020-12-01 19:46:44.117027 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-01 19:46:44.117120 (Thread-1): On rpc.sales_dataflo.request: WITH source AS (

    select * from salesforce.opportunity

    ),renamed as (
     select
      id as opportunity_id,

        -- keys
        account_id as opportunity_account_id,
        owner_id as opportunity_owner_id,

        -- company context
        name as company_name,
        description as opportunity_description,
        type as opportunity_type,

        -- attribution
        lead_source,
        is_private,

        -- pipeline
        fiscal as fiscal_yq,
        fiscal_year,
        fiscal_quarter,
        probability,
        next_step,
        has_open_activity,
        stage_name,
        forecast_category,
        forecast_category_name,
        campaign_id,
        is_won,
        is_closed,
        close_date,
        has_overdue_task,
        expected_revenue,
        total_opportunity_quantity,

        delivery_installation_status_c as delivery_installation_status,
        order_number_c as order_number,
        current_generators_c as current_generators,
        main_competitors_c as main_competitors,

        -- accounting
        amount,

        -- metadata
        last_activity_date,
        created_date as created_at,
        last_modified_date as updated_at,

        created_date >= 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_month,
        created_date >= 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_quarter,
        
  

    datediff(
        day,
        
    current_timestamp::
    timestamp_ntz

,
        created_date
        )


 as days_since_created,
        
  

    datediff(
        day,
        close_date,
        created_date
        )


 as days_to_close,
        
    date_trunc('month', close_date)
 = 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_month,
        
    date_trunc('quarter', close_date)
 = 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_quarter

        

     from source
    )


select * from renamed



limit 100
2020-12-01 19:46:44.117184 (Thread-1): Opening a new connection, currently in state init
2020-12-01 19:46:44.272392 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-01 19:46:45.171732 (Thread-45): handling poll request
2020-12-01 19:46:45.172293 (Thread-45): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafba0472b0>]}
2020-12-01 19:46:45.175471 (Thread-45): sending response (<Response 5056 bytes [200 OK]>) to 10.0.46.83
2020-12-01 19:46:45.413790 (Thread-1): SQL status: SUCCESS 31 in 1.30 seconds
2020-12-01 19:46:45.420194 (Thread-1): finished collecting timing info
2020-12-01 19:46:45.420753 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-01 19:46:47.033739 (Thread-46): handling poll request
2020-12-01 19:46:47.034260 (Thread-46): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafae4ffb70>]}
2020-12-01 19:46:47.040501 (Thread-46): sending response (<Response 29203 bytes [200 OK]>) to 10.0.33.229
2020-12-01 19:46:57.343317 (Thread-47): Got an acceptable cached parse result
2020-12-01 19:46:57.454861 (Thread-48): handling status request
2020-12-01 19:46:57.455395 (Thread-48): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafac36e518>]}
2020-12-01 19:46:57.456266 (Thread-48): sending response (<Response 184 bytes [200 OK]>) to 10.0.6.210
2020-12-01 19:46:57.911549 (Thread-47): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 4 unused configuration paths:
- models.sales_dataflo.utils
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-01 19:46:59.006976 (Thread-49): handling status request
2020-12-01 19:46:59.007517 (Thread-49): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafac3e70f0>]}
2020-12-01 19:46:59.008574 (Thread-49): sending response (<Response 976 bytes [200 OK]>) to 10.0.33.129
2020-12-01 19:53:29.494338 (MainThread): writing 1 spans (enabled:True), 130 additional messages skipped
2020-12-01 19:53:29.496065 (MainThread): 
      name jinja2.compile
        id 2728509961697372858
  trace_id 1637202968549210574
 parent_id None
   service None
  resource <memory>
      type template
     start 1606852409.493411
       end 1606852409.494133
  duration 0.000722s
     error 0
      tags 
           jinja2.template_name:<memory>
           runtime-id:effd176b76e4423c802d73d161102125, 164 additional messages skipped
2020-12-01 19:53:29.999907 (Thread-50): Got an acceptable cached parse result
2020-12-01 19:53:30.280999 (AgentWriter): reported 61 traces in 0.04428s, 5 additional messages skipped
2020-12-01 19:53:30.281542 (AgentWriter): initialized RateSampler, sample 100% of traces, 215 additional messages skipped
2020-12-01 19:53:30.578411 (Thread-50): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 4 unused configuration paths:
- models.sales_dataflo.utils
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-01 19:53:30.982835 (Thread-51): handling status request
2020-12-01 19:53:30.983395 (Thread-51): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf9f7e1860>]}
2020-12-01 19:53:30.984515 (Thread-51): sending response (<Response 976 bytes [200 OK]>) to 10.0.33.229
2020-12-01 19:53:58.343192 (Thread-53): handling status request
2020-12-01 19:53:58.343797 (Thread-53): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafac0c5748>]}
2020-12-01 19:53:58.344577 (Thread-53): sending response (<Response 184 bytes [200 OK]>) to 10.0.3.206
2020-12-01 19:53:58.359698 (Thread-52): Got an acceptable cached parse result
2020-12-01 19:53:58.918086 (Thread-52): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 4 unused configuration paths:
- models.sales_dataflo.utils
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-01 19:53:59.906019 (Thread-54): handling status request
2020-12-01 19:53:59.906518 (Thread-54): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf9f723278>]}
2020-12-01 19:53:59.907594 (Thread-54): sending response (<Response 976 bytes [200 OK]>) to 10.0.33.229
2020-12-01 19:54:30.743836 (MainThread): writing 1 spans (enabled:True), 121 additional messages skipped
2020-12-01 19:54:30.744048 (MainThread): 
      name jinja2.compile
        id 6833285521761620659
  trace_id 12092883806845910195
 parent_id None
   service None
  resource <memory>
      type template
     start 1606852470.7431092
       end 1606852470.7436762
  duration 0.000567s
     error 0
      tags 
           jinja2.template_name:<memory>
           runtime-id:effd176b76e4423c802d73d161102125, 121 additional messages skipped
2020-12-01 19:54:31.210159 (Thread-55): Got an acceptable cached parse result
2020-12-01 19:54:31.301452 (AgentWriter): reported 61 traces in 0.00323s, 2 additional messages skipped
2020-12-01 19:54:31.301731 (AgentWriter): initialized RateSampler, sample 100% of traces, 107 additional messages skipped
2020-12-01 19:54:31.519918 (Thread-56): handling status request
2020-12-01 19:54:31.530358 (Thread-56): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafac1d7390>]}
2020-12-01 19:54:31.531339 (Thread-56): sending response (<Response 184 bytes [200 OK]>) to 10.0.33.229
2020-12-01 19:54:31.743652 (Thread-55): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 4 unused configuration paths:
- models.sales_dataflo.utils
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-01 19:54:33.042354 (Thread-57): handling status request
2020-12-01 19:54:33.042882 (Thread-57): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafac0c2cf8>]}
2020-12-01 19:54:33.044029 (Thread-57): sending response (<Response 976 bytes [200 OK]>) to 10.0.23.23
2020-12-01 20:08:58.988533 (MainThread): writing 1 spans (enabled:True), 60 additional messages skipped
2020-12-01 20:08:58.990201 (MainThread): 
      name jinja2.compile
        id 14612343115456331159
  trace_id 12585159926692119824
 parent_id None
   service None
  resource <memory>
      type template
     start 1606853338.987573
       end 1606853338.988318
  duration 0.000745s
     error 0
      tags 
           jinja2.template_name:<memory>
           runtime-id:effd176b76e4423c802d73d161102125, 60 additional messages skipped
2020-12-01 20:08:59.517404 (Thread-58): Got an acceptable cached parse result
2020-12-01 20:08:59.786430 (AgentWriter): reported 61 traces in 0.04600s
2020-12-01 20:08:59.791948 (AgentWriter): initialized RateSampler, sample 100% of traces, 35 additional messages skipped
2020-12-01 20:09:00.180704 (Thread-58): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 4 unused configuration paths:
- models.sales_dataflo.utils
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-01 20:09:00.517415 (Thread-59): handling status request
2020-12-01 20:09:00.517919 (Thread-59): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafae4ba080>]}
2020-12-01 20:09:00.519047 (Thread-59): sending response (<Response 976 bytes [200 OK]>) to 10.0.6.210
2020-12-01 20:09:09.046885 (MainThread): writing 1 spans (enabled:True), 60 additional messages skipped
2020-12-01 20:09:09.047094 (MainThread): 
      name jinja2.compile
        id 13322575471386894950
  trace_id 3594818441854314800
 parent_id None
   service None
  resource <memory>
      type template
     start 1606853349.046174
       end 1606853349.0467231
  duration 0.000549s
     error 0
      tags 
           jinja2.template_name:<memory>
           runtime-id:effd176b76e4423c802d73d161102125, 60 additional messages skipped
2020-12-01 20:09:09.544400 (Thread-60): Got an acceptable cached parse result
2020-12-01 20:09:09.600275 (Thread-61): handling status request
2020-12-01 20:09:09.601016 (Thread-61): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafac0b48d0>]}
2020-12-01 20:09:09.602063 (Thread-61): sending response (<Response 184 bytes [200 OK]>) to 10.0.13.243
2020-12-01 20:09:09.843996 (AgentWriter): reported 61 traces in 0.03637s
2020-12-01 20:09:09.844447 (AgentWriter): initialized RateSampler, sample 100% of traces, 35 additional messages skipped
2020-12-01 20:09:10.203921 (Thread-60): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 4 unused configuration paths:
- models.sales_dataflo.utils
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-01 20:09:11.189447 (Thread-62): handling status request
2020-12-01 20:09:11.190134 (Thread-62): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf9ff50198>]}
2020-12-01 20:09:11.191747 (Thread-62): sending response (<Response 976 bytes [200 OK]>) to 10.0.16.71
2020-12-01 20:09:17.268270 (Thread-63): Got an acceptable cached parse result
2020-12-01 20:09:17.592723 (Thread-64): handling status request
2020-12-01 20:09:17.593474 (Thread-64): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf9fe9b048>]}
2020-12-01 20:09:17.594628 (Thread-64): sending response (<Response 184 bytes [200 OK]>) to 10.0.16.234
2020-12-01 20:09:17.808698 (Thread-63): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 4 unused configuration paths:
- models.sales_dataflo.utils
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-01 20:09:19.115420 (Thread-65): handling status request
2020-12-01 20:09:19.115934 (Thread-65): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafac3e52e8>]}
2020-12-01 20:09:19.117008 (Thread-65): sending response (<Response 976 bytes [200 OK]>) to 10.0.16.71
2020-12-01 20:09:42.728965 (Thread-66): Got an acceptable cached parse result
2020-12-01 20:09:42.938132 (Thread-67): handling status request
2020-12-01 20:09:42.951700 (Thread-67): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fafac08a4a8>]}
2020-12-01 20:09:42.952648 (Thread-67): sending response (<Response 184 bytes [200 OK]>) to 10.0.13.243
2020-12-01 20:09:43.277215 (Thread-66): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 4 unused configuration paths:
- models.sales_dataflo.utils
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-01 20:09:44.545089 (Thread-68): handling status request
2020-12-01 20:09:44.545698 (Thread-68): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '279545d9-0e4a-4735-b4f0-f01f1b2682be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faf9fd45898>]}
2020-12-01 20:09:44.546850 (Thread-68): sending response (<Response 976 bytes [200 OK]>) to 10.0.16.234
2020-12-02 04:55:59.112211 (MainThread): Running with dbt=0.18.1
2020-12-02 04:55:59.420709 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.rpc.server.RPCServerTask'>, debug=False, defer=None, exclude=None, host='0.0.0.0', log_cache_events=False, log_format='default', models=None, partial_parse=True, port=8580, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='rpc', write_json=True)
2020-12-02 04:55:59.435364 (MainThread): Tracking: tracking
2020-12-02 04:55:59.435555 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc60011d6a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc60011dba8>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc60011df98>]}
2020-12-02 04:55:59.435883 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=13
2020-12-02 04:55:59.436302 (MainThread): Supported methods: ['cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'status', 'test']
2020-12-02 04:55:59.442416 (MainThread): Send requests to http://localhost:8580/jsonrpc
2020-12-02 04:55:59.526587 (Thread-1): Parsing macros/adapters.sql
2020-12-02 04:55:59.556595 (Thread-1): Parsing macros/catalog.sql
2020-12-02 04:55:59.558649 (Thread-1): Parsing macros/materializations/table.sql
2020-12-02 04:55:59.562662 (Thread-1): Parsing macros/materializations/merge.sql
2020-12-02 04:55:59.564711 (Thread-1): Parsing macros/materializations/view.sql
2020-12-02 04:55:59.566299 (Thread-1): Parsing macros/materializations/incremental.sql
2020-12-02 04:55:59.576600 (Thread-1): Parsing macros/core.sql
2020-12-02 04:55:59.580442 (Thread-1): Parsing macros/adapters/common.sql
2020-12-02 04:55:59.624209 (Thread-1): Parsing macros/materializations/helpers.sql
2020-12-02 04:55:59.633497 (Thread-1): Parsing macros/materializations/table/table.sql
2020-12-02 04:55:59.640505 (Thread-1): Parsing macros/materializations/seed/seed.sql
2020-12-02 04:55:59.661671 (Thread-1): Parsing macros/materializations/view/view.sql
2020-12-02 04:55:59.668013 (Thread-1): Parsing macros/materializations/view/create_or_replace_view.sql
2020-12-02 04:55:59.673094 (Thread-1): Parsing macros/materializations/incremental/helpers.sql
2020-12-02 04:55:59.675014 (Thread-1): Parsing macros/materializations/incremental/incremental.sql
2020-12-02 04:55:59.681469 (Thread-1): Parsing macros/materializations/common/merge.sql
2020-12-02 04:55:59.695823 (Thread-1): Parsing macros/materializations/snapshot/strategies.sql
2020-12-02 04:55:59.712734 (Thread-1): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-12-02 04:55:59.714627 (Thread-1): Parsing macros/materializations/snapshot/snapshot.sql
2020-12-02 04:55:59.743784 (Thread-1): Parsing macros/schema_tests/relationships.sql
2020-12-02 04:55:59.745820 (Thread-1): Parsing macros/schema_tests/not_null.sql
2020-12-02 04:55:59.747454 (Thread-1): Parsing macros/schema_tests/unique.sql
2020-12-02 04:55:59.749273 (Thread-1): Parsing macros/schema_tests/accepted_values.sql
2020-12-02 04:55:59.752094 (Thread-1): Parsing macros/etc/get_custom_database.sql
2020-12-02 04:55:59.753853 (Thread-1): Parsing macros/etc/query.sql
2020-12-02 04:55:59.754968 (Thread-1): Parsing macros/etc/datetime.sql
2020-12-02 04:55:59.764167 (Thread-1): Parsing macros/etc/get_custom_alias.sql
2020-12-02 04:55:59.765193 (Thread-1): Parsing macros/etc/is_incremental.sql
2020-12-02 04:55:59.766945 (Thread-1): Parsing macros/etc/get_custom_schema.sql
2020-12-02 04:55:59.787130 (Thread-1): Parsing macros/logger/pretty_time.sql
2020-12-02 04:55:59.794084 (Thread-1): Parsing macros/logger/log_info.sql
2020-12-02 04:55:59.800934 (Thread-1): Parsing macros/logger/pretty_log_format.sql
2020-12-02 04:55:59.809294 (Thread-1): Parsing macros/sql/pivot.sql
2020-12-02 04:55:59.818108 (Thread-1): Parsing macros/sql/star.sql
2020-12-02 04:55:59.828534 (Thread-1): Parsing macros/sql/surrogate_key.sql
2020-12-02 04:55:59.837990 (Thread-1): Parsing macros/sql/get_query_results_as_dict.sql
2020-12-02 04:55:59.846534 (Thread-1): Parsing macros/sql/get_column_values.sql
2020-12-02 04:55:59.857849 (Thread-1): Parsing macros/sql/groupby.sql
2020-12-02 04:55:59.864661 (Thread-1): Parsing macros/sql/get_tables_by_pattern_sql.sql
2020-12-02 04:55:59.876911 (Thread-1): Parsing macros/sql/nullcheck_table.sql
2020-12-02 04:55:59.884995 (Thread-1): Parsing macros/sql/get_tables_by_prefix_sql.sql
2020-12-02 04:55:59.892249 (Thread-1): Parsing macros/sql/get_relations_by_pattern.sql
2020-12-02 04:55:59.904512 (Thread-1): Parsing macros/sql/get_relations_by_prefix.sql
2020-12-02 04:55:59.915046 (Thread-1): Parsing macros/sql/safe_add.sql
2020-12-02 04:55:59.923399 (Thread-1): Parsing macros/sql/unpivot.sql
2020-12-02 04:55:59.941015 (Thread-1): Parsing macros/sql/generate_series.sql
2020-12-02 04:55:59.953605 (Thread-1): Parsing macros/sql/nullcheck.sql
2020-12-02 04:55:59.961780 (Thread-1): Parsing macros/sql/union.sql
2020-12-02 04:55:59.977361 (Thread-1): Parsing macros/materializations/insert_by_period_materialization.sql
2020-12-02 04:56:00.007926 (Thread-1): Parsing macros/web/get_url_parameter.sql
2020-12-02 04:56:00.016021 (Thread-1): Parsing macros/web/get_url_path.sql
2020-12-02 04:56:00.023946 (Thread-1): Parsing macros/web/get_url_host.sql
2020-12-02 04:56:00.032249 (Thread-1): Parsing macros/datetime/date_spine.sql
2020-12-02 04:56:00.042993 (Thread-1): Parsing macros/schema_tests/expression_is_true.sql
2020-12-02 04:56:00.051253 (Thread-1): Parsing macros/schema_tests/not_constant.sql
2020-12-02 04:56:00.058361 (Thread-1): Parsing macros/schema_tests/at_least_one.sql
2020-12-02 04:56:00.066963 (Thread-1): Parsing macros/schema_tests/equality.sql
2020-12-02 04:56:00.078607 (Thread-1): Parsing macros/schema_tests/test_not_null_where.sql
2020-12-02 04:56:00.091169 (Thread-1): Parsing macros/schema_tests/equal_rowcount.sql
2020-12-02 04:56:00.099310 (Thread-1): Parsing macros/schema_tests/test_unique_where.sql
2020-12-02 04:56:00.109034 (Thread-1): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2020-12-02 04:56:00.120726 (Thread-1): Parsing macros/schema_tests/relationships_where.sql
2020-12-02 04:56:00.128295 (Thread-1): Parsing macros/schema_tests/unique_combination_of_columns.sql
2020-12-02 04:56:00.137842 (Thread-1): Parsing macros/schema_tests/recency.sql
2020-12-02 04:56:00.146731 (Thread-1): Parsing macros/schema_tests/cardinality_equality.sql
2020-12-02 04:56:00.154684 (Thread-1): Parsing macros/geo/haversine_distance.sql
2020-12-02 04:56:00.162030 (Thread-1): Parsing macros/cross_db_utils/split_part.sql
2020-12-02 04:56:00.170918 (Thread-1): Parsing macros/cross_db_utils/length.sql
2020-12-02 04:56:00.179716 (Thread-1): Parsing macros/cross_db_utils/current_timestamp.sql
2020-12-02 04:56:00.188668 (Thread-1): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2020-12-02 04:56:00.196271 (Thread-1): Parsing macros/cross_db_utils/right.sql
2020-12-02 04:56:00.205968 (Thread-1): Parsing macros/cross_db_utils/hash.sql
2020-12-02 04:56:00.214216 (Thread-1): Parsing macros/cross_db_utils/replace.sql
2020-12-02 04:56:00.221229 (Thread-1): Parsing macros/cross_db_utils/concat.sql
2020-12-02 04:56:00.229337 (Thread-1): Parsing macros/cross_db_utils/_is_relation.sql
2020-12-02 04:56:00.236729 (Thread-1): Parsing macros/cross_db_utils/identifier.sql
2020-12-02 04:56:00.245176 (Thread-1): Parsing macros/cross_db_utils/datediff.sql
2020-12-02 04:56:00.261483 (Thread-1): Parsing macros/cross_db_utils/dateadd.sql
2020-12-02 04:56:00.271379 (Thread-1): Parsing macros/cross_db_utils/datatypes.sql
2020-12-02 04:56:00.286096 (Thread-1): Parsing macros/cross_db_utils/position.sql
2020-12-02 04:56:00.294335 (Thread-1): Parsing macros/cross_db_utils/literal.sql
2020-12-02 04:56:00.302174 (Thread-1): Parsing macros/cross_db_utils/_is_ephemeral.sql
2020-12-02 04:56:00.311211 (Thread-1): Parsing macros/cross_db_utils/width_bucket.sql
2020-12-02 04:56:00.324322 (Thread-1): Parsing macros/cross_db_utils/date_trunc.sql
2020-12-02 04:56:00.332603 (Thread-1): Parsing macros/cross_db_utils/except.sql
2020-12-02 04:56:00.341473 (Thread-1): Parsing macros/cross_db_utils/safe_cast.sql
2020-12-02 04:56:00.351112 (Thread-1): Parsing macros/cross_db_utils/last_day.sql
2020-12-02 04:56:00.361275 (Thread-1): Parsing macros/cross_db_utils/intersect.sql
2020-12-02 04:56:00.373039 (Thread-1): Parsing macros/get_date_dimension.sql
2020-12-02 04:56:00.393001 (Thread-1): Parsing macros/get_base_dates.sql
2020-12-02 04:56:00.401831 (AgentWriter): reported 51 traces in 0.00429s, 2 additional messages skipped
2020-12-02 04:56:00.402040 (AgentWriter): initialized RateSampler, sample 100% of traces, 107 additional messages skipped
2020-12-02 04:56:00.403928 (Thread-1): Parsing macros/calendar_date/n_weeks_ago.sql
2020-12-02 04:56:00.411497 (Thread-1): Parsing macros/calendar_date/to_unixtimestamp.sql
2020-12-02 04:56:00.419662 (Thread-1): Parsing macros/calendar_date/yesterday.sql
2020-12-02 04:56:00.427081 (Thread-1): Parsing macros/calendar_date/month_name.sql
2020-12-02 04:56:00.435246 (Thread-1): Parsing macros/calendar_date/day_name.sql
2020-12-02 04:56:00.443211 (Thread-1): Parsing macros/calendar_date/_get_utils_namespaces.sql
2020-12-02 04:56:00.450015 (Thread-1): Parsing macros/calendar_date/date_part.sql
2020-12-02 04:56:00.457597 (Thread-1): Parsing macros/calendar_date/n_days_ago.sql
2020-12-02 04:56:00.465815 (Thread-1): Parsing macros/calendar_date/now.sql
2020-12-02 04:56:00.473381 (Thread-1): Parsing macros/calendar_date/n_months_ago.sql
2020-12-02 04:56:00.481137 (Thread-1): Parsing macros/calendar_date/this_week.sql
2020-12-02 04:56:00.489201 (Thread-1): Parsing macros/calendar_date/convert_timezone.sql
2020-12-02 04:56:00.498852 (Thread-1): Parsing macros/calendar_date/periods_since.sql
2020-12-02 04:56:00.505854 (Thread-1): Parsing macros/calendar_date/n_months_away.sql
2020-12-02 04:56:00.512637 (Thread-1): Parsing macros/calendar_date/n_days_away.sql
2020-12-02 04:56:00.520293 (Thread-1): Parsing macros/calendar_date/last_week.sql
2020-12-02 04:56:00.528063 (Thread-1): Parsing macros/calendar_date/n_weeks_away.sql
2020-12-02 04:56:00.535273 (Thread-1): Parsing macros/calendar_date/tomorrow.sql
2020-12-02 04:56:00.541946 (Thread-1): Parsing macros/calendar_date/today.sql
2020-12-02 04:56:00.548800 (Thread-1): Parsing macros/fiscal_date/get_fiscal_periods.sql
2020-12-02 04:56:00.561284 (Thread-1): Parsing macros/fiscal_date/get_fiscal_year_dates.sql
2020-12-02 04:56:00.571657 (Thread-1): writing 1 spans (enabled:True), 97 additional messages skipped
2020-12-02 04:56:00.571810 (Thread-1): 
      name jinja2.compile
        id 15258071467024640676
  trace_id 4367375223847930894
 parent_id None
   service None
  resource <memory>
      type template
     start 1606884960.567753
       end 1606884960.5715182
  duration 0.003765s
     error 0
      tags 
           jinja2.template_name:<memory>
           runtime-id:2ffeb47d61e440b18e8a536870c1653f, 130 additional messages skipped
2020-12-02 04:56:00.642888 (Thread-1): Acquiring new snowflake connection "model.sales_dataflo.stg_sf_opportunity".
2020-12-02 04:56:00.994714 (Thread-1): Acquiring new snowflake connection "model.dbt_date.dim_date_fiscal".
2020-12-02 04:56:01.034925 (Thread-1): Acquiring new snowflake connection "model.dbt_date.dim_date".
2020-12-02 04:56:01.058912 (Thread-1): Acquiring new snowflake connection "model.dbt_date.dates".
2020-12-02 04:56:01.252588 (Thread-1): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 4 unused configuration paths:
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- models.sales_dataflo.utils
- seeds.FivetranDbt_Transformation

2020-12-02 04:56:02.194910 (Thread-2): handling status request
2020-12-02 04:56:02.195410 (Thread-2): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '03d16ca6-1793-434d-b7de-5779deede782', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc60011d9e8>]}
2020-12-02 04:56:02.208495 (Thread-2): sending response (<Response 32170 bytes [200 OK]>) to 10.0.11.16
2020-12-02 08:32:44.031733 (Thread-3): handling status request
2020-12-02 08:32:44.033259 (Thread-3): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '03d16ca6-1793-434d-b7de-5779deede782', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc5f376cef0>]}
2020-12-02 08:32:44.045607 (Thread-3): sending response (<Response 32170 bytes [200 OK]>) to 10.0.31.170
2020-12-02 08:32:44.398224 (Thread-4): handling ps request
2020-12-02 08:32:44.398911 (Thread-4): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '03d16ca6-1793-434d-b7de-5779deede782', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc5f375e978>]}
2020-12-02 08:32:44.401614 (Thread-4): sending response (<Response 104 bytes [200 OK]>) to 10.0.45.111
2020-12-02 08:38:10.306586 (Thread-5): handling status request
2020-12-02 08:38:10.308162 (Thread-5): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '03d16ca6-1793-434d-b7de-5779deede782', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc5f3768908>]}
2020-12-02 08:38:10.320101 (Thread-5): sending response (<Response 32170 bytes [200 OK]>) to 10.0.27.241
2020-12-02 08:38:10.703587 (Thread-6): handling ps request
2020-12-02 08:38:10.704081 (Thread-6): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '03d16ca6-1793-434d-b7de-5779deede782', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc5f37fbcf8>]}
2020-12-02 08:38:10.704867 (Thread-6): sending response (<Response 104 bytes [200 OK]>) to 10.0.27.241
2020-12-02 08:44:00.559462 (Thread-7): handling status request
2020-12-02 08:44:00.561376 (Thread-7): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '03d16ca6-1793-434d-b7de-5779deede782', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc5f376c908>]}
2020-12-02 08:44:00.572981 (Thread-7): sending response (<Response 32170 bytes [200 OK]>) to 10.0.26.14
2020-12-02 08:44:01.129186 (Thread-8): handling run_sql request
2020-12-02 08:44:01.129743 (Thread-8): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '03d16ca6-1793-434d-b7de-5779deede782', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc5f377b6d8>]}
2020-12-02 08:44:01.132973 (Thread-8): Connection 'model.dbt_date.dates' was properly closed.
2020-12-02 08:44:02.191592 (Thread-8): sending response (<Response 137 bytes [200 OK]>) to 10.0.45.111
2020-12-02 08:44:02.219970 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 08:44:02.263050 (MainThread): Found 1 model, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 08:44:02.263617 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 08:44:02.263774 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 08:44:02.287517 (Thread-1): finished collecting timing info
2020-12-02 08:44:02.289306 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 08:44:02.289408 (Thread-1): On rpc.sales_dataflo.request: WITH source AS (

    select * from salesforce.opportunity

    ),renamed as (
     select
      id as opportunity_id,

        -- keys
        account_id as opportunity_account_id,
        owner_id as opportunity_owner_id,

        -- company context
        name as company_name,
        description as opportunity_description,
        type as opportunity_type,

        -- attribution
        lead_source,
        is_private,

        -- pipeline
        fiscal as fiscal_yq,
        fiscal_year,
        fiscal_quarter,
        probability,
        next_step,
        has_open_activity,
        stage_name,
        forecast_category,
        forecast_category_name,
        campaign_id,
        is_won,
        is_closed,
        close_date,
        has_overdue_task,
        expected_revenue,
        total_opportunity_quantity,

        delivery_installation_status_c as delivery_installation_status,
        order_number_c as order_number,
        current_generators_c as current_generators,
        main_competitors_c as main_competitors,

        -- accounting
        amount,

        -- metadata
        last_activity_date,
        created_date as created_at,
        last_modified_date as updated_at,

        created_date >= 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_month,
        created_date >= 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_quarter,
        
  

    datediff(
        day,
        
    current_timestamp::
    timestamp_ntz

,
        created_date
        )


 as days_since_created,
        
  

    datediff(
        day,
        close_date,
        created_date
        )


 as days_to_close,
        
    date_trunc('month', close_date)
 = 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_month,
        
    date_trunc('quarter', close_date)
 = 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_quarter

        

     from source
    )


select * from renamed



limit 100
2020-12-02 08:44:02.289468 (Thread-1): Opening a new connection, currently in state init
2020-12-02 08:44:02.440215 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 08:44:02.835527 (Thread-9): handling poll request
2020-12-02 08:44:02.836223 (Thread-9): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '03d16ca6-1793-434d-b7de-5779deede782', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc5f377bac8>]}
2020-12-02 08:44:02.841783 (Thread-9): sending response (<Response 5057 bytes [200 OK]>) to 10.0.45.111
2020-12-02 08:44:03.526412 (Thread-1): SQL status: SUCCESS 31 in 1.24 seconds
2020-12-02 08:44:03.532426 (Thread-1): finished collecting timing info
2020-12-02 08:44:03.532931 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 08:44:04.513679 (Thread-10): handling poll request
2020-12-02 08:44:04.514176 (Thread-10): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '03d16ca6-1793-434d-b7de-5779deede782', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fc5f377b0b8>]}
2020-12-02 08:44:04.519888 (Thread-10): sending response (<Response 29203 bytes [200 OK]>) to 10.0.12.174
2020-12-02 08:50:50.147505 (MainThread): Running with dbt=0.18.1
2020-12-02 08:50:50.462418 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.rpc.server.RPCServerTask'>, debug=False, defer=None, exclude=None, host='0.0.0.0', log_cache_events=False, log_format='default', models=None, partial_parse=True, port=8580, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='rpc', write_json=True)
2020-12-02 08:50:50.477737 (MainThread): Tracking: tracking
2020-12-02 08:50:50.483108 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7395dcdb00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7393c08f28>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7393c2a2e8>]}
2020-12-02 08:50:50.488080 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=13
2020-12-02 08:50:50.488485 (MainThread): Supported methods: ['cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'status', 'test']
2020-12-02 08:50:50.488741 (MainThread): Send requests to http://localhost:8580/jsonrpc
2020-12-02 08:50:50.581858 (Thread-1): Parsing macros/adapters.sql
2020-12-02 08:50:50.612084 (Thread-1): Parsing macros/catalog.sql
2020-12-02 08:50:50.614094 (Thread-1): Parsing macros/materializations/table.sql
2020-12-02 08:50:50.618055 (Thread-1): Parsing macros/materializations/merge.sql
2020-12-02 08:50:50.620148 (Thread-1): Parsing macros/materializations/view.sql
2020-12-02 08:50:50.621667 (Thread-1): Parsing macros/materializations/incremental.sql
2020-12-02 08:50:50.631819 (Thread-1): Parsing macros/core.sql
2020-12-02 08:50:50.635820 (Thread-1): Parsing macros/adapters/common.sql
2020-12-02 08:50:50.679491 (Thread-1): Parsing macros/materializations/helpers.sql
2020-12-02 08:50:50.688745 (Thread-1): Parsing macros/materializations/table/table.sql
2020-12-02 08:50:50.695787 (Thread-1): Parsing macros/materializations/seed/seed.sql
2020-12-02 08:50:50.716952 (Thread-1): Parsing macros/materializations/view/view.sql
2020-12-02 08:50:50.725087 (Thread-1): Parsing macros/materializations/view/create_or_replace_view.sql
2020-12-02 08:50:50.733273 (Thread-1): Parsing macros/materializations/incremental/helpers.sql
2020-12-02 08:50:50.736311 (Thread-1): Parsing macros/materializations/incremental/incremental.sql
2020-12-02 08:50:50.746802 (Thread-1): Parsing macros/materializations/common/merge.sql
2020-12-02 08:50:50.765681 (Thread-1): Parsing macros/materializations/snapshot/strategies.sql
2020-12-02 08:50:50.782661 (Thread-1): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-12-02 08:50:50.784530 (Thread-1): Parsing macros/materializations/snapshot/snapshot.sql
2020-12-02 08:50:50.813742 (Thread-1): Parsing macros/schema_tests/relationships.sql
2020-12-02 08:50:50.815759 (Thread-1): Parsing macros/schema_tests/not_null.sql
2020-12-02 08:50:50.817371 (Thread-1): Parsing macros/schema_tests/unique.sql
2020-12-02 08:50:50.819210 (Thread-1): Parsing macros/schema_tests/accepted_values.sql
2020-12-02 08:50:50.822009 (Thread-1): Parsing macros/etc/get_custom_database.sql
2020-12-02 08:50:50.823803 (Thread-1): Parsing macros/etc/query.sql
2020-12-02 08:50:50.824910 (Thread-1): Parsing macros/etc/datetime.sql
2020-12-02 08:50:50.833977 (Thread-1): Parsing macros/etc/get_custom_alias.sql
2020-12-02 08:50:50.835028 (Thread-1): Parsing macros/etc/is_incremental.sql
2020-12-02 08:50:50.836714 (Thread-1): Parsing macros/etc/get_custom_schema.sql
2020-12-02 08:50:50.872684 (Thread-1): Parsing macros/logger/pretty_time.sql
2020-12-02 08:50:50.881096 (Thread-1): Parsing macros/logger/log_info.sql
2020-12-02 08:50:50.888995 (Thread-1): Parsing macros/logger/pretty_log_format.sql
2020-12-02 08:50:50.896202 (Thread-1): Parsing macros/sql/pivot.sql
2020-12-02 08:50:50.905107 (Thread-1): Parsing macros/sql/star.sql
2020-12-02 08:50:50.913698 (Thread-1): Parsing macros/sql/surrogate_key.sql
2020-12-02 08:50:50.923875 (Thread-1): Parsing macros/sql/get_query_results_as_dict.sql
2020-12-02 08:50:50.931922 (Thread-1): Parsing macros/sql/get_column_values.sql
2020-12-02 08:50:50.941987 (Thread-1): Parsing macros/sql/groupby.sql
2020-12-02 08:50:50.950155 (Thread-1): Parsing macros/sql/get_tables_by_pattern_sql.sql
2020-12-02 08:50:50.963798 (Thread-1): Parsing macros/sql/nullcheck_table.sql
2020-12-02 08:50:50.970758 (Thread-1): Parsing macros/sql/get_tables_by_prefix_sql.sql
2020-12-02 08:50:50.977845 (Thread-1): Parsing macros/sql/get_relations_by_pattern.sql
2020-12-02 08:50:50.988459 (Thread-1): Parsing macros/sql/get_relations_by_prefix.sql
2020-12-02 08:50:50.998804 (Thread-1): Parsing macros/sql/safe_add.sql
2020-12-02 08:50:51.006451 (Thread-1): Parsing macros/sql/unpivot.sql
2020-12-02 08:50:51.022092 (Thread-1): Parsing macros/sql/generate_series.sql
2020-12-02 08:50:51.032015 (Thread-1): Parsing macros/sql/nullcheck.sql
2020-12-02 08:50:51.039034 (Thread-1): Parsing macros/sql/union.sql
2020-12-02 08:50:51.055535 (Thread-1): Parsing macros/materializations/insert_by_period_materialization.sql
2020-12-02 08:50:51.088056 (Thread-1): Parsing macros/web/get_url_parameter.sql
2020-12-02 08:50:51.095399 (Thread-1): Parsing macros/web/get_url_path.sql
2020-12-02 08:50:51.104274 (Thread-1): Parsing macros/web/get_url_host.sql
2020-12-02 08:50:51.111580 (Thread-1): Parsing macros/datetime/date_spine.sql
2020-12-02 08:50:51.121905 (Thread-1): Parsing macros/schema_tests/expression_is_true.sql
2020-12-02 08:50:51.129495 (Thread-1): Parsing macros/schema_tests/not_constant.sql
2020-12-02 08:50:51.137048 (Thread-1): Parsing macros/schema_tests/at_least_one.sql
2020-12-02 08:50:51.145166 (Thread-1): Parsing macros/schema_tests/equality.sql
2020-12-02 08:50:51.155032 (Thread-1): Parsing macros/schema_tests/test_not_null_where.sql
2020-12-02 08:50:51.163109 (Thread-1): Parsing macros/schema_tests/equal_rowcount.sql
2020-12-02 08:50:51.172123 (Thread-1): Parsing macros/schema_tests/test_unique_where.sql
2020-12-02 08:50:51.180554 (Thread-1): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2020-12-02 08:50:51.191800 (Thread-1): Parsing macros/schema_tests/relationships_where.sql
2020-12-02 08:50:51.199856 (Thread-1): Parsing macros/schema_tests/unique_combination_of_columns.sql
2020-12-02 08:50:51.210123 (Thread-1): Parsing macros/schema_tests/recency.sql
2020-12-02 08:50:51.218185 (Thread-1): Parsing macros/schema_tests/cardinality_equality.sql
2020-12-02 08:50:51.226765 (Thread-1): Parsing macros/geo/haversine_distance.sql
2020-12-02 08:50:51.234922 (Thread-1): Parsing macros/cross_db_utils/split_part.sql
2020-12-02 08:50:51.243723 (Thread-1): Parsing macros/cross_db_utils/length.sql
2020-12-02 08:50:51.251394 (Thread-1): Parsing macros/cross_db_utils/current_timestamp.sql
2020-12-02 08:50:51.260834 (Thread-1): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2020-12-02 08:50:51.268901 (Thread-1): Parsing macros/cross_db_utils/right.sql
2020-12-02 08:50:51.277501 (Thread-1): Parsing macros/cross_db_utils/hash.sql
2020-12-02 08:50:51.284666 (Thread-1): Parsing macros/cross_db_utils/replace.sql
2020-12-02 08:50:51.291498 (Thread-1): Parsing macros/cross_db_utils/concat.sql
2020-12-02 08:50:51.299378 (Thread-1): Parsing macros/cross_db_utils/_is_relation.sql
2020-12-02 08:50:51.305648 (Thread-1): Parsing macros/cross_db_utils/identifier.sql
2020-12-02 08:50:51.313424 (Thread-1): Parsing macros/cross_db_utils/datediff.sql
2020-12-02 08:50:51.328742 (Thread-1): Parsing macros/cross_db_utils/dateadd.sql
2020-12-02 08:50:51.337452 (Thread-1): Parsing macros/cross_db_utils/datatypes.sql
2020-12-02 08:50:51.349474 (Thread-1): Parsing macros/cross_db_utils/position.sql
2020-12-02 08:50:51.357139 (Thread-1): Parsing macros/cross_db_utils/literal.sql
2020-12-02 08:50:51.362811 (Thread-1): Parsing macros/cross_db_utils/_is_ephemeral.sql
2020-12-02 08:50:51.369623 (Thread-1): Parsing macros/cross_db_utils/width_bucket.sql
2020-12-02 08:50:51.380318 (Thread-1): Parsing macros/cross_db_utils/date_trunc.sql
2020-12-02 08:50:51.387964 (Thread-2): handling status request
2020-12-02 08:50:51.388176 (Thread-1): Parsing macros/cross_db_utils/except.sql
2020-12-02 08:50:51.388661 (Thread-2): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '459f6bc7-2725-47e0-935e-b1bc02500cf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f73923b90b8>]}
2020-12-02 08:50:51.392037 (Thread-2): sending response (<Response 184 bytes [200 OK]>) to 10.0.27.241
2020-12-02 08:50:51.395026 (Thread-1): Parsing macros/cross_db_utils/safe_cast.sql
2020-12-02 08:50:51.402479 (Thread-1): Parsing macros/cross_db_utils/last_day.sql
2020-12-02 08:50:51.411133 (Thread-1): Parsing macros/cross_db_utils/intersect.sql
2020-12-02 08:50:51.420343 (Thread-1): Parsing macros/get_date_dimension.sql
2020-12-02 08:50:51.435918 (Thread-1): Parsing macros/get_base_dates.sql
2020-12-02 08:50:51.441533 (Thread-1): Parsing macros/calendar_date/n_weeks_ago.sql
2020-12-02 08:50:51.446259 (Thread-1): Parsing macros/calendar_date/to_unixtimestamp.sql
2020-12-02 08:50:51.451461 (Thread-1): Parsing macros/calendar_date/yesterday.sql
2020-12-02 08:50:51.455833 (Thread-1): Parsing macros/calendar_date/month_name.sql
2020-12-02 08:50:51.461446 (Thread-1): Parsing macros/calendar_date/day_name.sql
2020-12-02 08:50:51.467411 (Thread-1): Parsing macros/calendar_date/_get_utils_namespaces.sql
2020-12-02 08:50:51.472406 (Thread-1): Parsing macros/calendar_date/date_part.sql
2020-12-02 08:50:51.477805 (Thread-1): Parsing macros/calendar_date/n_days_ago.sql
2020-12-02 08:50:51.482110 (Thread-1): Parsing macros/calendar_date/now.sql
2020-12-02 08:50:51.486817 (Thread-1): Parsing macros/calendar_date/n_months_ago.sql
2020-12-02 08:50:51.491561 (Thread-1): Parsing macros/calendar_date/this_week.sql
2020-12-02 08:50:51.496329 (Thread-1): Parsing macros/calendar_date/convert_timezone.sql
2020-12-02 08:50:51.503187 (Thread-1): Parsing macros/calendar_date/periods_since.sql
2020-12-02 08:50:51.507323 (Thread-1): Parsing macros/calendar_date/n_months_away.sql
2020-12-02 08:50:51.512000 (Thread-1): Parsing macros/calendar_date/n_days_away.sql
2020-12-02 08:50:51.516349 (Thread-1): Parsing macros/calendar_date/last_week.sql
2020-12-02 08:50:51.520643 (Thread-1): Parsing macros/calendar_date/n_weeks_away.sql
2020-12-02 08:50:51.526055 (Thread-1): Parsing macros/calendar_date/tomorrow.sql
2020-12-02 08:50:51.530560 (Thread-1): Parsing macros/calendar_date/today.sql
2020-12-02 08:50:51.535128 (Thread-1): Parsing macros/fiscal_date/get_fiscal_periods.sql
2020-12-02 08:50:51.540624 (Thread-1): Parsing macros/fiscal_date/get_fiscal_year_dates.sql
2020-12-02 08:50:51.625935 (Thread-1): Acquiring new snowflake connection "model.sales_dataflo.stg_sf_opportunity".
2020-12-02 08:50:51.981188 (Thread-1): Acquiring new snowflake connection "model.dbt_date.dim_date_fiscal".
2020-12-02 08:50:52.016220 (Thread-1): Acquiring new snowflake connection "model.dbt_date.dim_date".
2020-12-02 08:50:52.037091 (Thread-1): Acquiring new snowflake connection "model.dbt_date.dates".
2020-12-02 08:50:52.229872 (Thread-1): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 4 unused configuration paths:
- models.sales_dataflo.utils
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-02 08:50:52.830879 (Thread-3): handling status request
2020-12-02 08:50:52.831380 (Thread-3): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '459f6bc7-2725-47e0-935e-b1bc02500cf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f73916430b8>]}
2020-12-02 08:50:52.843386 (Thread-3): sending response (<Response 32170 bytes [200 OK]>) to 10.0.23.210
2020-12-02 08:59:19.691799 (MainThread): Running with dbt=0.18.1
2020-12-02 08:59:20.037038 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.rpc.server.RPCServerTask'>, debug=False, defer=None, exclude=None, host='0.0.0.0', log_cache_events=False, log_format='default', models=None, partial_parse=True, port=8580, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='rpc', write_json=True)
2020-12-02 08:59:20.053128 (MainThread): Tracking: tracking
2020-12-02 08:59:20.053408 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8e80ea080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8e8137198>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8e81374a8>]}
2020-12-02 08:59:20.054652 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=13
2020-12-02 08:59:20.060258 (MainThread): Supported methods: ['cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'status', 'test']
2020-12-02 08:59:20.066374 (MainThread): Send requests to http://localhost:8580/jsonrpc
2020-12-02 08:59:20.146681 (Thread-1): Parsing macros/adapters.sql
2020-12-02 08:59:20.177860 (Thread-1): Parsing macros/catalog.sql
2020-12-02 08:59:20.180073 (Thread-1): Parsing macros/materializations/table.sql
2020-12-02 08:59:20.184519 (Thread-1): Parsing macros/materializations/merge.sql
2020-12-02 08:59:20.187540 (Thread-2): handling status request
2020-12-02 08:59:20.188046 (Thread-2): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '0a6bdcbd-e8bd-4b67-a81c-f607e5818544', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8e8118e80>]}
2020-12-02 08:59:20.190089 (Thread-2): sending response (<Response 184 bytes [200 OK]>) to 10.0.33.208
2020-12-02 08:59:20.190311 (Thread-1): Parsing macros/materializations/view.sql
2020-12-02 08:59:20.192774 (Thread-1): Parsing macros/materializations/incremental.sql
2020-12-02 08:59:20.203608 (Thread-1): Parsing macros/core.sql
2020-12-02 08:59:20.207544 (Thread-1): Parsing macros/adapters/common.sql
2020-12-02 08:59:20.253141 (Thread-1): Parsing macros/materializations/helpers.sql
2020-12-02 08:59:20.262868 (Thread-1): Parsing macros/materializations/table/table.sql
2020-12-02 08:59:20.270512 (Thread-1): Parsing macros/materializations/seed/seed.sql
2020-12-02 08:59:20.292831 (Thread-1): Parsing macros/materializations/view/view.sql
2020-12-02 08:59:20.299920 (Thread-1): Parsing macros/materializations/view/create_or_replace_view.sql
2020-12-02 08:59:20.305413 (Thread-1): Parsing macros/materializations/incremental/helpers.sql
2020-12-02 08:59:20.307499 (Thread-1): Parsing macros/materializations/incremental/incremental.sql
2020-12-02 08:59:20.314227 (Thread-1): Parsing macros/materializations/common/merge.sql
2020-12-02 08:59:20.329509 (Thread-1): Parsing macros/materializations/snapshot/strategies.sql
2020-12-02 08:59:20.347051 (Thread-1): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-12-02 08:59:20.349073 (Thread-1): Parsing macros/materializations/snapshot/snapshot.sql
2020-12-02 08:59:20.379440 (Thread-1): Parsing macros/schema_tests/relationships.sql
2020-12-02 08:59:20.381725 (Thread-1): Parsing macros/schema_tests/not_null.sql
2020-12-02 08:59:20.383495 (Thread-1): Parsing macros/schema_tests/unique.sql
2020-12-02 08:59:20.385424 (Thread-1): Parsing macros/schema_tests/accepted_values.sql
2020-12-02 08:59:20.388362 (Thread-1): Parsing macros/etc/get_custom_database.sql
2020-12-02 08:59:20.390178 (Thread-1): Parsing macros/etc/query.sql
2020-12-02 08:59:20.391356 (Thread-1): Parsing macros/etc/datetime.sql
2020-12-02 08:59:20.400805 (Thread-1): Parsing macros/etc/get_custom_alias.sql
2020-12-02 08:59:20.401897 (Thread-1): Parsing macros/etc/is_incremental.sql
2020-12-02 08:59:20.403951 (Thread-1): Parsing macros/etc/get_custom_schema.sql
2020-12-02 08:59:20.423961 (Thread-1): Parsing macros/logger/pretty_time.sql
2020-12-02 08:59:20.429339 (Thread-1): Parsing macros/logger/log_info.sql
2020-12-02 08:59:20.433992 (Thread-1): Parsing macros/logger/pretty_log_format.sql
2020-12-02 08:59:20.438327 (Thread-1): Parsing macros/sql/pivot.sql
2020-12-02 08:59:20.445252 (Thread-1): Parsing macros/sql/star.sql
2020-12-02 08:59:20.451936 (Thread-1): Parsing macros/sql/surrogate_key.sql
2020-12-02 08:59:20.458864 (Thread-1): Parsing macros/sql/get_query_results_as_dict.sql
2020-12-02 08:59:20.464739 (Thread-1): Parsing macros/sql/get_column_values.sql
2020-12-02 08:59:20.472532 (Thread-1): Parsing macros/sql/groupby.sql
2020-12-02 08:59:20.477731 (Thread-1): Parsing macros/sql/get_tables_by_pattern_sql.sql
2020-12-02 08:59:20.488602 (Thread-1): Parsing macros/sql/nullcheck_table.sql
2020-12-02 08:59:20.494119 (Thread-1): Parsing macros/sql/get_tables_by_prefix_sql.sql
2020-12-02 08:59:20.498668 (Thread-1): Parsing macros/sql/get_relations_by_pattern.sql
2020-12-02 08:59:20.505310 (Thread-1): Parsing macros/sql/get_relations_by_prefix.sql
2020-12-02 08:59:20.512341 (Thread-1): Parsing macros/sql/safe_add.sql
2020-12-02 08:59:20.517697 (Thread-1): Parsing macros/sql/unpivot.sql
2020-12-02 08:59:20.530156 (Thread-1): Parsing macros/sql/generate_series.sql
2020-12-02 08:59:20.538642 (Thread-1): Parsing macros/sql/nullcheck.sql
2020-12-02 08:59:20.544302 (Thread-1): Parsing macros/sql/union.sql
2020-12-02 08:59:20.559623 (Thread-1): Parsing macros/materializations/insert_by_period_materialization.sql
2020-12-02 08:59:20.596998 (Thread-1): Parsing macros/web/get_url_parameter.sql
2020-12-02 08:59:20.601770 (Thread-1): Parsing macros/web/get_url_path.sql
2020-12-02 08:59:20.607874 (Thread-1): Parsing macros/web/get_url_host.sql
2020-12-02 08:59:20.612460 (Thread-1): Parsing macros/datetime/date_spine.sql
2020-12-02 08:59:20.619243 (Thread-1): Parsing macros/schema_tests/expression_is_true.sql
2020-12-02 08:59:20.624720 (Thread-1): Parsing macros/schema_tests/not_constant.sql
2020-12-02 08:59:20.629236 (Thread-1): Parsing macros/schema_tests/at_least_one.sql
2020-12-02 08:59:20.633454 (Thread-1): Parsing macros/schema_tests/equality.sql
2020-12-02 08:59:20.640438 (Thread-1): Parsing macros/schema_tests/test_not_null_where.sql
2020-12-02 08:59:20.645282 (Thread-1): Parsing macros/schema_tests/equal_rowcount.sql
2020-12-02 08:59:20.650146 (Thread-1): Parsing macros/schema_tests/test_unique_where.sql
2020-12-02 08:59:20.655195 (Thread-1): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2020-12-02 08:59:20.664550 (Thread-1): Parsing macros/schema_tests/relationships_where.sql
2020-12-02 08:59:20.669903 (Thread-1): Parsing macros/schema_tests/unique_combination_of_columns.sql
2020-12-02 08:59:20.676102 (Thread-1): Parsing macros/schema_tests/recency.sql
2020-12-02 08:59:20.680771 (Thread-1): Parsing macros/schema_tests/cardinality_equality.sql
2020-12-02 08:59:20.685735 (Thread-1): Parsing macros/geo/haversine_distance.sql
2020-12-02 08:59:20.689760 (Thread-1): Parsing macros/cross_db_utils/split_part.sql
2020-12-02 08:59:20.695004 (Thread-1): Parsing macros/cross_db_utils/length.sql
2020-12-02 08:59:20.699877 (Thread-1): Parsing macros/cross_db_utils/current_timestamp.sql
2020-12-02 08:59:20.707007 (Thread-1): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2020-12-02 08:59:20.711520 (Thread-1): Parsing macros/cross_db_utils/right.sql
2020-12-02 08:59:20.717395 (Thread-1): Parsing macros/cross_db_utils/hash.sql
2020-12-02 08:59:20.722272 (Thread-1): Parsing macros/cross_db_utils/replace.sql
2020-12-02 08:59:20.727109 (Thread-1): Parsing macros/cross_db_utils/concat.sql
2020-12-02 08:59:20.733382 (Thread-1): Parsing macros/cross_db_utils/_is_relation.sql
2020-12-02 08:59:20.737843 (Thread-1): Parsing macros/cross_db_utils/identifier.sql
2020-12-02 08:59:20.744263 (Thread-1): Parsing macros/cross_db_utils/datediff.sql
2020-12-02 08:59:20.757991 (Thread-1): Parsing macros/cross_db_utils/dateadd.sql
2020-12-02 08:59:20.764230 (Thread-1): Parsing macros/cross_db_utils/datatypes.sql
2020-12-02 08:59:20.774820 (Thread-1): Parsing macros/cross_db_utils/position.sql
2020-12-02 08:59:20.780159 (Thread-1): Parsing macros/cross_db_utils/literal.sql
2020-12-02 08:59:20.784334 (Thread-1): Parsing macros/cross_db_utils/_is_ephemeral.sql
2020-12-02 08:59:20.789771 (Thread-1): Parsing macros/cross_db_utils/width_bucket.sql
2020-12-02 08:59:20.799090 (Thread-1): Parsing macros/cross_db_utils/date_trunc.sql
2020-12-02 08:59:20.804343 (Thread-1): Parsing macros/cross_db_utils/except.sql
2020-12-02 08:59:20.809226 (Thread-1): Parsing macros/cross_db_utils/safe_cast.sql
2020-12-02 08:59:20.814779 (Thread-1): Parsing macros/cross_db_utils/last_day.sql
2020-12-02 08:59:20.821059 (Thread-1): Parsing macros/cross_db_utils/intersect.sql
2020-12-02 08:59:20.828133 (Thread-1): Parsing macros/get_date_dimension.sql
2020-12-02 08:59:20.843085 (Thread-1): Parsing macros/get_base_dates.sql
2020-12-02 08:59:20.848349 (Thread-1): Parsing macros/calendar_date/n_weeks_ago.sql
2020-12-02 08:59:20.852728 (Thread-1): Parsing macros/calendar_date/to_unixtimestamp.sql
2020-12-02 08:59:20.858331 (Thread-1): Parsing macros/calendar_date/yesterday.sql
2020-12-02 08:59:20.862323 (Thread-1): Parsing macros/calendar_date/month_name.sql
2020-12-02 08:59:20.867940 (Thread-1): Parsing macros/calendar_date/day_name.sql
2020-12-02 08:59:20.873569 (Thread-1): Parsing macros/calendar_date/_get_utils_namespaces.sql
2020-12-02 08:59:20.878360 (Thread-1): Parsing macros/calendar_date/date_part.sql
2020-12-02 08:59:20.883549 (Thread-1): Parsing macros/calendar_date/n_days_ago.sql
2020-12-02 08:59:20.887955 (Thread-1): Parsing macros/calendar_date/now.sql
2020-12-02 08:59:20.892292 (Thread-1): Parsing macros/calendar_date/n_months_ago.sql
2020-12-02 08:59:20.896697 (Thread-1): Parsing macros/calendar_date/this_week.sql
2020-12-02 08:59:20.900651 (Thread-1): Parsing macros/calendar_date/convert_timezone.sql
2020-12-02 08:59:20.906860 (Thread-1): Parsing macros/calendar_date/periods_since.sql
2020-12-02 08:59:20.911336 (Thread-1): Parsing macros/calendar_date/n_months_away.sql
2020-12-02 08:59:20.915557 (Thread-1): Parsing macros/calendar_date/n_days_away.sql
2020-12-02 08:59:20.919582 (Thread-1): Parsing macros/calendar_date/last_week.sql
2020-12-02 08:59:20.926052 (Thread-1): Parsing macros/calendar_date/n_weeks_away.sql
2020-12-02 08:59:20.930527 (Thread-1): Parsing macros/calendar_date/tomorrow.sql
2020-12-02 08:59:20.934831 (Thread-1): Parsing macros/calendar_date/today.sql
2020-12-02 08:59:20.938891 (Thread-1): Parsing macros/fiscal_date/get_fiscal_periods.sql
2020-12-02 08:59:20.944329 (Thread-1): Parsing macros/fiscal_date/get_fiscal_year_dates.sql
2020-12-02 08:59:21.025127 (Thread-1): Acquiring new snowflake connection "model.sales_dataflo.stg_sf_opportunity".
2020-12-02 08:59:21.392690 (Thread-1): Acquiring new snowflake connection "model.dbt_date.dim_date_fiscal".
2020-12-02 08:59:21.428844 (Thread-1): Acquiring new snowflake connection "model.dbt_date.dim_date".
2020-12-02 08:59:21.449407 (Thread-1): Acquiring new snowflake connection "model.dbt_date.dates".
2020-12-02 08:59:21.638240 (Thread-1): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 4 unused configuration paths:
- models.sales_dataflo.utils
- models.sales_dataflo.marts
- models.sales_dataflo.intermediate
- seeds.FivetranDbt_Transformation

2020-12-02 08:59:22.146274 (Thread-3): handling status request
2020-12-02 08:59:22.146782 (Thread-3): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '0a6bdcbd-e8bd-4b67-a81c-f607e5818544', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8e03eb160>]}
2020-12-02 08:59:22.159262 (Thread-3): sending response (<Response 32170 bytes [200 OK]>) to 10.0.45.111
2020-12-02 08:59:33.824425 (Thread-4): handling status request
2020-12-02 08:59:33.826203 (Thread-4): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '0a6bdcbd-e8bd-4b67-a81c-f607e5818544', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8e03c3400>]}
2020-12-02 08:59:33.838578 (Thread-4): sending response (<Response 32170 bytes [200 OK]>) to 10.0.45.111
2020-12-02 08:59:34.265881 (Thread-5): handling ps request
2020-12-02 08:59:34.266440 (Thread-5): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '0a6bdcbd-e8bd-4b67-a81c-f607e5818544', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd8e03e5240>]}
2020-12-02 08:59:34.268395 (Thread-5): sending response (<Response 104 bytes [200 OK]>) to 10.0.26.14
2020-12-02 09:14:19.584440 (MainThread): Running with dbt=0.18.1
2020-12-02 09:14:19.899384 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.rpc.server.RPCServerTask'>, debug=False, defer=None, exclude=None, host='0.0.0.0', log_cache_events=False, log_format='default', models=None, partial_parse=True, port=8580, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='rpc', write_json=True)
2020-12-02 09:14:19.913748 (MainThread): Tracking: tracking
2020-12-02 09:14:19.913944 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd71b506a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd738aa1dd8>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd71b51a7b8>]}
2020-12-02 09:14:19.914991 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=13
2020-12-02 09:14:19.920517 (MainThread): Supported methods: ['cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'status', 'test']
2020-12-02 09:14:19.925618 (MainThread): Send requests to http://localhost:8580/jsonrpc
2020-12-02 09:14:19.957627 (Thread-2): handling status request
2020-12-02 09:14:19.958032 (Thread-2): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'f00b0631-4bb8-406d-b5fb-ccfa9370457b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd71b506a90>]}
2020-12-02 09:14:19.959895 (Thread-2): sending response (<Response 184 bytes [200 OK]>) to 10.0.12.174
2020-12-02 09:14:20.018994 (Thread-1): Parsing macros/adapters.sql
2020-12-02 09:14:20.050590 (Thread-1): Parsing macros/catalog.sql
2020-12-02 09:14:20.052641 (Thread-1): Parsing macros/materializations/table.sql
2020-12-02 09:14:20.056681 (Thread-1): Parsing macros/materializations/merge.sql
2020-12-02 09:14:20.058830 (Thread-1): Parsing macros/materializations/view.sql
2020-12-02 09:14:20.060401 (Thread-1): Parsing macros/materializations/incremental.sql
2020-12-02 09:14:20.070928 (Thread-1): Parsing macros/core.sql
2020-12-02 09:14:20.074785 (Thread-1): Parsing macros/adapters/common.sql
2020-12-02 09:14:20.119390 (Thread-1): Parsing macros/materializations/helpers.sql
2020-12-02 09:14:20.128791 (Thread-1): Parsing macros/materializations/table/table.sql
2020-12-02 09:14:20.135830 (Thread-1): Parsing macros/materializations/seed/seed.sql
2020-12-02 09:14:20.157498 (Thread-1): Parsing macros/materializations/view/view.sql
2020-12-02 09:14:20.164016 (Thread-1): Parsing macros/materializations/view/create_or_replace_view.sql
2020-12-02 09:14:20.169250 (Thread-1): Parsing macros/materializations/incremental/helpers.sql
2020-12-02 09:14:20.171202 (Thread-1): Parsing macros/materializations/incremental/incremental.sql
2020-12-02 09:14:20.177558 (Thread-1): Parsing macros/materializations/common/merge.sql
2020-12-02 09:14:20.192049 (Thread-1): Parsing macros/materializations/snapshot/strategies.sql
2020-12-02 09:14:20.209403 (Thread-1): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-12-02 09:14:20.211273 (Thread-1): Parsing macros/materializations/snapshot/snapshot.sql
2020-12-02 09:14:20.250415 (Thread-1): Parsing macros/schema_tests/relationships.sql
2020-12-02 09:14:20.252751 (Thread-1): Parsing macros/schema_tests/not_null.sql
2020-12-02 09:14:20.254448 (Thread-1): Parsing macros/schema_tests/unique.sql
2020-12-02 09:14:20.256340 (Thread-1): Parsing macros/schema_tests/accepted_values.sql
2020-12-02 09:14:20.259239 (Thread-1): Parsing macros/etc/get_custom_database.sql
2020-12-02 09:14:20.261022 (Thread-1): Parsing macros/etc/query.sql
2020-12-02 09:14:20.262206 (Thread-1): Parsing macros/etc/datetime.sql
2020-12-02 09:14:20.271475 (Thread-1): Parsing macros/etc/get_custom_alias.sql
2020-12-02 09:14:20.272507 (Thread-1): Parsing macros/etc/is_incremental.sql
2020-12-02 09:14:20.274276 (Thread-1): Parsing macros/etc/get_custom_schema.sql
2020-12-02 09:14:20.302322 (Thread-1): Parsing macros/logger/pretty_time.sql
2020-12-02 09:14:20.309204 (Thread-1): Parsing macros/logger/log_info.sql
2020-12-02 09:14:20.316955 (Thread-1): Parsing macros/logger/pretty_log_format.sql
2020-12-02 09:14:20.324020 (Thread-1): Parsing macros/sql/pivot.sql
2020-12-02 09:14:20.334207 (Thread-1): Parsing macros/sql/star.sql
2020-12-02 09:14:20.344608 (Thread-1): Parsing macros/sql/surrogate_key.sql
2020-12-02 09:14:20.353810 (Thread-1): Parsing macros/sql/get_query_results_as_dict.sql
2020-12-02 09:14:20.363461 (Thread-1): Parsing macros/sql/get_column_values.sql
2020-12-02 09:14:20.375996 (Thread-1): Parsing macros/sql/groupby.sql
2020-12-02 09:14:20.384604 (Thread-1): Parsing macros/sql/get_tables_by_pattern_sql.sql
2020-12-02 09:14:20.398669 (Thread-1): Parsing macros/sql/nullcheck_table.sql
2020-12-02 09:14:20.406914 (Thread-1): Parsing macros/sql/get_tables_by_prefix_sql.sql
2020-12-02 09:14:20.414327 (Thread-1): Parsing macros/sql/get_relations_by_pattern.sql
2020-12-02 09:14:20.423092 (Thread-1): Parsing macros/sql/get_relations_by_prefix.sql
2020-12-02 09:14:20.432842 (Thread-1): Parsing macros/sql/safe_add.sql
2020-12-02 09:14:20.440245 (Thread-1): Parsing macros/sql/unpivot.sql
2020-12-02 09:14:20.453471 (Thread-1): Parsing macros/sql/generate_series.sql
2020-12-02 09:14:20.464963 (Thread-1): Parsing macros/sql/nullcheck.sql
2020-12-02 09:14:20.474543 (Thread-1): Parsing macros/sql/union.sql
2020-12-02 09:14:20.496235 (Thread-1): Parsing macros/materializations/insert_by_period_materialization.sql
2020-12-02 09:14:20.530810 (Thread-1): Parsing macros/web/get_url_parameter.sql
2020-12-02 09:14:20.539086 (Thread-1): Parsing macros/web/get_url_path.sql
2020-12-02 09:14:20.548662 (Thread-1): Parsing macros/web/get_url_host.sql
2020-12-02 09:14:20.559501 (Thread-1): Parsing macros/datetime/date_spine.sql
2020-12-02 09:14:20.569858 (Thread-1): Parsing macros/schema_tests/expression_is_true.sql
2020-12-02 09:14:20.578037 (Thread-1): Parsing macros/schema_tests/not_constant.sql
2020-12-02 09:14:20.597281 (Thread-1): Parsing macros/schema_tests/at_least_one.sql
2020-12-02 09:14:20.605927 (Thread-1): Parsing macros/schema_tests/equality.sql
2020-12-02 09:14:20.618270 (Thread-1): Parsing macros/schema_tests/test_not_null_where.sql
2020-12-02 09:14:20.629136 (Thread-1): Parsing macros/schema_tests/equal_rowcount.sql
2020-12-02 09:14:20.638154 (Thread-1): Parsing macros/schema_tests/test_unique_where.sql
2020-12-02 09:14:20.648251 (Thread-1): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2020-12-02 09:14:20.663394 (Thread-1): Parsing macros/schema_tests/relationships_where.sql
2020-12-02 09:14:20.671677 (Thread-1): Parsing macros/schema_tests/unique_combination_of_columns.sql
2020-12-02 09:14:20.680869 (Thread-1): Parsing macros/schema_tests/recency.sql
2020-12-02 09:14:20.690175 (Thread-1): Parsing macros/schema_tests/cardinality_equality.sql
2020-12-02 09:14:20.697567 (Thread-1): Parsing macros/geo/haversine_distance.sql
2020-12-02 09:14:20.706333 (Thread-1): Parsing macros/cross_db_utils/split_part.sql
2020-12-02 09:14:20.716014 (Thread-1): Parsing macros/cross_db_utils/length.sql
2020-12-02 09:14:20.725988 (Thread-1): Parsing macros/cross_db_utils/current_timestamp.sql
2020-12-02 09:14:20.738783 (Thread-1): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2020-12-02 09:14:20.748387 (Thread-1): Parsing macros/cross_db_utils/right.sql
2020-12-02 09:14:20.758740 (Thread-1): Parsing macros/cross_db_utils/hash.sql
2020-12-02 09:14:20.766525 (Thread-1): Parsing macros/cross_db_utils/replace.sql
2020-12-02 09:14:20.774895 (Thread-1): Parsing macros/cross_db_utils/concat.sql
2020-12-02 09:14:20.784870 (Thread-1): Parsing macros/cross_db_utils/_is_relation.sql
2020-12-02 09:14:20.793876 (Thread-1): Parsing macros/cross_db_utils/identifier.sql
2020-12-02 09:14:20.802229 (Thread-1): Parsing macros/cross_db_utils/datediff.sql
2020-12-02 09:14:20.820255 (Thread-1): Parsing macros/cross_db_utils/dateadd.sql
2020-12-02 09:14:20.829971 (Thread-1): Parsing macros/cross_db_utils/datatypes.sql
2020-12-02 09:14:20.843392 (Thread-1): Parsing macros/cross_db_utils/position.sql
2020-12-02 09:14:20.852389 (Thread-1): Parsing macros/cross_db_utils/literal.sql
2020-12-02 09:14:20.860655 (Thread-1): Parsing macros/cross_db_utils/_is_ephemeral.sql
2020-12-02 09:14:20.869678 (Thread-1): Parsing macros/cross_db_utils/width_bucket.sql
2020-12-02 09:14:20.883565 (Thread-1): Parsing macros/cross_db_utils/date_trunc.sql
2020-12-02 09:14:20.893875 (Thread-1): Parsing macros/cross_db_utils/except.sql
2020-12-02 09:14:20.901898 (Thread-1): Parsing macros/cross_db_utils/safe_cast.sql
2020-12-02 09:14:20.911942 (Thread-1): Parsing macros/cross_db_utils/last_day.sql
2020-12-02 09:14:20.924543 (Thread-1): Parsing macros/cross_db_utils/intersect.sql
2020-12-02 09:14:20.936981 (Thread-1): Parsing macros/get_date_dimension.sql
2020-12-02 09:14:20.955791 (Thread-1): Parsing macros/get_base_dates.sql
2020-12-02 09:14:20.964246 (Thread-1): Parsing macros/calendar_date/n_weeks_ago.sql
2020-12-02 09:14:20.972646 (Thread-1): Parsing macros/calendar_date/to_unixtimestamp.sql
2020-12-02 09:14:20.981434 (Thread-1): Parsing macros/calendar_date/yesterday.sql
2020-12-02 09:14:20.989267 (Thread-1): Parsing macros/calendar_date/month_name.sql
2020-12-02 09:14:20.998147 (Thread-1): Parsing macros/calendar_date/day_name.sql
2020-12-02 09:14:21.007382 (Thread-1): Parsing macros/calendar_date/_get_utils_namespaces.sql
2020-12-02 09:14:21.016786 (Thread-1): Parsing macros/calendar_date/date_part.sql
2020-12-02 09:14:21.025297 (Thread-1): Parsing macros/calendar_date/n_days_ago.sql
2020-12-02 09:14:21.032817 (Thread-1): Parsing macros/calendar_date/now.sql
2020-12-02 09:14:21.040598 (Thread-1): Parsing macros/calendar_date/n_months_ago.sql
2020-12-02 09:14:21.050420 (Thread-1): Parsing macros/calendar_date/this_week.sql
2020-12-02 09:14:21.057967 (Thread-1): Parsing macros/calendar_date/convert_timezone.sql
2020-12-02 09:14:21.070468 (Thread-1): Parsing macros/calendar_date/periods_since.sql
2020-12-02 09:14:21.078751 (Thread-1): Parsing macros/calendar_date/n_months_away.sql
2020-12-02 09:14:21.087468 (Thread-1): Parsing macros/calendar_date/n_days_away.sql
2020-12-02 09:14:21.095863 (Thread-1): Parsing macros/calendar_date/last_week.sql
2020-12-02 09:14:21.104897 (Thread-1): Parsing macros/calendar_date/n_weeks_away.sql
2020-12-02 09:14:21.114262 (Thread-1): Parsing macros/calendar_date/tomorrow.sql
2020-12-02 09:14:21.121711 (Thread-1): Parsing macros/calendar_date/today.sql
2020-12-02 09:14:21.130570 (Thread-1): Parsing macros/fiscal_date/get_fiscal_periods.sql
2020-12-02 09:14:21.142698 (Thread-1): Parsing macros/fiscal_date/get_fiscal_year_dates.sql
2020-12-02 09:14:21.260149 (Thread-1): Acquiring new snowflake connection "model.sales_dataflo.stg_sf_opportunity".
2020-12-02 09:14:21.515943 (Thread-3): handling status request
2020-12-02 09:14:21.516486 (Thread-3): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'f00b0631-4bb8-406d-b5fb-ccfa9370457b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd7191a13c8>]}
2020-12-02 09:14:21.517370 (Thread-3): sending response (<Response 184 bytes [200 OK]>) to 10.0.31.170
2020-12-02 09:14:21.621122 (Thread-1): Acquiring new snowflake connection "model.dbt_date.dim_date_fiscal".
2020-12-02 09:14:21.657291 (Thread-1): Acquiring new snowflake connection "model.dbt_date.dim_date".
2020-12-02 09:14:21.678577 (Thread-1): Acquiring new snowflake connection "model.dbt_date.dates".
2020-12-02 09:14:21.878454 (Thread-1): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 4 unused configuration paths:
- models.sales_dataflo.utils
- models.sales_dataflo.marts
- models.sales_dataflo.intermediate
- seeds.FivetranDbt_Transformation

2020-12-02 09:14:22.969528 (Thread-4): handling status request
2020-12-02 09:14:22.970029 (Thread-4): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'f00b0631-4bb8-406d-b5fb-ccfa9370457b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd718fa7e80>]}
2020-12-02 09:14:22.982234 (Thread-4): sending response (<Response 32170 bytes [200 OK]>) to 10.0.23.210
2020-12-02 09:22:14.011690 (Thread-5): handling status request
2020-12-02 09:22:14.014065 (Thread-5): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'f00b0631-4bb8-406d-b5fb-ccfa9370457b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd718f28550>]}
2020-12-02 09:22:14.026260 (Thread-5): sending response (<Response 32170 bytes [200 OK]>) to 10.0.47.27
2020-12-02 09:22:14.544422 (Thread-6): handling run_sql request
2020-12-02 09:22:14.544921 (Thread-6): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'f00b0631-4bb8-406d-b5fb-ccfa9370457b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd718f89278>]}
2020-12-02 09:22:14.548271 (Thread-6): Connection 'model.dbt_date.dates' was properly closed.
2020-12-02 09:22:15.616498 (Thread-6): sending response (<Response 137 bytes [200 OK]>) to 10.0.12.174
2020-12-02 09:22:15.644092 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 09:22:15.735689 (MainThread): Found 1 model, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 09:22:15.736205 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 09:22:15.736343 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 09:22:15.755294 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 09:22:15.755392 (Thread-1): On rpc.sales_dataflo.request: BEGIN
2020-12-02 09:22:15.755460 (Thread-1): Opening a new connection, currently in state init
2020-12-02 09:22:15.915274 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 09:22:16.195280 (Thread-7): handling poll request
2020-12-02 09:22:16.195824 (Thread-7): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'f00b0631-4bb8-406d-b5fb-ccfa9370457b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd718f14908>]}
2020-12-02 09:22:16.199675 (Thread-7): sending response (<Response 2413 bytes [200 OK]>) to 10.0.12.174
2020-12-02 09:22:17.022135 (Thread-1): SQL status: SUCCESS 1 in 1.27 seconds
2020-12-02 09:22:17.022302 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 09:22:17.022371 (Thread-1): On rpc.sales_dataflo.request: select 
  

    datediff(
        day,
        cast('2015-01-01' as datetime),
        cast('2022-12-31' as datetime)
        )
2020-12-02 09:22:17.114749 (Thread-1): SQL status: SUCCESS 1 in 0.09 seconds
2020-12-02 09:22:17.127442 (Thread-1): finished collecting timing info
2020-12-02 09:22:17.131473 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 09:22:17.131569 (Thread-1): On rpc.sales_dataflo.request: with base_dates as (
    
with date_spine as
(
    

    

/*
call as follows:

date_spine(
    "day",
    "to_date('01/01/2016', 'mm/dd/yyyy')",
    "dateadd(week, 1, current_date)"
)

*/

with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * pow(2, 0)
     + 
    
    p1.generated_number * pow(2, 1)
     + 
    
    p2.generated_number * pow(2, 2)
     + 
    
    p3.generated_number * pow(2, 3)
     + 
    
    p4.generated_number * pow(2, 4)
     + 
    
    p5.generated_number * pow(2, 5)
     + 
    
    p6.generated_number * pow(2, 6)
     + 
    
    p7.generated_number * pow(2, 7)
     + 
    
    p8.generated_number * pow(2, 8)
     + 
    
    p9.generated_number * pow(2, 9)
     + 
    
    p10.generated_number * pow(2, 10)
     + 
    
    p11.generated_number * pow(2, 11)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
     cross join 
    
    p as p7
     cross join 
    
    p as p8
     cross join 
    
    p as p9
     cross join 
    
    p as p10
     cross join 
    
    p as p11
    
    

    )

    select *
    from unioned
    where generated_number <= 2921
    order by generated_number



),

all_periods as (

    select (
        
  

    dateadd(
        day,
        row_number() over (order by 1) - 1,
        cast('2015-01-01' as datetime)
        )



    ) as date_day
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_day <= cast('2022-12-31' as datetime)

)

select * from filtered



)
select
    date(d.date_day) as date_day
from
    date_spine d

),
dates_with_prior_year_dates as (
    select
        cast(d.date_day as date) as date_day,
        cast(
  

    dateadd(
        year,
        -1,
        d.date_day
        )


 as date) as prior_year_date_day,
        cast(
  

    dateadd(
        day,
        -364,
        d.date_day
        )


 as date) as prior_year_over_year_date_day
    from
    	base_dates d
)
select
    d.date_day,
    cast(
  

    dateadd(
        day,
        -1,
        d.date_day
        )


 as date) as prior_date_day,
    cast(
  

    dateadd(
        day,
        1,
        d.date_day
        )


 as date) as next_date_day,
    d.prior_year_date_day as prior_year_date_day,
    d.prior_year_over_year_date_day,
    cast(
            case
                when date_part('dayofweek', d.date_day) = 0 then 7
                else date_part('dayofweek', d.date_day)
            end
        as 
    int

    ) as day_of_week,

    to_char(d.date_day, 'Day') as day_of_week_name,
    to_char(d.date_day, 'Dy') as day_of_week_name_short,
    cast(date_part('day', d.date_day) as 
    int
) as day_of_month,
    cast(date_part('dayofyear', d.date_day) as 
    int
) as day_of_year,

    cast(
    date_trunc('week', d.date_day)
 as date) as week_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', d.date_day)

        )



        )



        as date)
 as date) as week_end_date,
    cast(date_part('week', d.date_day) as 
    int
) as week_of_year,
    cast(
    date_trunc('week', d.prior_year_over_year_date_day)
 as date) as prior_year_week_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', d.prior_year_over_year_date_day)

        )



        )



        as date)
 as date) as prior_year_week_end_date,
    cast(date_part('week', d.prior_year_over_year_date_day) as 
    int
) as prior_year_week_of_year,

    cast(date_part('month', d.date_day) as 
    int
) as month_of_year,
    to_char(d.date_day, 'MONTH')  as month_name,
    to_char(d.date_day, 'MON')  as month_name_short,

    cast(
    date_trunc('month', d.date_day)
 as date) as month_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', d.date_day)

        )



        )



        as date)
 as date) as month_end_date,

    cast(
    date_trunc('month', d.prior_year_date_day)
 as date) as prior_year_month_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', d.prior_year_date_day)

        )



        )



        as date)
 as date) as prior_year_month_end_date,

    cast(date_part('quarter', d.date_day) as 
    int
) as quarter_of_year,
    cast(
    date_trunc('quarter', d.date_day)
 as date) as quarter_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        quarter,
        1,
        
    date_trunc('quarter', d.date_day)

        )



        )



        as date)
 as date) as quarter_end_date,

    cast(date_part('year', d.date_day) as 
    int
) as year_number,
    cast(
    date_trunc('year', d.date_day)
 as date) as year_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        year,
        1,
        
    date_trunc('year', d.date_day)

        )



        )



        as date)
 as date) as year_end_date
from
    dates_with_prior_year_dates d
order by 1


limit 100
2020-12-02 09:22:17.797683 (Thread-1): SQL status: SUCCESS 100 in 0.67 seconds
2020-12-02 09:22:17.814814 (Thread-1): finished collecting timing info
2020-12-02 09:22:17.815186 (Thread-1): On rpc.sales_dataflo.request: ROLLBACK
2020-12-02 09:22:17.934247 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 09:22:18.591988 (Thread-8): handling poll request
2020-12-02 09:22:18.592481 (Thread-8): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'f00b0631-4bb8-406d-b5fb-ccfa9370457b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd718fa4ac8>]}
2020-12-02 09:22:18.601699 (Thread-8): sending response (<Response 61773 bytes [200 OK]>) to 10.0.24.195
2020-12-02 09:24:00.013915 (MainThread): writing 1 spans (enabled:True), 110 additional messages skipped
2020-12-02 09:24:00.016454 (MainThread): 
      name jinja2.compile
        id 6298413933897532077
  trace_id 11912398855836320665
 parent_id None
   service None
  resource <memory>
      type template
     start 1606901040.012925
       end 1606901040.0136778
  duration 0.000753s
     error 0
      tags 
           jinja2.template_name:<memory>
           runtime-id:f39b0e32baf34f3f86b8d47dfbd1a614, 177 additional messages skipped
2020-12-02 09:24:00.542847 (Thread-9): Got an acceptable cached parse result
2020-12-02 09:24:00.830731 (AgentWriter): reported 61 traces in 0.00381s, 5 additional messages skipped
2020-12-02 09:24:00.830967 (AgentWriter): initialized RateSampler, sample 100% of traces, 215 additional messages skipped
2020-12-02 09:24:01.039739 (Thread-9): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 4 unused configuration paths:
- models.sales_dataflo.utils
- models.sales_dataflo.marts
- models.sales_dataflo.intermediate
- seeds.FivetranDbt_Transformation

2020-12-02 09:24:01.040674 (Thread-10): handling status request
2020-12-02 09:24:01.042033 (Thread-10): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': 'f00b0631-4bb8-406d-b5fb-ccfa9370457b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd7193699e8>]}
2020-12-02 09:24:01.043426 (Thread-10): sending response (<Response 974 bytes [200 OK]>) to 10.0.27.241
2020-12-02 11:42:35.030022 (MainThread): Running with dbt=0.18.1
2020-12-02 11:42:35.343417 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.rpc.server.RPCServerTask'>, debug=False, defer=None, exclude=None, host='0.0.0.0', log_cache_events=False, log_format='default', models=None, partial_parse=True, port=8580, profile='user', profiles_dir='/usr/src/develop/.dbt', project_dir=None, record_timing_info=None, rpc_method=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='rpc', write_json=True)
2020-12-02 11:42:35.357483 (MainThread): Tracking: tracking
2020-12-02 11:42:35.357671 (MainThread): Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce6439f748>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce6439f940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce6439f4a8>]}
2020-12-02 11:42:35.357982 (MainThread): Serving RPC server at 0.0.0.0:8580, pid=14
2020-12-02 11:42:35.364314 (MainThread): Supported methods: ['cli_args', 'compile', 'compile_sql', 'deps', 'docs.generate', 'gc', 'get-manifest', 'kill', 'poll', 'ps', 'run', 'run-operation', 'run_sql', 'seed', 'snapshot', 'snapshot-freshness', 'status', 'test']
2020-12-02 11:42:35.369061 (MainThread): Send requests to http://localhost:8580/jsonrpc
2020-12-02 11:42:35.447331 (Thread-1): Parsing macros/adapters.sql
2020-12-02 11:42:35.477873 (Thread-1): Parsing macros/catalog.sql
2020-12-02 11:42:35.479949 (Thread-1): Parsing macros/materializations/table.sql
2020-12-02 11:42:35.484430 (Thread-1): Parsing macros/materializations/merge.sql
2020-12-02 11:42:35.486529 (Thread-1): Parsing macros/materializations/view.sql
2020-12-02 11:42:35.488081 (Thread-1): Parsing macros/materializations/incremental.sql
2020-12-02 11:42:35.498635 (Thread-1): Parsing macros/core.sql
2020-12-02 11:42:35.502456 (Thread-1): Parsing macros/adapters/common.sql
2020-12-02 11:42:35.547055 (Thread-1): Parsing macros/materializations/helpers.sql
2020-12-02 11:42:35.556459 (Thread-1): Parsing macros/materializations/table/table.sql
2020-12-02 11:42:35.563625 (Thread-1): Parsing macros/materializations/seed/seed.sql
2020-12-02 11:42:35.585130 (Thread-1): Parsing macros/materializations/view/view.sql
2020-12-02 11:42:35.591603 (Thread-1): Parsing macros/materializations/view/create_or_replace_view.sql
2020-12-02 11:42:35.596736 (Thread-1): Parsing macros/materializations/incremental/helpers.sql
2020-12-02 11:42:35.598712 (Thread-1): Parsing macros/materializations/incremental/incremental.sql
2020-12-02 11:42:35.605205 (Thread-1): Parsing macros/materializations/common/merge.sql
2020-12-02 11:42:35.619775 (Thread-1): Parsing macros/materializations/snapshot/strategies.sql
2020-12-02 11:42:35.636657 (Thread-1): Parsing macros/materializations/snapshot/snapshot_merge.sql
2020-12-02 11:42:35.638527 (Thread-1): Parsing macros/materializations/snapshot/snapshot.sql
2020-12-02 11:42:35.683173 (Thread-1): Parsing macros/schema_tests/relationships.sql
2020-12-02 11:42:35.686499 (Thread-1): Parsing macros/schema_tests/not_null.sql
2020-12-02 11:42:35.689126 (Thread-1): Parsing macros/schema_tests/unique.sql
2020-12-02 11:42:35.692111 (Thread-1): Parsing macros/schema_tests/accepted_values.sql
2020-12-02 11:42:35.696796 (Thread-1): Parsing macros/etc/get_custom_database.sql
2020-12-02 11:42:35.699688 (Thread-1): Parsing macros/etc/query.sql
2020-12-02 11:42:35.701458 (Thread-1): Parsing macros/etc/datetime.sql
2020-12-02 11:42:35.710880 (Thread-1): Parsing macros/etc/get_custom_alias.sql
2020-12-02 11:42:35.711893 (Thread-1): Parsing macros/etc/is_incremental.sql
2020-12-02 11:42:35.713576 (Thread-1): Parsing macros/etc/get_custom_schema.sql
2020-12-02 11:42:35.732313 (Thread-1): Parsing macros/logger/pretty_time.sql
2020-12-02 11:42:35.737424 (Thread-1): Parsing macros/logger/log_info.sql
2020-12-02 11:42:35.742380 (Thread-1): Parsing macros/logger/pretty_log_format.sql
2020-12-02 11:42:35.747195 (Thread-1): Parsing macros/sql/pivot.sql
2020-12-02 11:42:35.754436 (Thread-1): Parsing macros/sql/star.sql
2020-12-02 11:42:35.761597 (Thread-1): Parsing macros/sql/surrogate_key.sql
2020-12-02 11:42:35.768566 (Thread-1): Parsing macros/sql/get_query_results_as_dict.sql
2020-12-02 11:42:35.774779 (Thread-1): Parsing macros/sql/get_column_values.sql
2020-12-02 11:42:35.783382 (Thread-1): Parsing macros/sql/groupby.sql
2020-12-02 11:42:35.788648 (Thread-1): Parsing macros/sql/get_tables_by_pattern_sql.sql
2020-12-02 11:42:35.799274 (Thread-1): Parsing macros/sql/nullcheck_table.sql
2020-12-02 11:42:35.804844 (Thread-1): Parsing macros/sql/get_tables_by_prefix_sql.sql
2020-12-02 11:42:35.810238 (Thread-1): Parsing macros/sql/get_relations_by_pattern.sql
2020-12-02 11:42:35.817020 (Thread-1): Parsing macros/sql/get_relations_by_prefix.sql
2020-12-02 11:42:35.824193 (Thread-1): Parsing macros/sql/safe_add.sql
2020-12-02 11:42:35.829335 (Thread-1): Parsing macros/sql/unpivot.sql
2020-12-02 11:42:35.840053 (Thread-1): Parsing macros/sql/generate_series.sql
2020-12-02 11:42:35.847801 (Thread-1): Parsing macros/sql/nullcheck.sql
2020-12-02 11:42:35.853559 (Thread-1): Parsing macros/sql/union.sql
2020-12-02 11:42:35.868399 (Thread-1): Parsing macros/materializations/insert_by_period_materialization.sql
2020-12-02 11:42:35.896475 (Thread-1): Parsing macros/web/get_url_parameter.sql
2020-12-02 11:42:35.901825 (Thread-1): Parsing macros/web/get_url_path.sql
2020-12-02 11:42:35.908425 (Thread-1): Parsing macros/web/get_url_host.sql
2020-12-02 11:42:35.914086 (Thread-1): Parsing macros/datetime/date_spine.sql
2020-12-02 11:42:35.921722 (Thread-1): Parsing macros/schema_tests/expression_is_true.sql
2020-12-02 11:42:35.927539 (Thread-1): Parsing macros/schema_tests/not_constant.sql
2020-12-02 11:42:35.932999 (Thread-1): Parsing macros/schema_tests/at_least_one.sql
2020-12-02 11:42:35.938395 (Thread-1): Parsing macros/schema_tests/equality.sql
2020-12-02 11:42:35.946423 (Thread-1): Parsing macros/schema_tests/test_not_null_where.sql
2020-12-02 11:42:35.954221 (Thread-1): Parsing macros/schema_tests/equal_rowcount.sql
2020-12-02 11:42:35.959883 (Thread-1): Parsing macros/schema_tests/test_unique_where.sql
2020-12-02 11:42:35.965968 (Thread-1): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2020-12-02 11:42:35.975989 (Thread-1): Parsing macros/schema_tests/relationships_where.sql
2020-12-02 11:42:35.982624 (Thread-1): Parsing macros/schema_tests/unique_combination_of_columns.sql
2020-12-02 11:42:35.989416 (Thread-1): Parsing macros/schema_tests/recency.sql
2020-12-02 11:42:35.995171 (Thread-1): Parsing macros/schema_tests/cardinality_equality.sql
2020-12-02 11:42:36.002733 (Thread-1): Parsing macros/geo/haversine_distance.sql
2020-12-02 11:42:36.009328 (Thread-1): Parsing macros/cross_db_utils/split_part.sql
2020-12-02 11:42:36.016542 (Thread-1): Parsing macros/cross_db_utils/length.sql
2020-12-02 11:42:36.022303 (Thread-1): Parsing macros/cross_db_utils/current_timestamp.sql
2020-12-02 11:42:36.030934 (Thread-1): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2020-12-02 11:42:36.039635 (Thread-1): Parsing macros/cross_db_utils/right.sql
2020-12-02 11:42:36.048385 (Thread-1): Parsing macros/cross_db_utils/hash.sql
2020-12-02 11:42:36.054687 (Thread-1): Parsing macros/cross_db_utils/replace.sql
2020-12-02 11:42:36.060877 (Thread-1): Parsing macros/cross_db_utils/concat.sql
2020-12-02 11:42:36.068625 (Thread-1): Parsing macros/cross_db_utils/_is_relation.sql
2020-12-02 11:42:36.075384 (Thread-1): Parsing macros/cross_db_utils/identifier.sql
2020-12-02 11:42:36.081512 (Thread-1): Parsing macros/cross_db_utils/datediff.sql
2020-12-02 11:42:36.096704 (Thread-1): Parsing macros/cross_db_utils/dateadd.sql
2020-12-02 11:42:36.103755 (Thread-1): Parsing macros/cross_db_utils/datatypes.sql
2020-12-02 11:42:36.115786 (Thread-1): Parsing macros/cross_db_utils/position.sql
2020-12-02 11:42:36.121965 (Thread-1): Parsing macros/cross_db_utils/literal.sql
2020-12-02 11:42:36.127761 (Thread-1): Parsing macros/cross_db_utils/_is_ephemeral.sql
2020-12-02 11:42:36.134751 (Thread-1): Parsing macros/cross_db_utils/width_bucket.sql
2020-12-02 11:42:36.145663 (Thread-1): Parsing macros/cross_db_utils/date_trunc.sql
2020-12-02 11:42:36.151857 (Thread-1): Parsing macros/cross_db_utils/except.sql
2020-12-02 11:42:36.157608 (Thread-1): Parsing macros/cross_db_utils/safe_cast.sql
2020-12-02 11:42:36.164293 (Thread-1): Parsing macros/cross_db_utils/last_day.sql
2020-12-02 11:42:36.172455 (Thread-1): Parsing macros/cross_db_utils/intersect.sql
2020-12-02 11:42:36.183553 (Thread-1): Parsing macros/get_date_dimension.sql
2020-12-02 11:42:36.199881 (Thread-1): Parsing macros/get_base_dates.sql
2020-12-02 11:42:36.207419 (Thread-1): Parsing macros/calendar_date/n_weeks_ago.sql
2020-12-02 11:42:36.213418 (Thread-1): Parsing macros/calendar_date/to_unixtimestamp.sql
2020-12-02 11:42:36.219653 (Thread-1): Parsing macros/calendar_date/yesterday.sql
2020-12-02 11:42:36.224567 (Thread-1): Parsing macros/calendar_date/month_name.sql
2020-12-02 11:42:36.231469 (Thread-1): Parsing macros/calendar_date/day_name.sql
2020-12-02 11:42:36.238340 (Thread-1): Parsing macros/calendar_date/_get_utils_namespaces.sql
2020-12-02 11:42:36.243615 (Thread-1): Parsing macros/calendar_date/date_part.sql
2020-12-02 11:42:36.249556 (Thread-1): Parsing macros/calendar_date/n_days_ago.sql
2020-12-02 11:42:36.254794 (Thread-1): Parsing macros/calendar_date/now.sql
2020-12-02 11:42:36.260343 (Thread-1): Parsing macros/calendar_date/n_months_ago.sql
2020-12-02 11:42:36.266230 (Thread-1): Parsing macros/calendar_date/this_week.sql
2020-12-02 11:42:36.271643 (Thread-1): Parsing macros/calendar_date/convert_timezone.sql
2020-12-02 11:42:36.278624 (Thread-1): Parsing macros/calendar_date/periods_since.sql
2020-12-02 11:42:36.284469 (Thread-1): Parsing macros/calendar_date/n_months_away.sql
2020-12-02 11:42:36.290768 (Thread-1): Parsing macros/calendar_date/n_days_away.sql
2020-12-02 11:42:36.296225 (Thread-1): Parsing macros/calendar_date/last_week.sql
2020-12-02 11:42:36.301834 (Thread-1): Parsing macros/calendar_date/n_weeks_away.sql
2020-12-02 11:42:36.307338 (Thread-1): Parsing macros/calendar_date/tomorrow.sql
2020-12-02 11:42:36.312640 (Thread-1): Parsing macros/calendar_date/today.sql
2020-12-02 11:42:36.318973 (Thread-1): Parsing macros/fiscal_date/get_fiscal_periods.sql
2020-12-02 11:42:36.325239 (Thread-1): Parsing macros/fiscal_date/get_fiscal_year_dates.sql
2020-12-02 11:42:36.409515 (Thread-1): Acquiring new snowflake connection "model.sales_dataflo.stg_sf_opportunity".
2020-12-02 11:42:36.745006 (Thread-1): Acquiring new snowflake connection "model.dbt_date.dim_date_fiscal".
2020-12-02 11:42:36.781030 (Thread-1): Acquiring new snowflake connection "model.dbt_date.dim_date".
2020-12-02 11:42:36.802855 (Thread-1): Acquiring new snowflake connection "model.dbt_date.dates".
2020-12-02 11:42:36.990584 (Thread-1): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 4 unused configuration paths:
- models.sales_dataflo.utils
- models.sales_dataflo.intermediate
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-02 11:42:37.368754 (Thread-2): handling status request
2020-12-02 11:42:37.369293 (Thread-2): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f5a92e8>]}
2020-12-02 11:42:37.382526 (Thread-2): sending response (<Response 32170 bytes [200 OK]>) to 10.0.33.208
2020-12-02 11:42:50.776141 (Thread-3): handling status request
2020-12-02 11:42:50.777747 (Thread-3): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f619be0>]}
2020-12-02 11:42:50.789376 (Thread-3): sending response (<Response 32170 bytes [200 OK]>) to 10.0.26.14
2020-12-02 11:43:39.831783 (MainThread): writing 1 spans (enabled:True), 110 additional messages skipped
2020-12-02 11:43:39.833872 (MainThread): 
      name jinja2.compile
        id 11204321176159944712
  trace_id 11381158779671496912
 parent_id None
   service None
  resource <memory>
      type template
     start 1606909419.8310962
       end 1606909419.8316152
  duration 0.000519s
     error 0
      tags 
           jinja2.template_name:<memory>
           runtime-id:8daea1d60d034a8cace00663c6a43dc8, 177 additional messages skipped
2020-12-02 11:43:39.874452 (MainThread): Connection 'model.dbt_date.dates' was properly closed.
2020-12-02 11:43:40.053953 (AgentWriter): reported 60 traces in 0.00352s, 4 additional messages skipped
2020-12-02 11:43:40.054160 (AgentWriter): initialized RateSampler, sample 100% of traces, 179 additional messages skipped
2020-12-02 11:43:40.276220 (Thread-5): handling status request
2020-12-02 11:43:40.276749 (Thread-5): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f619a90>]}
2020-12-02 11:43:40.277569 (Thread-5): sending response (<Response 184 bytes [200 OK]>) to 10.0.26.14
2020-12-02 11:43:40.312303 (Thread-4): Got an acceptable cached parse result
2020-12-02 11:43:40.361275 (Thread-4): Acquiring new snowflake connection "model.sales_dataflo.D_Calendar".
2020-12-02 11:43:40.782068 (Thread-4): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.sales_dataflo.utils
- models.sales_dataflo.marts
- seeds.FivetranDbt_Transformation

2020-12-02 11:43:41.800152 (Thread-6): handling status request
2020-12-02 11:43:41.800709 (Thread-6): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5ebed5f8>]}
2020-12-02 11:43:41.801845 (Thread-6): sending response (<Response 1237 bytes [200 OK]>) to 10.0.33.208
2020-12-02 11:44:35.686521 (Thread-7): handling status request
2020-12-02 11:44:35.688522 (Thread-7): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce64294940>]}
2020-12-02 11:44:35.689644 (Thread-7): sending response (<Response 1237 bytes [200 OK]>) to 10.0.27.241
2020-12-02 11:44:36.259410 (Thread-8): handling run_sql request
2020-12-02 11:44:36.259917 (Thread-8): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce6428a6a0>]}
2020-12-02 11:44:36.263055 (Thread-8): Connection 'model.sales_dataflo.D_Calendar' was properly closed.
2020-12-02 11:44:37.312778 (Thread-8): sending response (<Response 137 bytes [200 OK]>) to 10.0.47.27
2020-12-02 11:44:37.339633 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 11:44:37.360796 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 11:44:37.361271 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 11:44:37.361414 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 11:44:37.375831 (Thread-1): finished collecting timing info
2020-12-02 11:44:37.376134 (Thread-1): Got an exception: Compilation Error in rpc request (from remote system)
  'DATAFLOTEST_DATABASE' is undefined
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 496, in catch_jinja
    yield
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 528, in render_template
    return template.render(ctx)
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 1090, in render
    self.environment.handle_exception()
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/lib/python3.6/dist-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<template>", line 2, in top-level template code
  File "/usr/local/lib/python3.6/dist-packages/jinja2/sandbox.py", line 407, in getattr
    value = getattr(obj, attribute)
jinja2.exceptions.UndefinedError: 'DATAFLOTEST_DATABASE' is undefined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 270, in compile_and_execute
    ctx.node = self.compile(manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 41, in compile
    return compiler.compile_node(self.node, manifest, {}, write=False)
  File "/usr/local/lib/python3.6/dist-packages/dbt/compilation.py", line 479, in compile_node
    node = self._compile_node(node, manifest, extra_context)
  File "/usr/local/lib/python3.6/dist-packages/dbt/compilation.py", line 388, in _compile_node
    node,
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 577, in get_rendered
    return render_template(template, ctx, node)
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 528, in render_template
    return template.render(ctx)
  File "/usr/lib/python3.6/contextlib.py", line 99, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 501, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  'DATAFLOTEST_DATABASE' is undefined
2020-12-02 11:44:37.377576 (Thread-1): Got exception RPCException(10004, Compilation Error, {'type': 'CompilationException', 'message': "Compilation Error in rpc request (from remote system)\n  'DATAFLOTEST_DATABASE' is undefined", 'raw_sql': '\r\nselect * from {{ DATAFLOTEST_DATABASE.SALESFORCE.Account }}\nlimit 100', 'compiled_sql': None, 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10004, Compilation Error, {'type': 'CompilationException', 'message': "Compilation Error in rpc request (from remote system)\n  'DATAFLOTEST_DATABASE' is undefined", 'raw_sql': '\r\nselect * from {{ DATAFLOTEST_DATABASE.SALESFORCE.Account }}\nlimit 100', 'compiled_sql': None, 'tags': None}, None)
2020-12-02 11:44:37.762744 (Thread-9): handling poll request
2020-12-02 11:44:37.763937 (Thread-9): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce642f8c50>]}
2020-12-02 11:44:37.766676 (Thread-9): sending response (<Response 6301 bytes [200 OK]>) to 10.0.15.181
2020-12-02 11:46:22.170677 (Thread-10): handling status request
2020-12-02 11:46:22.172379 (Thread-10): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f623390>]}
2020-12-02 11:46:22.173591 (Thread-10): sending response (<Response 1237 bytes [200 OK]>) to 10.0.26.14
2020-12-02 11:46:22.655622 (Thread-11): handling run_sql request
2020-12-02 11:46:22.656176 (Thread-11): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5ec5d7b8>]}
2020-12-02 11:46:23.836723 (Thread-11): sending response (<Response 137 bytes [200 OK]>) to 10.0.47.27
2020-12-02 11:46:23.863958 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 11:46:23.888474 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 11:46:23.889024 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 11:46:23.889161 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 11:46:23.904722 (Thread-1): finished collecting timing info
2020-12-02 11:46:23.905044 (Thread-1): Got an exception: Compilation Error in rpc request (from remote system)
  'DATAFLOTEST_DATABASE' is undefined
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 496, in catch_jinja
    yield
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 528, in render_template
    return template.render(ctx)
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 1090, in render
    self.environment.handle_exception()
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/lib/python3.6/dist-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<template>", line 2, in top-level template code
  File "/usr/local/lib/python3.6/dist-packages/jinja2/sandbox.py", line 407, in getattr
    value = getattr(obj, attribute)
jinja2.exceptions.UndefinedError: 'DATAFLOTEST_DATABASE' is undefined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 270, in compile_and_execute
    ctx.node = self.compile(manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 41, in compile
    return compiler.compile_node(self.node, manifest, {}, write=False)
  File "/usr/local/lib/python3.6/dist-packages/dbt/compilation.py", line 479, in compile_node
    node = self._compile_node(node, manifest, extra_context)
  File "/usr/local/lib/python3.6/dist-packages/dbt/compilation.py", line 388, in _compile_node
    node,
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 577, in get_rendered
    return render_template(template, ctx, node)
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 528, in render_template
    return template.render(ctx)
  File "/usr/lib/python3.6/contextlib.py", line 99, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 501, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  'DATAFLOTEST_DATABASE' is undefined
2020-12-02 11:46:23.906597 (Thread-1): Got exception RPCException(10004, Compilation Error, {'type': 'CompilationException', 'message': "Compilation Error in rpc request (from remote system)\n  'DATAFLOTEST_DATABASE' is undefined", 'raw_sql': '\r\nselect * from {{ DATAFLOTEST_DATABASE.SALESFORCE.ACCOUNT }}\nlimit 100', 'compiled_sql': None, 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10004, Compilation Error, {'type': 'CompilationException', 'message': "Compilation Error in rpc request (from remote system)\n  'DATAFLOTEST_DATABASE' is undefined", 'raw_sql': '\r\nselect * from {{ DATAFLOTEST_DATABASE.SALESFORCE.ACCOUNT }}\nlimit 100', 'compiled_sql': None, 'tags': None}, None)
2020-12-02 11:46:24.292740 (Thread-12): handling poll request
2020-12-02 11:46:24.293318 (Thread-12): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5ec5d7b8>]}
2020-12-02 11:46:24.294742 (Thread-12): sending response (<Response 6301 bytes [200 OK]>) to 10.0.12.174
2020-12-02 11:48:27.830583 (Thread-13): handling status request
2020-12-02 11:48:27.832726 (Thread-13): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce642e58d0>]}
2020-12-02 11:48:27.833942 (Thread-13): sending response (<Response 1237 bytes [200 OK]>) to 10.0.38.46
2020-12-02 11:48:28.319702 (Thread-14): handling run_sql request
2020-12-02 11:48:28.320341 (Thread-14): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce642e58d0>]}
2020-12-02 11:48:29.395947 (Thread-14): sending response (<Response 137 bytes [200 OK]>) to 10.0.45.0
2020-12-02 11:48:29.423360 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 11:48:29.447935 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 11:48:29.448471 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 11:48:29.448611 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 11:48:29.463619 (Thread-1): finished collecting timing info
2020-12-02 11:48:29.463939 (Thread-1): Got an exception: Compilation Error in rpc request (from remote system)
  'DATAFLOTEST_DATABASE' is undefined
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 496, in catch_jinja
    yield
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 528, in render_template
    return template.render(ctx)
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 1090, in render
    self.environment.handle_exception()
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/lib/python3.6/dist-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<template>", line 2, in top-level template code
  File "/usr/local/lib/python3.6/dist-packages/jinja2/sandbox.py", line 407, in getattr
    value = getattr(obj, attribute)
jinja2.exceptions.UndefinedError: 'DATAFLOTEST_DATABASE' is undefined

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 270, in compile_and_execute
    ctx.node = self.compile(manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 41, in compile
    return compiler.compile_node(self.node, manifest, {}, write=False)
  File "/usr/local/lib/python3.6/dist-packages/dbt/compilation.py", line 479, in compile_node
    node = self._compile_node(node, manifest, extra_context)
  File "/usr/local/lib/python3.6/dist-packages/dbt/compilation.py", line 388, in _compile_node
    node,
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 577, in get_rendered
    return render_template(template, ctx, node)
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 528, in render_template
    return template.render(ctx)
  File "/usr/lib/python3.6/contextlib.py", line 99, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 501, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  'DATAFLOTEST_DATABASE' is undefined
2020-12-02 11:48:29.465443 (Thread-1): Got exception RPCException(10004, Compilation Error, {'type': 'CompilationException', 'message': "Compilation Error in rpc request (from remote system)\n  'DATAFLOTEST_DATABASE' is undefined", 'raw_sql': 'with test)\r\nselect * from {{ DATAFLOTEST_DATABASE.SALESFORCE.ACCOUNT }};\r\n)\r\nselect * from test;\nlimit 100', 'compiled_sql': None, 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10004, Compilation Error, {'type': 'CompilationException', 'message': "Compilation Error in rpc request (from remote system)\n  'DATAFLOTEST_DATABASE' is undefined", 'raw_sql': 'with test)\r\nselect * from {{ DATAFLOTEST_DATABASE.SALESFORCE.ACCOUNT }};\r\n)\r\nselect * from test;\nlimit 100', 'compiled_sql': None, 'tags': None}, None)
2020-12-02 11:48:29.864709 (Thread-15): handling poll request
2020-12-02 11:48:29.865213 (Thread-15): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5ec5d400>]}
2020-12-02 11:48:29.866552 (Thread-15): sending response (<Response 6426 bytes [200 OK]>) to 10.0.45.111
2020-12-02 14:09:59.922077 (Thread-16): handling status request
2020-12-02 14:09:59.923792 (Thread-16): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce642e4198>]}
2020-12-02 14:09:59.924983 (Thread-16): sending response (<Response 1237 bytes [200 OK]>) to 10.0.31.170
2020-12-02 14:10:00.399444 (Thread-17): handling ps request
2020-12-02 14:10:00.399948 (Thread-17): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce642d00b8>]}
2020-12-02 14:10:00.402757 (Thread-17): sending response (<Response 1619 bytes [200 OK]>) to 10.0.33.208
2020-12-02 14:51:14.172404 (Thread-18): handling status request
2020-12-02 14:51:14.174561 (Thread-18): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce642d00b8>]}
2020-12-02 14:51:14.176243 (Thread-18): sending response (<Response 1237 bytes [200 OK]>) to 10.0.33.208
2020-12-02 14:51:14.793843 (Thread-19): handling run_sql request
2020-12-02 14:51:14.794377 (Thread-19): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce642c9390>]}
2020-12-02 14:51:15.853382 (Thread-19): sending response (<Response 137 bytes [200 OK]>) to 10.0.12.174
2020-12-02 14:51:15.879968 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:51:15.971557 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 14:51:15.972071 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:51:15.972210 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 14:51:15.990883 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:51:15.990993 (Thread-1): On rpc.sales_dataflo.request: BEGIN
2020-12-02 14:51:15.991056 (Thread-1): Opening a new connection, currently in state init
2020-12-02 14:51:16.180710 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 14:51:16.441122 (Thread-20): handling poll request
2020-12-02 14:51:16.441642 (Thread-20): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce642c9390>]}
2020-12-02 14:51:16.445404 (Thread-20): sending response (<Response 2424 bytes [200 OK]>) to 10.0.11.16
2020-12-02 14:51:16.772793 (Thread-1): SQL status: SUCCESS 1 in 0.78 seconds
2020-12-02 14:51:16.772954 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:51:16.773019 (Thread-1): On rpc.sales_dataflo.request: select 
  

    datediff(
        day,
        cast('2015-01-01' as datetime),
        cast('2022-12-31' as datetime)
        )
2020-12-02 14:51:16.890790 (Thread-1): SQL status: SUCCESS 1 in 0.12 seconds
2020-12-02 14:51:16.902189 (Thread-1): finished collecting timing info
2020-12-02 14:51:16.906134 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:51:16.906233 (Thread-1): On rpc.sales_dataflo.request: select * from 
    
with base_dates as (
    
with date_spine as
(
    

    

/*
call as follows:

date_spine(
    "day",
    "to_date('01/01/2016', 'mm/dd/yyyy')",
    "dateadd(week, 1, current_date)"
)

*/

with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * pow(2, 0)
     + 
    
    p1.generated_number * pow(2, 1)
     + 
    
    p2.generated_number * pow(2, 2)
     + 
    
    p3.generated_number * pow(2, 3)
     + 
    
    p4.generated_number * pow(2, 4)
     + 
    
    p5.generated_number * pow(2, 5)
     + 
    
    p6.generated_number * pow(2, 6)
     + 
    
    p7.generated_number * pow(2, 7)
     + 
    
    p8.generated_number * pow(2, 8)
     + 
    
    p9.generated_number * pow(2, 9)
     + 
    
    p10.generated_number * pow(2, 10)
     + 
    
    p11.generated_number * pow(2, 11)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
     cross join 
    
    p as p7
     cross join 
    
    p as p8
     cross join 
    
    p as p9
     cross join 
    
    p as p10
     cross join 
    
    p as p11
    
    

    )

    select *
    from unioned
    where generated_number <= 2921
    order by generated_number



),

all_periods as (

    select (
        
  

    dateadd(
        day,
        row_number() over (order by 1) - 1,
        cast('2015-01-01' as datetime)
        )



    ) as date_day
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_day <= cast('2022-12-31' as datetime)

)

select * from filtered



)
select
    date(d.date_day) as date_day
from
    date_spine d

),
dates_with_prior_year_dates as (
    select
        cast(d.date_day as date) as date_day,
        cast(
  

    dateadd(
        year,
        -1,
        d.date_day
        )


 as date) as prior_year_date_day,
        cast(
  

    dateadd(
        day,
        -364,
        d.date_day
        )


 as date) as prior_year_over_year_date_day
    from
    	base_dates d
)
select
    d.date_day,
    cast(
  

    dateadd(
        day,
        -1,
        d.date_day
        )


 as date) as prior_date_day,
    cast(
  

    dateadd(
        day,
        1,
        d.date_day
        )


 as date) as next_date_day,
    d.prior_year_date_day as prior_year_date_day,
    d.prior_year_over_year_date_day,
    cast(
            case
                when date_part('dayofweek', d.date_day) = 0 then 7
                else date_part('dayofweek', d.date_day)
            end
        as 
    int

    ) as day_of_week,

    to_char(d.date_day, 'Day') as day_of_week_name,
    to_char(d.date_day, 'Dy') as day_of_week_name_short,
    cast(date_part('day', d.date_day) as 
    int
) as day_of_month,
    cast(date_part('dayofyear', d.date_day) as 
    int
) as day_of_year,

    cast(
    date_trunc('week', d.date_day)
 as date) as week_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', d.date_day)

        )



        )



        as date)
 as date) as week_end_date,
    cast(date_part('week', d.date_day) as 
    int
) as week_of_year,
    cast(
    date_trunc('week', d.prior_year_over_year_date_day)
 as date) as prior_year_week_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', d.prior_year_over_year_date_day)

        )



        )



        as date)
 as date) as prior_year_week_end_date,
    cast(date_part('week', d.prior_year_over_year_date_day) as 
    int
) as prior_year_week_of_year,

    cast(date_part('month', d.date_day) as 
    int
) as month_of_year,
    to_char(d.date_day, 'MONTH')  as month_name,
    to_char(d.date_day, 'MON')  as month_name_short,

    cast(
    date_trunc('month', d.date_day)
 as date) as month_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', d.date_day)

        )



        )



        as date)
 as date) as month_end_date,

    cast(
    date_trunc('month', d.prior_year_date_day)
 as date) as prior_year_month_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', d.prior_year_date_day)

        )



        )



        as date)
 as date) as prior_year_month_end_date,

    cast(date_part('quarter', d.date_day) as 
    int
) as quarter_of_year,
    cast(
    date_trunc('quarter', d.date_day)
 as date) as quarter_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        quarter,
        1,
        
    date_trunc('quarter', d.date_day)

        )



        )



        as date)
 as date) as quarter_end_date,

    cast(date_part('year', d.date_day) as 
    int
) as year_number,
    cast(
    date_trunc('year', d.date_day)
 as date) as year_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        year,
        1,
        
    date_trunc('year', d.date_day)

        )



        )



        as date)
 as date) as year_end_date
from
    dates_with_prior_year_dates d
order by 1


limit 100
2020-12-02 14:51:16.977868 (Thread-1): Snowflake query id: 0198a93b-0093-5b1f-0000-00005eb1ffcd
2020-12-02 14:51:16.977951 (Thread-1): Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 3 at position 0 unexpected 'with'.
syntax error line 30 at position 4 unexpected ')'.
2020-12-02 14:51:16.978028 (Thread-1): finished collecting timing info
2020-12-02 14:51:16.978376 (Thread-1): On rpc.sales_dataflo.request: ROLLBACK
2020-12-02 14:51:17.096387 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 14:51:17.171749 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 3 at position 0 unexpected 'with'.
  syntax error line 30 at position 4 unexpected ')'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 161, in exception_handler
    yield
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/cursor.py", line 597, in execute
    errvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 97, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, errorclass, errorvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 73, in default_errorhandler
    done_format_msg=errorvalue.get(u'done_format_msg'))
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 3 at position 0 unexpected 'with'.
syntax error line 30 at position 4 unexpected ')'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 85, in execute
    compiled_node.injected_sql, fetch=True
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/base/impl.py", line 227, in execute
    fetch=fetch
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 312, in add_query
    abridge_sql_log=abridge_sql_log
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.6/contextlib.py", line 99, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 178, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 3 at position 0 unexpected 'with'.
  syntax error line 30 at position 4 unexpected ')'.
2020-12-02 14:51:17.173503 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 3 at position 0 unexpected 'with'.\n  syntax error line 30 at position 4 unexpected ')'.", 'raw_sql': "select * from {{ dbt_date.get_date_dimension('2015-01-01', '2022-12-31') }}\nlimit 100", 'compiled_sql': 'select * from \n    \nwith base_dates as (\n    \nwith date_spine as\n(\n    \n\n    \n\n/*\ncall as follows:\n\ndate_spine(\n    "day",\n    "to_date(\'01/01/2016\', \'mm/dd/yyyy\')",\n    "dateadd(week, 1, current_date)"\n)\n\n*/\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * pow(2, 0)\n     + \n    \n    p1.generated_number * pow(2, 1)\n     + \n    \n    p2.generated_number * pow(2, 2)\n     + \n    \n    p3.generated_number * pow(2, 3)\n     + \n    \n    p4.generated_number * pow(2, 4)\n     + \n    \n    p5.generated_number * pow(2, 5)\n     + \n    \n    p6.generated_number * pow(2, 6)\n     + \n    \n    p7.generated_number * pow(2, 7)\n     + \n    \n    p8.generated_number * pow(2, 8)\n     + \n    \n    p9.generated_number * pow(2, 9)\n     + \n    \n    p10.generated_number * pow(2, 10)\n     + \n    \n    p11.generated_number * pow(2, 11)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 2921\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n  \n\n    dateadd(\n        day,\n        row_number() over (order by 1) - 1,\n        cast(\'2015-01-01\' as datetime)\n        )\n\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast(\'2022-12-31\' as datetime)\n\n)\n\nselect * from filtered\n\n\n\n)\nselect\n    date(d.date_day) as date_day\nfrom\n    date_spine d\n\n),\ndates_with_prior_year_dates as (\n    select\n        cast(d.date_day as date) as date_day,\n        cast(\n  \n\n    dateadd(\n        year,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_year_date_day,\n        cast(\n  \n\n    dateadd(\n        day,\n        -364,\n        d.date_day\n        )\n\n\n as date) as prior_year_over_year_date_day\n    from\n    \tbase_dates d\n)\nselect\n    d.date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        1,\n        d.date_day\n        )\n\n\n as date) as next_date_day,\n    d.prior_year_date_day as prior_year_date_day,\n    d.prior_year_over_year_date_day,\n    cast(\n            case\n                when date_part(\'dayofweek\', d.date_day) = 0 then 7\n                else date_part(\'dayofweek\', d.date_day)\n            end\n        as \n    int\n\n    ) as day_of_week,\n\n    to_char(d.date_day, \'Day\') as day_of_week_name,\n    to_char(d.date_day, \'Dy\') as day_of_week_name_short,\n    cast(date_part(\'day\', d.date_day) as \n    int\n) as day_of_month,\n    cast(date_part(\'dayofyear\', d.date_day) as \n    int\n) as day_of_year,\n\n    cast(\n    date_trunc(\'week\', d.date_day)\n as date) as week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as week_end_date,\n    cast(date_part(\'week\', d.date_day) as \n    int\n) as week_of_year,\n    cast(\n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n as date) as prior_year_week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_week_end_date,\n    cast(date_part(\'week\', d.prior_year_over_year_date_day) as \n    int\n) as prior_year_week_of_year,\n\n    cast(date_part(\'month\', d.date_day) as \n    int\n) as month_of_year,\n    to_char(d.date_day, \'MONTH\')  as month_name,\n    to_char(d.date_day, \'MON\')  as month_name_short,\n\n    cast(\n    date_trunc(\'month\', d.date_day)\n as date) as month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as month_end_date,\n\n    cast(\n    date_trunc(\'month\', d.prior_year_date_day)\n as date) as prior_year_month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.prior_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_month_end_date,\n\n    cast(date_part(\'quarter\', d.date_day) as \n    int\n) as quarter_of_year,\n    cast(\n    date_trunc(\'quarter\', d.date_day)\n as date) as quarter_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        quarter,\n        1,\n        \n    date_trunc(\'quarter\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as quarter_end_date,\n\n    cast(date_part(\'year\', d.date_day) as \n    int\n) as year_number,\n    cast(\n    date_trunc(\'year\', d.date_day)\n as date) as year_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        year,\n        1,\n        \n    date_trunc(\'year\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as year_end_date\nfrom\n    dates_with_prior_year_dates d\norder by 1\n\n\nlimit 100', 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 3 at position 0 unexpected 'with'.\n  syntax error line 30 at position 4 unexpected ')'.", 'raw_sql': "select * from {{ dbt_date.get_date_dimension('2015-01-01', '2022-12-31') }}\nlimit 100", 'compiled_sql': 'select * from \n    \nwith base_dates as (\n    \nwith date_spine as\n(\n    \n\n    \n\n/*\ncall as follows:\n\ndate_spine(\n    "day",\n    "to_date(\'01/01/2016\', \'mm/dd/yyyy\')",\n    "dateadd(week, 1, current_date)"\n)\n\n*/\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * pow(2, 0)\n     + \n    \n    p1.generated_number * pow(2, 1)\n     + \n    \n    p2.generated_number * pow(2, 2)\n     + \n    \n    p3.generated_number * pow(2, 3)\n     + \n    \n    p4.generated_number * pow(2, 4)\n     + \n    \n    p5.generated_number * pow(2, 5)\n     + \n    \n    p6.generated_number * pow(2, 6)\n     + \n    \n    p7.generated_number * pow(2, 7)\n     + \n    \n    p8.generated_number * pow(2, 8)\n     + \n    \n    p9.generated_number * pow(2, 9)\n     + \n    \n    p10.generated_number * pow(2, 10)\n     + \n    \n    p11.generated_number * pow(2, 11)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 2921\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n  \n\n    dateadd(\n        day,\n        row_number() over (order by 1) - 1,\n        cast(\'2015-01-01\' as datetime)\n        )\n\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast(\'2022-12-31\' as datetime)\n\n)\n\nselect * from filtered\n\n\n\n)\nselect\n    date(d.date_day) as date_day\nfrom\n    date_spine d\n\n),\ndates_with_prior_year_dates as (\n    select\n        cast(d.date_day as date) as date_day,\n        cast(\n  \n\n    dateadd(\n        year,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_year_date_day,\n        cast(\n  \n\n    dateadd(\n        day,\n        -364,\n        d.date_day\n        )\n\n\n as date) as prior_year_over_year_date_day\n    from\n    \tbase_dates d\n)\nselect\n    d.date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        1,\n        d.date_day\n        )\n\n\n as date) as next_date_day,\n    d.prior_year_date_day as prior_year_date_day,\n    d.prior_year_over_year_date_day,\n    cast(\n            case\n                when date_part(\'dayofweek\', d.date_day) = 0 then 7\n                else date_part(\'dayofweek\', d.date_day)\n            end\n        as \n    int\n\n    ) as day_of_week,\n\n    to_char(d.date_day, \'Day\') as day_of_week_name,\n    to_char(d.date_day, \'Dy\') as day_of_week_name_short,\n    cast(date_part(\'day\', d.date_day) as \n    int\n) as day_of_month,\n    cast(date_part(\'dayofyear\', d.date_day) as \n    int\n) as day_of_year,\n\n    cast(\n    date_trunc(\'week\', d.date_day)\n as date) as week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as week_end_date,\n    cast(date_part(\'week\', d.date_day) as \n    int\n) as week_of_year,\n    cast(\n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n as date) as prior_year_week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_week_end_date,\n    cast(date_part(\'week\', d.prior_year_over_year_date_day) as \n    int\n) as prior_year_week_of_year,\n\n    cast(date_part(\'month\', d.date_day) as \n    int\n) as month_of_year,\n    to_char(d.date_day, \'MONTH\')  as month_name,\n    to_char(d.date_day, \'MON\')  as month_name_short,\n\n    cast(\n    date_trunc(\'month\', d.date_day)\n as date) as month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as month_end_date,\n\n    cast(\n    date_trunc(\'month\', d.prior_year_date_day)\n as date) as prior_year_month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.prior_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_month_end_date,\n\n    cast(date_part(\'quarter\', d.date_day) as \n    int\n) as quarter_of_year,\n    cast(\n    date_trunc(\'quarter\', d.date_day)\n as date) as quarter_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        quarter,\n        1,\n        \n    date_trunc(\'quarter\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as quarter_end_date,\n\n    cast(date_part(\'year\', d.date_day) as \n    int\n) as year_number,\n    cast(\n    date_trunc(\'year\', d.date_day)\n as date) as year_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        year,\n        1,\n        \n    date_trunc(\'year\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as year_end_date\nfrom\n    dates_with_prior_year_dates d\norder by 1\n\n\nlimit 100', 'tags': None}, None)
2020-12-02 14:51:18.156223 (Thread-21): handling poll request
2020-12-02 14:51:18.156710 (Thread-21): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce642d0160>]}
2020-12-02 14:51:18.157837 (Thread-21): sending response (<Response 36330 bytes [200 OK]>) to 10.0.38.46
2020-12-02 14:52:07.258418 (Thread-22): handling status request
2020-12-02 14:52:07.258907 (Thread-22): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce64255ac8>]}
2020-12-02 14:52:07.260123 (Thread-22): sending response (<Response 1237 bytes [200 OK]>) to 10.0.26.14
2020-12-02 14:52:08.773523 (Thread-23): handling run_sql request
2020-12-02 14:52:08.774002 (Thread-23): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce64255ac8>]}
2020-12-02 14:52:09.844345 (Thread-23): sending response (<Response 137 bytes [200 OK]>) to 10.0.45.0
2020-12-02 14:52:09.870892 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:52:09.958207 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 14:52:09.958727 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:52:09.958872 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 14:52:09.976590 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:52:09.976683 (Thread-1): On rpc.sales_dataflo.request: BEGIN
2020-12-02 14:52:09.976744 (Thread-1): Opening a new connection, currently in state init
2020-12-02 14:52:10.176594 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 14:52:10.481814 (Thread-24): handling poll request
2020-12-02 14:52:10.482351 (Thread-24): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce64255ac8>]}
2020-12-02 14:52:10.484647 (Thread-24): sending response (<Response 2424 bytes [200 OK]>) to 10.0.26.14
2020-12-02 14:52:10.625996 (Thread-1): SQL status: SUCCESS 1 in 0.65 seconds
2020-12-02 14:52:10.626159 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:52:10.626250 (Thread-1): On rpc.sales_dataflo.request: select 
  

    datediff(
        day,
        cast('2015-01-01' as datetime),
        cast('2022-12-31' as datetime)
        )
2020-12-02 14:52:10.695387 (Thread-1): SQL status: SUCCESS 1 in 0.07 seconds
2020-12-02 14:52:10.708372 (Thread-1): finished collecting timing info
2020-12-02 14:52:10.712402 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:52:10.712483 (Thread-1): On rpc.sales_dataflo.request: with source(
select * from 
    
with base_dates as (
    
with date_spine as
(
    

    

/*
call as follows:

date_spine(
    "day",
    "to_date('01/01/2016', 'mm/dd/yyyy')",
    "dateadd(week, 1, current_date)"
)

*/

with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * pow(2, 0)
     + 
    
    p1.generated_number * pow(2, 1)
     + 
    
    p2.generated_number * pow(2, 2)
     + 
    
    p3.generated_number * pow(2, 3)
     + 
    
    p4.generated_number * pow(2, 4)
     + 
    
    p5.generated_number * pow(2, 5)
     + 
    
    p6.generated_number * pow(2, 6)
     + 
    
    p7.generated_number * pow(2, 7)
     + 
    
    p8.generated_number * pow(2, 8)
     + 
    
    p9.generated_number * pow(2, 9)
     + 
    
    p10.generated_number * pow(2, 10)
     + 
    
    p11.generated_number * pow(2, 11)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
     cross join 
    
    p as p7
     cross join 
    
    p as p8
     cross join 
    
    p as p9
     cross join 
    
    p as p10
     cross join 
    
    p as p11
    
    

    )

    select *
    from unioned
    where generated_number <= 2921
    order by generated_number



),

all_periods as (

    select (
        
  

    dateadd(
        day,
        row_number() over (order by 1) - 1,
        cast('2015-01-01' as datetime)
        )



    ) as date_day
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_day <= cast('2022-12-31' as datetime)

)

select * from filtered



)
select
    date(d.date_day) as date_day
from
    date_spine d

),
dates_with_prior_year_dates as (
    select
        cast(d.date_day as date) as date_day,
        cast(
  

    dateadd(
        year,
        -1,
        d.date_day
        )


 as date) as prior_year_date_day,
        cast(
  

    dateadd(
        day,
        -364,
        d.date_day
        )


 as date) as prior_year_over_year_date_day
    from
    	base_dates d
)
select
    d.date_day,
    cast(
  

    dateadd(
        day,
        -1,
        d.date_day
        )


 as date) as prior_date_day,
    cast(
  

    dateadd(
        day,
        1,
        d.date_day
        )


 as date) as next_date_day,
    d.prior_year_date_day as prior_year_date_day,
    d.prior_year_over_year_date_day,
    cast(
            case
                when date_part('dayofweek', d.date_day) = 0 then 7
                else date_part('dayofweek', d.date_day)
            end
        as 
    int

    ) as day_of_week,

    to_char(d.date_day, 'Day') as day_of_week_name,
    to_char(d.date_day, 'Dy') as day_of_week_name_short,
    cast(date_part('day', d.date_day) as 
    int
) as day_of_month,
    cast(date_part('dayofyear', d.date_day) as 
    int
) as day_of_year,

    cast(
    date_trunc('week', d.date_day)
 as date) as week_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', d.date_day)

        )



        )



        as date)
 as date) as week_end_date,
    cast(date_part('week', d.date_day) as 
    int
) as week_of_year,
    cast(
    date_trunc('week', d.prior_year_over_year_date_day)
 as date) as prior_year_week_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', d.prior_year_over_year_date_day)

        )



        )



        as date)
 as date) as prior_year_week_end_date,
    cast(date_part('week', d.prior_year_over_year_date_day) as 
    int
) as prior_year_week_of_year,

    cast(date_part('month', d.date_day) as 
    int
) as month_of_year,
    to_char(d.date_day, 'MONTH')  as month_name,
    to_char(d.date_day, 'MON')  as month_name_short,

    cast(
    date_trunc('month', d.date_day)
 as date) as month_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', d.date_day)

        )



        )



        as date)
 as date) as month_end_date,

    cast(
    date_trunc('month', d.prior_year_date_day)
 as date) as prior_year_month_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', d.prior_year_date_day)

        )



        )



        as date)
 as date) as prior_year_month_end_date,

    cast(date_part('quarter', d.date_day) as 
    int
) as quarter_of_year,
    cast(
    date_trunc('quarter', d.date_day)
 as date) as quarter_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        quarter,
        1,
        
    date_trunc('quarter', d.date_day)

        )



        )



        as date)
 as date) as quarter_end_date,

    cast(date_part('year', d.date_day) as 
    int
) as year_number,
    cast(
    date_trunc('year', d.date_day)
 as date) as year_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        year,
        1,
        
    date_trunc('year', d.date_day)

        )



        )



        as date)
 as date) as year_end_date
from
    dates_with_prior_year_dates d
order by 1

;
2020-12-02 14:52:10.786936 (Thread-1): Snowflake query id: 0198a93c-0020-a0b8-0000-00005eb1ffdd
2020-12-02 14:52:10.787017 (Thread-1): Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 2 at position 0 unexpected 'select'.
2020-12-02 14:52:10.787106 (Thread-1): finished collecting timing info
2020-12-02 14:52:10.787390 (Thread-1): On rpc.sales_dataflo.request: ROLLBACK
2020-12-02 14:52:10.915563 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 14:52:10.998353 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 2 at position 0 unexpected 'select'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 161, in exception_handler
    yield
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/cursor.py", line 597, in execute
    errvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 97, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, errorclass, errorvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 73, in default_errorhandler
    done_format_msg=errorvalue.get(u'done_format_msg'))
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 2 at position 0 unexpected 'select'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 85, in execute
    compiled_node.injected_sql, fetch=True
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/base/impl.py", line 227, in execute
    fetch=fetch
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 312, in add_query
    abridge_sql_log=abridge_sql_log
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.6/contextlib.py", line 99, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 178, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 2 at position 0 unexpected 'select'.
2020-12-02 14:52:11.000527 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 2 at position 0 unexpected 'select'.", 'raw_sql': "with source(\r\nselect * from {{ dbt_date.get_date_dimension('2015-01-01', '2022-12-31') }};\r\n)\r\nselect * from source;\nlimit 100", 'compiled_sql': 'with source(\nselect * from \n    \nwith base_dates as (\n    \nwith date_spine as\n(\n    \n\n    \n\n/*\ncall as follows:\n\ndate_spine(\n    "day",\n    "to_date(\'01/01/2016\', \'mm/dd/yyyy\')",\n    "dateadd(week, 1, current_date)"\n)\n\n*/\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * pow(2, 0)\n     + \n    \n    p1.generated_number * pow(2, 1)\n     + \n    \n    p2.generated_number * pow(2, 2)\n     + \n    \n    p3.generated_number * pow(2, 3)\n     + \n    \n    p4.generated_number * pow(2, 4)\n     + \n    \n    p5.generated_number * pow(2, 5)\n     + \n    \n    p6.generated_number * pow(2, 6)\n     + \n    \n    p7.generated_number * pow(2, 7)\n     + \n    \n    p8.generated_number * pow(2, 8)\n     + \n    \n    p9.generated_number * pow(2, 9)\n     + \n    \n    p10.generated_number * pow(2, 10)\n     + \n    \n    p11.generated_number * pow(2, 11)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 2921\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n  \n\n    dateadd(\n        day,\n        row_number() over (order by 1) - 1,\n        cast(\'2015-01-01\' as datetime)\n        )\n\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast(\'2022-12-31\' as datetime)\n\n)\n\nselect * from filtered\n\n\n\n)\nselect\n    date(d.date_day) as date_day\nfrom\n    date_spine d\n\n),\ndates_with_prior_year_dates as (\n    select\n        cast(d.date_day as date) as date_day,\n        cast(\n  \n\n    dateadd(\n        year,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_year_date_day,\n        cast(\n  \n\n    dateadd(\n        day,\n        -364,\n        d.date_day\n        )\n\n\n as date) as prior_year_over_year_date_day\n    from\n    \tbase_dates d\n)\nselect\n    d.date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        1,\n        d.date_day\n        )\n\n\n as date) as next_date_day,\n    d.prior_year_date_day as prior_year_date_day,\n    d.prior_year_over_year_date_day,\n    cast(\n            case\n                when date_part(\'dayofweek\', d.date_day) = 0 then 7\n                else date_part(\'dayofweek\', d.date_day)\n            end\n        as \n    int\n\n    ) as day_of_week,\n\n    to_char(d.date_day, \'Day\') as day_of_week_name,\n    to_char(d.date_day, \'Dy\') as day_of_week_name_short,\n    cast(date_part(\'day\', d.date_day) as \n    int\n) as day_of_month,\n    cast(date_part(\'dayofyear\', d.date_day) as \n    int\n) as day_of_year,\n\n    cast(\n    date_trunc(\'week\', d.date_day)\n as date) as week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as week_end_date,\n    cast(date_part(\'week\', d.date_day) as \n    int\n) as week_of_year,\n    cast(\n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n as date) as prior_year_week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_week_end_date,\n    cast(date_part(\'week\', d.prior_year_over_year_date_day) as \n    int\n) as prior_year_week_of_year,\n\n    cast(date_part(\'month\', d.date_day) as \n    int\n) as month_of_year,\n    to_char(d.date_day, \'MONTH\')  as month_name,\n    to_char(d.date_day, \'MON\')  as month_name_short,\n\n    cast(\n    date_trunc(\'month\', d.date_day)\n as date) as month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as month_end_date,\n\n    cast(\n    date_trunc(\'month\', d.prior_year_date_day)\n as date) as prior_year_month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.prior_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_month_end_date,\n\n    cast(date_part(\'quarter\', d.date_day) as \n    int\n) as quarter_of_year,\n    cast(\n    date_trunc(\'quarter\', d.date_day)\n as date) as quarter_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        quarter,\n        1,\n        \n    date_trunc(\'quarter\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as quarter_end_date,\n\n    cast(date_part(\'year\', d.date_day) as \n    int\n) as year_number,\n    cast(\n    date_trunc(\'year\', d.date_day)\n as date) as year_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        year,\n        1,\n        \n    date_trunc(\'year\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as year_end_date\nfrom\n    dates_with_prior_year_dates d\norder by 1\n\n;\n)\nselect * from source;\nlimit 100', 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 2 at position 0 unexpected 'select'.", 'raw_sql': "with source(\r\nselect * from {{ dbt_date.get_date_dimension('2015-01-01', '2022-12-31') }};\r\n)\r\nselect * from source;\nlimit 100", 'compiled_sql': 'with source(\nselect * from \n    \nwith base_dates as (\n    \nwith date_spine as\n(\n    \n\n    \n\n/*\ncall as follows:\n\ndate_spine(\n    "day",\n    "to_date(\'01/01/2016\', \'mm/dd/yyyy\')",\n    "dateadd(week, 1, current_date)"\n)\n\n*/\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * pow(2, 0)\n     + \n    \n    p1.generated_number * pow(2, 1)\n     + \n    \n    p2.generated_number * pow(2, 2)\n     + \n    \n    p3.generated_number * pow(2, 3)\n     + \n    \n    p4.generated_number * pow(2, 4)\n     + \n    \n    p5.generated_number * pow(2, 5)\n     + \n    \n    p6.generated_number * pow(2, 6)\n     + \n    \n    p7.generated_number * pow(2, 7)\n     + \n    \n    p8.generated_number * pow(2, 8)\n     + \n    \n    p9.generated_number * pow(2, 9)\n     + \n    \n    p10.generated_number * pow(2, 10)\n     + \n    \n    p11.generated_number * pow(2, 11)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 2921\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n  \n\n    dateadd(\n        day,\n        row_number() over (order by 1) - 1,\n        cast(\'2015-01-01\' as datetime)\n        )\n\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast(\'2022-12-31\' as datetime)\n\n)\n\nselect * from filtered\n\n\n\n)\nselect\n    date(d.date_day) as date_day\nfrom\n    date_spine d\n\n),\ndates_with_prior_year_dates as (\n    select\n        cast(d.date_day as date) as date_day,\n        cast(\n  \n\n    dateadd(\n        year,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_year_date_day,\n        cast(\n  \n\n    dateadd(\n        day,\n        -364,\n        d.date_day\n        )\n\n\n as date) as prior_year_over_year_date_day\n    from\n    \tbase_dates d\n)\nselect\n    d.date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        1,\n        d.date_day\n        )\n\n\n as date) as next_date_day,\n    d.prior_year_date_day as prior_year_date_day,\n    d.prior_year_over_year_date_day,\n    cast(\n            case\n                when date_part(\'dayofweek\', d.date_day) = 0 then 7\n                else date_part(\'dayofweek\', d.date_day)\n            end\n        as \n    int\n\n    ) as day_of_week,\n\n    to_char(d.date_day, \'Day\') as day_of_week_name,\n    to_char(d.date_day, \'Dy\') as day_of_week_name_short,\n    cast(date_part(\'day\', d.date_day) as \n    int\n) as day_of_month,\n    cast(date_part(\'dayofyear\', d.date_day) as \n    int\n) as day_of_year,\n\n    cast(\n    date_trunc(\'week\', d.date_day)\n as date) as week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as week_end_date,\n    cast(date_part(\'week\', d.date_day) as \n    int\n) as week_of_year,\n    cast(\n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n as date) as prior_year_week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_week_end_date,\n    cast(date_part(\'week\', d.prior_year_over_year_date_day) as \n    int\n) as prior_year_week_of_year,\n\n    cast(date_part(\'month\', d.date_day) as \n    int\n) as month_of_year,\n    to_char(d.date_day, \'MONTH\')  as month_name,\n    to_char(d.date_day, \'MON\')  as month_name_short,\n\n    cast(\n    date_trunc(\'month\', d.date_day)\n as date) as month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as month_end_date,\n\n    cast(\n    date_trunc(\'month\', d.prior_year_date_day)\n as date) as prior_year_month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.prior_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_month_end_date,\n\n    cast(date_part(\'quarter\', d.date_day) as \n    int\n) as quarter_of_year,\n    cast(\n    date_trunc(\'quarter\', d.date_day)\n as date) as quarter_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        quarter,\n        1,\n        \n    date_trunc(\'quarter\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as quarter_end_date,\n\n    cast(date_part(\'year\', d.date_day) as \n    int\n) as year_number,\n    cast(\n    date_trunc(\'year\', d.date_day)\n as date) as year_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        year,\n        1,\n        \n    date_trunc(\'year\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as year_end_date\nfrom\n    dates_with_prior_year_dates d\norder by 1\n\n;\n)\nselect * from source;\nlimit 100', 'tags': None}, None)
2020-12-02 14:52:12.044176 (Thread-25): handling poll request
2020-12-02 14:52:12.044663 (Thread-25): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce64336ef0>]}
2020-12-02 14:52:12.045723 (Thread-25): sending response (<Response 36254 bytes [200 OK]>) to 10.0.47.27
2020-12-02 14:56:59.063763 (Thread-26): handling status request
2020-12-02 14:56:59.065514 (Thread-26): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce6426a208>]}
2020-12-02 14:56:59.066736 (Thread-26): sending response (<Response 1237 bytes [200 OK]>) to 10.0.11.131
2020-12-02 14:56:59.614316 (Thread-27): handling run_sql request
2020-12-02 14:56:59.614789 (Thread-27): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce64255f60>]}
2020-12-02 14:57:00.699179 (Thread-27): sending response (<Response 137 bytes [200 OK]>) to 10.0.15.181
2020-12-02 14:57:00.740807 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:57:00.838346 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 14:57:00.838979 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:57:00.839169 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 14:57:00.858200 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:57:00.858301 (Thread-1): On rpc.sales_dataflo.request: BEGIN
2020-12-02 14:57:00.858364 (Thread-1): Opening a new connection, currently in state init
2020-12-02 14:57:01.044297 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 14:57:01.267552 (Thread-28): handling poll request
2020-12-02 14:57:01.268078 (Thread-28): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce64321da0>]}
2020-12-02 14:57:01.270398 (Thread-28): sending response (<Response 2424 bytes [200 OK]>) to 10.0.11.131
2020-12-02 14:57:01.437160 (Thread-1): SQL status: SUCCESS 1 in 0.58 seconds
2020-12-02 14:57:01.437319 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:57:01.437383 (Thread-1): On rpc.sales_dataflo.request: select 
  

    datediff(
        day,
        cast('2015-01-01' as datetime),
        cast('2022-12-31' as datetime)
        )
2020-12-02 14:57:01.514499 (Thread-1): SQL status: SUCCESS 1 in 0.08 seconds
2020-12-02 14:57:01.526810 (Thread-1): finished collecting timing info
2020-12-02 14:57:01.530920 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:57:01.531011 (Thread-1): On rpc.sales_dataflo.request: with source(
select * from 
    
with base_dates as (
    
with date_spine as
(
    

    

/*
call as follows:

date_spine(
    "day",
    "to_date('01/01/2016', 'mm/dd/yyyy')",
    "dateadd(week, 1, current_date)"
)

*/

with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * pow(2, 0)
     + 
    
    p1.generated_number * pow(2, 1)
     + 
    
    p2.generated_number * pow(2, 2)
     + 
    
    p3.generated_number * pow(2, 3)
     + 
    
    p4.generated_number * pow(2, 4)
     + 
    
    p5.generated_number * pow(2, 5)
     + 
    
    p6.generated_number * pow(2, 6)
     + 
    
    p7.generated_number * pow(2, 7)
     + 
    
    p8.generated_number * pow(2, 8)
     + 
    
    p9.generated_number * pow(2, 9)
     + 
    
    p10.generated_number * pow(2, 10)
     + 
    
    p11.generated_number * pow(2, 11)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
     cross join 
    
    p as p7
     cross join 
    
    p as p8
     cross join 
    
    p as p9
     cross join 
    
    p as p10
     cross join 
    
    p as p11
    
    

    )

    select *
    from unioned
    where generated_number <= 2921
    order by generated_number



),

all_periods as (

    select (
        
  

    dateadd(
        day,
        row_number() over (order by 1) - 1,
        cast('2015-01-01' as datetime)
        )



    ) as date_day
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_day <= cast('2022-12-31' as datetime)

)

select * from filtered



)
select
    date(d.date_day) as date_day
from
    date_spine d

),
dates_with_prior_year_dates as (
    select
        cast(d.date_day as date) as date_day,
        cast(
  

    dateadd(
        year,
        -1,
        d.date_day
        )


 as date) as prior_year_date_day,
        cast(
  

    dateadd(
        day,
        -364,
        d.date_day
        )


 as date) as prior_year_over_year_date_day
    from
    	base_dates d
)
select
    d.date_day,
    cast(
  

    dateadd(
        day,
        -1,
        d.date_day
        )


 as date) as prior_date_day,
    cast(
  

    dateadd(
        day,
        1,
        d.date_day
        )


 as date) as next_date_day,
    d.prior_year_date_day as prior_year_date_day,
    d.prior_year_over_year_date_day,
    cast(
            case
                when date_part('dayofweek', d.date_day) = 0 then 7
                else date_part('dayofweek', d.date_day)
            end
        as 
    int

    ) as day_of_week,

    to_char(d.date_day, 'Day') as day_of_week_name,
    to_char(d.date_day, 'Dy') as day_of_week_name_short,
    cast(date_part('day', d.date_day) as 
    int
) as day_of_month,
    cast(date_part('dayofyear', d.date_day) as 
    int
) as day_of_year,

    cast(
    date_trunc('week', d.date_day)
 as date) as week_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', d.date_day)

        )



        )



        as date)
 as date) as week_end_date,
    cast(date_part('week', d.date_day) as 
    int
) as week_of_year,
    cast(
    date_trunc('week', d.prior_year_over_year_date_day)
 as date) as prior_year_week_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', d.prior_year_over_year_date_day)

        )



        )



        as date)
 as date) as prior_year_week_end_date,
    cast(date_part('week', d.prior_year_over_year_date_day) as 
    int
) as prior_year_week_of_year,

    cast(date_part('month', d.date_day) as 
    int
) as month_of_year,
    to_char(d.date_day, 'MONTH')  as month_name,
    to_char(d.date_day, 'MON')  as month_name_short,

    cast(
    date_trunc('month', d.date_day)
 as date) as month_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', d.date_day)

        )



        )



        as date)
 as date) as month_end_date,

    cast(
    date_trunc('month', d.prior_year_date_day)
 as date) as prior_year_month_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', d.prior_year_date_day)

        )



        )



        as date)
 as date) as prior_year_month_end_date,

    cast(date_part('quarter', d.date_day) as 
    int
) as quarter_of_year,
    cast(
    date_trunc('quarter', d.date_day)
 as date) as quarter_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        quarter,
        1,
        
    date_trunc('quarter', d.date_day)

        )



        )



        as date)
 as date) as quarter_end_date,

    cast(date_part('year', d.date_day) as 
    int
) as year_number,
    cast(
    date_trunc('year', d.date_day)
 as date) as year_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        year,
        1,
        
    date_trunc('year', d.date_day)

        )



        )



        as date)
 as date) as year_end_date
from
    dates_with_prior_year_dates d
order by 1


)
select * from source
limit 100
2020-12-02 14:57:01.603383 (Thread-1): Snowflake query id: 0198a941-003f-62af-0000-5eb100011016
2020-12-02 14:57:01.603470 (Thread-1): Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 2 at position 0 unexpected 'select'.
syntax error line 444 at position 0 unexpected ')'.
2020-12-02 14:57:01.603549 (Thread-1): finished collecting timing info
2020-12-02 14:57:01.603824 (Thread-1): On rpc.sales_dataflo.request: ROLLBACK
2020-12-02 14:57:01.720584 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 14:57:01.785910 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 2 at position 0 unexpected 'select'.
  syntax error line 444 at position 0 unexpected ')'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 161, in exception_handler
    yield
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/cursor.py", line 597, in execute
    errvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 97, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, errorclass, errorvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 73, in default_errorhandler
    done_format_msg=errorvalue.get(u'done_format_msg'))
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 2 at position 0 unexpected 'select'.
syntax error line 444 at position 0 unexpected ')'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 85, in execute
    compiled_node.injected_sql, fetch=True
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/base/impl.py", line 227, in execute
    fetch=fetch
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 312, in add_query
    abridge_sql_log=abridge_sql_log
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.6/contextlib.py", line 99, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 178, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 2 at position 0 unexpected 'select'.
  syntax error line 444 at position 0 unexpected ')'.
2020-12-02 14:57:01.787636 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 2 at position 0 unexpected 'select'.\n  syntax error line 444 at position 0 unexpected ')'.", 'raw_sql': "with source(\r\nselect * from {{ dbt_date.get_date_dimension('2015-01-01', '2022-12-31') }}\r\n)\r\nselect * from source\nlimit 100", 'compiled_sql': 'with source(\nselect * from \n    \nwith base_dates as (\n    \nwith date_spine as\n(\n    \n\n    \n\n/*\ncall as follows:\n\ndate_spine(\n    "day",\n    "to_date(\'01/01/2016\', \'mm/dd/yyyy\')",\n    "dateadd(week, 1, current_date)"\n)\n\n*/\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * pow(2, 0)\n     + \n    \n    p1.generated_number * pow(2, 1)\n     + \n    \n    p2.generated_number * pow(2, 2)\n     + \n    \n    p3.generated_number * pow(2, 3)\n     + \n    \n    p4.generated_number * pow(2, 4)\n     + \n    \n    p5.generated_number * pow(2, 5)\n     + \n    \n    p6.generated_number * pow(2, 6)\n     + \n    \n    p7.generated_number * pow(2, 7)\n     + \n    \n    p8.generated_number * pow(2, 8)\n     + \n    \n    p9.generated_number * pow(2, 9)\n     + \n    \n    p10.generated_number * pow(2, 10)\n     + \n    \n    p11.generated_number * pow(2, 11)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 2921\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n  \n\n    dateadd(\n        day,\n        row_number() over (order by 1) - 1,\n        cast(\'2015-01-01\' as datetime)\n        )\n\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast(\'2022-12-31\' as datetime)\n\n)\n\nselect * from filtered\n\n\n\n)\nselect\n    date(d.date_day) as date_day\nfrom\n    date_spine d\n\n),\ndates_with_prior_year_dates as (\n    select\n        cast(d.date_day as date) as date_day,\n        cast(\n  \n\n    dateadd(\n        year,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_year_date_day,\n        cast(\n  \n\n    dateadd(\n        day,\n        -364,\n        d.date_day\n        )\n\n\n as date) as prior_year_over_year_date_day\n    from\n    \tbase_dates d\n)\nselect\n    d.date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        1,\n        d.date_day\n        )\n\n\n as date) as next_date_day,\n    d.prior_year_date_day as prior_year_date_day,\n    d.prior_year_over_year_date_day,\n    cast(\n            case\n                when date_part(\'dayofweek\', d.date_day) = 0 then 7\n                else date_part(\'dayofweek\', d.date_day)\n            end\n        as \n    int\n\n    ) as day_of_week,\n\n    to_char(d.date_day, \'Day\') as day_of_week_name,\n    to_char(d.date_day, \'Dy\') as day_of_week_name_short,\n    cast(date_part(\'day\', d.date_day) as \n    int\n) as day_of_month,\n    cast(date_part(\'dayofyear\', d.date_day) as \n    int\n) as day_of_year,\n\n    cast(\n    date_trunc(\'week\', d.date_day)\n as date) as week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as week_end_date,\n    cast(date_part(\'week\', d.date_day) as \n    int\n) as week_of_year,\n    cast(\n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n as date) as prior_year_week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_week_end_date,\n    cast(date_part(\'week\', d.prior_year_over_year_date_day) as \n    int\n) as prior_year_week_of_year,\n\n    cast(date_part(\'month\', d.date_day) as \n    int\n) as month_of_year,\n    to_char(d.date_day, \'MONTH\')  as month_name,\n    to_char(d.date_day, \'MON\')  as month_name_short,\n\n    cast(\n    date_trunc(\'month\', d.date_day)\n as date) as month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as month_end_date,\n\n    cast(\n    date_trunc(\'month\', d.prior_year_date_day)\n as date) as prior_year_month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.prior_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_month_end_date,\n\n    cast(date_part(\'quarter\', d.date_day) as \n    int\n) as quarter_of_year,\n    cast(\n    date_trunc(\'quarter\', d.date_day)\n as date) as quarter_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        quarter,\n        1,\n        \n    date_trunc(\'quarter\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as quarter_end_date,\n\n    cast(date_part(\'year\', d.date_day) as \n    int\n) as year_number,\n    cast(\n    date_trunc(\'year\', d.date_day)\n as date) as year_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        year,\n        1,\n        \n    date_trunc(\'year\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as year_end_date\nfrom\n    dates_with_prior_year_dates d\norder by 1\n\n\n)\nselect * from source\nlimit 100', 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 2 at position 0 unexpected 'select'.\n  syntax error line 444 at position 0 unexpected ')'.", 'raw_sql': "with source(\r\nselect * from {{ dbt_date.get_date_dimension('2015-01-01', '2022-12-31') }}\r\n)\r\nselect * from source\nlimit 100", 'compiled_sql': 'with source(\nselect * from \n    \nwith base_dates as (\n    \nwith date_spine as\n(\n    \n\n    \n\n/*\ncall as follows:\n\ndate_spine(\n    "day",\n    "to_date(\'01/01/2016\', \'mm/dd/yyyy\')",\n    "dateadd(week, 1, current_date)"\n)\n\n*/\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * pow(2, 0)\n     + \n    \n    p1.generated_number * pow(2, 1)\n     + \n    \n    p2.generated_number * pow(2, 2)\n     + \n    \n    p3.generated_number * pow(2, 3)\n     + \n    \n    p4.generated_number * pow(2, 4)\n     + \n    \n    p5.generated_number * pow(2, 5)\n     + \n    \n    p6.generated_number * pow(2, 6)\n     + \n    \n    p7.generated_number * pow(2, 7)\n     + \n    \n    p8.generated_number * pow(2, 8)\n     + \n    \n    p9.generated_number * pow(2, 9)\n     + \n    \n    p10.generated_number * pow(2, 10)\n     + \n    \n    p11.generated_number * pow(2, 11)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 2921\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n  \n\n    dateadd(\n        day,\n        row_number() over (order by 1) - 1,\n        cast(\'2015-01-01\' as datetime)\n        )\n\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast(\'2022-12-31\' as datetime)\n\n)\n\nselect * from filtered\n\n\n\n)\nselect\n    date(d.date_day) as date_day\nfrom\n    date_spine d\n\n),\ndates_with_prior_year_dates as (\n    select\n        cast(d.date_day as date) as date_day,\n        cast(\n  \n\n    dateadd(\n        year,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_year_date_day,\n        cast(\n  \n\n    dateadd(\n        day,\n        -364,\n        d.date_day\n        )\n\n\n as date) as prior_year_over_year_date_day\n    from\n    \tbase_dates d\n)\nselect\n    d.date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        1,\n        d.date_day\n        )\n\n\n as date) as next_date_day,\n    d.prior_year_date_day as prior_year_date_day,\n    d.prior_year_over_year_date_day,\n    cast(\n            case\n                when date_part(\'dayofweek\', d.date_day) = 0 then 7\n                else date_part(\'dayofweek\', d.date_day)\n            end\n        as \n    int\n\n    ) as day_of_week,\n\n    to_char(d.date_day, \'Day\') as day_of_week_name,\n    to_char(d.date_day, \'Dy\') as day_of_week_name_short,\n    cast(date_part(\'day\', d.date_day) as \n    int\n) as day_of_month,\n    cast(date_part(\'dayofyear\', d.date_day) as \n    int\n) as day_of_year,\n\n    cast(\n    date_trunc(\'week\', d.date_day)\n as date) as week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as week_end_date,\n    cast(date_part(\'week\', d.date_day) as \n    int\n) as week_of_year,\n    cast(\n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n as date) as prior_year_week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_week_end_date,\n    cast(date_part(\'week\', d.prior_year_over_year_date_day) as \n    int\n) as prior_year_week_of_year,\n\n    cast(date_part(\'month\', d.date_day) as \n    int\n) as month_of_year,\n    to_char(d.date_day, \'MONTH\')  as month_name,\n    to_char(d.date_day, \'MON\')  as month_name_short,\n\n    cast(\n    date_trunc(\'month\', d.date_day)\n as date) as month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as month_end_date,\n\n    cast(\n    date_trunc(\'month\', d.prior_year_date_day)\n as date) as prior_year_month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.prior_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_month_end_date,\n\n    cast(date_part(\'quarter\', d.date_day) as \n    int\n) as quarter_of_year,\n    cast(\n    date_trunc(\'quarter\', d.date_day)\n as date) as quarter_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        quarter,\n        1,\n        \n    date_trunc(\'quarter\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as quarter_end_date,\n\n    cast(date_part(\'year\', d.date_day) as \n    int\n) as year_number,\n    cast(\n    date_trunc(\'year\', d.date_day)\n as date) as year_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        year,\n        1,\n        \n    date_trunc(\'year\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as year_end_date\nfrom\n    dates_with_prior_year_dates d\norder by 1\n\n\n)\nselect * from source\nlimit 100', 'tags': None}, None)
2020-12-02 14:57:02.849676 (Thread-29): handling poll request
2020-12-02 14:57:02.850173 (Thread-29): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce64325b38>]}
2020-12-02 14:57:02.851341 (Thread-29): sending response (<Response 36660 bytes [200 OK]>) to 10.0.11.131
2020-12-02 14:58:16.360429 (Thread-30): handling status request
2020-12-02 14:58:16.361101 (Thread-30): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce643027b8>]}
2020-12-02 14:58:16.362833 (Thread-30): sending response (<Response 1237 bytes [200 OK]>) to 10.0.38.46
2020-12-02 14:58:17.006567 (Thread-31): handling run_sql request
2020-12-02 14:58:17.007043 (Thread-31): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce643027b8>]}
2020-12-02 14:58:17.011062 (Thread-31): Checking header 'user-agent' tracing in whitelist set(), 44 additional messages skipped
2020-12-02 14:58:17.180911 (Thread-31): writing 1 spans (enabled:True), 60 additional messages skipped
2020-12-02 14:58:17.181286 (Thread-31): 
      name requests.request
        id 2390269028387053583
  trace_id 8560540252516637957
 parent_id None
   service requests
  resource requests.request
      type http
     start 1606921097.010566
       end 1606921097.180682
  duration 0.170116s
     error 0
      tags 
           http.method:POST
           http.status_code:200
           http.url:https://fishtownanalytics.sinter-collect.com/com.snowplowanalytics.snowplow/tp2
           runtime-id:8daea1d60d034a8cace00663c6a43dc8, 60 additional messages skipped
2020-12-02 14:58:18.134161 (AgentWriter): reported 1 traces in 0.00351s, 1 additional messages skipped
2020-12-02 14:58:18.134593 (AgentWriter): initialized RateSampler, sample 100% of traces, 71 additional messages skipped
2020-12-02 14:58:18.229635 (Thread-31): sending response (<Response 137 bytes [200 OK]>) to 10.0.15.181
2020-12-02 14:58:18.259439 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:58:18.350011 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 14:58:18.350653 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:58:18.350800 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 14:58:18.369127 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:58:18.369235 (Thread-1): On rpc.sales_dataflo.request: BEGIN
2020-12-02 14:58:18.369299 (Thread-1): Opening a new connection, currently in state init
2020-12-02 14:58:18.565850 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 14:58:18.930928 (Thread-32): handling poll request
2020-12-02 14:58:18.931499 (Thread-32): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f4e2400>]}
2020-12-02 14:58:18.933823 (Thread-32): sending response (<Response 2423 bytes [200 OK]>) to 10.0.11.16
2020-12-02 14:58:18.974240 (Thread-1): SQL status: SUCCESS 1 in 0.60 seconds
2020-12-02 14:58:18.974480 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:58:18.974596 (Thread-1): On rpc.sales_dataflo.request: select 
  

    datediff(
        day,
        cast('2015-01-01' as datetime),
        cast('2022-12-31' as datetime)
        )
2020-12-02 14:58:19.038707 (Thread-1): SQL status: SUCCESS 1 in 0.06 seconds
2020-12-02 14:58:19.056543 (Thread-1): finished collecting timing info
2020-12-02 14:58:19.062943 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:58:19.063094 (Thread-1): On rpc.sales_dataflo.request: with source as (
select * from 
    
with base_dates as (
    
with date_spine as
(
    

    

/*
call as follows:

date_spine(
    "day",
    "to_date('01/01/2016', 'mm/dd/yyyy')",
    "dateadd(week, 1, current_date)"
)

*/

with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * pow(2, 0)
     + 
    
    p1.generated_number * pow(2, 1)
     + 
    
    p2.generated_number * pow(2, 2)
     + 
    
    p3.generated_number * pow(2, 3)
     + 
    
    p4.generated_number * pow(2, 4)
     + 
    
    p5.generated_number * pow(2, 5)
     + 
    
    p6.generated_number * pow(2, 6)
     + 
    
    p7.generated_number * pow(2, 7)
     + 
    
    p8.generated_number * pow(2, 8)
     + 
    
    p9.generated_number * pow(2, 9)
     + 
    
    p10.generated_number * pow(2, 10)
     + 
    
    p11.generated_number * pow(2, 11)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
     cross join 
    
    p as p7
     cross join 
    
    p as p8
     cross join 
    
    p as p9
     cross join 
    
    p as p10
     cross join 
    
    p as p11
    
    

    )

    select *
    from unioned
    where generated_number <= 2921
    order by generated_number



),

all_periods as (

    select (
        
  

    dateadd(
        day,
        row_number() over (order by 1) - 1,
        cast('2015-01-01' as datetime)
        )



    ) as date_day
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_day <= cast('2022-12-31' as datetime)

)

select * from filtered



)
select
    date(d.date_day) as date_day
from
    date_spine d

),
dates_with_prior_year_dates as (
    select
        cast(d.date_day as date) as date_day,
        cast(
  

    dateadd(
        year,
        -1,
        d.date_day
        )


 as date) as prior_year_date_day,
        cast(
  

    dateadd(
        day,
        -364,
        d.date_day
        )


 as date) as prior_year_over_year_date_day
    from
    	base_dates d
)
select
    d.date_day,
    cast(
  

    dateadd(
        day,
        -1,
        d.date_day
        )


 as date) as prior_date_day,
    cast(
  

    dateadd(
        day,
        1,
        d.date_day
        )


 as date) as next_date_day,
    d.prior_year_date_day as prior_year_date_day,
    d.prior_year_over_year_date_day,
    cast(
            case
                when date_part('dayofweek', d.date_day) = 0 then 7
                else date_part('dayofweek', d.date_day)
            end
        as 
    int

    ) as day_of_week,

    to_char(d.date_day, 'Day') as day_of_week_name,
    to_char(d.date_day, 'Dy') as day_of_week_name_short,
    cast(date_part('day', d.date_day) as 
    int
) as day_of_month,
    cast(date_part('dayofyear', d.date_day) as 
    int
) as day_of_year,

    cast(
    date_trunc('week', d.date_day)
 as date) as week_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', d.date_day)

        )



        )



        as date)
 as date) as week_end_date,
    cast(date_part('week', d.date_day) as 
    int
) as week_of_year,
    cast(
    date_trunc('week', d.prior_year_over_year_date_day)
 as date) as prior_year_week_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', d.prior_year_over_year_date_day)

        )



        )



        as date)
 as date) as prior_year_week_end_date,
    cast(date_part('week', d.prior_year_over_year_date_day) as 
    int
) as prior_year_week_of_year,

    cast(date_part('month', d.date_day) as 
    int
) as month_of_year,
    to_char(d.date_day, 'MONTH')  as month_name,
    to_char(d.date_day, 'MON')  as month_name_short,

    cast(
    date_trunc('month', d.date_day)
 as date) as month_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', d.date_day)

        )



        )



        as date)
 as date) as month_end_date,

    cast(
    date_trunc('month', d.prior_year_date_day)
 as date) as prior_year_month_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', d.prior_year_date_day)

        )



        )



        as date)
 as date) as prior_year_month_end_date,

    cast(date_part('quarter', d.date_day) as 
    int
) as quarter_of_year,
    cast(
    date_trunc('quarter', d.date_day)
 as date) as quarter_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        quarter,
        1,
        
    date_trunc('quarter', d.date_day)

        )



        )



        as date)
 as date) as quarter_end_date,

    cast(date_part('year', d.date_day) as 
    int
) as year_number,
    cast(
    date_trunc('year', d.date_day)
 as date) as year_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        year,
        1,
        
    date_trunc('year', d.date_day)

        )



        )



        as date)
 as date) as year_end_date
from
    dates_with_prior_year_dates d
order by 1


)
select * from source
limit 100
2020-12-02 14:58:19.144859 (Thread-1): Snowflake query id: 0198a942-0041-796a-0000-00005eb1ffed
2020-12-02 14:58:19.144988 (Thread-1): Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 4 at position 0 unexpected 'with'.
syntax error line 163 at position 1 unexpected ','.
2020-12-02 14:58:19.145081 (Thread-1): finished collecting timing info
2020-12-02 14:58:19.145415 (Thread-1): On rpc.sales_dataflo.request: ROLLBACK
2020-12-02 14:58:19.260497 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 14:58:19.344723 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 4 at position 0 unexpected 'with'.
  syntax error line 163 at position 1 unexpected ','.
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 161, in exception_handler
    yield
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/cursor.py", line 597, in execute
    errvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 97, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, errorclass, errorvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 73, in default_errorhandler
    done_format_msg=errorvalue.get(u'done_format_msg'))
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 4 at position 0 unexpected 'with'.
syntax error line 163 at position 1 unexpected ','.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 85, in execute
    compiled_node.injected_sql, fetch=True
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/base/impl.py", line 227, in execute
    fetch=fetch
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 312, in add_query
    abridge_sql_log=abridge_sql_log
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.6/contextlib.py", line 99, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 178, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 4 at position 0 unexpected 'with'.
  syntax error line 163 at position 1 unexpected ','.
2020-12-02 14:58:19.346455 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 4 at position 0 unexpected 'with'.\n  syntax error line 163 at position 1 unexpected ','.", 'raw_sql': "with source as (\r\nselect * from {{ dbt_date.get_date_dimension('2015-01-01', '2022-12-31') }}\r\n)\r\nselect * from source\nlimit 100", 'compiled_sql': 'with source as (\nselect * from \n    \nwith base_dates as (\n    \nwith date_spine as\n(\n    \n\n    \n\n/*\ncall as follows:\n\ndate_spine(\n    "day",\n    "to_date(\'01/01/2016\', \'mm/dd/yyyy\')",\n    "dateadd(week, 1, current_date)"\n)\n\n*/\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * pow(2, 0)\n     + \n    \n    p1.generated_number * pow(2, 1)\n     + \n    \n    p2.generated_number * pow(2, 2)\n     + \n    \n    p3.generated_number * pow(2, 3)\n     + \n    \n    p4.generated_number * pow(2, 4)\n     + \n    \n    p5.generated_number * pow(2, 5)\n     + \n    \n    p6.generated_number * pow(2, 6)\n     + \n    \n    p7.generated_number * pow(2, 7)\n     + \n    \n    p8.generated_number * pow(2, 8)\n     + \n    \n    p9.generated_number * pow(2, 9)\n     + \n    \n    p10.generated_number * pow(2, 10)\n     + \n    \n    p11.generated_number * pow(2, 11)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 2921\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n  \n\n    dateadd(\n        day,\n        row_number() over (order by 1) - 1,\n        cast(\'2015-01-01\' as datetime)\n        )\n\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast(\'2022-12-31\' as datetime)\n\n)\n\nselect * from filtered\n\n\n\n)\nselect\n    date(d.date_day) as date_day\nfrom\n    date_spine d\n\n),\ndates_with_prior_year_dates as (\n    select\n        cast(d.date_day as date) as date_day,\n        cast(\n  \n\n    dateadd(\n        year,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_year_date_day,\n        cast(\n  \n\n    dateadd(\n        day,\n        -364,\n        d.date_day\n        )\n\n\n as date) as prior_year_over_year_date_day\n    from\n    \tbase_dates d\n)\nselect\n    d.date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        1,\n        d.date_day\n        )\n\n\n as date) as next_date_day,\n    d.prior_year_date_day as prior_year_date_day,\n    d.prior_year_over_year_date_day,\n    cast(\n            case\n                when date_part(\'dayofweek\', d.date_day) = 0 then 7\n                else date_part(\'dayofweek\', d.date_day)\n            end\n        as \n    int\n\n    ) as day_of_week,\n\n    to_char(d.date_day, \'Day\') as day_of_week_name,\n    to_char(d.date_day, \'Dy\') as day_of_week_name_short,\n    cast(date_part(\'day\', d.date_day) as \n    int\n) as day_of_month,\n    cast(date_part(\'dayofyear\', d.date_day) as \n    int\n) as day_of_year,\n\n    cast(\n    date_trunc(\'week\', d.date_day)\n as date) as week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as week_end_date,\n    cast(date_part(\'week\', d.date_day) as \n    int\n) as week_of_year,\n    cast(\n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n as date) as prior_year_week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_week_end_date,\n    cast(date_part(\'week\', d.prior_year_over_year_date_day) as \n    int\n) as prior_year_week_of_year,\n\n    cast(date_part(\'month\', d.date_day) as \n    int\n) as month_of_year,\n    to_char(d.date_day, \'MONTH\')  as month_name,\n    to_char(d.date_day, \'MON\')  as month_name_short,\n\n    cast(\n    date_trunc(\'month\', d.date_day)\n as date) as month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as month_end_date,\n\n    cast(\n    date_trunc(\'month\', d.prior_year_date_day)\n as date) as prior_year_month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.prior_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_month_end_date,\n\n    cast(date_part(\'quarter\', d.date_day) as \n    int\n) as quarter_of_year,\n    cast(\n    date_trunc(\'quarter\', d.date_day)\n as date) as quarter_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        quarter,\n        1,\n        \n    date_trunc(\'quarter\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as quarter_end_date,\n\n    cast(date_part(\'year\', d.date_day) as \n    int\n) as year_number,\n    cast(\n    date_trunc(\'year\', d.date_day)\n as date) as year_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        year,\n        1,\n        \n    date_trunc(\'year\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as year_end_date\nfrom\n    dates_with_prior_year_dates d\norder by 1\n\n\n)\nselect * from source\nlimit 100', 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 4 at position 0 unexpected 'with'.\n  syntax error line 163 at position 1 unexpected ','.", 'raw_sql': "with source as (\r\nselect * from {{ dbt_date.get_date_dimension('2015-01-01', '2022-12-31') }}\r\n)\r\nselect * from source\nlimit 100", 'compiled_sql': 'with source as (\nselect * from \n    \nwith base_dates as (\n    \nwith date_spine as\n(\n    \n\n    \n\n/*\ncall as follows:\n\ndate_spine(\n    "day",\n    "to_date(\'01/01/2016\', \'mm/dd/yyyy\')",\n    "dateadd(week, 1, current_date)"\n)\n\n*/\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * pow(2, 0)\n     + \n    \n    p1.generated_number * pow(2, 1)\n     + \n    \n    p2.generated_number * pow(2, 2)\n     + \n    \n    p3.generated_number * pow(2, 3)\n     + \n    \n    p4.generated_number * pow(2, 4)\n     + \n    \n    p5.generated_number * pow(2, 5)\n     + \n    \n    p6.generated_number * pow(2, 6)\n     + \n    \n    p7.generated_number * pow(2, 7)\n     + \n    \n    p8.generated_number * pow(2, 8)\n     + \n    \n    p9.generated_number * pow(2, 9)\n     + \n    \n    p10.generated_number * pow(2, 10)\n     + \n    \n    p11.generated_number * pow(2, 11)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 2921\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n  \n\n    dateadd(\n        day,\n        row_number() over (order by 1) - 1,\n        cast(\'2015-01-01\' as datetime)\n        )\n\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast(\'2022-12-31\' as datetime)\n\n)\n\nselect * from filtered\n\n\n\n)\nselect\n    date(d.date_day) as date_day\nfrom\n    date_spine d\n\n),\ndates_with_prior_year_dates as (\n    select\n        cast(d.date_day as date) as date_day,\n        cast(\n  \n\n    dateadd(\n        year,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_year_date_day,\n        cast(\n  \n\n    dateadd(\n        day,\n        -364,\n        d.date_day\n        )\n\n\n as date) as prior_year_over_year_date_day\n    from\n    \tbase_dates d\n)\nselect\n    d.date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        1,\n        d.date_day\n        )\n\n\n as date) as next_date_day,\n    d.prior_year_date_day as prior_year_date_day,\n    d.prior_year_over_year_date_day,\n    cast(\n            case\n                when date_part(\'dayofweek\', d.date_day) = 0 then 7\n                else date_part(\'dayofweek\', d.date_day)\n            end\n        as \n    int\n\n    ) as day_of_week,\n\n    to_char(d.date_day, \'Day\') as day_of_week_name,\n    to_char(d.date_day, \'Dy\') as day_of_week_name_short,\n    cast(date_part(\'day\', d.date_day) as \n    int\n) as day_of_month,\n    cast(date_part(\'dayofyear\', d.date_day) as \n    int\n) as day_of_year,\n\n    cast(\n    date_trunc(\'week\', d.date_day)\n as date) as week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as week_end_date,\n    cast(date_part(\'week\', d.date_day) as \n    int\n) as week_of_year,\n    cast(\n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n as date) as prior_year_week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_week_end_date,\n    cast(date_part(\'week\', d.prior_year_over_year_date_day) as \n    int\n) as prior_year_week_of_year,\n\n    cast(date_part(\'month\', d.date_day) as \n    int\n) as month_of_year,\n    to_char(d.date_day, \'MONTH\')  as month_name,\n    to_char(d.date_day, \'MON\')  as month_name_short,\n\n    cast(\n    date_trunc(\'month\', d.date_day)\n as date) as month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as month_end_date,\n\n    cast(\n    date_trunc(\'month\', d.prior_year_date_day)\n as date) as prior_year_month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.prior_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_month_end_date,\n\n    cast(date_part(\'quarter\', d.date_day) as \n    int\n) as quarter_of_year,\n    cast(\n    date_trunc(\'quarter\', d.date_day)\n as date) as quarter_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        quarter,\n        1,\n        \n    date_trunc(\'quarter\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as quarter_end_date,\n\n    cast(date_part(\'year\', d.date_day) as \n    int\n) as year_number,\n    cast(\n    date_trunc(\'year\', d.date_day)\n as date) as year_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        year,\n        1,\n        \n    date_trunc(\'year\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as year_end_date\nfrom\n    dates_with_prior_year_dates d\norder by 1\n\n\n)\nselect * from source\nlimit 100', 'tags': None}, None)
2020-12-02 14:58:20.487162 (Thread-33): handling poll request
2020-12-02 14:58:20.487647 (Thread-33): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f64bbe0>]}
2020-12-02 14:58:20.488783 (Thread-33): sending response (<Response 36674 bytes [200 OK]>) to 10.0.15.181
2020-12-02 14:59:26.884956 (Thread-34): handling status request
2020-12-02 14:59:26.885465 (Thread-34): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f7a47b8>]}
2020-12-02 14:59:26.886695 (Thread-34): sending response (<Response 1237 bytes [200 OK]>) to 10.0.38.46
2020-12-02 14:59:27.413939 (Thread-35): handling run_sql request
2020-12-02 14:59:27.414445 (Thread-35): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f7a47b8>]}
2020-12-02 14:59:28.460353 (Thread-35): sending response (<Response 137 bytes [200 OK]>) to 10.0.24.195
2020-12-02 14:59:28.486881 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:59:28.577680 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 14:59:28.578235 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:59:28.578384 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 14:59:28.596164 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:59:28.596262 (Thread-1): On rpc.sales_dataflo.request: BEGIN
2020-12-02 14:59:28.596325 (Thread-1): Opening a new connection, currently in state init
2020-12-02 14:59:28.776104 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 14:59:29.074679 (Thread-36): handling poll request
2020-12-02 14:59:29.075190 (Thread-36): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f79f160>]}
2020-12-02 14:59:29.077638 (Thread-36): sending response (<Response 2424 bytes [200 OK]>) to 10.0.24.195
2020-12-02 14:59:29.355934 (Thread-1): SQL status: SUCCESS 1 in 0.76 seconds
2020-12-02 14:59:29.356097 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:59:29.356162 (Thread-1): On rpc.sales_dataflo.request: select 
  

    datediff(
        day,
        cast('2015-01-01' as datetime),
        cast('2022-12-31' as datetime)
        )
2020-12-02 14:59:29.426309 (Thread-1): SQL status: SUCCESS 1 in 0.07 seconds
2020-12-02 14:59:29.438418 (Thread-1): finished collecting timing info
2020-12-02 14:59:29.442510 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 14:59:29.442593 (Thread-1): On rpc.sales_dataflo.request: WITH source as (
select * from 
    
with base_dates as (
    
with date_spine as
(
    

    

/*
call as follows:

date_spine(
    "day",
    "to_date('01/01/2016', 'mm/dd/yyyy')",
    "dateadd(week, 1, current_date)"
)

*/

with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * pow(2, 0)
     + 
    
    p1.generated_number * pow(2, 1)
     + 
    
    p2.generated_number * pow(2, 2)
     + 
    
    p3.generated_number * pow(2, 3)
     + 
    
    p4.generated_number * pow(2, 4)
     + 
    
    p5.generated_number * pow(2, 5)
     + 
    
    p6.generated_number * pow(2, 6)
     + 
    
    p7.generated_number * pow(2, 7)
     + 
    
    p8.generated_number * pow(2, 8)
     + 
    
    p9.generated_number * pow(2, 9)
     + 
    
    p10.generated_number * pow(2, 10)
     + 
    
    p11.generated_number * pow(2, 11)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
     cross join 
    
    p as p7
     cross join 
    
    p as p8
     cross join 
    
    p as p9
     cross join 
    
    p as p10
     cross join 
    
    p as p11
    
    

    )

    select *
    from unioned
    where generated_number <= 2921
    order by generated_number



),

all_periods as (

    select (
        
  

    dateadd(
        day,
        row_number() over (order by 1) - 1,
        cast('2015-01-01' as datetime)
        )



    ) as date_day
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_day <= cast('2022-12-31' as datetime)

)

select * from filtered



)
select
    date(d.date_day) as date_day
from
    date_spine d

),
dates_with_prior_year_dates as (
    select
        cast(d.date_day as date) as date_day,
        cast(
  

    dateadd(
        year,
        -1,
        d.date_day
        )


 as date) as prior_year_date_day,
        cast(
  

    dateadd(
        day,
        -364,
        d.date_day
        )


 as date) as prior_year_over_year_date_day
    from
    	base_dates d
)
select
    d.date_day,
    cast(
  

    dateadd(
        day,
        -1,
        d.date_day
        )


 as date) as prior_date_day,
    cast(
  

    dateadd(
        day,
        1,
        d.date_day
        )


 as date) as next_date_day,
    d.prior_year_date_day as prior_year_date_day,
    d.prior_year_over_year_date_day,
    cast(
            case
                when date_part('dayofweek', d.date_day) = 0 then 7
                else date_part('dayofweek', d.date_day)
            end
        as 
    int

    ) as day_of_week,

    to_char(d.date_day, 'Day') as day_of_week_name,
    to_char(d.date_day, 'Dy') as day_of_week_name_short,
    cast(date_part('day', d.date_day) as 
    int
) as day_of_month,
    cast(date_part('dayofyear', d.date_day) as 
    int
) as day_of_year,

    cast(
    date_trunc('week', d.date_day)
 as date) as week_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', d.date_day)

        )



        )



        as date)
 as date) as week_end_date,
    cast(date_part('week', d.date_day) as 
    int
) as week_of_year,
    cast(
    date_trunc('week', d.prior_year_over_year_date_day)
 as date) as prior_year_week_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', d.prior_year_over_year_date_day)

        )



        )



        as date)
 as date) as prior_year_week_end_date,
    cast(date_part('week', d.prior_year_over_year_date_day) as 
    int
) as prior_year_week_of_year,

    cast(date_part('month', d.date_day) as 
    int
) as month_of_year,
    to_char(d.date_day, 'MONTH')  as month_name,
    to_char(d.date_day, 'MON')  as month_name_short,

    cast(
    date_trunc('month', d.date_day)
 as date) as month_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', d.date_day)

        )



        )



        as date)
 as date) as month_end_date,

    cast(
    date_trunc('month', d.prior_year_date_day)
 as date) as prior_year_month_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', d.prior_year_date_day)

        )



        )



        as date)
 as date) as prior_year_month_end_date,

    cast(date_part('quarter', d.date_day) as 
    int
) as quarter_of_year,
    cast(
    date_trunc('quarter', d.date_day)
 as date) as quarter_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        quarter,
        1,
        
    date_trunc('quarter', d.date_day)

        )



        )



        as date)
 as date) as quarter_end_date,

    cast(date_part('year', d.date_day) as 
    int
) as year_number,
    cast(
    date_trunc('year', d.date_day)
 as date) as year_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        year,
        1,
        
    date_trunc('year', d.date_day)

        )



        )



        as date)
 as date) as year_end_date
from
    dates_with_prior_year_dates d
order by 1


)
select * from source
limit 100
2020-12-02 14:59:29.547007 (Thread-1): Snowflake query id: 0198a943-0029-5b73-0000-5eb100011026
2020-12-02 14:59:29.547111 (Thread-1): Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 4 at position 0 unexpected 'with'.
syntax error line 163 at position 1 unexpected ','.
2020-12-02 14:59:29.547198 (Thread-1): finished collecting timing info
2020-12-02 14:59:29.547514 (Thread-1): On rpc.sales_dataflo.request: ROLLBACK
2020-12-02 14:59:29.710886 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 14:59:29.800014 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 4 at position 0 unexpected 'with'.
  syntax error line 163 at position 1 unexpected ','.
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 161, in exception_handler
    yield
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/cursor.py", line 597, in execute
    errvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 97, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, errorclass, errorvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 73, in default_errorhandler
    done_format_msg=errorvalue.get(u'done_format_msg'))
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 4 at position 0 unexpected 'with'.
syntax error line 163 at position 1 unexpected ','.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 85, in execute
    compiled_node.injected_sql, fetch=True
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/base/impl.py", line 227, in execute
    fetch=fetch
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 312, in add_query
    abridge_sql_log=abridge_sql_log
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.6/contextlib.py", line 99, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 178, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 4 at position 0 unexpected 'with'.
  syntax error line 163 at position 1 unexpected ','.
2020-12-02 14:59:29.801793 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 4 at position 0 unexpected 'with'.\n  syntax error line 163 at position 1 unexpected ','.", 'raw_sql': "WITH source as (\r\nselect * from {{ dbt_date.get_date_dimension('2015-01-01', '2022-12-31') }}\r\n)\r\nselect * from source\nlimit 100", 'compiled_sql': 'WITH source as (\nselect * from \n    \nwith base_dates as (\n    \nwith date_spine as\n(\n    \n\n    \n\n/*\ncall as follows:\n\ndate_spine(\n    "day",\n    "to_date(\'01/01/2016\', \'mm/dd/yyyy\')",\n    "dateadd(week, 1, current_date)"\n)\n\n*/\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * pow(2, 0)\n     + \n    \n    p1.generated_number * pow(2, 1)\n     + \n    \n    p2.generated_number * pow(2, 2)\n     + \n    \n    p3.generated_number * pow(2, 3)\n     + \n    \n    p4.generated_number * pow(2, 4)\n     + \n    \n    p5.generated_number * pow(2, 5)\n     + \n    \n    p6.generated_number * pow(2, 6)\n     + \n    \n    p7.generated_number * pow(2, 7)\n     + \n    \n    p8.generated_number * pow(2, 8)\n     + \n    \n    p9.generated_number * pow(2, 9)\n     + \n    \n    p10.generated_number * pow(2, 10)\n     + \n    \n    p11.generated_number * pow(2, 11)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 2921\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n  \n\n    dateadd(\n        day,\n        row_number() over (order by 1) - 1,\n        cast(\'2015-01-01\' as datetime)\n        )\n\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast(\'2022-12-31\' as datetime)\n\n)\n\nselect * from filtered\n\n\n\n)\nselect\n    date(d.date_day) as date_day\nfrom\n    date_spine d\n\n),\ndates_with_prior_year_dates as (\n    select\n        cast(d.date_day as date) as date_day,\n        cast(\n  \n\n    dateadd(\n        year,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_year_date_day,\n        cast(\n  \n\n    dateadd(\n        day,\n        -364,\n        d.date_day\n        )\n\n\n as date) as prior_year_over_year_date_day\n    from\n    \tbase_dates d\n)\nselect\n    d.date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        1,\n        d.date_day\n        )\n\n\n as date) as next_date_day,\n    d.prior_year_date_day as prior_year_date_day,\n    d.prior_year_over_year_date_day,\n    cast(\n            case\n                when date_part(\'dayofweek\', d.date_day) = 0 then 7\n                else date_part(\'dayofweek\', d.date_day)\n            end\n        as \n    int\n\n    ) as day_of_week,\n\n    to_char(d.date_day, \'Day\') as day_of_week_name,\n    to_char(d.date_day, \'Dy\') as day_of_week_name_short,\n    cast(date_part(\'day\', d.date_day) as \n    int\n) as day_of_month,\n    cast(date_part(\'dayofyear\', d.date_day) as \n    int\n) as day_of_year,\n\n    cast(\n    date_trunc(\'week\', d.date_day)\n as date) as week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as week_end_date,\n    cast(date_part(\'week\', d.date_day) as \n    int\n) as week_of_year,\n    cast(\n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n as date) as prior_year_week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_week_end_date,\n    cast(date_part(\'week\', d.prior_year_over_year_date_day) as \n    int\n) as prior_year_week_of_year,\n\n    cast(date_part(\'month\', d.date_day) as \n    int\n) as month_of_year,\n    to_char(d.date_day, \'MONTH\')  as month_name,\n    to_char(d.date_day, \'MON\')  as month_name_short,\n\n    cast(\n    date_trunc(\'month\', d.date_day)\n as date) as month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as month_end_date,\n\n    cast(\n    date_trunc(\'month\', d.prior_year_date_day)\n as date) as prior_year_month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.prior_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_month_end_date,\n\n    cast(date_part(\'quarter\', d.date_day) as \n    int\n) as quarter_of_year,\n    cast(\n    date_trunc(\'quarter\', d.date_day)\n as date) as quarter_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        quarter,\n        1,\n        \n    date_trunc(\'quarter\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as quarter_end_date,\n\n    cast(date_part(\'year\', d.date_day) as \n    int\n) as year_number,\n    cast(\n    date_trunc(\'year\', d.date_day)\n as date) as year_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        year,\n        1,\n        \n    date_trunc(\'year\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as year_end_date\nfrom\n    dates_with_prior_year_dates d\norder by 1\n\n\n)\nselect * from source\nlimit 100', 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 4 at position 0 unexpected 'with'.\n  syntax error line 163 at position 1 unexpected ','.", 'raw_sql': "WITH source as (\r\nselect * from {{ dbt_date.get_date_dimension('2015-01-01', '2022-12-31') }}\r\n)\r\nselect * from source\nlimit 100", 'compiled_sql': 'WITH source as (\nselect * from \n    \nwith base_dates as (\n    \nwith date_spine as\n(\n    \n\n    \n\n/*\ncall as follows:\n\ndate_spine(\n    "day",\n    "to_date(\'01/01/2016\', \'mm/dd/yyyy\')",\n    "dateadd(week, 1, current_date)"\n)\n\n*/\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * pow(2, 0)\n     + \n    \n    p1.generated_number * pow(2, 1)\n     + \n    \n    p2.generated_number * pow(2, 2)\n     + \n    \n    p3.generated_number * pow(2, 3)\n     + \n    \n    p4.generated_number * pow(2, 4)\n     + \n    \n    p5.generated_number * pow(2, 5)\n     + \n    \n    p6.generated_number * pow(2, 6)\n     + \n    \n    p7.generated_number * pow(2, 7)\n     + \n    \n    p8.generated_number * pow(2, 8)\n     + \n    \n    p9.generated_number * pow(2, 9)\n     + \n    \n    p10.generated_number * pow(2, 10)\n     + \n    \n    p11.generated_number * pow(2, 11)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 2921\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n  \n\n    dateadd(\n        day,\n        row_number() over (order by 1) - 1,\n        cast(\'2015-01-01\' as datetime)\n        )\n\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast(\'2022-12-31\' as datetime)\n\n)\n\nselect * from filtered\n\n\n\n)\nselect\n    date(d.date_day) as date_day\nfrom\n    date_spine d\n\n),\ndates_with_prior_year_dates as (\n    select\n        cast(d.date_day as date) as date_day,\n        cast(\n  \n\n    dateadd(\n        year,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_year_date_day,\n        cast(\n  \n\n    dateadd(\n        day,\n        -364,\n        d.date_day\n        )\n\n\n as date) as prior_year_over_year_date_day\n    from\n    \tbase_dates d\n)\nselect\n    d.date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        1,\n        d.date_day\n        )\n\n\n as date) as next_date_day,\n    d.prior_year_date_day as prior_year_date_day,\n    d.prior_year_over_year_date_day,\n    cast(\n            case\n                when date_part(\'dayofweek\', d.date_day) = 0 then 7\n                else date_part(\'dayofweek\', d.date_day)\n            end\n        as \n    int\n\n    ) as day_of_week,\n\n    to_char(d.date_day, \'Day\') as day_of_week_name,\n    to_char(d.date_day, \'Dy\') as day_of_week_name_short,\n    cast(date_part(\'day\', d.date_day) as \n    int\n) as day_of_month,\n    cast(date_part(\'dayofyear\', d.date_day) as \n    int\n) as day_of_year,\n\n    cast(\n    date_trunc(\'week\', d.date_day)\n as date) as week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as week_end_date,\n    cast(date_part(\'week\', d.date_day) as \n    int\n) as week_of_year,\n    cast(\n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n as date) as prior_year_week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_week_end_date,\n    cast(date_part(\'week\', d.prior_year_over_year_date_day) as \n    int\n) as prior_year_week_of_year,\n\n    cast(date_part(\'month\', d.date_day) as \n    int\n) as month_of_year,\n    to_char(d.date_day, \'MONTH\')  as month_name,\n    to_char(d.date_day, \'MON\')  as month_name_short,\n\n    cast(\n    date_trunc(\'month\', d.date_day)\n as date) as month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as month_end_date,\n\n    cast(\n    date_trunc(\'month\', d.prior_year_date_day)\n as date) as prior_year_month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.prior_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_month_end_date,\n\n    cast(date_part(\'quarter\', d.date_day) as \n    int\n) as quarter_of_year,\n    cast(\n    date_trunc(\'quarter\', d.date_day)\n as date) as quarter_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        quarter,\n        1,\n        \n    date_trunc(\'quarter\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as quarter_end_date,\n\n    cast(date_part(\'year\', d.date_day) as \n    int\n) as year_number,\n    cast(\n    date_trunc(\'year\', d.date_day)\n as date) as year_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        year,\n        1,\n        \n    date_trunc(\'year\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as year_end_date\nfrom\n    dates_with_prior_year_dates d\norder by 1\n\n\n)\nselect * from source\nlimit 100', 'tags': None}, None)
2020-12-02 14:59:30.617583 (Thread-37): handling poll request
2020-12-02 14:59:30.618130 (Thread-37): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f7a44e0>]}
2020-12-02 14:59:30.619380 (Thread-37): sending response (<Response 36674 bytes [200 OK]>) to 10.0.11.16
2020-12-02 15:21:26.717892 (Thread-38): handling status request
2020-12-02 15:21:26.719756 (Thread-38): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f797cf8>]}
2020-12-02 15:21:26.720945 (Thread-38): sending response (<Response 1237 bytes [200 OK]>) to 10.0.18.0
2020-12-02 15:21:27.323798 (Thread-39): handling run_sql request
2020-12-02 15:21:27.324287 (Thread-39): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f796630>]}
2020-12-02 15:21:28.370732 (Thread-39): sending response (<Response 137 bytes [200 OK]>) to 10.0.42.75
2020-12-02 15:21:28.408921 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 15:21:28.453139 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 15:21:28.453670 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 15:21:28.453811 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 15:21:28.476789 (Thread-1): finished collecting timing info
2020-12-02 15:21:28.478543 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 15:21:28.478621 (Thread-1): On rpc.sales_dataflo.request: WITH source AS (

    select * from salesforce.opportunity

    ),renamed as (
     select
      id as opportunity_id,

        -- keys
        account_id as opportunity_account_id,
        owner_id as opportunity_owner_id,

        -- company context
        name as company_name,
        description as opportunity_description,
        type as opportunity_type,

        -- attribution
        lead_source,
        is_private,

        -- pipeline
        fiscal as fiscal_yq,
        fiscal_year,
        fiscal_quarter,
        probability,
        next_step,
        has_open_activity,
        stage_name,
        forecast_category,
        forecast_category_name,
        campaign_id,
        is_won,
        is_closed,
        close_date,
        has_overdue_task,
        expected_revenue,
        total_opportunity_quantity,

        delivery_installation_status_c as delivery_installation_status,
        order_number_c as order_number,
        current_generators_c as current_generators,
        main_competitors_c as main_competitors,

        -- accounting
        amount,

        -- metadata
        last_activity_date,
        created_date as created_at,
        last_modified_date as updated_at,

        created_date >= 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_month,
        created_date >= 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_quarter,
        
  

    datediff(
        day,
        
    current_timestamp::
    timestamp_ntz

,
        created_date
        )


 as days_since_created,
        
  

    datediff(
        day,
        close_date,
        created_date
        )


 as days_to_close,
        
    date_trunc('month', close_date)
 = 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_month,
        
    date_trunc('quarter', close_date)
 = 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_quarter

        

     from source
    )


select * from renamed



limit 100
2020-12-02 15:21:28.478680 (Thread-1): Opening a new connection, currently in state init
2020-12-02 15:21:28.671779 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 15:21:29.116358 (Thread-40): handling poll request
2020-12-02 15:21:29.116986 (Thread-40): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f796630>]}
2020-12-02 15:21:29.119579 (Thread-40): sending response (<Response 5058 bytes [200 OK]>) to 10.0.23.203
2020-12-02 15:21:29.904513 (Thread-1): SQL status: SUCCESS 31 in 1.43 seconds
2020-12-02 15:21:29.910733 (Thread-1): finished collecting timing info
2020-12-02 15:21:29.911264 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 15:21:30.679098 (Thread-41): handling poll request
2020-12-02 15:21:30.679658 (Thread-41): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f78e080>]}
2020-12-02 15:21:30.685722 (Thread-41): sending response (<Response 29203 bytes [200 OK]>) to 10.0.15.0
2020-12-02 15:24:13.354167 (Thread-42): handling status request
2020-12-02 15:24:13.356066 (Thread-42): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f7bae80>]}
2020-12-02 15:24:13.357250 (Thread-42): sending response (<Response 1237 bytes [200 OK]>) to 10.0.23.203
2020-12-02 15:24:13.909719 (Thread-43): handling run_sql request
2020-12-02 15:24:13.910299 (Thread-43): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f78fa20>]}
2020-12-02 15:24:14.944064 (Thread-43): sending response (<Response 137 bytes [200 OK]>) to 10.0.34.197
2020-12-02 15:24:14.971258 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 15:24:15.012412 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 15:24:15.013041 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 15:24:15.013235 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 15:24:15.047777 (Thread-1): finished collecting timing info
2020-12-02 15:24:15.049521 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 15:24:15.049631 (Thread-1): On rpc.sales_dataflo.request: WITH source AS (

    select * from salesforce.opportunity

    ),
    test as (
     select
        created_date >= 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_month,
        created_date >= 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_quarter,
        
  

    datediff(
        day,
        
    current_timestamp::
    timestamp_ntz

,
        created_date
        )


 as days_since_created,
        
  

    datediff(
        day,
        close_date,
        created_date
        )


 as days_to_close,
        
    date_trunc('month', close_date)
 = 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_month,
        
    date_trunc('quarter', close_date)
 = 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_quarter
     from source
    )
)
select * from test
limit 100
2020-12-02 15:24:15.049716 (Thread-1): Opening a new connection, currently in state init
2020-12-02 15:24:15.253189 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 15:24:15.523530 (Thread-44): handling poll request
2020-12-02 15:24:15.524082 (Thread-44): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6f7080>]}
2020-12-02 15:24:15.526495 (Thread-44): sending response (<Response 3850 bytes [200 OK]>) to 10.0.34.197
2020-12-02 15:24:15.746257 (Thread-1): Snowflake query id: 0198a95c-006a-f34a-0000-5eb100010002
2020-12-02 15:24:15.746389 (Thread-1): Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 68 at position 0 unexpected ')'.
2020-12-02 15:24:15.746531 (Thread-1): finished collecting timing info
2020-12-02 15:24:15.747055 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 15:24:15.824786 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 68 at position 0 unexpected ')'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 161, in exception_handler
    yield
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/cursor.py", line 597, in execute
    errvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 97, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, errorclass, errorvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 73, in default_errorhandler
    done_format_msg=errorvalue.get(u'done_format_msg'))
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 68 at position 0 unexpected ')'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 85, in execute
    compiled_node.injected_sql, fetch=True
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/base/impl.py", line 227, in execute
    fetch=fetch
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 312, in add_query
    abridge_sql_log=abridge_sql_log
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.6/contextlib.py", line 99, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 178, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 68 at position 0 unexpected ')'.
2020-12-02 15:24:15.826161 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 68 at position 0 unexpected ')'.", 'raw_sql': "WITH source AS (\r\n\r\n    select * from {{ var('salesforce_schema_name') }}.{{ var('salesforce_opportunity_table_name') }}\r\n\r\n    ),\r\n    test as (\r\n     select\r\n        created_date >= {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_created_this_month,\r\n        created_date >= {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_created_this_quarter,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n     from source\r\n    )\r\n)\r\nselect * from test\nlimit 100", 'compiled_sql': "WITH source AS (\n\n    select * from salesforce.opportunity\n\n    ),\n    test as (\n     select\n        created_date >= \n    date_trunc('month', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_month,\n        created_date >= \n    date_trunc('quarter', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_quarter,\n        \n  \n\n    datediff(\n        day,\n        \n    current_timestamp::\n    timestamp_ntz\n\n,\n        created_date\n        )\n\n\n as days_since_created,\n        \n  \n\n    datediff(\n        day,\n        close_date,\n        created_date\n        )\n\n\n as days_to_close,\n        \n    date_trunc('month', close_date)\n = \n    date_trunc('month', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_month,\n        \n    date_trunc('quarter', close_date)\n = \n    date_trunc('quarter', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_quarter\n     from source\n    )\n)\nselect * from test\nlimit 100", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 68 at position 0 unexpected ')'.", 'raw_sql': "WITH source AS (\r\n\r\n    select * from {{ var('salesforce_schema_name') }}.{{ var('salesforce_opportunity_table_name') }}\r\n\r\n    ),\r\n    test as (\r\n     select\r\n        created_date >= {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_created_this_month,\r\n        created_date >= {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_created_this_quarter,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n     from source\r\n    )\r\n)\r\nselect * from test\nlimit 100", 'compiled_sql': "WITH source AS (\n\n    select * from salesforce.opportunity\n\n    ),\n    test as (\n     select\n        created_date >= \n    date_trunc('month', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_month,\n        created_date >= \n    date_trunc('quarter', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_quarter,\n        \n  \n\n    datediff(\n        day,\n        \n    current_timestamp::\n    timestamp_ntz\n\n,\n        created_date\n        )\n\n\n as days_since_created,\n        \n  \n\n    datediff(\n        day,\n        close_date,\n        created_date\n        )\n\n\n as days_to_close,\n        \n    date_trunc('month', close_date)\n = \n    date_trunc('month', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_month,\n        \n    date_trunc('quarter', close_date)\n = \n    date_trunc('quarter', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_quarter\n     from source\n    )\n)\nselect * from test\nlimit 100", 'tags': None}, None)
2020-12-02 15:24:17.171439 (Thread-45): handling poll request
2020-12-02 15:24:17.171962 (Thread-45): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6fa3c8>]}
2020-12-02 15:24:17.172954 (Thread-45): sending response (<Response 15635 bytes [200 OK]>) to 10.0.32.18
2020-12-02 15:25:04.007777 (Thread-46): handling status request
2020-12-02 15:25:04.008301 (Thread-46): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6f7c88>]}
2020-12-02 15:25:04.009513 (Thread-46): sending response (<Response 1237 bytes [200 OK]>) to 10.0.42.75
2020-12-02 15:25:04.620812 (Thread-47): handling run_sql request
2020-12-02 15:25:04.621322 (Thread-47): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6d6470>]}
2020-12-02 15:25:05.703802 (Thread-47): sending response (<Response 137 bytes [200 OK]>) to 10.0.21.144
2020-12-02 15:25:05.735800 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 15:25:05.774152 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 15:25:05.774744 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 15:25:05.774907 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 15:25:05.796459 (Thread-1): finished collecting timing info
2020-12-02 15:25:05.797531 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 15:25:05.797608 (Thread-1): On rpc.sales_dataflo.request: WITH source AS (
    select * from salesforce.opportunity
    ),
    test as (
     select
        created_date >= 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_month,
        created_date >= 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_quarter,
        
  

    datediff(
        day,
        
    current_timestamp::
    timestamp_ntz

,
        created_date
        )


 as days_since_created,
        
  

    datediff(
        day,
        close_date,
        created_date
        )


 as days_to_close,
        
    date_trunc('month', close_date)
 = 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_month,
        
    date_trunc('quarter', close_date)
 = 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_quarter
     from source
    )
select * from test
limit 100
2020-12-02 15:25:05.797668 (Thread-1): Opening a new connection, currently in state init
2020-12-02 15:25:06.023045 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 15:25:06.321312 (Thread-48): handling poll request
2020-12-02 15:25:06.321864 (Thread-48): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6d6470>]}
2020-12-02 15:25:06.324323 (Thread-48): sending response (<Response 3843 bytes [200 OK]>) to 10.0.15.0
2020-12-02 15:25:07.480868 (Thread-1): SQL status: SUCCESS 31 in 1.68 seconds
2020-12-02 15:25:07.482087 (Thread-1): finished collecting timing info
2020-12-02 15:25:07.482686 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 15:25:07.872980 (Thread-49): handling poll request
2020-12-02 15:25:07.873476 (Thread-49): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6ef390>]}
2020-12-02 15:25:07.878278 (Thread-49): sending response (<Response 9409 bytes [200 OK]>) to 10.0.0.188
2020-12-02 15:26:43.411989 (Thread-50): handling status request
2020-12-02 15:26:43.413785 (Thread-50): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6ef390>]}
2020-12-02 15:26:43.415290 (Thread-50): sending response (<Response 1237 bytes [200 OK]>) to 10.0.15.0
2020-12-02 15:26:44.043556 (Thread-51): handling run_sql request
2020-12-02 15:26:44.044045 (Thread-51): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6efb38>]}
2020-12-02 15:26:45.091920 (Thread-51): sending response (<Response 137 bytes [200 OK]>) to 10.0.23.132
2020-12-02 15:26:45.118906 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 15:26:45.226683 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 15:26:45.227395 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 15:26:45.227587 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 15:26:45.257713 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 15:26:45.257870 (Thread-1): On rpc.sales_dataflo.request: BEGIN
2020-12-02 15:26:45.257961 (Thread-1): Opening a new connection, currently in state init
2020-12-02 15:26:45.454933 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 15:26:45.609471 (Thread-52): handling poll request
2020-12-02 15:26:45.609988 (Thread-52): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6e1780>]}
2020-12-02 15:26:45.612561 (Thread-52): sending response (<Response 2424 bytes [200 OK]>) to 10.0.13.116
2020-12-02 15:26:45.900652 (Thread-1): SQL status: SUCCESS 1 in 0.64 seconds
2020-12-02 15:26:45.900806 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 15:26:45.900870 (Thread-1): On rpc.sales_dataflo.request: select 
  

    datediff(
        day,
        cast('2015-01-01' as datetime),
        cast('2022-12-31' as datetime)
        )
2020-12-02 15:26:45.970294 (Thread-1): SQL status: SUCCESS 1 in 0.07 seconds
2020-12-02 15:26:45.986100 (Thread-1): finished collecting timing info
2020-12-02 15:26:45.990664 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 15:26:45.990747 (Thread-1): On rpc.sales_dataflo.request: WITH source AS (
    select * from 
    
with base_dates as (
    
with date_spine as
(
    

    

/*
call as follows:

date_spine(
    "day",
    "to_date('01/01/2016', 'mm/dd/yyyy')",
    "dateadd(week, 1, current_date)"
)

*/

with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * pow(2, 0)
     + 
    
    p1.generated_number * pow(2, 1)
     + 
    
    p2.generated_number * pow(2, 2)
     + 
    
    p3.generated_number * pow(2, 3)
     + 
    
    p4.generated_number * pow(2, 4)
     + 
    
    p5.generated_number * pow(2, 5)
     + 
    
    p6.generated_number * pow(2, 6)
     + 
    
    p7.generated_number * pow(2, 7)
     + 
    
    p8.generated_number * pow(2, 8)
     + 
    
    p9.generated_number * pow(2, 9)
     + 
    
    p10.generated_number * pow(2, 10)
     + 
    
    p11.generated_number * pow(2, 11)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
     cross join 
    
    p as p7
     cross join 
    
    p as p8
     cross join 
    
    p as p9
     cross join 
    
    p as p10
     cross join 
    
    p as p11
    
    

    )

    select *
    from unioned
    where generated_number <= 2921
    order by generated_number



),

all_periods as (

    select (
        
  

    dateadd(
        day,
        row_number() over (order by 1) - 1,
        cast('2015-01-01' as datetime)
        )



    ) as date_day
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_day <= cast('2022-12-31' as datetime)

)

select * from filtered



)
select
    date(d.date_day) as date_day
from
    date_spine d

),
dates_with_prior_year_dates as (
    select
        cast(d.date_day as date) as date_day,
        cast(
  

    dateadd(
        year,
        -1,
        d.date_day
        )


 as date) as prior_year_date_day,
        cast(
  

    dateadd(
        day,
        -364,
        d.date_day
        )


 as date) as prior_year_over_year_date_day
    from
    	base_dates d
)
select
    d.date_day,
    cast(
  

    dateadd(
        day,
        -1,
        d.date_day
        )


 as date) as prior_date_day,
    cast(
  

    dateadd(
        day,
        1,
        d.date_day
        )


 as date) as next_date_day,
    d.prior_year_date_day as prior_year_date_day,
    d.prior_year_over_year_date_day,
    cast(
            case
                when date_part('dayofweek', d.date_day) = 0 then 7
                else date_part('dayofweek', d.date_day)
            end
        as 
    int

    ) as day_of_week,

    to_char(d.date_day, 'Day') as day_of_week_name,
    to_char(d.date_day, 'Dy') as day_of_week_name_short,
    cast(date_part('day', d.date_day) as 
    int
) as day_of_month,
    cast(date_part('dayofyear', d.date_day) as 
    int
) as day_of_year,

    cast(
    date_trunc('week', d.date_day)
 as date) as week_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', d.date_day)

        )



        )



        as date)
 as date) as week_end_date,
    cast(date_part('week', d.date_day) as 
    int
) as week_of_year,
    cast(
    date_trunc('week', d.prior_year_over_year_date_day)
 as date) as prior_year_week_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', d.prior_year_over_year_date_day)

        )



        )



        as date)
 as date) as prior_year_week_end_date,
    cast(date_part('week', d.prior_year_over_year_date_day) as 
    int
) as prior_year_week_of_year,

    cast(date_part('month', d.date_day) as 
    int
) as month_of_year,
    to_char(d.date_day, 'MONTH')  as month_name,
    to_char(d.date_day, 'MON')  as month_name_short,

    cast(
    date_trunc('month', d.date_day)
 as date) as month_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', d.date_day)

        )



        )



        as date)
 as date) as month_end_date,

    cast(
    date_trunc('month', d.prior_year_date_day)
 as date) as prior_year_month_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', d.prior_year_date_day)

        )



        )



        as date)
 as date) as prior_year_month_end_date,

    cast(date_part('quarter', d.date_day) as 
    int
) as quarter_of_year,
    cast(
    date_trunc('quarter', d.date_day)
 as date) as quarter_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        quarter,
        1,
        
    date_trunc('quarter', d.date_day)

        )



        )



        as date)
 as date) as quarter_end_date,

    cast(date_part('year', d.date_day) as 
    int
) as year_number,
    cast(
    date_trunc('year', d.date_day)
 as date) as year_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        year,
        1,
        
    date_trunc('year', d.date_day)

        )



        )



        as date)
 as date) as year_end_date
from
    dates_with_prior_year_dates d
order by 1


    ),
    test as (
     select
        created_date >= 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_month,
        created_date >= 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_quarter,
        
  

    datediff(
        day,
        
    current_timestamp::
    timestamp_ntz

,
        created_date
        )


 as days_since_created,
        
  

    datediff(
        day,
        close_date,
        created_date
        )


 as days_to_close,
        
    date_trunc('month', close_date)
 = 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_month,
        
    date_trunc('quarter', close_date)
 = 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_quarter
     from source
    )
select * from test
limit 100
2020-12-02 15:26:46.065255 (Thread-1): Snowflake query id: 0198a95e-0025-26e9-0000-5eb10001103a
2020-12-02 15:26:46.065378 (Thread-1): Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 4 at position 0 unexpected 'with'.
syntax error line 163 at position 1 unexpected ','.
2020-12-02 15:26:46.065468 (Thread-1): finished collecting timing info
2020-12-02 15:26:46.065789 (Thread-1): On rpc.sales_dataflo.request: ROLLBACK
2020-12-02 15:26:46.174486 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 15:26:46.249381 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 4 at position 0 unexpected 'with'.
  syntax error line 163 at position 1 unexpected ','.
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 161, in exception_handler
    yield
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/cursor.py", line 597, in execute
    errvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 97, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, errorclass, errorvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 73, in default_errorhandler
    done_format_msg=errorvalue.get(u'done_format_msg'))
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 4 at position 0 unexpected 'with'.
syntax error line 163 at position 1 unexpected ','.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 85, in execute
    compiled_node.injected_sql, fetch=True
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/base/impl.py", line 227, in execute
    fetch=fetch
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 312, in add_query
    abridge_sql_log=abridge_sql_log
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.6/contextlib.py", line 99, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 178, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 4 at position 0 unexpected 'with'.
  syntax error line 163 at position 1 unexpected ','.
2020-12-02 15:26:46.251122 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 4 at position 0 unexpected 'with'.\n  syntax error line 163 at position 1 unexpected ','.", 'raw_sql': "WITH source AS (\r\n    select * from {{ dbt_date.get_date_dimension('2015-01-01', '2022-12-31') }}\r\n    ),\r\n    test as (\r\n     select\r\n        created_date >= {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_created_this_month,\r\n        created_date >= {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_created_this_quarter,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n     from source\r\n    )\r\nselect * from test\nlimit 100", 'compiled_sql': 'WITH source AS (\n    select * from \n    \nwith base_dates as (\n    \nwith date_spine as\n(\n    \n\n    \n\n/*\ncall as follows:\n\ndate_spine(\n    "day",\n    "to_date(\'01/01/2016\', \'mm/dd/yyyy\')",\n    "dateadd(week, 1, current_date)"\n)\n\n*/\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * pow(2, 0)\n     + \n    \n    p1.generated_number * pow(2, 1)\n     + \n    \n    p2.generated_number * pow(2, 2)\n     + \n    \n    p3.generated_number * pow(2, 3)\n     + \n    \n    p4.generated_number * pow(2, 4)\n     + \n    \n    p5.generated_number * pow(2, 5)\n     + \n    \n    p6.generated_number * pow(2, 6)\n     + \n    \n    p7.generated_number * pow(2, 7)\n     + \n    \n    p8.generated_number * pow(2, 8)\n     + \n    \n    p9.generated_number * pow(2, 9)\n     + \n    \n    p10.generated_number * pow(2, 10)\n     + \n    \n    p11.generated_number * pow(2, 11)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 2921\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n  \n\n    dateadd(\n        day,\n        row_number() over (order by 1) - 1,\n        cast(\'2015-01-01\' as datetime)\n        )\n\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast(\'2022-12-31\' as datetime)\n\n)\n\nselect * from filtered\n\n\n\n)\nselect\n    date(d.date_day) as date_day\nfrom\n    date_spine d\n\n),\ndates_with_prior_year_dates as (\n    select\n        cast(d.date_day as date) as date_day,\n        cast(\n  \n\n    dateadd(\n        year,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_year_date_day,\n        cast(\n  \n\n    dateadd(\n        day,\n        -364,\n        d.date_day\n        )\n\n\n as date) as prior_year_over_year_date_day\n    from\n    \tbase_dates d\n)\nselect\n    d.date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        1,\n        d.date_day\n        )\n\n\n as date) as next_date_day,\n    d.prior_year_date_day as prior_year_date_day,\n    d.prior_year_over_year_date_day,\n    cast(\n            case\n                when date_part(\'dayofweek\', d.date_day) = 0 then 7\n                else date_part(\'dayofweek\', d.date_day)\n            end\n        as \n    int\n\n    ) as day_of_week,\n\n    to_char(d.date_day, \'Day\') as day_of_week_name,\n    to_char(d.date_day, \'Dy\') as day_of_week_name_short,\n    cast(date_part(\'day\', d.date_day) as \n    int\n) as day_of_month,\n    cast(date_part(\'dayofyear\', d.date_day) as \n    int\n) as day_of_year,\n\n    cast(\n    date_trunc(\'week\', d.date_day)\n as date) as week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as week_end_date,\n    cast(date_part(\'week\', d.date_day) as \n    int\n) as week_of_year,\n    cast(\n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n as date) as prior_year_week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_week_end_date,\n    cast(date_part(\'week\', d.prior_year_over_year_date_day) as \n    int\n) as prior_year_week_of_year,\n\n    cast(date_part(\'month\', d.date_day) as \n    int\n) as month_of_year,\n    to_char(d.date_day, \'MONTH\')  as month_name,\n    to_char(d.date_day, \'MON\')  as month_name_short,\n\n    cast(\n    date_trunc(\'month\', d.date_day)\n as date) as month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as month_end_date,\n\n    cast(\n    date_trunc(\'month\', d.prior_year_date_day)\n as date) as prior_year_month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.prior_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_month_end_date,\n\n    cast(date_part(\'quarter\', d.date_day) as \n    int\n) as quarter_of_year,\n    cast(\n    date_trunc(\'quarter\', d.date_day)\n as date) as quarter_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        quarter,\n        1,\n        \n    date_trunc(\'quarter\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as quarter_end_date,\n\n    cast(date_part(\'year\', d.date_day) as \n    int\n) as year_number,\n    cast(\n    date_trunc(\'year\', d.date_day)\n as date) as year_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        year,\n        1,\n        \n    date_trunc(\'year\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as year_end_date\nfrom\n    dates_with_prior_year_dates d\norder by 1\n\n\n    ),\n    test as (\n     select\n        created_date >= \n    date_trunc(\'month\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_month,\n        created_date >= \n    date_trunc(\'quarter\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_quarter,\n        \n  \n\n    datediff(\n        day,\n        \n    current_timestamp::\n    timestamp_ntz\n\n,\n        created_date\n        )\n\n\n as days_since_created,\n        \n  \n\n    datediff(\n        day,\n        close_date,\n        created_date\n        )\n\n\n as days_to_close,\n        \n    date_trunc(\'month\', close_date)\n = \n    date_trunc(\'month\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_month,\n        \n    date_trunc(\'quarter\', close_date)\n = \n    date_trunc(\'quarter\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_quarter\n     from source\n    )\nselect * from test\nlimit 100', 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 4 at position 0 unexpected 'with'.\n  syntax error line 163 at position 1 unexpected ','.", 'raw_sql': "WITH source AS (\r\n    select * from {{ dbt_date.get_date_dimension('2015-01-01', '2022-12-31') }}\r\n    ),\r\n    test as (\r\n     select\r\n        created_date >= {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_created_this_month,\r\n        created_date >= {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_created_this_quarter,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n     from source\r\n    )\r\nselect * from test\nlimit 100", 'compiled_sql': 'WITH source AS (\n    select * from \n    \nwith base_dates as (\n    \nwith date_spine as\n(\n    \n\n    \n\n/*\ncall as follows:\n\ndate_spine(\n    "day",\n    "to_date(\'01/01/2016\', \'mm/dd/yyyy\')",\n    "dateadd(week, 1, current_date)"\n)\n\n*/\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * pow(2, 0)\n     + \n    \n    p1.generated_number * pow(2, 1)\n     + \n    \n    p2.generated_number * pow(2, 2)\n     + \n    \n    p3.generated_number * pow(2, 3)\n     + \n    \n    p4.generated_number * pow(2, 4)\n     + \n    \n    p5.generated_number * pow(2, 5)\n     + \n    \n    p6.generated_number * pow(2, 6)\n     + \n    \n    p7.generated_number * pow(2, 7)\n     + \n    \n    p8.generated_number * pow(2, 8)\n     + \n    \n    p9.generated_number * pow(2, 9)\n     + \n    \n    p10.generated_number * pow(2, 10)\n     + \n    \n    p11.generated_number * pow(2, 11)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 2921\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n  \n\n    dateadd(\n        day,\n        row_number() over (order by 1) - 1,\n        cast(\'2015-01-01\' as datetime)\n        )\n\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast(\'2022-12-31\' as datetime)\n\n)\n\nselect * from filtered\n\n\n\n)\nselect\n    date(d.date_day) as date_day\nfrom\n    date_spine d\n\n),\ndates_with_prior_year_dates as (\n    select\n        cast(d.date_day as date) as date_day,\n        cast(\n  \n\n    dateadd(\n        year,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_year_date_day,\n        cast(\n  \n\n    dateadd(\n        day,\n        -364,\n        d.date_day\n        )\n\n\n as date) as prior_year_over_year_date_day\n    from\n    \tbase_dates d\n)\nselect\n    d.date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        1,\n        d.date_day\n        )\n\n\n as date) as next_date_day,\n    d.prior_year_date_day as prior_year_date_day,\n    d.prior_year_over_year_date_day,\n    cast(\n            case\n                when date_part(\'dayofweek\', d.date_day) = 0 then 7\n                else date_part(\'dayofweek\', d.date_day)\n            end\n        as \n    int\n\n    ) as day_of_week,\n\n    to_char(d.date_day, \'Day\') as day_of_week_name,\n    to_char(d.date_day, \'Dy\') as day_of_week_name_short,\n    cast(date_part(\'day\', d.date_day) as \n    int\n) as day_of_month,\n    cast(date_part(\'dayofyear\', d.date_day) as \n    int\n) as day_of_year,\n\n    cast(\n    date_trunc(\'week\', d.date_day)\n as date) as week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as week_end_date,\n    cast(date_part(\'week\', d.date_day) as \n    int\n) as week_of_year,\n    cast(\n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n as date) as prior_year_week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_week_end_date,\n    cast(date_part(\'week\', d.prior_year_over_year_date_day) as \n    int\n) as prior_year_week_of_year,\n\n    cast(date_part(\'month\', d.date_day) as \n    int\n) as month_of_year,\n    to_char(d.date_day, \'MONTH\')  as month_name,\n    to_char(d.date_day, \'MON\')  as month_name_short,\n\n    cast(\n    date_trunc(\'month\', d.date_day)\n as date) as month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as month_end_date,\n\n    cast(\n    date_trunc(\'month\', d.prior_year_date_day)\n as date) as prior_year_month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.prior_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_month_end_date,\n\n    cast(date_part(\'quarter\', d.date_day) as \n    int\n) as quarter_of_year,\n    cast(\n    date_trunc(\'quarter\', d.date_day)\n as date) as quarter_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        quarter,\n        1,\n        \n    date_trunc(\'quarter\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as quarter_end_date,\n\n    cast(date_part(\'year\', d.date_day) as \n    int\n) as year_number,\n    cast(\n    date_trunc(\'year\', d.date_day)\n as date) as year_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        year,\n        1,\n        \n    date_trunc(\'year\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as year_end_date\nfrom\n    dates_with_prior_year_dates d\norder by 1\n\n\n    ),\n    test as (\n     select\n        created_date >= \n    date_trunc(\'month\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_month,\n        created_date >= \n    date_trunc(\'quarter\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_quarter,\n        \n  \n\n    datediff(\n        day,\n        \n    current_timestamp::\n    timestamp_ntz\n\n,\n        created_date\n        )\n\n\n as days_since_created,\n        \n  \n\n    datediff(\n        day,\n        close_date,\n        created_date\n        )\n\n\n as days_to_close,\n        \n    date_trunc(\'month\', close_date)\n = \n    date_trunc(\'month\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_month,\n        \n    date_trunc(\'quarter\', close_date)\n = \n    date_trunc(\'quarter\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_quarter\n     from source\n    )\nselect * from test\nlimit 100', 'tags': None}, None)
2020-12-02 15:26:47.144841 (Thread-53): handling poll request
2020-12-02 15:26:47.145383 (Thread-53): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6d65c0>]}
2020-12-02 15:26:47.146637 (Thread-53): sending response (<Response 43075 bytes [200 OK]>) to 10.0.23.203
2020-12-02 15:52:09.913869 (Thread-54): handling status request
2020-12-02 15:52:09.916098 (Thread-54): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6e4ba8>]}
2020-12-02 15:52:09.917442 (Thread-54): sending response (<Response 1237 bytes [200 OK]>) to 10.0.23.132
2020-12-02 15:52:10.400580 (Thread-55): handling run_sql request
2020-12-02 15:52:10.401070 (Thread-55): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6cb5f8>]}
2020-12-02 15:52:11.505978 (Thread-55): sending response (<Response 137 bytes [200 OK]>) to 10.0.16.71
2020-12-02 15:52:11.533457 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 15:52:11.636640 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 15:52:11.637222 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 15:52:11.637371 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 15:52:11.656641 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 15:52:11.656756 (Thread-1): On rpc.sales_dataflo.request: BEGIN
2020-12-02 15:52:11.656845 (Thread-1): Opening a new connection, currently in state init
2020-12-02 15:52:11.865616 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 15:52:12.146276 (Thread-56): handling poll request
2020-12-02 15:52:12.146826 (Thread-56): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6cb5f8>]}
2020-12-02 15:52:12.149188 (Thread-56): sending response (<Response 2424 bytes [200 OK]>) to 10.0.18.0
2020-12-02 15:52:12.358302 (Thread-1): SQL status: SUCCESS 1 in 0.70 seconds
2020-12-02 15:52:12.358468 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 15:52:12.358531 (Thread-1): On rpc.sales_dataflo.request: select 
  

    datediff(
        day,
        cast('2015-01-01' as datetime),
        cast('2022-12-31' as datetime)
        )
2020-12-02 15:52:12.437608 (Thread-1): SQL status: SUCCESS 1 in 0.08 seconds
2020-12-02 15:52:12.451797 (Thread-1): finished collecting timing info
2020-12-02 15:52:12.456365 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 15:52:12.456455 (Thread-1): On rpc.sales_dataflo.request: WITH source AS (
    select * from salesforce.opportunity
    ),
    test as (
     select
        
    
with base_dates as (
    
with date_spine as
(
    

    

/*
call as follows:

date_spine(
    "day",
    "to_date('01/01/2016', 'mm/dd/yyyy')",
    "dateadd(week, 1, current_date)"
)

*/

with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * pow(2, 0)
     + 
    
    p1.generated_number * pow(2, 1)
     + 
    
    p2.generated_number * pow(2, 2)
     + 
    
    p3.generated_number * pow(2, 3)
     + 
    
    p4.generated_number * pow(2, 4)
     + 
    
    p5.generated_number * pow(2, 5)
     + 
    
    p6.generated_number * pow(2, 6)
     + 
    
    p7.generated_number * pow(2, 7)
     + 
    
    p8.generated_number * pow(2, 8)
     + 
    
    p9.generated_number * pow(2, 9)
     + 
    
    p10.generated_number * pow(2, 10)
     + 
    
    p11.generated_number * pow(2, 11)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
     cross join 
    
    p as p7
     cross join 
    
    p as p8
     cross join 
    
    p as p9
     cross join 
    
    p as p10
     cross join 
    
    p as p11
    
    

    )

    select *
    from unioned
    where generated_number <= 2921
    order by generated_number



),

all_periods as (

    select (
        
  

    dateadd(
        day,
        row_number() over (order by 1) - 1,
        cast('2015-01-01' as datetime)
        )



    ) as date_day
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_day <= cast('2022-12-31' as datetime)

)

select * from filtered



)
select
    date(d.date_day) as date_day
from
    date_spine d

),
dates_with_prior_year_dates as (
    select
        cast(d.date_day as date) as date_day,
        cast(
  

    dateadd(
        year,
        -1,
        d.date_day
        )


 as date) as prior_year_date_day,
        cast(
  

    dateadd(
        day,
        -364,
        d.date_day
        )


 as date) as prior_year_over_year_date_day
    from
    	base_dates d
)
select
    d.date_day,
    cast(
  

    dateadd(
        day,
        -1,
        d.date_day
        )


 as date) as prior_date_day,
    cast(
  

    dateadd(
        day,
        1,
        d.date_day
        )


 as date) as next_date_day,
    d.prior_year_date_day as prior_year_date_day,
    d.prior_year_over_year_date_day,
    cast(
            case
                when date_part('dayofweek', d.date_day) = 0 then 7
                else date_part('dayofweek', d.date_day)
            end
        as 
    int

    ) as day_of_week,

    to_char(d.date_day, 'Day') as day_of_week_name,
    to_char(d.date_day, 'Dy') as day_of_week_name_short,
    cast(date_part('day', d.date_day) as 
    int
) as day_of_month,
    cast(date_part('dayofyear', d.date_day) as 
    int
) as day_of_year,

    cast(
    date_trunc('week', d.date_day)
 as date) as week_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', d.date_day)

        )



        )



        as date)
 as date) as week_end_date,
    cast(date_part('week', d.date_day) as 
    int
) as week_of_year,
    cast(
    date_trunc('week', d.prior_year_over_year_date_day)
 as date) as prior_year_week_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', d.prior_year_over_year_date_day)

        )



        )



        as date)
 as date) as prior_year_week_end_date,
    cast(date_part('week', d.prior_year_over_year_date_day) as 
    int
) as prior_year_week_of_year,

    cast(date_part('month', d.date_day) as 
    int
) as month_of_year,
    to_char(d.date_day, 'MONTH')  as month_name,
    to_char(d.date_day, 'MON')  as month_name_short,

    cast(
    date_trunc('month', d.date_day)
 as date) as month_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', d.date_day)

        )



        )



        as date)
 as date) as month_end_date,

    cast(
    date_trunc('month', d.prior_year_date_day)
 as date) as prior_year_month_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', d.prior_year_date_day)

        )



        )



        as date)
 as date) as prior_year_month_end_date,

    cast(date_part('quarter', d.date_day) as 
    int
) as quarter_of_year,
    cast(
    date_trunc('quarter', d.date_day)
 as date) as quarter_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        quarter,
        1,
        
    date_trunc('quarter', d.date_day)

        )



        )



        as date)
 as date) as quarter_end_date,

    cast(date_part('year', d.date_day) as 
    int
) as year_number,
    cast(
    date_trunc('year', d.date_day)
 as date) as year_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        year,
        1,
        
    date_trunc('year', d.date_day)

        )



        )



        as date)
 as date) as year_end_date
from
    dates_with_prior_year_dates d
order by 1

 as date
        created_date >= 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_month,
        created_date >= 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_quarter,
        
  

    datediff(
        day,
        
    current_timestamp::
    timestamp_ntz

,
        created_date
        )


 as days_since_created,
        
  

    datediff(
        day,
        close_date,
        created_date
        )


 as days_to_close,
        
    date_trunc('month', close_date)
 = 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_month,
        
    date_trunc('quarter', close_date)
 = 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_quarter
     from source
    )
select * from test
limit 100
2020-12-02 15:52:12.543871 (Thread-1): Snowflake query id: 0198a978-0006-3bba-0000-5eb10001200e
2020-12-02 15:52:12.543998 (Thread-1): Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 8 at position 0 unexpected 'with'.
syntax error line 167 at position 1 unexpected ','.
2020-12-02 15:52:12.544087 (Thread-1): finished collecting timing info
2020-12-02 15:52:12.544425 (Thread-1): On rpc.sales_dataflo.request: ROLLBACK
2020-12-02 15:52:12.702220 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 15:52:12.835816 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 8 at position 0 unexpected 'with'.
  syntax error line 167 at position 1 unexpected ','.
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 161, in exception_handler
    yield
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/cursor.py", line 597, in execute
    errvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 97, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, errorclass, errorvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 73, in default_errorhandler
    done_format_msg=errorvalue.get(u'done_format_msg'))
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 8 at position 0 unexpected 'with'.
syntax error line 167 at position 1 unexpected ','.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 85, in execute
    compiled_node.injected_sql, fetch=True
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/base/impl.py", line 227, in execute
    fetch=fetch
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 312, in add_query
    abridge_sql_log=abridge_sql_log
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.6/contextlib.py", line 99, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 178, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 8 at position 0 unexpected 'with'.
  syntax error line 167 at position 1 unexpected ','.
2020-12-02 15:52:12.837530 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 8 at position 0 unexpected 'with'.\n  syntax error line 167 at position 1 unexpected ','.", 'raw_sql': "WITH source AS (\r\n    select * from {{ var('salesforce_schema_name') }}.{{ var('salesforce_opportunity_table_name') }}\r\n    ),\r\n    test as (\r\n     select\r\n        {{ dbt_date.get_date_dimension('2015-01-01', '2022-12-31') }} as date\r\n        created_date >= {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_created_this_month,\r\n        created_date >= {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_created_this_quarter,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n     from source\r\n    )\r\nselect * from test\nlimit 100", 'compiled_sql': 'WITH source AS (\n    select * from salesforce.opportunity\n    ),\n    test as (\n     select\n        \n    \nwith base_dates as (\n    \nwith date_spine as\n(\n    \n\n    \n\n/*\ncall as follows:\n\ndate_spine(\n    "day",\n    "to_date(\'01/01/2016\', \'mm/dd/yyyy\')",\n    "dateadd(week, 1, current_date)"\n)\n\n*/\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * pow(2, 0)\n     + \n    \n    p1.generated_number * pow(2, 1)\n     + \n    \n    p2.generated_number * pow(2, 2)\n     + \n    \n    p3.generated_number * pow(2, 3)\n     + \n    \n    p4.generated_number * pow(2, 4)\n     + \n    \n    p5.generated_number * pow(2, 5)\n     + \n    \n    p6.generated_number * pow(2, 6)\n     + \n    \n    p7.generated_number * pow(2, 7)\n     + \n    \n    p8.generated_number * pow(2, 8)\n     + \n    \n    p9.generated_number * pow(2, 9)\n     + \n    \n    p10.generated_number * pow(2, 10)\n     + \n    \n    p11.generated_number * pow(2, 11)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 2921\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n  \n\n    dateadd(\n        day,\n        row_number() over (order by 1) - 1,\n        cast(\'2015-01-01\' as datetime)\n        )\n\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast(\'2022-12-31\' as datetime)\n\n)\n\nselect * from filtered\n\n\n\n)\nselect\n    date(d.date_day) as date_day\nfrom\n    date_spine d\n\n),\ndates_with_prior_year_dates as (\n    select\n        cast(d.date_day as date) as date_day,\n        cast(\n  \n\n    dateadd(\n        year,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_year_date_day,\n        cast(\n  \n\n    dateadd(\n        day,\n        -364,\n        d.date_day\n        )\n\n\n as date) as prior_year_over_year_date_day\n    from\n    \tbase_dates d\n)\nselect\n    d.date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        1,\n        d.date_day\n        )\n\n\n as date) as next_date_day,\n    d.prior_year_date_day as prior_year_date_day,\n    d.prior_year_over_year_date_day,\n    cast(\n            case\n                when date_part(\'dayofweek\', d.date_day) = 0 then 7\n                else date_part(\'dayofweek\', d.date_day)\n            end\n        as \n    int\n\n    ) as day_of_week,\n\n    to_char(d.date_day, \'Day\') as day_of_week_name,\n    to_char(d.date_day, \'Dy\') as day_of_week_name_short,\n    cast(date_part(\'day\', d.date_day) as \n    int\n) as day_of_month,\n    cast(date_part(\'dayofyear\', d.date_day) as \n    int\n) as day_of_year,\n\n    cast(\n    date_trunc(\'week\', d.date_day)\n as date) as week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as week_end_date,\n    cast(date_part(\'week\', d.date_day) as \n    int\n) as week_of_year,\n    cast(\n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n as date) as prior_year_week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_week_end_date,\n    cast(date_part(\'week\', d.prior_year_over_year_date_day) as \n    int\n) as prior_year_week_of_year,\n\n    cast(date_part(\'month\', d.date_day) as \n    int\n) as month_of_year,\n    to_char(d.date_day, \'MONTH\')  as month_name,\n    to_char(d.date_day, \'MON\')  as month_name_short,\n\n    cast(\n    date_trunc(\'month\', d.date_day)\n as date) as month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as month_end_date,\n\n    cast(\n    date_trunc(\'month\', d.prior_year_date_day)\n as date) as prior_year_month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.prior_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_month_end_date,\n\n    cast(date_part(\'quarter\', d.date_day) as \n    int\n) as quarter_of_year,\n    cast(\n    date_trunc(\'quarter\', d.date_day)\n as date) as quarter_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        quarter,\n        1,\n        \n    date_trunc(\'quarter\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as quarter_end_date,\n\n    cast(date_part(\'year\', d.date_day) as \n    int\n) as year_number,\n    cast(\n    date_trunc(\'year\', d.date_day)\n as date) as year_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        year,\n        1,\n        \n    date_trunc(\'year\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as year_end_date\nfrom\n    dates_with_prior_year_dates d\norder by 1\n\n as date\n        created_date >= \n    date_trunc(\'month\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_month,\n        created_date >= \n    date_trunc(\'quarter\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_quarter,\n        \n  \n\n    datediff(\n        day,\n        \n    current_timestamp::\n    timestamp_ntz\n\n,\n        created_date\n        )\n\n\n as days_since_created,\n        \n  \n\n    datediff(\n        day,\n        close_date,\n        created_date\n        )\n\n\n as days_to_close,\n        \n    date_trunc(\'month\', close_date)\n = \n    date_trunc(\'month\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_month,\n        \n    date_trunc(\'quarter\', close_date)\n = \n    date_trunc(\'quarter\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_quarter\n     from source\n    )\nselect * from test\nlimit 100', 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 8 at position 0 unexpected 'with'.\n  syntax error line 167 at position 1 unexpected ','.", 'raw_sql': "WITH source AS (\r\n    select * from {{ var('salesforce_schema_name') }}.{{ var('salesforce_opportunity_table_name') }}\r\n    ),\r\n    test as (\r\n     select\r\n        {{ dbt_date.get_date_dimension('2015-01-01', '2022-12-31') }} as date\r\n        created_date >= {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_created_this_month,\r\n        created_date >= {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_created_this_quarter,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n     from source\r\n    )\r\nselect * from test\nlimit 100", 'compiled_sql': 'WITH source AS (\n    select * from salesforce.opportunity\n    ),\n    test as (\n     select\n        \n    \nwith base_dates as (\n    \nwith date_spine as\n(\n    \n\n    \n\n/*\ncall as follows:\n\ndate_spine(\n    "day",\n    "to_date(\'01/01/2016\', \'mm/dd/yyyy\')",\n    "dateadd(week, 1, current_date)"\n)\n\n*/\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * pow(2, 0)\n     + \n    \n    p1.generated_number * pow(2, 1)\n     + \n    \n    p2.generated_number * pow(2, 2)\n     + \n    \n    p3.generated_number * pow(2, 3)\n     + \n    \n    p4.generated_number * pow(2, 4)\n     + \n    \n    p5.generated_number * pow(2, 5)\n     + \n    \n    p6.generated_number * pow(2, 6)\n     + \n    \n    p7.generated_number * pow(2, 7)\n     + \n    \n    p8.generated_number * pow(2, 8)\n     + \n    \n    p9.generated_number * pow(2, 9)\n     + \n    \n    p10.generated_number * pow(2, 10)\n     + \n    \n    p11.generated_number * pow(2, 11)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 2921\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n  \n\n    dateadd(\n        day,\n        row_number() over (order by 1) - 1,\n        cast(\'2015-01-01\' as datetime)\n        )\n\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast(\'2022-12-31\' as datetime)\n\n)\n\nselect * from filtered\n\n\n\n)\nselect\n    date(d.date_day) as date_day\nfrom\n    date_spine d\n\n),\ndates_with_prior_year_dates as (\n    select\n        cast(d.date_day as date) as date_day,\n        cast(\n  \n\n    dateadd(\n        year,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_year_date_day,\n        cast(\n  \n\n    dateadd(\n        day,\n        -364,\n        d.date_day\n        )\n\n\n as date) as prior_year_over_year_date_day\n    from\n    \tbase_dates d\n)\nselect\n    d.date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        1,\n        d.date_day\n        )\n\n\n as date) as next_date_day,\n    d.prior_year_date_day as prior_year_date_day,\n    d.prior_year_over_year_date_day,\n    cast(\n            case\n                when date_part(\'dayofweek\', d.date_day) = 0 then 7\n                else date_part(\'dayofweek\', d.date_day)\n            end\n        as \n    int\n\n    ) as day_of_week,\n\n    to_char(d.date_day, \'Day\') as day_of_week_name,\n    to_char(d.date_day, \'Dy\') as day_of_week_name_short,\n    cast(date_part(\'day\', d.date_day) as \n    int\n) as day_of_month,\n    cast(date_part(\'dayofyear\', d.date_day) as \n    int\n) as day_of_year,\n\n    cast(\n    date_trunc(\'week\', d.date_day)\n as date) as week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as week_end_date,\n    cast(date_part(\'week\', d.date_day) as \n    int\n) as week_of_year,\n    cast(\n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n as date) as prior_year_week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_week_end_date,\n    cast(date_part(\'week\', d.prior_year_over_year_date_day) as \n    int\n) as prior_year_week_of_year,\n\n    cast(date_part(\'month\', d.date_day) as \n    int\n) as month_of_year,\n    to_char(d.date_day, \'MONTH\')  as month_name,\n    to_char(d.date_day, \'MON\')  as month_name_short,\n\n    cast(\n    date_trunc(\'month\', d.date_day)\n as date) as month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as month_end_date,\n\n    cast(\n    date_trunc(\'month\', d.prior_year_date_day)\n as date) as prior_year_month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.prior_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_month_end_date,\n\n    cast(date_part(\'quarter\', d.date_day) as \n    int\n) as quarter_of_year,\n    cast(\n    date_trunc(\'quarter\', d.date_day)\n as date) as quarter_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        quarter,\n        1,\n        \n    date_trunc(\'quarter\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as quarter_end_date,\n\n    cast(date_part(\'year\', d.date_day) as \n    int\n) as year_number,\n    cast(\n    date_trunc(\'year\', d.date_day)\n as date) as year_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        year,\n        1,\n        \n    date_trunc(\'year\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as year_end_date\nfrom\n    dates_with_prior_year_dates d\norder by 1\n\n as date\n        created_date >= \n    date_trunc(\'month\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_month,\n        created_date >= \n    date_trunc(\'quarter\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_quarter,\n        \n  \n\n    datediff(\n        day,\n        \n    current_timestamp::\n    timestamp_ntz\n\n,\n        created_date\n        )\n\n\n as days_since_created,\n        \n  \n\n    datediff(\n        day,\n        close_date,\n        created_date\n        )\n\n\n as days_to_close,\n        \n    date_trunc(\'month\', close_date)\n = \n    date_trunc(\'month\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_month,\n        \n    date_trunc(\'quarter\', close_date)\n = \n    date_trunc(\'quarter\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_quarter\n     from source\n    )\nselect * from test\nlimit 100', 'tags': None}, None)
2020-12-02 15:52:14.382710 (Thread-57): handling poll request
2020-12-02 15:52:14.383191 (Thread-57): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6cfc50>]}
2020-12-02 15:52:14.384285 (Thread-57): sending response (<Response 43547 bytes [200 OK]>) to 10.0.13.141
2020-12-02 16:00:59.047006 (Thread-58): handling status request
2020-12-02 16:00:59.049068 (Thread-58): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6cfa58>]}
2020-12-02 16:00:59.050924 (Thread-58): sending response (<Response 1237 bytes [200 OK]>) to 10.0.32.130
2020-12-02 16:00:59.634725 (Thread-59): handling run_sql request
2020-12-02 16:00:59.635527 (Thread-59): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6ef320>]}
2020-12-02 16:01:01.161403 (Thread-59): sending response (<Response 137 bytes [200 OK]>) to 10.0.32.18
2020-12-02 16:01:01.210376 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:01:01.395041 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 16:01:01.395839 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:01:01.396047 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 16:01:01.417875 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:01:01.418006 (Thread-1): On rpc.sales_dataflo.request: BEGIN
2020-12-02 16:01:01.418073 (Thread-1): Opening a new connection, currently in state init
2020-12-02 16:01:01.658656 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 16:01:01.882575 (Thread-60): handling poll request
2020-12-02 16:01:01.883145 (Thread-60): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f722080>]}
2020-12-02 16:01:01.885514 (Thread-60): sending response (<Response 2424 bytes [200 OK]>) to 10.0.23.132
2020-12-02 16:01:02.094435 (Thread-1): SQL status: SUCCESS 1 in 0.68 seconds
2020-12-02 16:01:02.094671 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:01:02.094788 (Thread-1): On rpc.sales_dataflo.request: select 
  

    datediff(
        day,
        cast('2015-01-01' as datetime),
        cast('2022-12-31' as datetime)
        )
2020-12-02 16:01:02.157984 (Thread-1): SQL status: SUCCESS 1 in 0.06 seconds
2020-12-02 16:01:02.180274 (Thread-1): finished collecting timing info
2020-12-02 16:01:02.188142 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:01:02.188320 (Thread-1): On rpc.sales_dataflo.request: WITH source AS (
    select * from salesforce.opportunity
    ),
    test as (
     select
        
    
with base_dates as (
    
with date_spine as
(
    

    

/*
call as follows:

date_spine(
    "day",
    "to_date('01/01/2016', 'mm/dd/yyyy')",
    "dateadd(week, 1, current_date)"
)

*/

with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * pow(2, 0)
     + 
    
    p1.generated_number * pow(2, 1)
     + 
    
    p2.generated_number * pow(2, 2)
     + 
    
    p3.generated_number * pow(2, 3)
     + 
    
    p4.generated_number * pow(2, 4)
     + 
    
    p5.generated_number * pow(2, 5)
     + 
    
    p6.generated_number * pow(2, 6)
     + 
    
    p7.generated_number * pow(2, 7)
     + 
    
    p8.generated_number * pow(2, 8)
     + 
    
    p9.generated_number * pow(2, 9)
     + 
    
    p10.generated_number * pow(2, 10)
     + 
    
    p11.generated_number * pow(2, 11)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
     cross join 
    
    p as p7
     cross join 
    
    p as p8
     cross join 
    
    p as p9
     cross join 
    
    p as p10
     cross join 
    
    p as p11
    
    

    )

    select *
    from unioned
    where generated_number <= 2921
    order by generated_number



),

all_periods as (

    select (
        
  

    dateadd(
        day,
        row_number() over (order by 1) - 1,
        cast('2015-01-01' as datetime)
        )



    ) as date_day
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_day <= cast('2022-12-31' as datetime)

)

select * from filtered



)
select
    date(d.date_day) as date_day
from
    date_spine d

),
dates_with_prior_year_dates as (
    select
        cast(d.date_day as date) as date_day,
        cast(
  

    dateadd(
        year,
        -1,
        d.date_day
        )


 as date) as prior_year_date_day,
        cast(
  

    dateadd(
        day,
        -364,
        d.date_day
        )


 as date) as prior_year_over_year_date_day
    from
    	base_dates d
)
select
    d.date_day,
    cast(
  

    dateadd(
        day,
        -1,
        d.date_day
        )


 as date) as prior_date_day,
    cast(
  

    dateadd(
        day,
        1,
        d.date_day
        )


 as date) as next_date_day,
    d.prior_year_date_day as prior_year_date_day,
    d.prior_year_over_year_date_day,
    cast(
            case
                when date_part('dayofweek', d.date_day) = 0 then 7
                else date_part('dayofweek', d.date_day)
            end
        as 
    int

    ) as day_of_week,

    to_char(d.date_day, 'Day') as day_of_week_name,
    to_char(d.date_day, 'Dy') as day_of_week_name_short,
    cast(date_part('day', d.date_day) as 
    int
) as day_of_month,
    cast(date_part('dayofyear', d.date_day) as 
    int
) as day_of_year,

    cast(
    date_trunc('week', d.date_day)
 as date) as week_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', d.date_day)

        )



        )



        as date)
 as date) as week_end_date,
    cast(date_part('week', d.date_day) as 
    int
) as week_of_year,
    cast(
    date_trunc('week', d.prior_year_over_year_date_day)
 as date) as prior_year_week_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', d.prior_year_over_year_date_day)

        )



        )



        as date)
 as date) as prior_year_week_end_date,
    cast(date_part('week', d.prior_year_over_year_date_day) as 
    int
) as prior_year_week_of_year,

    cast(date_part('month', d.date_day) as 
    int
) as month_of_year,
    to_char(d.date_day, 'MONTH')  as month_name,
    to_char(d.date_day, 'MON')  as month_name_short,

    cast(
    date_trunc('month', d.date_day)
 as date) as month_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', d.date_day)

        )



        )



        as date)
 as date) as month_end_date,

    cast(
    date_trunc('month', d.prior_year_date_day)
 as date) as prior_year_month_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', d.prior_year_date_day)

        )



        )



        as date)
 as date) as prior_year_month_end_date,

    cast(date_part('quarter', d.date_day) as 
    int
) as quarter_of_year,
    cast(
    date_trunc('quarter', d.date_day)
 as date) as quarter_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        quarter,
        1,
        
    date_trunc('quarter', d.date_day)

        )



        )



        as date)
 as date) as quarter_end_date,

    cast(date_part('year', d.date_day) as 
    int
) as year_number,
    cast(
    date_trunc('year', d.date_day)
 as date) as year_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        year,
        1,
        
    date_trunc('year', d.date_day)

        )



        )



        as date)
 as date) as year_end_date
from
    dates_with_prior_year_dates d
order by 1

 as date
        created_date >= 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_month,
        created_date >= 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_quarter,
        
  

    datediff(
        day,
        
    current_timestamp::
    timestamp_ntz

,
        created_date
        )


 as days_since_created,
        
  

    datediff(
        day,
        close_date,
        created_date
        )


 as days_to_close,
        
    date_trunc('month', close_date)
 = 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_month,
        
    date_trunc('quarter', close_date)
 = 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_quarter
     from source
    )
select * from test
limit 100
2020-12-02 16:01:02.259364 (Thread-1): Snowflake query id: 0198a981-009c-fd9f-0000-5eb10001104e
2020-12-02 16:01:02.259535 (Thread-1): Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 8 at position 0 unexpected 'with'.
syntax error line 167 at position 1 unexpected ','.
2020-12-02 16:01:02.259661 (Thread-1): finished collecting timing info
2020-12-02 16:01:02.260141 (Thread-1): On rpc.sales_dataflo.request: ROLLBACK
2020-12-02 16:01:02.388762 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 16:01:02.459751 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 8 at position 0 unexpected 'with'.
  syntax error line 167 at position 1 unexpected ','.
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 161, in exception_handler
    yield
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/cursor.py", line 597, in execute
    errvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 97, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, errorclass, errorvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 73, in default_errorhandler
    done_format_msg=errorvalue.get(u'done_format_msg'))
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 8 at position 0 unexpected 'with'.
syntax error line 167 at position 1 unexpected ','.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 85, in execute
    compiled_node.injected_sql, fetch=True
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/base/impl.py", line 227, in execute
    fetch=fetch
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 312, in add_query
    abridge_sql_log=abridge_sql_log
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.6/contextlib.py", line 99, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 178, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 8 at position 0 unexpected 'with'.
  syntax error line 167 at position 1 unexpected ','.
2020-12-02 16:01:02.461594 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 8 at position 0 unexpected 'with'.\n  syntax error line 167 at position 1 unexpected ','.", 'raw_sql': "WITH source AS (\r\n    select * from {{ var('salesforce_schema_name') }}.{{ var('salesforce_opportunity_table_name') }}\r\n    ),\r\n    test as (\r\n     select\r\n        {{ dbt_date.get_date_dimension('2015-01-01', '2022-12-31') }} as date\r\n        created_date >= {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_created_this_month,\r\n        created_date >= {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_created_this_quarter,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n     from source\r\n    )\r\nselect * from test\nlimit 100", 'compiled_sql': 'WITH source AS (\n    select * from salesforce.opportunity\n    ),\n    test as (\n     select\n        \n    \nwith base_dates as (\n    \nwith date_spine as\n(\n    \n\n    \n\n/*\ncall as follows:\n\ndate_spine(\n    "day",\n    "to_date(\'01/01/2016\', \'mm/dd/yyyy\')",\n    "dateadd(week, 1, current_date)"\n)\n\n*/\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * pow(2, 0)\n     + \n    \n    p1.generated_number * pow(2, 1)\n     + \n    \n    p2.generated_number * pow(2, 2)\n     + \n    \n    p3.generated_number * pow(2, 3)\n     + \n    \n    p4.generated_number * pow(2, 4)\n     + \n    \n    p5.generated_number * pow(2, 5)\n     + \n    \n    p6.generated_number * pow(2, 6)\n     + \n    \n    p7.generated_number * pow(2, 7)\n     + \n    \n    p8.generated_number * pow(2, 8)\n     + \n    \n    p9.generated_number * pow(2, 9)\n     + \n    \n    p10.generated_number * pow(2, 10)\n     + \n    \n    p11.generated_number * pow(2, 11)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 2921\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n  \n\n    dateadd(\n        day,\n        row_number() over (order by 1) - 1,\n        cast(\'2015-01-01\' as datetime)\n        )\n\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast(\'2022-12-31\' as datetime)\n\n)\n\nselect * from filtered\n\n\n\n)\nselect\n    date(d.date_day) as date_day\nfrom\n    date_spine d\n\n),\ndates_with_prior_year_dates as (\n    select\n        cast(d.date_day as date) as date_day,\n        cast(\n  \n\n    dateadd(\n        year,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_year_date_day,\n        cast(\n  \n\n    dateadd(\n        day,\n        -364,\n        d.date_day\n        )\n\n\n as date) as prior_year_over_year_date_day\n    from\n    \tbase_dates d\n)\nselect\n    d.date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        1,\n        d.date_day\n        )\n\n\n as date) as next_date_day,\n    d.prior_year_date_day as prior_year_date_day,\n    d.prior_year_over_year_date_day,\n    cast(\n            case\n                when date_part(\'dayofweek\', d.date_day) = 0 then 7\n                else date_part(\'dayofweek\', d.date_day)\n            end\n        as \n    int\n\n    ) as day_of_week,\n\n    to_char(d.date_day, \'Day\') as day_of_week_name,\n    to_char(d.date_day, \'Dy\') as day_of_week_name_short,\n    cast(date_part(\'day\', d.date_day) as \n    int\n) as day_of_month,\n    cast(date_part(\'dayofyear\', d.date_day) as \n    int\n) as day_of_year,\n\n    cast(\n    date_trunc(\'week\', d.date_day)\n as date) as week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as week_end_date,\n    cast(date_part(\'week\', d.date_day) as \n    int\n) as week_of_year,\n    cast(\n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n as date) as prior_year_week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_week_end_date,\n    cast(date_part(\'week\', d.prior_year_over_year_date_day) as \n    int\n) as prior_year_week_of_year,\n\n    cast(date_part(\'month\', d.date_day) as \n    int\n) as month_of_year,\n    to_char(d.date_day, \'MONTH\')  as month_name,\n    to_char(d.date_day, \'MON\')  as month_name_short,\n\n    cast(\n    date_trunc(\'month\', d.date_day)\n as date) as month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as month_end_date,\n\n    cast(\n    date_trunc(\'month\', d.prior_year_date_day)\n as date) as prior_year_month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.prior_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_month_end_date,\n\n    cast(date_part(\'quarter\', d.date_day) as \n    int\n) as quarter_of_year,\n    cast(\n    date_trunc(\'quarter\', d.date_day)\n as date) as quarter_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        quarter,\n        1,\n        \n    date_trunc(\'quarter\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as quarter_end_date,\n\n    cast(date_part(\'year\', d.date_day) as \n    int\n) as year_number,\n    cast(\n    date_trunc(\'year\', d.date_day)\n as date) as year_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        year,\n        1,\n        \n    date_trunc(\'year\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as year_end_date\nfrom\n    dates_with_prior_year_dates d\norder by 1\n\n as date\n        created_date >= \n    date_trunc(\'month\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_month,\n        created_date >= \n    date_trunc(\'quarter\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_quarter,\n        \n  \n\n    datediff(\n        day,\n        \n    current_timestamp::\n    timestamp_ntz\n\n,\n        created_date\n        )\n\n\n as days_since_created,\n        \n  \n\n    datediff(\n        day,\n        close_date,\n        created_date\n        )\n\n\n as days_to_close,\n        \n    date_trunc(\'month\', close_date)\n = \n    date_trunc(\'month\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_month,\n        \n    date_trunc(\'quarter\', close_date)\n = \n    date_trunc(\'quarter\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_quarter\n     from source\n    )\nselect * from test\nlimit 100', 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 8 at position 0 unexpected 'with'.\n  syntax error line 167 at position 1 unexpected ','.", 'raw_sql': "WITH source AS (\r\n    select * from {{ var('salesforce_schema_name') }}.{{ var('salesforce_opportunity_table_name') }}\r\n    ),\r\n    test as (\r\n     select\r\n        {{ dbt_date.get_date_dimension('2015-01-01', '2022-12-31') }} as date\r\n        created_date >= {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_created_this_month,\r\n        created_date >= {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_created_this_quarter,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n     from source\r\n    )\r\nselect * from test\nlimit 100", 'compiled_sql': 'WITH source AS (\n    select * from salesforce.opportunity\n    ),\n    test as (\n     select\n        \n    \nwith base_dates as (\n    \nwith date_spine as\n(\n    \n\n    \n\n/*\ncall as follows:\n\ndate_spine(\n    "day",\n    "to_date(\'01/01/2016\', \'mm/dd/yyyy\')",\n    "dateadd(week, 1, current_date)"\n)\n\n*/\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * pow(2, 0)\n     + \n    \n    p1.generated_number * pow(2, 1)\n     + \n    \n    p2.generated_number * pow(2, 2)\n     + \n    \n    p3.generated_number * pow(2, 3)\n     + \n    \n    p4.generated_number * pow(2, 4)\n     + \n    \n    p5.generated_number * pow(2, 5)\n     + \n    \n    p6.generated_number * pow(2, 6)\n     + \n    \n    p7.generated_number * pow(2, 7)\n     + \n    \n    p8.generated_number * pow(2, 8)\n     + \n    \n    p9.generated_number * pow(2, 9)\n     + \n    \n    p10.generated_number * pow(2, 10)\n     + \n    \n    p11.generated_number * pow(2, 11)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 2921\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n  \n\n    dateadd(\n        day,\n        row_number() over (order by 1) - 1,\n        cast(\'2015-01-01\' as datetime)\n        )\n\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast(\'2022-12-31\' as datetime)\n\n)\n\nselect * from filtered\n\n\n\n)\nselect\n    date(d.date_day) as date_day\nfrom\n    date_spine d\n\n),\ndates_with_prior_year_dates as (\n    select\n        cast(d.date_day as date) as date_day,\n        cast(\n  \n\n    dateadd(\n        year,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_year_date_day,\n        cast(\n  \n\n    dateadd(\n        day,\n        -364,\n        d.date_day\n        )\n\n\n as date) as prior_year_over_year_date_day\n    from\n    \tbase_dates d\n)\nselect\n    d.date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        1,\n        d.date_day\n        )\n\n\n as date) as next_date_day,\n    d.prior_year_date_day as prior_year_date_day,\n    d.prior_year_over_year_date_day,\n    cast(\n            case\n                when date_part(\'dayofweek\', d.date_day) = 0 then 7\n                else date_part(\'dayofweek\', d.date_day)\n            end\n        as \n    int\n\n    ) as day_of_week,\n\n    to_char(d.date_day, \'Day\') as day_of_week_name,\n    to_char(d.date_day, \'Dy\') as day_of_week_name_short,\n    cast(date_part(\'day\', d.date_day) as \n    int\n) as day_of_month,\n    cast(date_part(\'dayofyear\', d.date_day) as \n    int\n) as day_of_year,\n\n    cast(\n    date_trunc(\'week\', d.date_day)\n as date) as week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as week_end_date,\n    cast(date_part(\'week\', d.date_day) as \n    int\n) as week_of_year,\n    cast(\n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n as date) as prior_year_week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_week_end_date,\n    cast(date_part(\'week\', d.prior_year_over_year_date_day) as \n    int\n) as prior_year_week_of_year,\n\n    cast(date_part(\'month\', d.date_day) as \n    int\n) as month_of_year,\n    to_char(d.date_day, \'MONTH\')  as month_name,\n    to_char(d.date_day, \'MON\')  as month_name_short,\n\n    cast(\n    date_trunc(\'month\', d.date_day)\n as date) as month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as month_end_date,\n\n    cast(\n    date_trunc(\'month\', d.prior_year_date_day)\n as date) as prior_year_month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.prior_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_month_end_date,\n\n    cast(date_part(\'quarter\', d.date_day) as \n    int\n) as quarter_of_year,\n    cast(\n    date_trunc(\'quarter\', d.date_day)\n as date) as quarter_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        quarter,\n        1,\n        \n    date_trunc(\'quarter\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as quarter_end_date,\n\n    cast(date_part(\'year\', d.date_day) as \n    int\n) as year_number,\n    cast(\n    date_trunc(\'year\', d.date_day)\n as date) as year_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        year,\n        1,\n        \n    date_trunc(\'year\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as year_end_date\nfrom\n    dates_with_prior_year_dates d\norder by 1\n\n as date\n        created_date >= \n    date_trunc(\'month\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_month,\n        created_date >= \n    date_trunc(\'quarter\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_quarter,\n        \n  \n\n    datediff(\n        day,\n        \n    current_timestamp::\n    timestamp_ntz\n\n,\n        created_date\n        )\n\n\n as days_since_created,\n        \n  \n\n    datediff(\n        day,\n        close_date,\n        created_date\n        )\n\n\n as days_to_close,\n        \n    date_trunc(\'month\', close_date)\n = \n    date_trunc(\'month\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_month,\n        \n    date_trunc(\'quarter\', close_date)\n = \n    date_trunc(\'quarter\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_quarter\n     from source\n    )\nselect * from test\nlimit 100', 'tags': None}, None)
2020-12-02 16:01:03.481106 (Thread-61): handling poll request
2020-12-02 16:01:03.481606 (Thread-61): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f7105f8>]}
2020-12-02 16:01:03.483727 (Thread-61): Checking header 'user-agent' tracing in whitelist set(), 24 additional messages skipped
2020-12-02 16:01:03.613985 (Thread-61): writing 1 spans (enabled:True)
2020-12-02 16:01:03.614273 (Thread-61): 
      name requests.request
        id 5159474383143357157
  trace_id 13929314497569578265
 parent_id None
   service requests
  resource requests.request
      type http
     start 1606924863.483198
       end 1606924863.613867
  duration 0.130669s
     error 0
      tags 
           http.method:POST
           http.status_code:200
           http.url:https://fishtownanalytics.sinter-collect.com/com.snowplowanalytics.snowplow/tp2
           runtime-id:8daea1d60d034a8cace00663c6a43dc8
2020-12-02 16:01:03.616711 (Thread-61): sending response (<Response 43547 bytes [200 OK]>) to 10.0.23.203
2020-12-02 16:01:03.798441 (AgentWriter): reported 1 traces in 0.00555s
2020-12-02 16:01:03.798691 (AgentWriter): initialized RateSampler, sample 100% of traces, 35 additional messages skipped
2020-12-02 16:01:12.237976 (Thread-62): handling status request
2020-12-02 16:01:12.238712 (Thread-62): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f71c978>]}
2020-12-02 16:01:12.240401 (Thread-62): sending response (<Response 1237 bytes [200 OK]>) to 10.0.0.188
2020-12-02 16:01:12.867328 (Thread-63): handling run_sql request
2020-12-02 16:01:12.867851 (Thread-63): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f71c1d0>]}
2020-12-02 16:01:14.251324 (Thread-63): sending response (<Response 137 bytes [200 OK]>) to 10.0.23.132
2020-12-02 16:01:14.283225 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:01:14.401114 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 16:01:14.401768 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:01:14.401976 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 16:01:14.429914 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:01:14.430049 (Thread-1): On rpc.sales_dataflo.request: BEGIN
2020-12-02 16:01:14.430115 (Thread-1): Opening a new connection, currently in state init
2020-12-02 16:01:14.687531 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 16:01:15.009660 (Thread-64): handling poll request
2020-12-02 16:01:15.010263 (Thread-64): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f71c1d0>]}
2020-12-02 16:01:15.012691 (Thread-64): sending response (<Response 2424 bytes [200 OK]>) to 10.0.23.203
2020-12-02 16:01:15.323085 (Thread-1): SQL status: SUCCESS 1 in 0.89 seconds
2020-12-02 16:01:15.323379 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:01:15.323491 (Thread-1): On rpc.sales_dataflo.request: select 
  

    datediff(
        day,
        cast('2015-01-01' as datetime),
        cast('2022-12-31' as datetime)
        )
2020-12-02 16:01:15.453602 (Thread-1): SQL status: SUCCESS 1 in 0.13 seconds
2020-12-02 16:01:15.479490 (Thread-1): finished collecting timing info
2020-12-02 16:01:15.488176 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:01:15.488377 (Thread-1): On rpc.sales_dataflo.request: WITH source AS (
    select * from salesforce.opportunity
    ),
    test as (
     select
        
    
with base_dates as (
    
with date_spine as
(
    

    

/*
call as follows:

date_spine(
    "day",
    "to_date('01/01/2016', 'mm/dd/yyyy')",
    "dateadd(week, 1, current_date)"
)

*/

with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * pow(2, 0)
     + 
    
    p1.generated_number * pow(2, 1)
     + 
    
    p2.generated_number * pow(2, 2)
     + 
    
    p3.generated_number * pow(2, 3)
     + 
    
    p4.generated_number * pow(2, 4)
     + 
    
    p5.generated_number * pow(2, 5)
     + 
    
    p6.generated_number * pow(2, 6)
     + 
    
    p7.generated_number * pow(2, 7)
     + 
    
    p8.generated_number * pow(2, 8)
     + 
    
    p9.generated_number * pow(2, 9)
     + 
    
    p10.generated_number * pow(2, 10)
     + 
    
    p11.generated_number * pow(2, 11)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
     cross join 
    
    p as p7
     cross join 
    
    p as p8
     cross join 
    
    p as p9
     cross join 
    
    p as p10
     cross join 
    
    p as p11
    
    

    )

    select *
    from unioned
    where generated_number <= 2921
    order by generated_number



),

all_periods as (

    select (
        
  

    dateadd(
        day,
        row_number() over (order by 1) - 1,
        cast('2015-01-01' as datetime)
        )



    ) as date_day
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_day <= cast('2022-12-31' as datetime)

)

select * from filtered



)
select
    date(d.date_day) as date_day
from
    date_spine d

),
dates_with_prior_year_dates as (
    select
        cast(d.date_day as date) as date_day,
        cast(
  

    dateadd(
        year,
        -1,
        d.date_day
        )


 as date) as prior_year_date_day,
        cast(
  

    dateadd(
        day,
        -364,
        d.date_day
        )


 as date) as prior_year_over_year_date_day
    from
    	base_dates d
)
select
    d.date_day,
    cast(
  

    dateadd(
        day,
        -1,
        d.date_day
        )


 as date) as prior_date_day,
    cast(
  

    dateadd(
        day,
        1,
        d.date_day
        )


 as date) as next_date_day,
    d.prior_year_date_day as prior_year_date_day,
    d.prior_year_over_year_date_day,
    cast(
            case
                when date_part('dayofweek', d.date_day) = 0 then 7
                else date_part('dayofweek', d.date_day)
            end
        as 
    int

    ) as day_of_week,

    to_char(d.date_day, 'Day') as day_of_week_name,
    to_char(d.date_day, 'Dy') as day_of_week_name_short,
    cast(date_part('day', d.date_day) as 
    int
) as day_of_month,
    cast(date_part('dayofyear', d.date_day) as 
    int
) as day_of_year,

    cast(
    date_trunc('week', d.date_day)
 as date) as week_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', d.date_day)

        )



        )



        as date)
 as date) as week_end_date,
    cast(date_part('week', d.date_day) as 
    int
) as week_of_year,
    cast(
    date_trunc('week', d.prior_year_over_year_date_day)
 as date) as prior_year_week_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', d.prior_year_over_year_date_day)

        )



        )



        as date)
 as date) as prior_year_week_end_date,
    cast(date_part('week', d.prior_year_over_year_date_day) as 
    int
) as prior_year_week_of_year,

    cast(date_part('month', d.date_day) as 
    int
) as month_of_year,
    to_char(d.date_day, 'MONTH')  as month_name,
    to_char(d.date_day, 'MON')  as month_name_short,

    cast(
    date_trunc('month', d.date_day)
 as date) as month_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', d.date_day)

        )



        )



        as date)
 as date) as month_end_date,

    cast(
    date_trunc('month', d.prior_year_date_day)
 as date) as prior_year_month_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', d.prior_year_date_day)

        )



        )



        as date)
 as date) as prior_year_month_end_date,

    cast(date_part('quarter', d.date_day) as 
    int
) as quarter_of_year,
    cast(
    date_trunc('quarter', d.date_day)
 as date) as quarter_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        quarter,
        1,
        
    date_trunc('quarter', d.date_day)

        )



        )



        as date)
 as date) as quarter_end_date,

    cast(date_part('year', d.date_day) as 
    int
) as year_number,
    cast(
    date_trunc('year', d.date_day)
 as date) as year_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        year,
        1,
        
    date_trunc('year', d.date_day)

        )



        )



        as date)
 as date) as year_end_date
from
    dates_with_prior_year_dates d
order by 1

 as date,
        created_date >= 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_month,
        created_date >= 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_quarter,
        
  

    datediff(
        day,
        
    current_timestamp::
    timestamp_ntz

,
        created_date
        )


 as days_since_created,
        
  

    datediff(
        day,
        close_date,
        created_date
        )


 as days_to_close,
        
    date_trunc('month', close_date)
 = 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_month,
        
    date_trunc('quarter', close_date)
 = 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_quarter
     from source
    )
select * from test
limit 100
2020-12-02 16:01:15.578757 (Thread-1): Snowflake query id: 0198a981-002b-6354-0000-5eb10001201a
2020-12-02 16:01:15.578935 (Thread-1): Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 8 at position 0 unexpected 'with'.
syntax error line 167 at position 1 unexpected ','.
2020-12-02 16:01:15.579089 (Thread-1): finished collecting timing info
2020-12-02 16:01:15.579626 (Thread-1): On rpc.sales_dataflo.request: ROLLBACK
2020-12-02 16:01:15.726058 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 16:01:15.825589 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 8 at position 0 unexpected 'with'.
  syntax error line 167 at position 1 unexpected ','.
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 161, in exception_handler
    yield
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/cursor.py", line 597, in execute
    errvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 97, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, errorclass, errorvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 73, in default_errorhandler
    done_format_msg=errorvalue.get(u'done_format_msg'))
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 8 at position 0 unexpected 'with'.
syntax error line 167 at position 1 unexpected ','.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 85, in execute
    compiled_node.injected_sql, fetch=True
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/base/impl.py", line 227, in execute
    fetch=fetch
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 312, in add_query
    abridge_sql_log=abridge_sql_log
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.6/contextlib.py", line 99, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 178, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 8 at position 0 unexpected 'with'.
  syntax error line 167 at position 1 unexpected ','.
2020-12-02 16:01:15.828434 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 8 at position 0 unexpected 'with'.\n  syntax error line 167 at position 1 unexpected ','.", 'raw_sql': "WITH source AS (\r\n    select * from {{ var('salesforce_schema_name') }}.{{ var('salesforce_opportunity_table_name') }}\r\n    ),\r\n    test as (\r\n     select\r\n        {{ dbt_date.get_date_dimension('2015-01-01', '2022-12-31') }} as date,\r\n        created_date >= {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_created_this_month,\r\n        created_date >= {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_created_this_quarter,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n     from source\r\n    )\r\nselect * from test\nlimit 100", 'compiled_sql': 'WITH source AS (\n    select * from salesforce.opportunity\n    ),\n    test as (\n     select\n        \n    \nwith base_dates as (\n    \nwith date_spine as\n(\n    \n\n    \n\n/*\ncall as follows:\n\ndate_spine(\n    "day",\n    "to_date(\'01/01/2016\', \'mm/dd/yyyy\')",\n    "dateadd(week, 1, current_date)"\n)\n\n*/\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * pow(2, 0)\n     + \n    \n    p1.generated_number * pow(2, 1)\n     + \n    \n    p2.generated_number * pow(2, 2)\n     + \n    \n    p3.generated_number * pow(2, 3)\n     + \n    \n    p4.generated_number * pow(2, 4)\n     + \n    \n    p5.generated_number * pow(2, 5)\n     + \n    \n    p6.generated_number * pow(2, 6)\n     + \n    \n    p7.generated_number * pow(2, 7)\n     + \n    \n    p8.generated_number * pow(2, 8)\n     + \n    \n    p9.generated_number * pow(2, 9)\n     + \n    \n    p10.generated_number * pow(2, 10)\n     + \n    \n    p11.generated_number * pow(2, 11)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 2921\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n  \n\n    dateadd(\n        day,\n        row_number() over (order by 1) - 1,\n        cast(\'2015-01-01\' as datetime)\n        )\n\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast(\'2022-12-31\' as datetime)\n\n)\n\nselect * from filtered\n\n\n\n)\nselect\n    date(d.date_day) as date_day\nfrom\n    date_spine d\n\n),\ndates_with_prior_year_dates as (\n    select\n        cast(d.date_day as date) as date_day,\n        cast(\n  \n\n    dateadd(\n        year,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_year_date_day,\n        cast(\n  \n\n    dateadd(\n        day,\n        -364,\n        d.date_day\n        )\n\n\n as date) as prior_year_over_year_date_day\n    from\n    \tbase_dates d\n)\nselect\n    d.date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        1,\n        d.date_day\n        )\n\n\n as date) as next_date_day,\n    d.prior_year_date_day as prior_year_date_day,\n    d.prior_year_over_year_date_day,\n    cast(\n            case\n                when date_part(\'dayofweek\', d.date_day) = 0 then 7\n                else date_part(\'dayofweek\', d.date_day)\n            end\n        as \n    int\n\n    ) as day_of_week,\n\n    to_char(d.date_day, \'Day\') as day_of_week_name,\n    to_char(d.date_day, \'Dy\') as day_of_week_name_short,\n    cast(date_part(\'day\', d.date_day) as \n    int\n) as day_of_month,\n    cast(date_part(\'dayofyear\', d.date_day) as \n    int\n) as day_of_year,\n\n    cast(\n    date_trunc(\'week\', d.date_day)\n as date) as week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as week_end_date,\n    cast(date_part(\'week\', d.date_day) as \n    int\n) as week_of_year,\n    cast(\n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n as date) as prior_year_week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_week_end_date,\n    cast(date_part(\'week\', d.prior_year_over_year_date_day) as \n    int\n) as prior_year_week_of_year,\n\n    cast(date_part(\'month\', d.date_day) as \n    int\n) as month_of_year,\n    to_char(d.date_day, \'MONTH\')  as month_name,\n    to_char(d.date_day, \'MON\')  as month_name_short,\n\n    cast(\n    date_trunc(\'month\', d.date_day)\n as date) as month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as month_end_date,\n\n    cast(\n    date_trunc(\'month\', d.prior_year_date_day)\n as date) as prior_year_month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.prior_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_month_end_date,\n\n    cast(date_part(\'quarter\', d.date_day) as \n    int\n) as quarter_of_year,\n    cast(\n    date_trunc(\'quarter\', d.date_day)\n as date) as quarter_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        quarter,\n        1,\n        \n    date_trunc(\'quarter\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as quarter_end_date,\n\n    cast(date_part(\'year\', d.date_day) as \n    int\n) as year_number,\n    cast(\n    date_trunc(\'year\', d.date_day)\n as date) as year_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        year,\n        1,\n        \n    date_trunc(\'year\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as year_end_date\nfrom\n    dates_with_prior_year_dates d\norder by 1\n\n as date,\n        created_date >= \n    date_trunc(\'month\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_month,\n        created_date >= \n    date_trunc(\'quarter\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_quarter,\n        \n  \n\n    datediff(\n        day,\n        \n    current_timestamp::\n    timestamp_ntz\n\n,\n        created_date\n        )\n\n\n as days_since_created,\n        \n  \n\n    datediff(\n        day,\n        close_date,\n        created_date\n        )\n\n\n as days_to_close,\n        \n    date_trunc(\'month\', close_date)\n = \n    date_trunc(\'month\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_month,\n        \n    date_trunc(\'quarter\', close_date)\n = \n    date_trunc(\'quarter\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_quarter\n     from source\n    )\nselect * from test\nlimit 100', 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 8 at position 0 unexpected 'with'.\n  syntax error line 167 at position 1 unexpected ','.", 'raw_sql': "WITH source AS (\r\n    select * from {{ var('salesforce_schema_name') }}.{{ var('salesforce_opportunity_table_name') }}\r\n    ),\r\n    test as (\r\n     select\r\n        {{ dbt_date.get_date_dimension('2015-01-01', '2022-12-31') }} as date,\r\n        created_date >= {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_created_this_month,\r\n        created_date >= {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_created_this_quarter,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n     from source\r\n    )\r\nselect * from test\nlimit 100", 'compiled_sql': 'WITH source AS (\n    select * from salesforce.opportunity\n    ),\n    test as (\n     select\n        \n    \nwith base_dates as (\n    \nwith date_spine as\n(\n    \n\n    \n\n/*\ncall as follows:\n\ndate_spine(\n    "day",\n    "to_date(\'01/01/2016\', \'mm/dd/yyyy\')",\n    "dateadd(week, 1, current_date)"\n)\n\n*/\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * pow(2, 0)\n     + \n    \n    p1.generated_number * pow(2, 1)\n     + \n    \n    p2.generated_number * pow(2, 2)\n     + \n    \n    p3.generated_number * pow(2, 3)\n     + \n    \n    p4.generated_number * pow(2, 4)\n     + \n    \n    p5.generated_number * pow(2, 5)\n     + \n    \n    p6.generated_number * pow(2, 6)\n     + \n    \n    p7.generated_number * pow(2, 7)\n     + \n    \n    p8.generated_number * pow(2, 8)\n     + \n    \n    p9.generated_number * pow(2, 9)\n     + \n    \n    p10.generated_number * pow(2, 10)\n     + \n    \n    p11.generated_number * pow(2, 11)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 2921\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n  \n\n    dateadd(\n        day,\n        row_number() over (order by 1) - 1,\n        cast(\'2015-01-01\' as datetime)\n        )\n\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast(\'2022-12-31\' as datetime)\n\n)\n\nselect * from filtered\n\n\n\n)\nselect\n    date(d.date_day) as date_day\nfrom\n    date_spine d\n\n),\ndates_with_prior_year_dates as (\n    select\n        cast(d.date_day as date) as date_day,\n        cast(\n  \n\n    dateadd(\n        year,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_year_date_day,\n        cast(\n  \n\n    dateadd(\n        day,\n        -364,\n        d.date_day\n        )\n\n\n as date) as prior_year_over_year_date_day\n    from\n    \tbase_dates d\n)\nselect\n    d.date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        1,\n        d.date_day\n        )\n\n\n as date) as next_date_day,\n    d.prior_year_date_day as prior_year_date_day,\n    d.prior_year_over_year_date_day,\n    cast(\n            case\n                when date_part(\'dayofweek\', d.date_day) = 0 then 7\n                else date_part(\'dayofweek\', d.date_day)\n            end\n        as \n    int\n\n    ) as day_of_week,\n\n    to_char(d.date_day, \'Day\') as day_of_week_name,\n    to_char(d.date_day, \'Dy\') as day_of_week_name_short,\n    cast(date_part(\'day\', d.date_day) as \n    int\n) as day_of_month,\n    cast(date_part(\'dayofyear\', d.date_day) as \n    int\n) as day_of_year,\n\n    cast(\n    date_trunc(\'week\', d.date_day)\n as date) as week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as week_end_date,\n    cast(date_part(\'week\', d.date_day) as \n    int\n) as week_of_year,\n    cast(\n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n as date) as prior_year_week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_week_end_date,\n    cast(date_part(\'week\', d.prior_year_over_year_date_day) as \n    int\n) as prior_year_week_of_year,\n\n    cast(date_part(\'month\', d.date_day) as \n    int\n) as month_of_year,\n    to_char(d.date_day, \'MONTH\')  as month_name,\n    to_char(d.date_day, \'MON\')  as month_name_short,\n\n    cast(\n    date_trunc(\'month\', d.date_day)\n as date) as month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as month_end_date,\n\n    cast(\n    date_trunc(\'month\', d.prior_year_date_day)\n as date) as prior_year_month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.prior_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_month_end_date,\n\n    cast(date_part(\'quarter\', d.date_day) as \n    int\n) as quarter_of_year,\n    cast(\n    date_trunc(\'quarter\', d.date_day)\n as date) as quarter_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        quarter,\n        1,\n        \n    date_trunc(\'quarter\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as quarter_end_date,\n\n    cast(date_part(\'year\', d.date_day) as \n    int\n) as year_number,\n    cast(\n    date_trunc(\'year\', d.date_day)\n as date) as year_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        year,\n        1,\n        \n    date_trunc(\'year\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as year_end_date\nfrom\n    dates_with_prior_year_dates d\norder by 1\n\n as date,\n        created_date >= \n    date_trunc(\'month\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_month,\n        created_date >= \n    date_trunc(\'quarter\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_quarter,\n        \n  \n\n    datediff(\n        day,\n        \n    current_timestamp::\n    timestamp_ntz\n\n,\n        created_date\n        )\n\n\n as days_since_created,\n        \n  \n\n    datediff(\n        day,\n        close_date,\n        created_date\n        )\n\n\n as days_to_close,\n        \n    date_trunc(\'month\', close_date)\n = \n    date_trunc(\'month\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_month,\n        \n    date_trunc(\'quarter\', close_date)\n = \n    date_trunc(\'quarter\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_quarter\n     from source\n    )\nselect * from test\nlimit 100', 'tags': None}, None)
2020-12-02 16:01:16.835966 (Thread-65): handling poll request
2020-12-02 16:01:16.836702 (Thread-65): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f716470>]}
2020-12-02 16:01:16.838459 (Thread-65): sending response (<Response 43554 bytes [200 OK]>) to 10.0.15.0
2020-12-02 16:01:50.220498 (Thread-66): handling status request
2020-12-02 16:01:50.221179 (Thread-66): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f7287f0>]}
2020-12-02 16:01:50.222924 (Thread-66): sending response (<Response 1237 bytes [200 OK]>) to 10.0.16.71
2020-12-02 16:01:50.983136 (Thread-67): handling run_sql request
2020-12-02 16:01:50.983850 (Thread-67): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f7287f0>]}
2020-12-02 16:01:52.799251 (Thread-67): sending response (<Response 137 bytes [200 OK]>) to 10.0.44.113
2020-12-02 16:01:52.847134 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:01:53.025735 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 16:01:53.030467 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:01:53.030690 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 16:01:53.111833 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:01:53.112017 (Thread-1): On rpc.sales_dataflo.request: BEGIN
2020-12-02 16:01:53.112116 (Thread-1): Opening a new connection, currently in state init
2020-12-02 16:01:53.566982 (Thread-68): handling poll request
2020-12-02 16:01:53.567712 (Thread-68): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f7229e8>]}
2020-12-02 16:01:53.579279 (Thread-68): sending response (<Response 2423 bytes [200 OK]>) to 10.0.18.0
2020-12-02 16:01:53.641296 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 16:01:54.311642 (Thread-1): SQL status: SUCCESS 1 in 1.20 seconds
2020-12-02 16:01:54.311878 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:01:54.311991 (Thread-1): On rpc.sales_dataflo.request: select 
  

    datediff(
        day,
        cast('2015-01-01' as datetime),
        cast('2022-12-31' as datetime)
        )
2020-12-02 16:01:54.385838 (Thread-1): SQL status: SUCCESS 1 in 0.07 seconds
2020-12-02 16:01:54.414097 (Thread-1): finished collecting timing info
2020-12-02 16:01:54.423716 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:01:54.423881 (Thread-1): On rpc.sales_dataflo.request: WITH source AS (
    select * from salesforce.opportunity
    ),
    test as (
     select
        
    
with base_dates as (
    
with date_spine as
(
    

    

/*
call as follows:

date_spine(
    "day",
    "to_date('01/01/2016', 'mm/dd/yyyy')",
    "dateadd(week, 1, current_date)"
)

*/

with rawdata as (

    

    

    with p as (
        select 0 as generated_number union all select 1
    ), unioned as (

    select

    
    p0.generated_number * pow(2, 0)
     + 
    
    p1.generated_number * pow(2, 1)
     + 
    
    p2.generated_number * pow(2, 2)
     + 
    
    p3.generated_number * pow(2, 3)
     + 
    
    p4.generated_number * pow(2, 4)
     + 
    
    p5.generated_number * pow(2, 5)
     + 
    
    p6.generated_number * pow(2, 6)
     + 
    
    p7.generated_number * pow(2, 7)
     + 
    
    p8.generated_number * pow(2, 8)
     + 
    
    p9.generated_number * pow(2, 9)
     + 
    
    p10.generated_number * pow(2, 10)
     + 
    
    p11.generated_number * pow(2, 11)
    
    
    + 1
    as generated_number

    from

    
    p as p0
     cross join 
    
    p as p1
     cross join 
    
    p as p2
     cross join 
    
    p as p3
     cross join 
    
    p as p4
     cross join 
    
    p as p5
     cross join 
    
    p as p6
     cross join 
    
    p as p7
     cross join 
    
    p as p8
     cross join 
    
    p as p9
     cross join 
    
    p as p10
     cross join 
    
    p as p11
    
    

    )

    select *
    from unioned
    where generated_number <= 2921
    order by generated_number



),

all_periods as (

    select (
        
  

    dateadd(
        day,
        row_number() over (order by 1) - 1,
        cast('2015-01-01' as datetime)
        )



    ) as date_day
    from rawdata

),

filtered as (

    select *
    from all_periods
    where date_day <= cast('2022-12-31' as datetime)

)

select * from filtered



)
select
    date(d.date_day) as date_day
from
    date_spine d

),
dates_with_prior_year_dates as (
    select
        cast(d.date_day as date) as date_day,
        cast(
  

    dateadd(
        year,
        -1,
        d.date_day
        )


 as date) as prior_year_date_day,
        cast(
  

    dateadd(
        day,
        -364,
        d.date_day
        )


 as date) as prior_year_over_year_date_day
    from
    	base_dates d
)
select
    d.date_day,
    cast(
  

    dateadd(
        day,
        -1,
        d.date_day
        )


 as date) as prior_date_day,
    cast(
  

    dateadd(
        day,
        1,
        d.date_day
        )


 as date) as next_date_day,
    d.prior_year_date_day as prior_year_date_day,
    d.prior_year_over_year_date_day,
    cast(
            case
                when date_part('dayofweek', d.date_day) = 0 then 7
                else date_part('dayofweek', d.date_day)
            end
        as 
    int

    ) as day_of_week,

    to_char(d.date_day, 'Day') as day_of_week_name,
    to_char(d.date_day, 'Dy') as day_of_week_name_short,
    cast(date_part('day', d.date_day) as 
    int
) as day_of_month,
    cast(date_part('dayofyear', d.date_day) as 
    int
) as day_of_year,

    cast(
    date_trunc('week', d.date_day)
 as date) as week_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', d.date_day)

        )



        )



        as date)
 as date) as week_end_date,
    cast(date_part('week', d.date_day) as 
    int
) as week_of_year,
    cast(
    date_trunc('week', d.prior_year_over_year_date_day)
 as date) as prior_year_week_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', d.prior_year_over_year_date_day)

        )



        )



        as date)
 as date) as prior_year_week_end_date,
    cast(date_part('week', d.prior_year_over_year_date_day) as 
    int
) as prior_year_week_of_year,

    cast(date_part('month', d.date_day) as 
    int
) as month_of_year,
    to_char(d.date_day, 'MONTH')  as month_name,
    to_char(d.date_day, 'MON')  as month_name_short,

    cast(
    date_trunc('month', d.date_day)
 as date) as month_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', d.date_day)

        )



        )



        as date)
 as date) as month_end_date,

    cast(
    date_trunc('month', d.prior_year_date_day)
 as date) as prior_year_month_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', d.prior_year_date_day)

        )



        )



        as date)
 as date) as prior_year_month_end_date,

    cast(date_part('quarter', d.date_day) as 
    int
) as quarter_of_year,
    cast(
    date_trunc('quarter', d.date_day)
 as date) as quarter_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        quarter,
        1,
        
    date_trunc('quarter', d.date_day)

        )



        )



        as date)
 as date) as quarter_end_date,

    cast(date_part('year', d.date_day) as 
    int
) as year_number,
    cast(
    date_trunc('year', d.date_day)
 as date) as year_start_date,
    cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        year,
        1,
        
    date_trunc('year', d.date_day)

        )



        )



        as date)
 as date) as year_end_date
from
    dates_with_prior_year_dates d
order by 1

 as is_date,
        created_date >= 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_month,
        created_date >= 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_quarter,
        
  

    datediff(
        day,
        
    current_timestamp::
    timestamp_ntz

,
        created_date
        )


 as days_since_created,
        
  

    datediff(
        day,
        close_date,
        created_date
        )


 as days_to_close,
        
    date_trunc('month', close_date)
 = 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_month,
        
    date_trunc('quarter', close_date)
 = 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_quarter
     from source
    )
select * from test
limit 100
2020-12-02 16:01:54.767506 (Thread-1): Snowflake query id: 0198a981-006a-ea2a-0000-5eb100012022
2020-12-02 16:01:54.767675 (Thread-1): Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 8 at position 0 unexpected 'with'.
syntax error line 167 at position 1 unexpected ','.
2020-12-02 16:01:54.768377 (Thread-1): finished collecting timing info
2020-12-02 16:01:54.769544 (Thread-1): On rpc.sales_dataflo.request: ROLLBACK
2020-12-02 16:01:55.037607 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 16:01:55.120857 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 8 at position 0 unexpected 'with'.
  syntax error line 167 at position 1 unexpected ','.
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 161, in exception_handler
    yield
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/cursor.py", line 597, in execute
    errvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 97, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, errorclass, errorvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 73, in default_errorhandler
    done_format_msg=errorvalue.get(u'done_format_msg'))
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 8 at position 0 unexpected 'with'.
syntax error line 167 at position 1 unexpected ','.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 85, in execute
    compiled_node.injected_sql, fetch=True
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/base/impl.py", line 227, in execute
    fetch=fetch
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 312, in add_query
    abridge_sql_log=abridge_sql_log
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.6/contextlib.py", line 99, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 178, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 8 at position 0 unexpected 'with'.
  syntax error line 167 at position 1 unexpected ','.
2020-12-02 16:01:55.124271 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 8 at position 0 unexpected 'with'.\n  syntax error line 167 at position 1 unexpected ','.", 'raw_sql': "WITH source AS (\r\n    select * from {{ var('salesforce_schema_name') }}.{{ var('salesforce_opportunity_table_name') }}\r\n    ),\r\n    test as (\r\n     select\r\n        {{ dbt_date.get_date_dimension('2015-01-01', '2022-12-31') }} as is_date,\r\n        created_date >= {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_created_this_month,\r\n        created_date >= {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_created_this_quarter,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n     from source\r\n    )\r\nselect * from test\nlimit 100", 'compiled_sql': 'WITH source AS (\n    select * from salesforce.opportunity\n    ),\n    test as (\n     select\n        \n    \nwith base_dates as (\n    \nwith date_spine as\n(\n    \n\n    \n\n/*\ncall as follows:\n\ndate_spine(\n    "day",\n    "to_date(\'01/01/2016\', \'mm/dd/yyyy\')",\n    "dateadd(week, 1, current_date)"\n)\n\n*/\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * pow(2, 0)\n     + \n    \n    p1.generated_number * pow(2, 1)\n     + \n    \n    p2.generated_number * pow(2, 2)\n     + \n    \n    p3.generated_number * pow(2, 3)\n     + \n    \n    p4.generated_number * pow(2, 4)\n     + \n    \n    p5.generated_number * pow(2, 5)\n     + \n    \n    p6.generated_number * pow(2, 6)\n     + \n    \n    p7.generated_number * pow(2, 7)\n     + \n    \n    p8.generated_number * pow(2, 8)\n     + \n    \n    p9.generated_number * pow(2, 9)\n     + \n    \n    p10.generated_number * pow(2, 10)\n     + \n    \n    p11.generated_number * pow(2, 11)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 2921\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n  \n\n    dateadd(\n        day,\n        row_number() over (order by 1) - 1,\n        cast(\'2015-01-01\' as datetime)\n        )\n\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast(\'2022-12-31\' as datetime)\n\n)\n\nselect * from filtered\n\n\n\n)\nselect\n    date(d.date_day) as date_day\nfrom\n    date_spine d\n\n),\ndates_with_prior_year_dates as (\n    select\n        cast(d.date_day as date) as date_day,\n        cast(\n  \n\n    dateadd(\n        year,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_year_date_day,\n        cast(\n  \n\n    dateadd(\n        day,\n        -364,\n        d.date_day\n        )\n\n\n as date) as prior_year_over_year_date_day\n    from\n    \tbase_dates d\n)\nselect\n    d.date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        1,\n        d.date_day\n        )\n\n\n as date) as next_date_day,\n    d.prior_year_date_day as prior_year_date_day,\n    d.prior_year_over_year_date_day,\n    cast(\n            case\n                when date_part(\'dayofweek\', d.date_day) = 0 then 7\n                else date_part(\'dayofweek\', d.date_day)\n            end\n        as \n    int\n\n    ) as day_of_week,\n\n    to_char(d.date_day, \'Day\') as day_of_week_name,\n    to_char(d.date_day, \'Dy\') as day_of_week_name_short,\n    cast(date_part(\'day\', d.date_day) as \n    int\n) as day_of_month,\n    cast(date_part(\'dayofyear\', d.date_day) as \n    int\n) as day_of_year,\n\n    cast(\n    date_trunc(\'week\', d.date_day)\n as date) as week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as week_end_date,\n    cast(date_part(\'week\', d.date_day) as \n    int\n) as week_of_year,\n    cast(\n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n as date) as prior_year_week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_week_end_date,\n    cast(date_part(\'week\', d.prior_year_over_year_date_day) as \n    int\n) as prior_year_week_of_year,\n\n    cast(date_part(\'month\', d.date_day) as \n    int\n) as month_of_year,\n    to_char(d.date_day, \'MONTH\')  as month_name,\n    to_char(d.date_day, \'MON\')  as month_name_short,\n\n    cast(\n    date_trunc(\'month\', d.date_day)\n as date) as month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as month_end_date,\n\n    cast(\n    date_trunc(\'month\', d.prior_year_date_day)\n as date) as prior_year_month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.prior_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_month_end_date,\n\n    cast(date_part(\'quarter\', d.date_day) as \n    int\n) as quarter_of_year,\n    cast(\n    date_trunc(\'quarter\', d.date_day)\n as date) as quarter_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        quarter,\n        1,\n        \n    date_trunc(\'quarter\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as quarter_end_date,\n\n    cast(date_part(\'year\', d.date_day) as \n    int\n) as year_number,\n    cast(\n    date_trunc(\'year\', d.date_day)\n as date) as year_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        year,\n        1,\n        \n    date_trunc(\'year\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as year_end_date\nfrom\n    dates_with_prior_year_dates d\norder by 1\n\n as is_date,\n        created_date >= \n    date_trunc(\'month\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_month,\n        created_date >= \n    date_trunc(\'quarter\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_quarter,\n        \n  \n\n    datediff(\n        day,\n        \n    current_timestamp::\n    timestamp_ntz\n\n,\n        created_date\n        )\n\n\n as days_since_created,\n        \n  \n\n    datediff(\n        day,\n        close_date,\n        created_date\n        )\n\n\n as days_to_close,\n        \n    date_trunc(\'month\', close_date)\n = \n    date_trunc(\'month\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_month,\n        \n    date_trunc(\'quarter\', close_date)\n = \n    date_trunc(\'quarter\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_quarter\n     from source\n    )\nselect * from test\nlimit 100', 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 8 at position 0 unexpected 'with'.\n  syntax error line 167 at position 1 unexpected ','.", 'raw_sql': "WITH source AS (\r\n    select * from {{ var('salesforce_schema_name') }}.{{ var('salesforce_opportunity_table_name') }}\r\n    ),\r\n    test as (\r\n     select\r\n        {{ dbt_date.get_date_dimension('2015-01-01', '2022-12-31') }} as is_date,\r\n        created_date >= {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_created_this_month,\r\n        created_date >= {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_created_this_quarter,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n     from source\r\n    )\r\nselect * from test\nlimit 100", 'compiled_sql': 'WITH source AS (\n    select * from salesforce.opportunity\n    ),\n    test as (\n     select\n        \n    \nwith base_dates as (\n    \nwith date_spine as\n(\n    \n\n    \n\n/*\ncall as follows:\n\ndate_spine(\n    "day",\n    "to_date(\'01/01/2016\', \'mm/dd/yyyy\')",\n    "dateadd(week, 1, current_date)"\n)\n\n*/\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * pow(2, 0)\n     + \n    \n    p1.generated_number * pow(2, 1)\n     + \n    \n    p2.generated_number * pow(2, 2)\n     + \n    \n    p3.generated_number * pow(2, 3)\n     + \n    \n    p4.generated_number * pow(2, 4)\n     + \n    \n    p5.generated_number * pow(2, 5)\n     + \n    \n    p6.generated_number * pow(2, 6)\n     + \n    \n    p7.generated_number * pow(2, 7)\n     + \n    \n    p8.generated_number * pow(2, 8)\n     + \n    \n    p9.generated_number * pow(2, 9)\n     + \n    \n    p10.generated_number * pow(2, 10)\n     + \n    \n    p11.generated_number * pow(2, 11)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n     cross join \n    \n    p as p11\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 2921\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n  \n\n    dateadd(\n        day,\n        row_number() over (order by 1) - 1,\n        cast(\'2015-01-01\' as datetime)\n        )\n\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= cast(\'2022-12-31\' as datetime)\n\n)\n\nselect * from filtered\n\n\n\n)\nselect\n    date(d.date_day) as date_day\nfrom\n    date_spine d\n\n),\ndates_with_prior_year_dates as (\n    select\n        cast(d.date_day as date) as date_day,\n        cast(\n  \n\n    dateadd(\n        year,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_year_date_day,\n        cast(\n  \n\n    dateadd(\n        day,\n        -364,\n        d.date_day\n        )\n\n\n as date) as prior_year_over_year_date_day\n    from\n    \tbase_dates d\n)\nselect\n    d.date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        -1,\n        d.date_day\n        )\n\n\n as date) as prior_date_day,\n    cast(\n  \n\n    dateadd(\n        day,\n        1,\n        d.date_day\n        )\n\n\n as date) as next_date_day,\n    d.prior_year_date_day as prior_year_date_day,\n    d.prior_year_over_year_date_day,\n    cast(\n            case\n                when date_part(\'dayofweek\', d.date_day) = 0 then 7\n                else date_part(\'dayofweek\', d.date_day)\n            end\n        as \n    int\n\n    ) as day_of_week,\n\n    to_char(d.date_day, \'Day\') as day_of_week_name,\n    to_char(d.date_day, \'Dy\') as day_of_week_name_short,\n    cast(date_part(\'day\', d.date_day) as \n    int\n) as day_of_month,\n    cast(date_part(\'dayofyear\', d.date_day) as \n    int\n) as day_of_year,\n\n    cast(\n    date_trunc(\'week\', d.date_day)\n as date) as week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as week_end_date,\n    cast(date_part(\'week\', d.date_day) as \n    int\n) as week_of_year,\n    cast(\n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n as date) as prior_year_week_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc(\'week\', d.prior_year_over_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_week_end_date,\n    cast(date_part(\'week\', d.prior_year_over_year_date_day) as \n    int\n) as prior_year_week_of_year,\n\n    cast(date_part(\'month\', d.date_day) as \n    int\n) as month_of_year,\n    to_char(d.date_day, \'MONTH\')  as month_name,\n    to_char(d.date_day, \'MON\')  as month_name_short,\n\n    cast(\n    date_trunc(\'month\', d.date_day)\n as date) as month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as month_end_date,\n\n    cast(\n    date_trunc(\'month\', d.prior_year_date_day)\n as date) as prior_year_month_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc(\'month\', d.prior_year_date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as prior_year_month_end_date,\n\n    cast(date_part(\'quarter\', d.date_day) as \n    int\n) as quarter_of_year,\n    cast(\n    date_trunc(\'quarter\', d.date_day)\n as date) as quarter_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        quarter,\n        1,\n        \n    date_trunc(\'quarter\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as quarter_end_date,\n\n    cast(date_part(\'year\', d.date_day) as \n    int\n) as year_number,\n    cast(\n    date_trunc(\'year\', d.date_day)\n as date) as year_start_date,\n    cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        year,\n        1,\n        \n    date_trunc(\'year\', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as year_end_date\nfrom\n    dates_with_prior_year_dates d\norder by 1\n\n as is_date,\n        created_date >= \n    date_trunc(\'month\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_month,\n        created_date >= \n    date_trunc(\'quarter\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_quarter,\n        \n  \n\n    datediff(\n        day,\n        \n    current_timestamp::\n    timestamp_ntz\n\n,\n        created_date\n        )\n\n\n as days_since_created,\n        \n  \n\n    datediff(\n        day,\n        close_date,\n        created_date\n        )\n\n\n as days_to_close,\n        \n    date_trunc(\'month\', close_date)\n = \n    date_trunc(\'month\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_month,\n        \n    date_trunc(\'quarter\', close_date)\n = \n    date_trunc(\'quarter\', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_quarter\n     from source\n    )\nselect * from test\nlimit 100', 'tags': None}, None)
2020-12-02 16:01:55.582928 (Thread-69): handling poll request
2020-12-02 16:01:55.583556 (Thread-69): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f7158d0>]}
2020-12-02 16:01:55.585152 (Thread-69): sending response (<Response 43575 bytes [200 OK]>) to 10.0.15.0
2020-12-02 16:36:58.530664 (Thread-70): handling status request
2020-12-02 16:36:58.533089 (Thread-70): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f709668>]}
2020-12-02 16:36:58.534325 (Thread-70): sending response (<Response 1237 bytes [200 OK]>) to 10.0.32.130
2020-12-02 16:36:59.106512 (Thread-71): handling run_sql request
2020-12-02 16:36:59.106996 (Thread-71): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f709668>]}
2020-12-02 16:37:00.201284 (Thread-71): sending response (<Response 137 bytes [200 OK]>) to 10.0.34.197
2020-12-02 16:37:00.228942 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:37:00.271430 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 16:37:00.272084 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:37:00.272285 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 16:37:00.291001 (Thread-1): finished collecting timing info
2020-12-02 16:37:00.291337 (Thread-1): Got an exception: Compilation Error in rpc request (from remote system)
  Required var 'salesforce_calendar_table_name' not found in config:
  Vars supplied to request = {
      "enable_ads_warehouse": false,
      "enable_crm_warehouse": true,
      "enable_finance_warehouse": false,
      "enable_marketing_warehouse": false,
      "enable_product_warehouse": false,
      "enable_projects_warehouse": false,
      "enable_salesforce_source": true,
      "enable_subscriptions_warehouse": false,
      "salesforce_account_table_name": "account",
      "salesforce_case_table_name": "case",
      "salesforce_contact_table_name": "contact",
      "salesforce_crm_etl_name": "fivetran",
      "salesforce_lead_table_name": "lead",
      "salesforce_opportunity_table_name": "opportunity",
      "salesforce_schema_name": "salesforce",
      "salesforce_user_role_table_name": "user_role",
      "salesforce_user_table_name": "user"
  }
  
  > in rpc request (from remote system)
  > called by rpc request (from remote system)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 270, in compile_and_execute
    ctx.node = self.compile(manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 41, in compile
    return compiler.compile_node(self.node, manifest, {}, write=False)
  File "/usr/local/lib/python3.6/dist-packages/dbt/compilation.py", line 479, in compile_node
    node = self._compile_node(node, manifest, extra_context)
  File "/usr/local/lib/python3.6/dist-packages/dbt/compilation.py", line 388, in _compile_node
    node,
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 577, in get_rendered
    return render_template(template, ctx, node)
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 528, in render_template
    return template.render(ctx)
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 1090, in render
    self.environment.handle_exception()
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/lib/python3.6/dist-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<template>", line 2, in top-level template code
  File "/usr/local/lib/python3.6/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.6/dist-packages/dbt/context/base.py", line 148, in __call__
    return self.get_missing_var(var_name)
  File "/usr/local/lib/python3.6/dist-packages/dbt/context/base.py", line 129, in get_missing_var
    raise_compiler_error(msg, self._node)
  File "/usr/local/lib/python3.6/dist-packages/dbt/exceptions.py", line 407, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  Required var 'salesforce_calendar_table_name' not found in config:
  Vars supplied to request = {
      "enable_ads_warehouse": false,
      "enable_crm_warehouse": true,
      "enable_finance_warehouse": false,
      "enable_marketing_warehouse": false,
      "enable_product_warehouse": false,
      "enable_projects_warehouse": false,
      "enable_salesforce_source": true,
      "enable_subscriptions_warehouse": false,
      "salesforce_account_table_name": "account",
      "salesforce_case_table_name": "case",
      "salesforce_contact_table_name": "contact",
      "salesforce_crm_etl_name": "fivetran",
      "salesforce_lead_table_name": "lead",
      "salesforce_opportunity_table_name": "opportunity",
      "salesforce_schema_name": "salesforce",
      "salesforce_user_role_table_name": "user_role",
      "salesforce_user_table_name": "user"
  }
  
  > in rpc request (from remote system)
  > called by rpc request (from remote system)
2020-12-02 16:37:00.293007 (Thread-1): Got exception RPCException(10004, Compilation Error, {'type': 'CompilationException', 'message': 'Compilation Error in rpc request (from remote system)\n  Required var \'salesforce_calendar_table_name\' not found in config:\n  Vars supplied to request = {\n      "enable_ads_warehouse": false,\n      "enable_crm_warehouse": true,\n      "enable_finance_warehouse": false,\n      "enable_marketing_warehouse": false,\n      "enable_product_warehouse": false,\n      "enable_projects_warehouse": false,\n      "enable_salesforce_source": true,\n      "enable_subscriptions_warehouse": false,\n      "salesforce_account_table_name": "account",\n      "salesforce_case_table_name": "case",\n      "salesforce_contact_table_name": "contact",\n      "salesforce_crm_etl_name": "fivetran",\n      "salesforce_lead_table_name": "lead",\n      "salesforce_opportunity_table_name": "opportunity",\n      "salesforce_schema_name": "salesforce",\n      "salesforce_user_role_table_name": "user_role",\n      "salesforce_user_table_name": "user"\n  }\n  \n  > in rpc request (from remote system)\n  > called by rpc request (from remote system)', 'raw_sql': "WITH source AS (\r\n    select * from {{ var('salesforce_schema_name') }}.{{ var('salesforce_calendar_table_name') }}\r\n    ),\r\n    test as (\r\n     select\r\n        created_date >= {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_created_this_month,\r\n        created_date >= {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_created_this_quarter,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n     from source\r\n    )\r\nselect * from test\nlimit 100", 'compiled_sql': None, 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10004, Compilation Error, {'type': 'CompilationException', 'message': 'Compilation Error in rpc request (from remote system)\n  Required var \'salesforce_calendar_table_name\' not found in config:\n  Vars supplied to request = {\n      "enable_ads_warehouse": false,\n      "enable_crm_warehouse": true,\n      "enable_finance_warehouse": false,\n      "enable_marketing_warehouse": false,\n      "enable_product_warehouse": false,\n      "enable_projects_warehouse": false,\n      "enable_salesforce_source": true,\n      "enable_subscriptions_warehouse": false,\n      "salesforce_account_table_name": "account",\n      "salesforce_case_table_name": "case",\n      "salesforce_contact_table_name": "contact",\n      "salesforce_crm_etl_name": "fivetran",\n      "salesforce_lead_table_name": "lead",\n      "salesforce_opportunity_table_name": "opportunity",\n      "salesforce_schema_name": "salesforce",\n      "salesforce_user_role_table_name": "user_role",\n      "salesforce_user_table_name": "user"\n  }\n  \n  > in rpc request (from remote system)\n  > called by rpc request (from remote system)', 'raw_sql': "WITH source AS (\r\n    select * from {{ var('salesforce_schema_name') }}.{{ var('salesforce_calendar_table_name') }}\r\n    ),\r\n    test as (\r\n     select\r\n        created_date >= {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_created_this_month,\r\n        created_date >= {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_created_this_quarter,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n     from source\r\n    )\r\nselect * from test\nlimit 100", 'compiled_sql': None, 'tags': None}, None)
2020-12-02 16:37:00.857147 (Thread-72): handling poll request
2020-12-02 16:37:00.857684 (Thread-72): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6a11d0>]}
2020-12-02 16:37:00.859133 (Thread-72): sending response (<Response 13838 bytes [200 OK]>) to 10.0.32.18
2020-12-02 16:38:41.360564 (Thread-73): handling status request
2020-12-02 16:38:41.362748 (Thread-73): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6af860>]}
2020-12-02 16:38:41.365633 (Thread-73): sending response (<Response 1237 bytes [200 OK]>) to 10.0.8.143
2020-12-02 16:38:41.940216 (Thread-74): handling run_sql request
2020-12-02 16:38:41.940914 (Thread-74): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f728978>]}
2020-12-02 16:38:42.986628 (Thread-74): sending response (<Response 137 bytes [200 OK]>) to 10.0.44.113
2020-12-02 16:38:43.013792 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:38:43.054374 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 16:38:43.054980 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:38:43.055129 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 16:38:43.073279 (Thread-1): finished collecting timing info
2020-12-02 16:38:43.073617 (Thread-1): Got an exception: Compilation Error in rpc request (from remote system)
  Required var 'salesforce_calendar' not found in config:
  Vars supplied to request = {
      "enable_ads_warehouse": false,
      "enable_crm_warehouse": true,
      "enable_finance_warehouse": false,
      "enable_marketing_warehouse": false,
      "enable_product_warehouse": false,
      "enable_projects_warehouse": false,
      "enable_salesforce_source": true,
      "enable_subscriptions_warehouse": false,
      "salesforce_account_table_name": "account",
      "salesforce_case_table_name": "case",
      "salesforce_contact_table_name": "contact",
      "salesforce_crm_etl_name": "fivetran",
      "salesforce_lead_table_name": "lead",
      "salesforce_opportunity_table_name": "opportunity",
      "salesforce_schema_name": "salesforce",
      "salesforce_user_role_table_name": "user_role",
      "salesforce_user_table_name": "user"
  }
  
  > in rpc request (from remote system)
  > called by rpc request (from remote system)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 270, in compile_and_execute
    ctx.node = self.compile(manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 41, in compile
    return compiler.compile_node(self.node, manifest, {}, write=False)
  File "/usr/local/lib/python3.6/dist-packages/dbt/compilation.py", line 479, in compile_node
    node = self._compile_node(node, manifest, extra_context)
  File "/usr/local/lib/python3.6/dist-packages/dbt/compilation.py", line 388, in _compile_node
    node,
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 577, in get_rendered
    return render_template(template, ctx, node)
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 528, in render_template
    return template.render(ctx)
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 1090, in render
    self.environment.handle_exception()
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/lib/python3.6/dist-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<template>", line 2, in top-level template code
  File "/usr/local/lib/python3.6/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.6/dist-packages/dbt/context/base.py", line 148, in __call__
    return self.get_missing_var(var_name)
  File "/usr/local/lib/python3.6/dist-packages/dbt/context/base.py", line 129, in get_missing_var
    raise_compiler_error(msg, self._node)
  File "/usr/local/lib/python3.6/dist-packages/dbt/exceptions.py", line 407, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  Required var 'salesforce_calendar' not found in config:
  Vars supplied to request = {
      "enable_ads_warehouse": false,
      "enable_crm_warehouse": true,
      "enable_finance_warehouse": false,
      "enable_marketing_warehouse": false,
      "enable_product_warehouse": false,
      "enable_projects_warehouse": false,
      "enable_salesforce_source": true,
      "enable_subscriptions_warehouse": false,
      "salesforce_account_table_name": "account",
      "salesforce_case_table_name": "case",
      "salesforce_contact_table_name": "contact",
      "salesforce_crm_etl_name": "fivetran",
      "salesforce_lead_table_name": "lead",
      "salesforce_opportunity_table_name": "opportunity",
      "salesforce_schema_name": "salesforce",
      "salesforce_user_role_table_name": "user_role",
      "salesforce_user_table_name": "user"
  }
  
  > in rpc request (from remote system)
  > called by rpc request (from remote system)
2020-12-02 16:38:43.075358 (Thread-1): Got exception RPCException(10004, Compilation Error, {'type': 'CompilationException', 'message': 'Compilation Error in rpc request (from remote system)\n  Required var \'salesforce_calendar\' not found in config:\n  Vars supplied to request = {\n      "enable_ads_warehouse": false,\n      "enable_crm_warehouse": true,\n      "enable_finance_warehouse": false,\n      "enable_marketing_warehouse": false,\n      "enable_product_warehouse": false,\n      "enable_projects_warehouse": false,\n      "enable_salesforce_source": true,\n      "enable_subscriptions_warehouse": false,\n      "salesforce_account_table_name": "account",\n      "salesforce_case_table_name": "case",\n      "salesforce_contact_table_name": "contact",\n      "salesforce_crm_etl_name": "fivetran",\n      "salesforce_lead_table_name": "lead",\n      "salesforce_opportunity_table_name": "opportunity",\n      "salesforce_schema_name": "salesforce",\n      "salesforce_user_role_table_name": "user_role",\n      "salesforce_user_table_name": "user"\n  }\n  \n  > in rpc request (from remote system)\n  > called by rpc request (from remote system)', 'raw_sql': "WITH source AS (\r\n    select * from {{ var('salesforce_schema_name') }}.{{ var('salesforce_calendar') }}\r\n    ),\r\n    test as (\r\n     select\r\n        created_date >= {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_created_this_month,\r\n        created_date >= {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_created_this_quarter,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n     from source\r\n    )\r\nselect * from test\nlimit 100", 'compiled_sql': None, 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10004, Compilation Error, {'type': 'CompilationException', 'message': 'Compilation Error in rpc request (from remote system)\n  Required var \'salesforce_calendar\' not found in config:\n  Vars supplied to request = {\n      "enable_ads_warehouse": false,\n      "enable_crm_warehouse": true,\n      "enable_finance_warehouse": false,\n      "enable_marketing_warehouse": false,\n      "enable_product_warehouse": false,\n      "enable_projects_warehouse": false,\n      "enable_salesforce_source": true,\n      "enable_subscriptions_warehouse": false,\n      "salesforce_account_table_name": "account",\n      "salesforce_case_table_name": "case",\n      "salesforce_contact_table_name": "contact",\n      "salesforce_crm_etl_name": "fivetran",\n      "salesforce_lead_table_name": "lead",\n      "salesforce_opportunity_table_name": "opportunity",\n      "salesforce_schema_name": "salesforce",\n      "salesforce_user_role_table_name": "user_role",\n      "salesforce_user_table_name": "user"\n  }\n  \n  > in rpc request (from remote system)\n  > called by rpc request (from remote system)', 'raw_sql': "WITH source AS (\r\n    select * from {{ var('salesforce_schema_name') }}.{{ var('salesforce_calendar') }}\r\n    ),\r\n    test as (\r\n     select\r\n        created_date >= {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_created_this_month,\r\n        created_date >= {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_created_this_quarter,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n     from source\r\n    )\r\nselect * from test\nlimit 100", 'compiled_sql': None, 'tags': None}, None)
2020-12-02 16:38:43.697120 (Thread-75): handling poll request
2020-12-02 16:38:43.697666 (Thread-75): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f728978>]}
2020-12-02 16:38:43.699198 (Thread-75): sending response (<Response 13750 bytes [200 OK]>) to 10.0.21.144
2020-12-02 16:38:56.996643 (Thread-76): handling status request
2020-12-02 16:38:56.997138 (Thread-76): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6b6128>]}
2020-12-02 16:38:56.998392 (Thread-76): sending response (<Response 1237 bytes [200 OK]>) to 10.0.23.203
2020-12-02 16:38:57.663969 (Thread-77): handling run_sql request
2020-12-02 16:38:57.664508 (Thread-77): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6b6128>]}
2020-12-02 16:38:58.697758 (Thread-77): sending response (<Response 137 bytes [200 OK]>) to 10.0.42.75
2020-12-02 16:38:58.724873 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:38:58.763001 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 16:38:58.763687 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:38:58.763895 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 16:38:58.794978 (Thread-1): finished collecting timing info
2020-12-02 16:38:58.795448 (Thread-1): Got an exception: Compilation Error in rpc request (from remote system)
  Required var 'calendar' not found in config:
  Vars supplied to request = {
      "enable_ads_warehouse": false,
      "enable_crm_warehouse": true,
      "enable_finance_warehouse": false,
      "enable_marketing_warehouse": false,
      "enable_product_warehouse": false,
      "enable_projects_warehouse": false,
      "enable_salesforce_source": true,
      "enable_subscriptions_warehouse": false,
      "salesforce_account_table_name": "account",
      "salesforce_case_table_name": "case",
      "salesforce_contact_table_name": "contact",
      "salesforce_crm_etl_name": "fivetran",
      "salesforce_lead_table_name": "lead",
      "salesforce_opportunity_table_name": "opportunity",
      "salesforce_schema_name": "salesforce",
      "salesforce_user_role_table_name": "user_role",
      "salesforce_user_table_name": "user"
  }
  
  > in rpc request (from remote system)
  > called by rpc request (from remote system)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 270, in compile_and_execute
    ctx.node = self.compile(manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 41, in compile
    return compiler.compile_node(self.node, manifest, {}, write=False)
  File "/usr/local/lib/python3.6/dist-packages/dbt/compilation.py", line 479, in compile_node
    node = self._compile_node(node, manifest, extra_context)
  File "/usr/local/lib/python3.6/dist-packages/dbt/compilation.py", line 388, in _compile_node
    node,
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 577, in get_rendered
    return render_template(template, ctx, node)
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 528, in render_template
    return template.render(ctx)
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 1090, in render
    self.environment.handle_exception()
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/lib/python3.6/dist-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<template>", line 2, in top-level template code
  File "/usr/local/lib/python3.6/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.6/dist-packages/dbt/context/base.py", line 148, in __call__
    return self.get_missing_var(var_name)
  File "/usr/local/lib/python3.6/dist-packages/dbt/context/base.py", line 129, in get_missing_var
    raise_compiler_error(msg, self._node)
  File "/usr/local/lib/python3.6/dist-packages/dbt/exceptions.py", line 407, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  Required var 'calendar' not found in config:
  Vars supplied to request = {
      "enable_ads_warehouse": false,
      "enable_crm_warehouse": true,
      "enable_finance_warehouse": false,
      "enable_marketing_warehouse": false,
      "enable_product_warehouse": false,
      "enable_projects_warehouse": false,
      "enable_salesforce_source": true,
      "enable_subscriptions_warehouse": false,
      "salesforce_account_table_name": "account",
      "salesforce_case_table_name": "case",
      "salesforce_contact_table_name": "contact",
      "salesforce_crm_etl_name": "fivetran",
      "salesforce_lead_table_name": "lead",
      "salesforce_opportunity_table_name": "opportunity",
      "salesforce_schema_name": "salesforce",
      "salesforce_user_role_table_name": "user_role",
      "salesforce_user_table_name": "user"
  }
  
  > in rpc request (from remote system)
  > called by rpc request (from remote system)
2020-12-02 16:38:58.797216 (Thread-1): Got exception RPCException(10004, Compilation Error, {'type': 'CompilationException', 'message': 'Compilation Error in rpc request (from remote system)\n  Required var \'calendar\' not found in config:\n  Vars supplied to request = {\n      "enable_ads_warehouse": false,\n      "enable_crm_warehouse": true,\n      "enable_finance_warehouse": false,\n      "enable_marketing_warehouse": false,\n      "enable_product_warehouse": false,\n      "enable_projects_warehouse": false,\n      "enable_salesforce_source": true,\n      "enable_subscriptions_warehouse": false,\n      "salesforce_account_table_name": "account",\n      "salesforce_case_table_name": "case",\n      "salesforce_contact_table_name": "contact",\n      "salesforce_crm_etl_name": "fivetran",\n      "salesforce_lead_table_name": "lead",\n      "salesforce_opportunity_table_name": "opportunity",\n      "salesforce_schema_name": "salesforce",\n      "salesforce_user_role_table_name": "user_role",\n      "salesforce_user_table_name": "user"\n  }\n  \n  > in rpc request (from remote system)\n  > called by rpc request (from remote system)', 'raw_sql': "WITH source AS (\r\n    select * from {{ var('salesforce_schema_name') }}.{{ var('calendar') }}\r\n    ),\r\n    test as (\r\n     select\r\n        created_date >= {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_created_this_month,\r\n        created_date >= {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_created_this_quarter,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n     from source\r\n    )\r\nselect * from test\nlimit 100", 'compiled_sql': None, 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10004, Compilation Error, {'type': 'CompilationException', 'message': 'Compilation Error in rpc request (from remote system)\n  Required var \'calendar\' not found in config:\n  Vars supplied to request = {\n      "enable_ads_warehouse": false,\n      "enable_crm_warehouse": true,\n      "enable_finance_warehouse": false,\n      "enable_marketing_warehouse": false,\n      "enable_product_warehouse": false,\n      "enable_projects_warehouse": false,\n      "enable_salesforce_source": true,\n      "enable_subscriptions_warehouse": false,\n      "salesforce_account_table_name": "account",\n      "salesforce_case_table_name": "case",\n      "salesforce_contact_table_name": "contact",\n      "salesforce_crm_etl_name": "fivetran",\n      "salesforce_lead_table_name": "lead",\n      "salesforce_opportunity_table_name": "opportunity",\n      "salesforce_schema_name": "salesforce",\n      "salesforce_user_role_table_name": "user_role",\n      "salesforce_user_table_name": "user"\n  }\n  \n  > in rpc request (from remote system)\n  > called by rpc request (from remote system)', 'raw_sql': "WITH source AS (\r\n    select * from {{ var('salesforce_schema_name') }}.{{ var('calendar') }}\r\n    ),\r\n    test as (\r\n     select\r\n        created_date >= {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_created_this_month,\r\n        created_date >= {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_created_this_quarter,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n     from source\r\n    )\r\nselect * from test\nlimit 100", 'compiled_sql': None, 'tags': None}, None)
2020-12-02 16:38:59.241876 (Thread-78): handling poll request
2020-12-02 16:38:59.242427 (Thread-78): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6b6128>]}
2020-12-02 16:38:59.243843 (Thread-78): sending response (<Response 13662 bytes [200 OK]>) to 10.0.42.75
2020-12-02 16:43:07.422586 (Thread-79): handling status request
2020-12-02 16:43:07.424534 (Thread-79): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6a6128>]}
2020-12-02 16:43:07.426019 (Thread-79): sending response (<Response 1237 bytes [200 OK]>) to 10.0.44.113
2020-12-02 16:43:07.993087 (Thread-80): handling run_sql request
2020-12-02 16:43:07.993569 (Thread-80): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6b6710>]}
2020-12-02 16:43:09.052131 (Thread-80): sending response (<Response 137 bytes [200 OK]>) to 10.0.8.143
2020-12-02 16:43:09.081814 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:43:09.124895 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 16:43:09.125475 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:43:09.125625 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 16:43:09.148065 (Thread-1): finished collecting timing info
2020-12-02 16:43:09.149137 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:43:09.149217 (Thread-1): On rpc.sales_dataflo.request: WITH Test as (
     
        created_date >= 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_month,
        created_date >= 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_quarter,
        
  

    datediff(
        day,
        
    current_timestamp::
    timestamp_ntz

,
        created_date
        )


 as days_since_created,
        
  

    datediff(
        day,
        close_date,
        created_date
        )


 as days_to_close,
        
    date_trunc('month', close_date)
 = 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_month,
        
    date_trunc('quarter', close_date)
 = 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_quarter
     
    )
select * from test
limit 100
2020-12-02 16:43:09.149279 (Thread-1): Opening a new connection, currently in state init
2020-12-02 16:43:09.343610 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 16:43:09.632840 (Thread-81): handling poll request
2020-12-02 16:43:09.633473 (Thread-81): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6a6630>]}
2020-12-02 16:43:09.636537 (Thread-81): sending response (<Response 3759 bytes [200 OK]>) to 10.0.23.203
2020-12-02 16:43:09.787496 (Thread-1): Snowflake query id: 0198a9ab-0050-03cd-0000-5eb100012036
2020-12-02 16:43:09.787647 (Thread-1): Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 9 at position 1 unexpected 'as'.
syntax error line 10 at position 21 unexpected '>='.
syntax error line 11 at position 15 unexpected ''quarter''.
syntax error line 16 at position 1 unexpected 'as'.
2020-12-02 16:43:09.787797 (Thread-1): finished collecting timing info
2020-12-02 16:43:09.788347 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 16:43:09.839010 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 9 at position 1 unexpected 'as'.
  syntax error line 10 at position 21 unexpected '>='.
  syntax error line 11 at position 15 unexpected ''quarter''.
  syntax error line 16 at position 1 unexpected 'as'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 161, in exception_handler
    yield
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/cursor.py", line 597, in execute
    errvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 97, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, errorclass, errorvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 73, in default_errorhandler
    done_format_msg=errorvalue.get(u'done_format_msg'))
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 9 at position 1 unexpected 'as'.
syntax error line 10 at position 21 unexpected '>='.
syntax error line 11 at position 15 unexpected ''quarter''.
syntax error line 16 at position 1 unexpected 'as'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 85, in execute
    compiled_node.injected_sql, fetch=True
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/base/impl.py", line 227, in execute
    fetch=fetch
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 312, in add_query
    abridge_sql_log=abridge_sql_log
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.6/contextlib.py", line 99, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 178, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 9 at position 1 unexpected 'as'.
  syntax error line 10 at position 21 unexpected '>='.
  syntax error line 11 at position 15 unexpected ''quarter''.
  syntax error line 16 at position 1 unexpected 'as'.
2020-12-02 16:43:09.840427 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 9 at position 1 unexpected 'as'.\n  syntax error line 10 at position 21 unexpected '>='.\n  syntax error line 11 at position 15 unexpected ''quarter''.\n  syntax error line 16 at position 1 unexpected 'as'.", 'raw_sql': "WITH Test as (\r\n     \r\n        created_date >= {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_created_this_month,\r\n        created_date >= {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_created_this_quarter,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n     \r\n    )\r\nselect * from test\nlimit 100", 'compiled_sql': "WITH Test as (\n     \n        created_date >= \n    date_trunc('month', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_month,\n        created_date >= \n    date_trunc('quarter', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_quarter,\n        \n  \n\n    datediff(\n        day,\n        \n    current_timestamp::\n    timestamp_ntz\n\n,\n        created_date\n        )\n\n\n as days_since_created,\n        \n  \n\n    datediff(\n        day,\n        close_date,\n        created_date\n        )\n\n\n as days_to_close,\n        \n    date_trunc('month', close_date)\n = \n    date_trunc('month', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_month,\n        \n    date_trunc('quarter', close_date)\n = \n    date_trunc('quarter', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_quarter\n     \n    )\nselect * from test\nlimit 100", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 9 at position 1 unexpected 'as'.\n  syntax error line 10 at position 21 unexpected '>='.\n  syntax error line 11 at position 15 unexpected ''quarter''.\n  syntax error line 16 at position 1 unexpected 'as'.", 'raw_sql': "WITH Test as (\r\n     \r\n        created_date >= {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_created_this_month,\r\n        created_date >= {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_created_this_quarter,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n     \r\n    )\r\nselect * from test\nlimit 100", 'compiled_sql': "WITH Test as (\n     \n        created_date >= \n    date_trunc('month', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_month,\n        created_date >= \n    date_trunc('quarter', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_quarter,\n        \n  \n\n    datediff(\n        day,\n        \n    current_timestamp::\n    timestamp_ntz\n\n,\n        created_date\n        )\n\n\n as days_since_created,\n        \n  \n\n    datediff(\n        day,\n        close_date,\n        created_date\n        )\n\n\n as days_to_close,\n        \n    date_trunc('month', close_date)\n = \n    date_trunc('month', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_month,\n        \n    date_trunc('quarter', close_date)\n = \n    date_trunc('quarter', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_quarter\n     \n    )\nselect * from test\nlimit 100", 'tags': None}, None)
2020-12-02 16:43:11.395960 (Thread-82): handling poll request
2020-12-02 16:43:11.396456 (Thread-82): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6a84a8>]}
2020-12-02 16:43:11.397439 (Thread-82): sending response (<Response 15958 bytes [200 OK]>) to 10.0.21.144
2020-12-02 16:43:29.100792 (Thread-83): handling status request
2020-12-02 16:43:29.101294 (Thread-83): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f699860>]}
2020-12-02 16:43:29.102494 (Thread-83): sending response (<Response 1237 bytes [200 OK]>) to 10.0.0.188
2020-12-02 16:43:29.687133 (Thread-84): handling run_sql request
2020-12-02 16:43:29.687638 (Thread-84): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f699860>]}
2020-12-02 16:43:30.733144 (Thread-84): sending response (<Response 137 bytes [200 OK]>) to 10.0.21.144
2020-12-02 16:43:30.760687 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:43:30.799715 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 16:43:30.800403 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:43:30.800601 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 16:43:30.822057 (Thread-1): finished collecting timing info
2020-12-02 16:43:30.823106 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 16:43:30.823182 (Thread-1): On rpc.sales_dataflo.request: WITH Test as (
             created_date >= 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_month,
        created_date >= 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_quarter,
        
  

    datediff(
        day,
        
    current_timestamp::
    timestamp_ntz

,
        created_date
        )


 as days_since_created,
        
  

    datediff(
        day,
        close_date,
        created_date
        )


 as days_to_close,
        
    date_trunc('month', close_date)
 = 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_month,
        
    date_trunc('quarter', close_date)
 = 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_quarter
        )
select * from Test
limit 100
2020-12-02 16:43:30.823244 (Thread-1): Opening a new connection, currently in state init
2020-12-02 16:43:31.001210 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 16:43:31.374493 (Thread-85): handling poll request
2020-12-02 16:43:31.375339 (Thread-85): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f683128>]}
2020-12-02 16:43:31.377788 (Thread-85): sending response (<Response 3754 bytes [200 OK]>) to 10.0.23.203
2020-12-02 16:43:31.495637 (Thread-1): Snowflake query id: 0198a9ab-00d5-565c-0000-5eb10001203a
2020-12-02 16:43:31.495832 (Thread-1): Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 8 at position 1 unexpected 'as'.
syntax error line 9 at position 21 unexpected '>='.
syntax error line 10 at position 15 unexpected ''quarter''.
syntax error line 15 at position 1 unexpected 'as'.
2020-12-02 16:43:31.496032 (Thread-1): finished collecting timing info
2020-12-02 16:43:31.496704 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 16:43:31.548758 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 8 at position 1 unexpected 'as'.
  syntax error line 9 at position 21 unexpected '>='.
  syntax error line 10 at position 15 unexpected ''quarter''.
  syntax error line 15 at position 1 unexpected 'as'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 161, in exception_handler
    yield
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/cursor.py", line 597, in execute
    errvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 97, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, errorclass, errorvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 73, in default_errorhandler
    done_format_msg=errorvalue.get(u'done_format_msg'))
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 8 at position 1 unexpected 'as'.
syntax error line 9 at position 21 unexpected '>='.
syntax error line 10 at position 15 unexpected ''quarter''.
syntax error line 15 at position 1 unexpected 'as'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 85, in execute
    compiled_node.injected_sql, fetch=True
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/base/impl.py", line 227, in execute
    fetch=fetch
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 312, in add_query
    abridge_sql_log=abridge_sql_log
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.6/contextlib.py", line 99, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 178, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 8 at position 1 unexpected 'as'.
  syntax error line 9 at position 21 unexpected '>='.
  syntax error line 10 at position 15 unexpected ''quarter''.
  syntax error line 15 at position 1 unexpected 'as'.
2020-12-02 16:43:31.550233 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 8 at position 1 unexpected 'as'.\n  syntax error line 9 at position 21 unexpected '>='.\n  syntax error line 10 at position 15 unexpected ''quarter''.\n  syntax error line 15 at position 1 unexpected 'as'.", 'raw_sql': "WITH Test as (\r\n             created_date >= {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_created_this_month,\r\n        created_date >= {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_created_this_quarter,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n        )\r\nselect * from Test\nlimit 100", 'compiled_sql': "WITH Test as (\n             created_date >= \n    date_trunc('month', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_month,\n        created_date >= \n    date_trunc('quarter', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_quarter,\n        \n  \n\n    datediff(\n        day,\n        \n    current_timestamp::\n    timestamp_ntz\n\n,\n        created_date\n        )\n\n\n as days_since_created,\n        \n  \n\n    datediff(\n        day,\n        close_date,\n        created_date\n        )\n\n\n as days_to_close,\n        \n    date_trunc('month', close_date)\n = \n    date_trunc('month', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_month,\n        \n    date_trunc('quarter', close_date)\n = \n    date_trunc('quarter', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_quarter\n        )\nselect * from Test\nlimit 100", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 8 at position 1 unexpected 'as'.\n  syntax error line 9 at position 21 unexpected '>='.\n  syntax error line 10 at position 15 unexpected ''quarter''.\n  syntax error line 15 at position 1 unexpected 'as'.", 'raw_sql': "WITH Test as (\r\n             created_date >= {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_created_this_month,\r\n        created_date >= {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_created_this_quarter,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n        )\r\nselect * from Test\nlimit 100", 'compiled_sql': "WITH Test as (\n             created_date >= \n    date_trunc('month', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_month,\n        created_date >= \n    date_trunc('quarter', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_created_this_quarter,\n        \n  \n\n    datediff(\n        day,\n        \n    current_timestamp::\n    timestamp_ntz\n\n,\n        created_date\n        )\n\n\n as days_since_created,\n        \n  \n\n    datediff(\n        day,\n        close_date,\n        created_date\n        )\n\n\n as days_to_close,\n        \n    date_trunc('month', close_date)\n = \n    date_trunc('month', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_month,\n        \n    date_trunc('quarter', close_date)\n = \n    date_trunc('quarter', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_quarter\n        )\nselect * from Test\nlimit 100", 'tags': None}, None)
2020-12-02 16:43:32.928149 (Thread-86): handling poll request
2020-12-02 16:43:32.928649 (Thread-86): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f6a8710>]}
2020-12-02 16:43:32.929622 (Thread-86): sending response (<Response 15892 bytes [200 OK]>) to 10.0.23.203
2020-12-02 17:09:56.013006 (Thread-87): handling status request
2020-12-02 17:09:56.014982 (Thread-87): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce6407b9e8>]}
2020-12-02 17:09:56.016156 (Thread-87): sending response (<Response 1237 bytes [200 OK]>) to 10.0.16.71
2020-12-02 17:09:56.557207 (Thread-88): handling run_sql request
2020-12-02 17:09:56.557695 (Thread-88): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce6407b9e8>]}
2020-12-02 17:09:57.634911 (Thread-88): sending response (<Response 137 bytes [200 OK]>) to 10.0.32.18
2020-12-02 17:09:57.661906 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:09:57.704675 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 17:09:57.705181 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:09:57.705319 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 17:09:57.723556 (Thread-1): finished collecting timing info
2020-12-02 17:09:57.723896 (Thread-1): Got an exception: Compilation Error in rpc request (from remote system)
  Required var 'salesforce_calendar_table_name' not found in config:
  Vars supplied to request = {
      "enable_ads_warehouse": false,
      "enable_crm_warehouse": true,
      "enable_finance_warehouse": false,
      "enable_marketing_warehouse": false,
      "enable_product_warehouse": false,
      "enable_projects_warehouse": false,
      "enable_salesforce_source": true,
      "enable_subscriptions_warehouse": false,
      "salesforce_account_table_name": "account",
      "salesforce_case_table_name": "case",
      "salesforce_contact_table_name": "contact",
      "salesforce_crm_etl_name": "fivetran",
      "salesforce_lead_table_name": "lead",
      "salesforce_opportunity_table_name": "opportunity",
      "salesforce_schema_name": "salesforce",
      "salesforce_user_role_table_name": "user_role",
      "salesforce_user_table_name": "user"
  }
  
  > in rpc request (from remote system)
  > called by rpc request (from remote system)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 270, in compile_and_execute
    ctx.node = self.compile(manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 41, in compile
    return compiler.compile_node(self.node, manifest, {}, write=False)
  File "/usr/local/lib/python3.6/dist-packages/dbt/compilation.py", line 479, in compile_node
    node = self._compile_node(node, manifest, extra_context)
  File "/usr/local/lib/python3.6/dist-packages/dbt/compilation.py", line 388, in _compile_node
    node,
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 577, in get_rendered
    return render_template(template, ctx, node)
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 528, in render_template
    return template.render(ctx)
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 1090, in render
    self.environment.handle_exception()
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/lib/python3.6/dist-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<template>", line 2, in top-level template code
  File "/usr/local/lib/python3.6/dist-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.6/dist-packages/dbt/context/base.py", line 148, in __call__
    return self.get_missing_var(var_name)
  File "/usr/local/lib/python3.6/dist-packages/dbt/context/base.py", line 129, in get_missing_var
    raise_compiler_error(msg, self._node)
  File "/usr/local/lib/python3.6/dist-packages/dbt/exceptions.py", line 407, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  Required var 'salesforce_calendar_table_name' not found in config:
  Vars supplied to request = {
      "enable_ads_warehouse": false,
      "enable_crm_warehouse": true,
      "enable_finance_warehouse": false,
      "enable_marketing_warehouse": false,
      "enable_product_warehouse": false,
      "enable_projects_warehouse": false,
      "enable_salesforce_source": true,
      "enable_subscriptions_warehouse": false,
      "salesforce_account_table_name": "account",
      "salesforce_case_table_name": "case",
      "salesforce_contact_table_name": "contact",
      "salesforce_crm_etl_name": "fivetran",
      "salesforce_lead_table_name": "lead",
      "salesforce_opportunity_table_name": "opportunity",
      "salesforce_schema_name": "salesforce",
      "salesforce_user_role_table_name": "user_role",
      "salesforce_user_table_name": "user"
  }
  
  > in rpc request (from remote system)
  > called by rpc request (from remote system)
2020-12-02 17:09:57.725462 (Thread-1): Got exception RPCException(10004, Compilation Error, {'type': 'CompilationException', 'message': 'Compilation Error in rpc request (from remote system)\n  Required var \'salesforce_calendar_table_name\' not found in config:\n  Vars supplied to request = {\n      "enable_ads_warehouse": false,\n      "enable_crm_warehouse": true,\n      "enable_finance_warehouse": false,\n      "enable_marketing_warehouse": false,\n      "enable_product_warehouse": false,\n      "enable_projects_warehouse": false,\n      "enable_salesforce_source": true,\n      "enable_subscriptions_warehouse": false,\n      "salesforce_account_table_name": "account",\n      "salesforce_case_table_name": "case",\n      "salesforce_contact_table_name": "contact",\n      "salesforce_crm_etl_name": "fivetran",\n      "salesforce_lead_table_name": "lead",\n      "salesforce_opportunity_table_name": "opportunity",\n      "salesforce_schema_name": "salesforce",\n      "salesforce_user_role_table_name": "user_role",\n      "salesforce_user_table_name": "user"\n  }\n  \n  > in rpc request (from remote system)\n  > called by rpc request (from remote system)', 'raw_sql': "WITH source AS (\r\n    select * from {{ var('salesforce_schema_name') }}.{{ var('salesforce_calendar_table_name') }}\r\n    ),\r\n    test as (\r\n        select\r\n        {{ dbt_utils.current_timestamp() }}  as cldr_date,\r\n        created_date >= {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_created_this_month,\r\n        created_date >= {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_created_this_quarter,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n     from source\r\n    )\r\nselect * from test\nlimit 100", 'compiled_sql': None, 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10004, Compilation Error, {'type': 'CompilationException', 'message': 'Compilation Error in rpc request (from remote system)\n  Required var \'salesforce_calendar_table_name\' not found in config:\n  Vars supplied to request = {\n      "enable_ads_warehouse": false,\n      "enable_crm_warehouse": true,\n      "enable_finance_warehouse": false,\n      "enable_marketing_warehouse": false,\n      "enable_product_warehouse": false,\n      "enable_projects_warehouse": false,\n      "enable_salesforce_source": true,\n      "enable_subscriptions_warehouse": false,\n      "salesforce_account_table_name": "account",\n      "salesforce_case_table_name": "case",\n      "salesforce_contact_table_name": "contact",\n      "salesforce_crm_etl_name": "fivetran",\n      "salesforce_lead_table_name": "lead",\n      "salesforce_opportunity_table_name": "opportunity",\n      "salesforce_schema_name": "salesforce",\n      "salesforce_user_role_table_name": "user_role",\n      "salesforce_user_table_name": "user"\n  }\n  \n  > in rpc request (from remote system)\n  > called by rpc request (from remote system)', 'raw_sql': "WITH source AS (\r\n    select * from {{ var('salesforce_schema_name') }}.{{ var('salesforce_calendar_table_name') }}\r\n    ),\r\n    test as (\r\n        select\r\n        {{ dbt_utils.current_timestamp() }}  as cldr_date,\r\n        created_date >= {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_created_this_month,\r\n        created_date >= {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_created_this_quarter,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n     from source\r\n    )\r\nselect * from test\nlimit 100", 'compiled_sql': None, 'tags': None}, None)
2020-12-02 17:09:58.134262 (Thread-89): handling poll request
2020-12-02 17:09:58.134798 (Thread-89): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce6404d278>]}
2020-12-02 17:09:58.136235 (Thread-89): sending response (<Response 14037 bytes [200 OK]>) to 10.0.21.144
2020-12-02 17:10:31.201973 (Thread-90): handling status request
2020-12-02 17:10:31.202746 (Thread-90): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce64067908>]}
2020-12-02 17:10:31.204220 (Thread-90): sending response (<Response 1237 bytes [200 OK]>) to 10.0.34.197
2020-12-02 17:10:31.757984 (Thread-91): handling run_sql request
2020-12-02 17:10:31.758519 (Thread-91): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce64067908>]}
2020-12-02 17:10:31.760706 (Thread-91): Checking header 'user-agent' tracing in whitelist set(), 24 additional messages skipped
2020-12-02 17:10:31.876532 (Thread-91): writing 1 spans (enabled:True)
2020-12-02 17:10:31.876725 (Thread-91): 
      name requests.request
        id 12359505218908598463
  trace_id 7473774896884731007
 parent_id None
   service requests
  resource requests.request
      type http
     start 1606929031.7600079
       end 1606929031.8764358
  duration 0.116428s
     error 0
      tags 
           http.method:POST
           http.status_code:200
           http.url:https://fishtownanalytics.sinter-collect.com/com.snowplowanalytics.snowplow/tp2
           runtime-id:8daea1d60d034a8cace00663c6a43dc8
2020-12-02 17:10:32.691597 (AgentWriter): reported 1 traces in 0.00397s
2020-12-02 17:10:32.692015 (AgentWriter): initialized RateSampler, sample 100% of traces, 35 additional messages skipped
2020-12-02 17:10:32.926283 (Thread-91): sending response (<Response 137 bytes [200 OK]>) to 10.0.0.188
2020-12-02 17:10:32.953317 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:10:32.991931 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 17:10:32.992439 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:10:32.992622 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 17:10:33.014885 (Thread-1): finished collecting timing info
2020-12-02 17:10:33.015987 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:10:33.016059 (Thread-1): On rpc.sales_dataflo.request: WITH source AS (
    select * from salesforce.opportunity
    ),
    test as (
        select
        
    current_timestamp::
    timestamp_ntz

  as cldr_date,
        created_date >= 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_month,
        created_date >= 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_quarter,
        
  

    datediff(
        day,
        
    current_timestamp::
    timestamp_ntz

,
        created_date
        )


 as days_since_created,
        
  

    datediff(
        day,
        close_date,
        created_date
        )


 as days_to_close,
        
    date_trunc('month', close_date)
 = 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_month,
        
    date_trunc('quarter', close_date)
 = 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_quarter
     from source
    )
select * from test
limit 100
2020-12-02 17:10:33.016118 (Thread-1): Opening a new connection, currently in state init
2020-12-02 17:10:33.207242 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 17:10:33.508355 (Thread-92): handling poll request
2020-12-02 17:10:33.508905 (Thread-92): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce64325d68>]}
2020-12-02 17:10:33.511329 (Thread-92): sending response (<Response 3919 bytes [200 OK]>) to 10.0.15.0
2020-12-02 17:10:34.092438 (Thread-1): SQL status: SUCCESS 31 in 1.08 seconds
2020-12-02 17:10:34.093827 (Thread-1): finished collecting timing info
2020-12-02 17:10:34.094454 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 17:10:35.140944 (Thread-93): handling poll request
2020-12-02 17:10:35.141446 (Thread-93): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce64047da0>]}
2020-12-02 17:10:35.146509 (Thread-93): sending response (<Response 10709 bytes [200 OK]>) to 10.0.32.130
2020-12-02 17:15:46.027820 (Thread-94): handling status request
2020-12-02 17:15:46.030204 (Thread-94): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce6405e630>]}
2020-12-02 17:15:46.031492 (Thread-94): sending response (<Response 1237 bytes [200 OK]>) to 10.0.15.0
2020-12-02 17:15:46.556365 (Thread-95): handling run_sql request
2020-12-02 17:15:46.556860 (Thread-95): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce6405ea20>]}
2020-12-02 17:15:47.625541 (Thread-95): sending response (<Response 137 bytes [200 OK]>) to 10.0.18.0
2020-12-02 17:15:47.653794 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:15:47.702956 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 17:15:47.703470 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:15:47.703613 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 17:15:47.731914 (Thread-1): finished collecting timing info
2020-12-02 17:15:47.733443 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:15:47.733521 (Thread-1): On rpc.sales_dataflo.request: WITH source AS (
    select * from salesforce.opportunity
    ),
    test as (
        select
        
    current_timestamp::
    timestamp_ntz

  as cldr_date,
        
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as cldr_mnth_strt_dt,
        
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as cldr_mnth_end_dt,
        
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as cldr_qtr_strt_dt,
        
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as cldr_qtr_end_dt,
        
    date_trunc('year', 
    current_timestamp::
    timestamp_ntz

)
 as cldr_year_start_dt,
        
    date_trunc('year', 
    current_timestamp::
    timestamp_ntz

)
 as cldr_year_end_dt,
        created_date >= 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_month,
        created_date >= 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_created_this_quarter,
        
  

    datediff(
        day,
        
    current_timestamp::
    timestamp_ntz

,
        created_date
        )


 as days_since_created,
        
  

    datediff(
        day,
        close_date,
        created_date
        )


 as days_to_close,
        
    date_trunc('month', close_date)
 = 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_month,
        
    date_trunc('quarter', close_date)
 = 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_quarter
     from source
    )
select * from test
limit 100
2020-12-02 17:15:47.733582 (Thread-1): Opening a new connection, currently in state init
2020-12-02 17:15:47.934032 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 17:15:48.253436 (Thread-96): handling poll request
2020-12-02 17:15:48.253948 (Thread-96): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce64062390>]}
2020-12-02 17:15:48.256777 (Thread-96): sending response (<Response 4571 bytes [200 OK]>) to 10.0.18.0
2020-12-02 17:15:48.784246 (Thread-1): SQL status: SUCCESS 31 in 1.05 seconds
2020-12-02 17:15:48.786501 (Thread-1): finished collecting timing info
2020-12-02 17:15:48.787066 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 17:15:49.833509 (Thread-97): handling poll request
2020-12-02 17:15:49.834027 (Thread-97): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce64067240>]}
2020-12-02 17:15:49.840222 (Thread-97): sending response (<Response 18261 bytes [200 OK]>) to 10.0.23.132
2020-12-02 17:32:32.502512 (Thread-98): handling status request
2020-12-02 17:32:32.504579 (Thread-98): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce64062a58>]}
2020-12-02 17:32:32.505845 (Thread-98): sending response (<Response 1237 bytes [200 OK]>) to 10.0.16.71
2020-12-02 17:32:33.045059 (Thread-99): handling run_sql request
2020-12-02 17:32:33.045593 (Thread-99): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce64062be0>]}
2020-12-02 17:32:34.114753 (Thread-99): sending response (<Response 137 bytes [200 OK]>) to 10.0.18.0
2020-12-02 17:32:34.142928 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:32:34.206265 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 17:32:34.206885 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:32:34.207030 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 17:32:34.237784 (Thread-1): finished collecting timing info
2020-12-02 17:32:34.239748 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:32:34.239841 (Thread-1): On rpc.sales_dataflo.request: WITH source AS (
    select * from salesforce.opportunity
    ),
    test as (
        select
        
    current_timestamp::
    timestamp_ntz

  as cldr_date,
        cast(
    date_trunc('month', d.date_day)
 as date) as cldr_mnth_strt_dt,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', d.date_day)

        )



        )



        as date)
 as date) as cldr_mnth_end_dt,
        cast(
    date_trunc('quarter', d.date_day)
 as date) as cldr_qtr_strt_dt,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        quarter,
        1,
        
    date_trunc('quarter', d.date_day)

        )



        )



        as date)
 as date) as cldr_qtr_end_dt,
        cast(
    date_trunc('year', d.date_day)
 as date) as cldr_year_start_dt,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        year,
        1,
        
    date_trunc('year', d.date_day)

        )



        )



        as date)
 as date) as cldr_year_end_dt,
        cast(
    date_trunc('week', d.date_day)
 as date) as week_start_date,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', d.date_day)

        )



        )



        as date)
 as date) as week_end_date,
        to_char(d.date_day, 'Dy') as day_name,
        cast(date_part('day', d.date_day) as 
    int
) as cldr_day_num,
        cast(date_part('week', d.date_day) as 
    int
) as cldr_week_num,
        
  

    datediff(
        day,
        
    current_timestamp::
    timestamp_ntz

,
        created_date
        )


 as days_since_created,
        
  

    datediff(
        day,
        close_date,
        created_date
        )


 as days_to_close,
        
    date_trunc('month', close_date)
 = 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_month,
        
    date_trunc('quarter', close_date)
 = 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_quarter
     from source
    )
select * from test
limit 100
2020-12-02 17:32:34.239904 (Thread-1): Opening a new connection, currently in state init
2020-12-02 17:32:34.443788 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 17:32:34.740296 (Thread-100): handling poll request
2020-12-02 17:32:34.740823 (Thread-100): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce640486d8>]}
2020-12-02 17:32:34.743253 (Thread-100): sending response (<Response 5281 bytes [200 OK]>) to 10.0.13.141
2020-12-02 17:32:34.924864 (Thread-1): Snowflake query id: 0198a9dc-002f-0cfc-0000-5eb100012042
2020-12-02 17:32:34.925005 (Thread-1): Snowflake error: 000904 (42000): SQL compilation error: error line 12 at position 24
invalid identifier 'D.DATE_DAY'
2020-12-02 17:32:34.925142 (Thread-1): finished collecting timing info
2020-12-02 17:32:34.925667 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 17:32:34.981480 (Thread-1): Got an exception: Database Error
  000904 (42000): SQL compilation error: error line 12 at position 24
  invalid identifier 'D.DATE_DAY'
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 161, in exception_handler
    yield
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/cursor.py", line 597, in execute
    errvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 97, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, errorclass, errorvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 73, in default_errorhandler
    done_format_msg=errorvalue.get(u'done_format_msg'))
snowflake.connector.errors.ProgrammingError: 000904 (42000): SQL compilation error: error line 12 at position 24
invalid identifier 'D.DATE_DAY'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 85, in execute
    compiled_node.injected_sql, fetch=True
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/base/impl.py", line 227, in execute
    fetch=fetch
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 312, in add_query
    abridge_sql_log=abridge_sql_log
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.6/contextlib.py", line 99, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 178, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  000904 (42000): SQL compilation error: error line 12 at position 24
  invalid identifier 'D.DATE_DAY'
2020-12-02 17:32:34.982978 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  000904 (42000): SQL compilation error: error line 12 at position 24\n  invalid identifier 'D.DATE_DAY'", 'raw_sql': "WITH source AS (\r\n    select * from {{ var('salesforce_schema_name') }}.{{ var('salesforce_opportunity_table_name') }}\r\n    ),\r\n    test as (\r\n        select\r\n        {{ dbt_utils.current_timestamp() }}  as cldr_date,\r\n        cast({{ dbt_utils.date_trunc('month', 'd.date_day') }} as date) as cldr_mnth_strt_dt,\r\n        cast({{ dbt_utils.last_day('d.date_day', 'month') }} as date) as cldr_mnth_end_dt,\r\n        cast({{ dbt_utils.date_trunc('quarter', 'd.date_day') }} as date) as cldr_qtr_strt_dt,\r\n        cast({{ dbt_utils.last_day('d.date_day', 'quarter') }} as date) as cldr_qtr_end_dt,\r\n        cast({{ dbt_utils.date_trunc('year', 'd.date_day') }} as date) as cldr_year_start_dt,\r\n        cast({{ dbt_utils.last_day('d.date_day', 'year') }} as date) as cldr_year_end_dt,\r\n        cast({{ dbt_utils.date_trunc('week', 'd.date_day') }} as date) as week_start_date,\r\n        cast({{ dbt_utils.last_day('d.date_day', 'week') }} as date) as week_end_date,\r\n        {{ dbt_date.day_name('d.date_day', short=true) }} as day_name,\r\n        cast({{ dbt_date.date_part('day', 'd.date_day') }} as {{ dbt_utils.type_int() }}) as cldr_day_num,\r\n        cast({{ dbt_date.date_part('week', 'd.date_day') }} as {{ dbt_utils.type_int() }}) as cldr_week_num,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n     from source\r\n    )\r\nselect * from test\nlimit 100", 'compiled_sql': "WITH source AS (\n    select * from salesforce.opportunity\n    ),\n    test as (\n        select\n        \n    current_timestamp::\n    timestamp_ntz\n\n  as cldr_date,\n        cast(\n    date_trunc('month', d.date_day)\n as date) as cldr_mnth_strt_dt,\n        cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc('month', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as cldr_mnth_end_dt,\n        cast(\n    date_trunc('quarter', d.date_day)\n as date) as cldr_qtr_strt_dt,\n        cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        quarter,\n        1,\n        \n    date_trunc('quarter', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as cldr_qtr_end_dt,\n        cast(\n    date_trunc('year', d.date_day)\n as date) as cldr_year_start_dt,\n        cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        year,\n        1,\n        \n    date_trunc('year', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as cldr_year_end_dt,\n        cast(\n    date_trunc('week', d.date_day)\n as date) as week_start_date,\n        cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc('week', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as week_end_date,\n        to_char(d.date_day, 'Dy') as day_name,\n        cast(date_part('day', d.date_day) as \n    int\n) as cldr_day_num,\n        cast(date_part('week', d.date_day) as \n    int\n) as cldr_week_num,\n        \n  \n\n    datediff(\n        day,\n        \n    current_timestamp::\n    timestamp_ntz\n\n,\n        created_date\n        )\n\n\n as days_since_created,\n        \n  \n\n    datediff(\n        day,\n        close_date,\n        created_date\n        )\n\n\n as days_to_close,\n        \n    date_trunc('month', close_date)\n = \n    date_trunc('month', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_month,\n        \n    date_trunc('quarter', close_date)\n = \n    date_trunc('quarter', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_quarter\n     from source\n    )\nselect * from test\nlimit 100", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  000904 (42000): SQL compilation error: error line 12 at position 24\n  invalid identifier 'D.DATE_DAY'", 'raw_sql': "WITH source AS (\r\n    select * from {{ var('salesforce_schema_name') }}.{{ var('salesforce_opportunity_table_name') }}\r\n    ),\r\n    test as (\r\n        select\r\n        {{ dbt_utils.current_timestamp() }}  as cldr_date,\r\n        cast({{ dbt_utils.date_trunc('month', 'd.date_day') }} as date) as cldr_mnth_strt_dt,\r\n        cast({{ dbt_utils.last_day('d.date_day', 'month') }} as date) as cldr_mnth_end_dt,\r\n        cast({{ dbt_utils.date_trunc('quarter', 'd.date_day') }} as date) as cldr_qtr_strt_dt,\r\n        cast({{ dbt_utils.last_day('d.date_day', 'quarter') }} as date) as cldr_qtr_end_dt,\r\n        cast({{ dbt_utils.date_trunc('year', 'd.date_day') }} as date) as cldr_year_start_dt,\r\n        cast({{ dbt_utils.last_day('d.date_day', 'year') }} as date) as cldr_year_end_dt,\r\n        cast({{ dbt_utils.date_trunc('week', 'd.date_day') }} as date) as week_start_date,\r\n        cast({{ dbt_utils.last_day('d.date_day', 'week') }} as date) as week_end_date,\r\n        {{ dbt_date.day_name('d.date_day', short=true) }} as day_name,\r\n        cast({{ dbt_date.date_part('day', 'd.date_day') }} as {{ dbt_utils.type_int() }}) as cldr_day_num,\r\n        cast({{ dbt_date.date_part('week', 'd.date_day') }} as {{ dbt_utils.type_int() }}) as cldr_week_num,\r\n        {{ dbt_utils.datediff(dbt_utils.current_timestamp(), 'created_date', 'day') }} as days_since_created,\r\n        {{ dbt_utils.datediff('close_date', 'created_date', 'day') }} as days_to_close,\r\n        {{ dbt_utils.date_trunc('month', 'close_date') }} = {{ dbt_utils.date_trunc('month', dbt_utils.current_timestamp()) }} as is_closed_this_month,\r\n        {{ dbt_utils.date_trunc('quarter', 'close_date') }} = {{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as is_closed_this_quarter\r\n     from source\r\n    )\r\nselect * from test\nlimit 100", 'compiled_sql': "WITH source AS (\n    select * from salesforce.opportunity\n    ),\n    test as (\n        select\n        \n    current_timestamp::\n    timestamp_ntz\n\n  as cldr_date,\n        cast(\n    date_trunc('month', d.date_day)\n as date) as cldr_mnth_strt_dt,\n        cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc('month', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as cldr_mnth_end_dt,\n        cast(\n    date_trunc('quarter', d.date_day)\n as date) as cldr_qtr_strt_dt,\n        cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        quarter,\n        1,\n        \n    date_trunc('quarter', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as cldr_qtr_end_dt,\n        cast(\n    date_trunc('year', d.date_day)\n as date) as cldr_year_start_dt,\n        cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        year,\n        1,\n        \n    date_trunc('year', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as cldr_year_end_dt,\n        cast(\n    date_trunc('week', d.date_day)\n as date) as week_start_date,\n        cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc('week', d.date_day)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as week_end_date,\n        to_char(d.date_day, 'Dy') as day_name,\n        cast(date_part('day', d.date_day) as \n    int\n) as cldr_day_num,\n        cast(date_part('week', d.date_day) as \n    int\n) as cldr_week_num,\n        \n  \n\n    datediff(\n        day,\n        \n    current_timestamp::\n    timestamp_ntz\n\n,\n        created_date\n        )\n\n\n as days_since_created,\n        \n  \n\n    datediff(\n        day,\n        close_date,\n        created_date\n        )\n\n\n as days_to_close,\n        \n    date_trunc('month', close_date)\n = \n    date_trunc('month', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_month,\n        \n    date_trunc('quarter', close_date)\n = \n    date_trunc('quarter', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as is_closed_this_quarter\n     from source\n    )\nselect * from test\nlimit 100", 'tags': None}, None)
2020-12-02 17:32:36.310168 (Thread-101): handling poll request
2020-12-02 17:32:36.310689 (Thread-101): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e5756d8>]}
2020-12-02 17:32:36.311681 (Thread-101): sending response (<Response 24273 bytes [200 OK]>) to 10.0.15.0
2020-12-02 17:38:39.701457 (Thread-102): handling status request
2020-12-02 17:38:39.703208 (Thread-102): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e575240>]}
2020-12-02 17:38:39.704362 (Thread-102): sending response (<Response 1237 bytes [200 OK]>) to 10.0.13.141
2020-12-02 17:38:40.256381 (Thread-103): handling run_sql request
2020-12-02 17:38:40.256864 (Thread-103): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e580320>]}
2020-12-02 17:38:41.319702 (Thread-103): sending response (<Response 137 bytes [200 OK]>) to 10.0.0.188
2020-12-02 17:38:41.348164 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:38:41.359131 (MainThread): dbt runtime exception
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 496, in catch_jinja
    yield
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 523, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/lib/python3.6/dist-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 8, in template
jinja2.exceptions.TemplateSyntaxError: unexpected ')'
  line 8
    cast({{ dbt_utils.last_day(dbt_utils.current_timestamp()), 'month') }} as date) as cldr_mnth_end_dt,

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/task_handler.py", line 94, in task_exec
    result = self.task.handle_request()
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 162, in handle_request
    node = self._get_exec_node()
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 122, in _get_exec_node
    rpc_node = rpc_parser.parse_remote(sql, self.args.name)
  File "/usr/local/lib/python3.6/dist-packages/dbt/parser/rpc.py", line 48, in parse_remote
    return self.parse_node(contents)
  File "/usr/local/lib/python3.6/dist-packages/dbt/parser/base.py", line 402, in parse_node
    self.render_update(node, config)
  File "/usr/local/lib/python3.6/dist-packages/dbt/parser/base.py", line 377, in render_update
    self.render_with_context(node, config)
  File "/usr/local/lib/python3.6/dist-packages/dbt/parser/base.py", line 289, in render_with_context
    parsed_node.raw_sql, context, parsed_node, capture_macros=True
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 575, in get_rendered
    native=native,
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 523, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/lib/python3.6/contextlib.py", line 99, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 499, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  unexpected ')'
    line 8
      cast({{ dbt_utils.last_day(dbt_utils.current_timestamp()), 'month') }} as date) as cldr_mnth_end_dt,
2020-12-02 17:38:41.867225 (Thread-104): handling poll request
2020-12-02 17:38:41.867762 (Thread-104): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce6405e438>]}
2020-12-02 17:38:41.869141 (Thread-104): sending response (<Response 6241 bytes [200 OK]>) to 10.0.21.144
2020-12-02 17:41:25.232020 (Thread-105): handling status request
2020-12-02 17:41:25.233994 (Thread-105): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e575208>]}
2020-12-02 17:41:25.235251 (Thread-105): sending response (<Response 1237 bytes [200 OK]>) to 10.0.32.18
2020-12-02 17:41:25.777914 (Thread-106): handling run_sql request
2020-12-02 17:41:25.778451 (Thread-106): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce64047198>]}
2020-12-02 17:41:26.845851 (Thread-106): sending response (<Response 137 bytes [200 OK]>) to 10.0.13.116
2020-12-02 17:41:26.875096 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:41:26.886104 (MainThread): dbt runtime exception
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 496, in catch_jinja
    yield
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 523, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/lib/python3.6/dist-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 8, in template
jinja2.exceptions.TemplateSyntaxError: unexpected ')'
  line 8
    {{ dbt_utils.last_day(dbt_utils.current_timestamp()), 'month') }}  as cldr_mnth_end_dt,

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/task_handler.py", line 94, in task_exec
    result = self.task.handle_request()
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 162, in handle_request
    node = self._get_exec_node()
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 122, in _get_exec_node
    rpc_node = rpc_parser.parse_remote(sql, self.args.name)
  File "/usr/local/lib/python3.6/dist-packages/dbt/parser/rpc.py", line 48, in parse_remote
    return self.parse_node(contents)
  File "/usr/local/lib/python3.6/dist-packages/dbt/parser/base.py", line 402, in parse_node
    self.render_update(node, config)
  File "/usr/local/lib/python3.6/dist-packages/dbt/parser/base.py", line 377, in render_update
    self.render_with_context(node, config)
  File "/usr/local/lib/python3.6/dist-packages/dbt/parser/base.py", line 289, in render_with_context
    parsed_node.raw_sql, context, parsed_node, capture_macros=True
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 575, in get_rendered
    native=native,
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 523, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/lib/python3.6/contextlib.py", line 99, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 499, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  unexpected ')'
    line 8
      {{ dbt_utils.last_day(dbt_utils.current_timestamp()), 'month') }}  as cldr_mnth_end_dt,
2020-12-02 17:41:27.567464 (Thread-107): handling poll request
2020-12-02 17:41:27.568022 (Thread-107): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e580518>]}
2020-12-02 17:41:27.569425 (Thread-107): sending response (<Response 6025 bytes [200 OK]>) to 10.0.23.132
2020-12-02 17:42:33.668716 (Thread-108): handling status request
2020-12-02 17:42:33.669215 (Thread-108): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e586dd8>]}
2020-12-02 17:42:33.670476 (Thread-108): sending response (<Response 1237 bytes [200 OK]>) to 10.0.32.130
2020-12-02 17:42:34.233128 (Thread-109): handling run_sql request
2020-12-02 17:42:34.233646 (Thread-109): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e58d358>]}
2020-12-02 17:42:35.280631 (Thread-109): sending response (<Response 137 bytes [200 OK]>) to 10.0.44.113
2020-12-02 17:42:35.307307 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:42:35.356049 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 17:42:35.356517 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:42:35.356651 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 17:42:35.379234 (Thread-1): finished collecting timing info
2020-12-02 17:42:35.380391 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:42:35.380462 (Thread-1): On rpc.sales_dataflo.request: WITH source AS (
    select * from salesforce.opportunity
    ),
    test as (
        select
        
    current_timestamp::
    timestamp_ntz

  as cldr_date,
        
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as cldr_mnth_strt_dt,
        
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)

        )



        )



        as date)
  as cldr_mnth_end_dt,
        
  

    datediff(
        day,
        
    current_timestamp::
    timestamp_ntz

,
        created_date
        )


 as days_since_created,
        
  

    datediff(
        day,
        close_date,
        created_date
        )


 as days_to_close,
        
    date_trunc('month', close_date)
 = 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_month,
        
    date_trunc('quarter', close_date)
 = 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_quarter
     from source
    )
select * from test
limit 100
2020-12-02 17:42:35.380521 (Thread-1): Opening a new connection, currently in state init
2020-12-02 17:42:35.586899 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 17:42:35.868901 (Thread-110): handling poll request
2020-12-02 17:42:35.869415 (Thread-110): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e58d358>]}
2020-12-02 17:42:35.872117 (Thread-110): sending response (<Response 4062 bytes [200 OK]>) to 10.0.0.188
2020-12-02 17:42:37.507754 (Thread-111): handling poll request
2020-12-02 17:42:37.508266 (Thread-111): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e586240>]}
2020-12-02 17:42:37.509273 (Thread-111): sending response (<Response 394 bytes [200 OK]>) to 10.0.13.116
2020-12-02 17:42:37.952670 (Thread-1): SQL status: SUCCESS 31 in 2.57 seconds
2020-12-02 17:42:37.954251 (Thread-1): finished collecting timing info
2020-12-02 17:42:37.954787 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 17:42:39.039690 (Thread-112): handling poll request
2020-12-02 17:42:39.040183 (Thread-112): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e586ef0>]}
2020-12-02 17:42:39.045356 (Thread-112): sending response (<Response 11782 bytes [200 OK]>) to 10.0.0.188
2020-12-02 17:43:24.312316 (Thread-113): handling status request
2020-12-02 17:43:24.312804 (Thread-113): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e597a20>]}
2020-12-02 17:43:24.313964 (Thread-113): sending response (<Response 1237 bytes [200 OK]>) to 10.0.13.141
2020-12-02 17:43:24.842612 (Thread-114): handling run_sql request
2020-12-02 17:43:24.843120 (Thread-114): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e597dd8>]}
2020-12-02 17:43:25.901667 (Thread-114): sending response (<Response 137 bytes [200 OK]>) to 10.0.13.141
2020-12-02 17:43:25.928841 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:43:25.975879 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 17:43:25.976448 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:43:25.976598 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 17:43:26.001513 (Thread-1): finished collecting timing info
2020-12-02 17:43:26.003744 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:43:26.003885 (Thread-1): On rpc.sales_dataflo.request: WITH source AS (
    select * from salesforce.opportunity
    ),
    test as (
        select
        
    current_timestamp::
    timestamp_ntz

  as cldr_date,
        cast(
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as date) as cldr_mnth_strt_dt,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)

        )



        )



        as date)
 as date) as cldr_mnth_end_dt,
        
  

    datediff(
        day,
        
    current_timestamp::
    timestamp_ntz

,
        created_date
        )


 as days_since_created,
        
  

    datediff(
        day,
        close_date,
        created_date
        )


 as days_to_close,
        
    date_trunc('month', close_date)
 = 
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_month,
        
    date_trunc('quarter', close_date)
 = 
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as is_closed_this_quarter
     from source
    )
select * from test
limit 100
2020-12-02 17:43:26.003975 (Thread-1): Opening a new connection, currently in state init
2020-12-02 17:43:26.202726 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 17:43:26.579240 (Thread-115): handling poll request
2020-12-02 17:43:26.579780 (Thread-115): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e5a2160>]}
2020-12-02 17:43:26.582157 (Thread-115): sending response (<Response 4090 bytes [200 OK]>) to 10.0.13.116
2020-12-02 17:43:26.655825 (Thread-1): SQL status: SUCCESS 31 in 0.65 seconds
2020-12-02 17:43:26.657730 (Thread-1): finished collecting timing info
2020-12-02 17:43:26.658362 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 17:43:28.157697 (Thread-116): handling poll request
2020-12-02 17:43:28.158228 (Thread-116): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e5a7438>]}
2020-12-02 17:43:28.163474 (Thread-116): sending response (<Response 11637 bytes [200 OK]>) to 10.0.42.75
2020-12-02 17:45:17.959071 (Thread-117): handling status request
2020-12-02 17:45:17.961483 (Thread-117): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e575780>]}
2020-12-02 17:45:17.962736 (Thread-117): sending response (<Response 1237 bytes [200 OK]>) to 10.0.16.71
2020-12-02 17:45:18.509622 (Thread-118): handling run_sql request
2020-12-02 17:45:18.510149 (Thread-118): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e586ac8>]}
2020-12-02 17:45:19.676369 (Thread-118): sending response (<Response 137 bytes [200 OK]>) to 10.0.32.130
2020-12-02 17:45:19.705244 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:45:19.716525 (MainThread): dbt runtime exception
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 496, in catch_jinja
    yield
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 523, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/lib/python3.6/dist-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 9, in template
jinja2.exceptions.TemplateSyntaxError: unexpected ')'
  line 9
    cast({{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp())) }} as date) as cldr_qtr_strt_dt,

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/task_handler.py", line 94, in task_exec
    result = self.task.handle_request()
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 162, in handle_request
    node = self._get_exec_node()
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 122, in _get_exec_node
    rpc_node = rpc_parser.parse_remote(sql, self.args.name)
  File "/usr/local/lib/python3.6/dist-packages/dbt/parser/rpc.py", line 48, in parse_remote
    return self.parse_node(contents)
  File "/usr/local/lib/python3.6/dist-packages/dbt/parser/base.py", line 402, in parse_node
    self.render_update(node, config)
  File "/usr/local/lib/python3.6/dist-packages/dbt/parser/base.py", line 377, in render_update
    self.render_with_context(node, config)
  File "/usr/local/lib/python3.6/dist-packages/dbt/parser/base.py", line 289, in render_with_context
    parsed_node.raw_sql, context, parsed_node, capture_macros=True
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 575, in get_rendered
    native=native,
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 523, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/lib/python3.6/contextlib.py", line 99, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 499, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  unexpected ')'
    line 9
      cast({{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp())) }} as date) as cldr_qtr_strt_dt,
2020-12-02 17:45:20.270755 (Thread-119): handling poll request
2020-12-02 17:45:20.271289 (Thread-119): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e586ac8>]}
2020-12-02 17:45:20.272647 (Thread-119): sending response (<Response 5983 bytes [200 OK]>) to 10.0.15.0
2020-12-02 17:46:20.542789 (Thread-120): handling status request
2020-12-02 17:46:20.543308 (Thread-120): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e536048>]}
2020-12-02 17:46:20.544544 (Thread-120): sending response (<Response 1237 bytes [200 OK]>) to 10.0.16.71
2020-12-02 17:46:21.097655 (Thread-121): handling run_sql request
2020-12-02 17:46:21.098210 (Thread-121): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e5363c8>]}
2020-12-02 17:46:21.100322 (Thread-121): Checking header 'user-agent' tracing in whitelist set(), 24 additional messages skipped
2020-12-02 17:46:21.211388 (Thread-121): writing 1 spans (enabled:True)
2020-12-02 17:46:21.211607 (Thread-121): 
      name requests.request
        id 4181708323494039197
  trace_id 15104785436502199978
 parent_id None
   service requests
  resource requests.request
      type http
     start 1606931181.099819
       end 1606931181.211272
  duration 0.111453s
     error 0
      tags 
           http.method:POST
           http.status_code:200
           http.url:https://fishtownanalytics.sinter-collect.com/com.snowplowanalytics.snowplow/tp2
           runtime-id:8daea1d60d034a8cace00663c6a43dc8
2020-12-02 17:46:21.943529 (AgentWriter): reported 1 traces in 0.00331s
2020-12-02 17:46:21.943938 (AgentWriter): initialized RateSampler, sample 100% of traces, 35 additional messages skipped
2020-12-02 17:46:22.267799 (Thread-121): sending response (<Response 137 bytes [200 OK]>) to 10.0.18.0
2020-12-02 17:46:22.296320 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:46:22.308454 (MainThread): dbt runtime exception
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 496, in catch_jinja
    yield
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 523, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/lib/python3.6/dist-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 15, in template
jinja2.exceptions.TemplateSyntaxError: expected token 'end of print statement', got '='
  line 15
    {{ dbt_date.day_name(dbt_utils.current_timestamp()), short=true) }} as day_name,

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/task_handler.py", line 94, in task_exec
    result = self.task.handle_request()
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 162, in handle_request
    node = self._get_exec_node()
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 122, in _get_exec_node
    rpc_node = rpc_parser.parse_remote(sql, self.args.name)
  File "/usr/local/lib/python3.6/dist-packages/dbt/parser/rpc.py", line 48, in parse_remote
    return self.parse_node(contents)
  File "/usr/local/lib/python3.6/dist-packages/dbt/parser/base.py", line 402, in parse_node
    self.render_update(node, config)
  File "/usr/local/lib/python3.6/dist-packages/dbt/parser/base.py", line 377, in render_update
    self.render_with_context(node, config)
  File "/usr/local/lib/python3.6/dist-packages/dbt/parser/base.py", line 289, in render_with_context
    parsed_node.raw_sql, context, parsed_node, capture_macros=True
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 575, in get_rendered
    native=native,
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 523, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/lib/python3.6/contextlib.py", line 99, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 499, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  expected token 'end of print statement', got '='
    line 15
      {{ dbt_date.day_name(dbt_utils.current_timestamp()), short=true) }} as day_name,
2020-12-02 17:46:22.986709 (Thread-122): handling poll request
2020-12-02 17:46:22.987243 (Thread-122): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f71c278>]}
2020-12-02 17:46:22.988589 (Thread-122): sending response (<Response 6015 bytes [200 OK]>) to 10.0.16.71
2020-12-02 17:47:12.523621 (Thread-123): handling status request
2020-12-02 17:47:12.524117 (Thread-123): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e53d978>]}
2020-12-02 17:47:12.525316 (Thread-123): sending response (<Response 1237 bytes [200 OK]>) to 10.0.32.18
2020-12-02 17:47:13.055337 (Thread-124): handling run_sql request
2020-12-02 17:47:13.055847 (Thread-124): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e536ef0>]}
2020-12-02 17:47:14.124667 (Thread-124): sending response (<Response 137 bytes [200 OK]>) to 10.0.18.0
2020-12-02 17:47:14.152416 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:47:14.215856 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 17:47:14.216454 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:47:14.216650 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 17:47:14.254618 (Thread-1): finished collecting timing info
2020-12-02 17:47:14.258165 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:47:14.258314 (Thread-1): On rpc.sales_dataflo.request: WITH source AS (
    select * from salesforce.opportunity
    ),
    test as (
        select
        
    current_timestamp::
    timestamp_ntz

  as cldr_date,
        cast(
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as date) as cldr_mnth_strt_dt,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)

        )



        )



        as date)
 as date) as cldr_mnth_end_dt,
        cast(
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as date) as cldr_qtr_strt_dt,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        quarter,
        1,
        
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)

        )



        )



        as date)
 as date) as cldr_qtr_end_dt,
        cast(
    date_trunc('year', 
    current_timestamp::
    timestamp_ntz

)
 as date) as cldr_year_start_dt,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        year,
        1,
        
    date_trunc('year', 
    current_timestamp::
    timestamp_ntz

)

        )



        )



        as date)
 as date) as cldr_year_end_dt,
        cast(
    date_trunc('week', 
    current_timestamp::
    timestamp_ntz

)
 as date) as week_start_date,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', 
    current_timestamp::
    timestamp_ntz

)

        )



        )



        as date)
 as date) as week_end_date,
        to_char(
    current_timestamp::
    timestamp_ntz

, 'Dy') as day_name,
        cast(date_part('day', 
    current_timestamp::
    timestamp_ntz

) as 
    int
) as cldr_day_num,
        cast(date_part('week', 
    current_timestamp::
    timestamp_ntz

) as 
    int
) as cldr_week_num,
        cast(date_part('week', 
    current_timestamp::
    timestamp_ntz

) as 
    int
) as cldr_qtr_num,
       cast(date_part('quarter', 
    current_timestamp::
    timestamp_ntz

) as 
    int
) as week
       from source
    )
select * from test
limit 100
2020-12-02 17:47:14.258406 (Thread-1): Opening a new connection, currently in state init
2020-12-02 17:47:14.468771 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 17:47:14.737415 (Thread-125): handling poll request
2020-12-02 17:47:14.738001 (Thread-125): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e536ef0>]}
2020-12-02 17:47:14.740402 (Thread-125): sending response (<Response 5322 bytes [200 OK]>) to 10.0.32.130
2020-12-02 17:47:15.264952 (Thread-1): SQL status: SUCCESS 31 in 1.01 seconds
2020-12-02 17:47:15.269152 (Thread-1): finished collecting timing info
2020-12-02 17:47:15.269676 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 17:47:16.305845 (Thread-126): handling poll request
2020-12-02 17:47:16.306368 (Thread-126): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e54c748>]}
2020-12-02 17:47:16.312180 (Thread-126): sending response (<Response 19617 bytes [200 OK]>) to 10.0.23.203
2020-12-02 17:48:33.259979 (Thread-127): handling status request
2020-12-02 17:48:33.262011 (Thread-127): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e53dfd0>]}
2020-12-02 17:48:33.263242 (Thread-127): sending response (<Response 1237 bytes [200 OK]>) to 10.0.21.144
2020-12-02 17:48:33.821418 (Thread-128): handling run_sql request
2020-12-02 17:48:33.821901 (Thread-128): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e5523c8>]}
2020-12-02 17:48:34.896900 (Thread-128): sending response (<Response 137 bytes [200 OK]>) to 10.0.32.18
2020-12-02 17:48:34.925262 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:48:34.988828 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 17:48:34.989369 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:48:34.989510 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 17:48:35.020237 (Thread-1): finished collecting timing info
2020-12-02 17:48:35.022121 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:48:35.022208 (Thread-1): On rpc.sales_dataflo.request: WITH source AS (
    select * from salesforce.opportunity
    ),
    test as (
        select
        
    current_timestamp::
    timestamp_ntz

  as cldr_date,
        cast(
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as date) as cldr_mnth_strt_dt,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)

        )



        )



        as date)
 as date) as cldr_mnth_end_dt,
        cast(
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as date) as cldr_qtr_strt_dt,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        quarter,
        1,
        
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)

        )



        )



        as date)
 as date) as cldr_qtr_end_dt,
        cast(
    date_trunc('year', 
    current_timestamp::
    timestamp_ntz

)
 as date) as cldr_year_start_dt,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        year,
        1,
        
    date_trunc('year', 
    current_timestamp::
    timestamp_ntz

)

        )



        )



        as date)
 as date) as cldr_year_end_dt,
        cast(
    date_trunc('week', 
    current_timestamp::
    timestamp_ntz

)
 as date) as week_start_date,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', 
    current_timestamp::
    timestamp_ntz

)

        )



        )



        as date)
 as date) as week_end_date,
        to_char(
    current_timestamp::
    timestamp_ntz

, 'Dy') as day_name,
        cast(date_part('day', 
    current_timestamp::
    timestamp_ntz

) as 
    int
) as cldr_day_num,
        cast(date_part('week', 
    current_timestamp::
    timestamp_ntz

) as 
    int
) as cldr_week_num,
        cast(date_part('quarter', 
    current_timestamp::
    timestamp_ntz

) as 
    int
) as cldr_qtr_num,
       cast(date_part('week', 
    current_timestamp::
    timestamp_ntz

) as 
    int
) as week
       from source
    )
select * from test
limit 100
2020-12-02 17:48:35.022273 (Thread-1): Opening a new connection, currently in state init
2020-12-02 17:48:35.236425 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 17:48:35.407635 (Thread-129): handling poll request
2020-12-02 17:48:35.408185 (Thread-129): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e5523c8>]}
2020-12-02 17:48:35.410644 (Thread-129): sending response (<Response 5322 bytes [200 OK]>) to 10.0.23.203
2020-12-02 17:48:35.919009 (Thread-1): SQL status: SUCCESS 31 in 0.90 seconds
2020-12-02 17:48:35.923127 (Thread-1): finished collecting timing info
2020-12-02 17:48:35.923653 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 17:48:36.985435 (Thread-130): handling poll request
2020-12-02 17:48:36.985934 (Thread-130): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e5445c0>]}
2020-12-02 17:48:36.991264 (Thread-130): sending response (<Response 19617 bytes [200 OK]>) to 10.0.13.116
2020-12-02 17:54:57.807168 (Thread-131): handling status request
2020-12-02 17:54:57.809079 (Thread-131): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e544ba8>]}
2020-12-02 17:54:57.810255 (Thread-131): sending response (<Response 1237 bytes [200 OK]>) to 10.0.42.75
2020-12-02 17:54:58.356340 (Thread-132): handling run_sql request
2020-12-02 17:54:58.356991 (Thread-132): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e5600f0>]}
2020-12-02 17:54:59.407301 (Thread-132): sending response (<Response 137 bytes [200 OK]>) to 10.0.44.113
2020-12-02 17:54:59.435262 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:54:59.447654 (MainThread): dbt runtime exception
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 496, in catch_jinja
    yield
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 523, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 941, in from_string
    return cls.from_code(self, self.compile(source), globals, None)
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 638, in compile
    self.handle_exception(source=source_hint)
  File "/usr/local/lib/python3.6/dist-packages/jinja2/environment.py", line 832, in handle_exception
    reraise(*rewrite_traceback_stack(source=source))
  File "/usr/local/lib/python3.6/dist-packages/jinja2/_compat.py", line 28, in reraise
    raise value.with_traceback(tb)
  File "<unknown>", line 19, in template
jinja2.exceptions.TemplateSyntaxError: unexpected ')'
  line 19
    cast({{ dbt_date.date_part('day', dbt_utils.current_timestamp())) }} as {{ dbt_utils.type_int() }}) as cldr_day_num,

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/task_handler.py", line 94, in task_exec
    result = self.task.handle_request()
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 162, in handle_request
    node = self._get_exec_node()
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 122, in _get_exec_node
    rpc_node = rpc_parser.parse_remote(sql, self.args.name)
  File "/usr/local/lib/python3.6/dist-packages/dbt/parser/rpc.py", line 48, in parse_remote
    return self.parse_node(contents)
  File "/usr/local/lib/python3.6/dist-packages/dbt/parser/base.py", line 402, in parse_node
    self.render_update(node, config)
  File "/usr/local/lib/python3.6/dist-packages/dbt/parser/base.py", line 377, in render_update
    self.render_with_context(node, config)
  File "/usr/local/lib/python3.6/dist-packages/dbt/parser/base.py", line 289, in render_with_context
    parsed_node.raw_sql, context, parsed_node, capture_macros=True
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 575, in get_rendered
    native=native,
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 523, in get_template
    return env.from_string(template_source, globals=ctx)
  File "/usr/lib/python3.6/contextlib.py", line 99, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.6/dist-packages/dbt/clients/jinja.py", line 499, in catch_jinja
    raise CompilationException(str(e), node) from e
dbt.exceptions.CompilationException: Compilation Error in rpc request (from remote system)
  unexpected ')'
    line 19
      cast({{ dbt_date.date_part('day', dbt_utils.current_timestamp())) }} as {{ dbt_utils.type_int() }}) as cldr_day_num,
2020-12-02 17:55:00.115748 (Thread-133): handling poll request
2020-12-02 17:55:00.116289 (Thread-133): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e5600f0>]}
2020-12-02 17:55:00.117950 (Thread-133): sending response (<Response 6118 bytes [200 OK]>) to 10.0.13.116
2020-12-02 17:57:57.419043 (Thread-134): handling status request
2020-12-02 17:57:57.421240 (Thread-134): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e544128>]}
2020-12-02 17:57:57.422461 (Thread-134): sending response (<Response 1237 bytes [200 OK]>) to 10.0.13.116
2020-12-02 17:57:58.006550 (Thread-135): handling run_sql request
2020-12-02 17:57:58.007064 (Thread-135): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f71cfd0>]}
2020-12-02 17:57:59.054895 (Thread-135): sending response (<Response 137 bytes [200 OK]>) to 10.0.32.18
2020-12-02 17:57:59.082737 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:57:59.149778 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 17:57:59.150302 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:57:59.150444 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 17:57:59.181632 (Thread-1): finished collecting timing info
2020-12-02 17:57:59.183578 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:57:59.183655 (Thread-1): On rpc.sales_dataflo.request: WITH source AS (
    select * from salesforce.opportunity
    ),
    test as (
        select
        cast(
    current_timestamp::
    timestamp_ntz

 as date)  as cldr_date,
        cast(
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as date) as cldr_mnth_strt_dt,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)

        )



        )



        as date)
 as date) as cldr_mnth_end_dt,
        cast(
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as date) as cldr_qtr_strt_dt,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        quarter,
        1,
        
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)

        )



        )



        as date)
 as date) as cldr_qtr_end_dt,
        cast(
    date_trunc('year', 
    current_timestamp::
    timestamp_ntz

)
 as date) as cldr_year_start_dt,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        year,
        1,
        
    date_trunc('year', 
    current_timestamp::
    timestamp_ntz

)

        )



        )



        as date)
 as date) as cldr_year_end_dt,
        cast(
    date_trunc('week', 
    current_timestamp::
    timestamp_ntz

)
 as date) as week_start_date,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', 
    current_timestamp::
    timestamp_ntz

)

        )



        )



        as date)
 as date) as week_end_date,
        to_char(
    current_timestamp::
    timestamp_ntz

, 'Dy') as day_name,
	    to_char(
    current_timestamp::
    timestamp_ntz

, 'MON') as month_name,
    	
    current_timestamp::
    timestamp_ntz

 as DW_INS_UPD_DTS,
    	'D_CALENDAR_DIM_LOAD' as DW_SESSION_NM
        cast(date_part('day', 
    current_timestamp::
    timestamp_ntz

) as 
    int
) as cldr_day_num,
        cast(date_part('week', 
    current_timestamp::
    timestamp_ntz

) as 
    int
) as cldr_week_num,
        cast(date_part('quarter', 
    current_timestamp::
    timestamp_ntz

) as 
    int
) as cldr_qtr_num
       from source
    )
select * from test
limit 100
2020-12-02 17:57:59.183722 (Thread-1): Opening a new connection, currently in state init
2020-12-02 17:57:59.369077 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 17:57:59.724368 (Thread-136): handling poll request
2020-12-02 17:57:59.724889 (Thread-136): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5f71cfd0>]}
2020-12-02 17:57:59.727345 (Thread-136): sending response (<Response 5438 bytes [200 OK]>) to 10.0.18.0
2020-12-02 17:57:59.845000 (Thread-1): Snowflake query id: 0198a9f5-0095-a859-0000-5eb1000116b6
2020-12-02 17:57:59.845139 (Thread-1): Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 179 at position 8 unexpected 'cast'.
syntax error line 179 at position 13 unexpected 'date_part'.
syntax error line 183 at position 2 unexpected 'as'.
2020-12-02 17:57:59.845274 (Thread-1): finished collecting timing info
2020-12-02 17:57:59.845788 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 17:57:59.910595 (Thread-1): Got an exception: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 179 at position 8 unexpected 'cast'.
  syntax error line 179 at position 13 unexpected 'date_part'.
  syntax error line 183 at position 2 unexpected 'as'.
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 161, in exception_handler
    yield
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 78, in add_query
    cursor.execute(sql, bindings)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/cursor.py", line 597, in execute
    errvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 97, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, errorclass, errorvalue)
  File "/usr/local/lib/python3.6/dist-packages/snowflake/connector/errors.py", line 73, in default_errorhandler
    done_format_msg=errorvalue.get(u'done_format_msg'))
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 179 at position 8 unexpected 'cast'.
syntax error line 179 at position 13 unexpected 'date_part'.
syntax error line 183 at position 2 unexpected 'as'.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 333, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 276, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 378, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 85, in execute
    compiled_node.injected_sql, fetch=True
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/base/impl.py", line 227, in execute
    fetch=fetch
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 123, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 312, in add_query
    abridge_sql_log=abridge_sql_log
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/sql/connections.py", line 86, in add_query
    return connection, cursor
  File "/usr/lib/python3.6/contextlib.py", line 99, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.6/dist-packages/dbt/adapters/snowflake/connections.py", line 178, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error
  001003 (42000): SQL compilation error:
  syntax error line 179 at position 8 unexpected 'cast'.
  syntax error line 179 at position 13 unexpected 'date_part'.
  syntax error line 183 at position 2 unexpected 'as'.
2020-12-02 17:57:59.912309 (Thread-1): Got exception RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 179 at position 8 unexpected 'cast'.\n  syntax error line 179 at position 13 unexpected 'date_part'.\n  syntax error line 183 at position 2 unexpected 'as'.", 'raw_sql': "WITH source AS (\r\n    select * from {{ var('salesforce_schema_name') }}.{{ var('salesforce_opportunity_table_name') }}\r\n    ),\r\n    test as (\r\n        select\r\n        cast({{ dbt_utils.current_timestamp() }} as date)  as cldr_date,\r\n        cast({{ dbt_utils.date_trunc('month',  dbt_utils.current_timestamp()) }} as date) as cldr_mnth_strt_dt,\r\n        cast({{ dbt_utils.last_day(dbt_utils.current_timestamp(), 'month') }} as date) as cldr_mnth_end_dt,\r\n        cast({{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as date) as cldr_qtr_strt_dt,\r\n        cast({{ dbt_utils.last_day(dbt_utils.current_timestamp(), 'quarter') }} as date) as cldr_qtr_end_dt,\r\n        cast({{ dbt_utils.date_trunc('year', dbt_utils.current_timestamp()) }} as date) as cldr_year_start_dt,\r\n        cast({{ dbt_utils.last_day(dbt_utils.current_timestamp(), 'year') }} as date) as cldr_year_end_dt,\r\n        cast({{ dbt_utils.date_trunc('week', dbt_utils.current_timestamp()) }} as date) as week_start_date,\r\n        cast({{ dbt_utils.last_day(dbt_utils.current_timestamp(), 'week') }} as date) as week_end_date,\r\n        {{ dbt_date.day_name(dbt_utils.current_timestamp(), short=true) }} as day_name,\r\n\t    {{ dbt_date.month_name(dbt_utils.current_timestamp(), short=true) }} as month_name,\r\n    \t{{ dbt_utils.current_timestamp() }} as DW_INS_UPD_DTS,\r\n    \t'D_CALENDAR_DIM_LOAD' as DW_SESSION_NM\r\n        cast({{ dbt_date.date_part('day', dbt_utils.current_timestamp()) }} as {{ dbt_utils.type_int() }}) as cldr_day_num,\r\n        cast({{ dbt_date.date_part('week', dbt_utils.current_timestamp()) }} as {{ dbt_utils.type_int() }}) as cldr_week_num,\r\n        cast({{ dbt_date.date_part('quarter', dbt_utils.current_timestamp()) }} as {{ dbt_utils.type_int() }}) as cldr_qtr_num\r\n       from source\r\n    )\r\nselect * from test\nlimit 100", 'compiled_sql': "WITH source AS (\n    select * from salesforce.opportunity\n    ),\n    test as (\n        select\n        cast(\n    current_timestamp::\n    timestamp_ntz\n\n as date)  as cldr_date,\n        cast(\n    date_trunc('month', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as date) as cldr_mnth_strt_dt,\n        cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc('month', \n    current_timestamp::\n    timestamp_ntz\n\n)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as cldr_mnth_end_dt,\n        cast(\n    date_trunc('quarter', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as date) as cldr_qtr_strt_dt,\n        cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        quarter,\n        1,\n        \n    date_trunc('quarter', \n    current_timestamp::\n    timestamp_ntz\n\n)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as cldr_qtr_end_dt,\n        cast(\n    date_trunc('year', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as date) as cldr_year_start_dt,\n        cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        year,\n        1,\n        \n    date_trunc('year', \n    current_timestamp::\n    timestamp_ntz\n\n)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as cldr_year_end_dt,\n        cast(\n    date_trunc('week', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as date) as week_start_date,\n        cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc('week', \n    current_timestamp::\n    timestamp_ntz\n\n)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as week_end_date,\n        to_char(\n    current_timestamp::\n    timestamp_ntz\n\n, 'Dy') as day_name,\n\t    to_char(\n    current_timestamp::\n    timestamp_ntz\n\n, 'MON') as month_name,\n    \t\n    current_timestamp::\n    timestamp_ntz\n\n as DW_INS_UPD_DTS,\n    \t'D_CALENDAR_DIM_LOAD' as DW_SESSION_NM\n        cast(date_part('day', \n    current_timestamp::\n    timestamp_ntz\n\n) as \n    int\n) as cldr_day_num,\n        cast(date_part('week', \n    current_timestamp::\n    timestamp_ntz\n\n) as \n    int\n) as cldr_week_num,\n        cast(date_part('quarter', \n    current_timestamp::\n    timestamp_ntz\n\n) as \n    int\n) as cldr_qtr_num\n       from source\n    )\nselect * from test\nlimit 100", 'tags': None}, None)
Traceback (most recent call last):
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/rpc/sql_commands.py", line 145, in _in_thread
    self.node_results.append(runner.safe_run(self.manifest))
  File "/usr/local/lib/python3.6/dist-packages/dbt/task/base.py", line 349, in safe_run
    result = self.error_result(ctx.node, error, started, [])
  File "/usr/local/lib/python3.6/dist-packages/dbt/rpc/node_runners.py", line 52, in error_result
    raise error
dbt.rpc.error.RPCException: RPCException(10003, Database Error, {'type': 'DatabaseException', 'message': "Database Error in rpc request (from remote system)\n  001003 (42000): SQL compilation error:\n  syntax error line 179 at position 8 unexpected 'cast'.\n  syntax error line 179 at position 13 unexpected 'date_part'.\n  syntax error line 183 at position 2 unexpected 'as'.", 'raw_sql': "WITH source AS (\r\n    select * from {{ var('salesforce_schema_name') }}.{{ var('salesforce_opportunity_table_name') }}\r\n    ),\r\n    test as (\r\n        select\r\n        cast({{ dbt_utils.current_timestamp() }} as date)  as cldr_date,\r\n        cast({{ dbt_utils.date_trunc('month',  dbt_utils.current_timestamp()) }} as date) as cldr_mnth_strt_dt,\r\n        cast({{ dbt_utils.last_day(dbt_utils.current_timestamp(), 'month') }} as date) as cldr_mnth_end_dt,\r\n        cast({{ dbt_utils.date_trunc('quarter', dbt_utils.current_timestamp()) }} as date) as cldr_qtr_strt_dt,\r\n        cast({{ dbt_utils.last_day(dbt_utils.current_timestamp(), 'quarter') }} as date) as cldr_qtr_end_dt,\r\n        cast({{ dbt_utils.date_trunc('year', dbt_utils.current_timestamp()) }} as date) as cldr_year_start_dt,\r\n        cast({{ dbt_utils.last_day(dbt_utils.current_timestamp(), 'year') }} as date) as cldr_year_end_dt,\r\n        cast({{ dbt_utils.date_trunc('week', dbt_utils.current_timestamp()) }} as date) as week_start_date,\r\n        cast({{ dbt_utils.last_day(dbt_utils.current_timestamp(), 'week') }} as date) as week_end_date,\r\n        {{ dbt_date.day_name(dbt_utils.current_timestamp(), short=true) }} as day_name,\r\n\t    {{ dbt_date.month_name(dbt_utils.current_timestamp(), short=true) }} as month_name,\r\n    \t{{ dbt_utils.current_timestamp() }} as DW_INS_UPD_DTS,\r\n    \t'D_CALENDAR_DIM_LOAD' as DW_SESSION_NM\r\n        cast({{ dbt_date.date_part('day', dbt_utils.current_timestamp()) }} as {{ dbt_utils.type_int() }}) as cldr_day_num,\r\n        cast({{ dbt_date.date_part('week', dbt_utils.current_timestamp()) }} as {{ dbt_utils.type_int() }}) as cldr_week_num,\r\n        cast({{ dbt_date.date_part('quarter', dbt_utils.current_timestamp()) }} as {{ dbt_utils.type_int() }}) as cldr_qtr_num\r\n       from source\r\n    )\r\nselect * from test\nlimit 100", 'compiled_sql': "WITH source AS (\n    select * from salesforce.opportunity\n    ),\n    test as (\n        select\n        cast(\n    current_timestamp::\n    timestamp_ntz\n\n as date)  as cldr_date,\n        cast(\n    date_trunc('month', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as date) as cldr_mnth_strt_dt,\n        cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        month,\n        1,\n        \n    date_trunc('month', \n    current_timestamp::\n    timestamp_ntz\n\n)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as cldr_mnth_end_dt,\n        cast(\n    date_trunc('quarter', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as date) as cldr_qtr_strt_dt,\n        cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        quarter,\n        1,\n        \n    date_trunc('quarter', \n    current_timestamp::\n    timestamp_ntz\n\n)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as cldr_qtr_end_dt,\n        cast(\n    date_trunc('year', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as date) as cldr_year_start_dt,\n        cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        year,\n        1,\n        \n    date_trunc('year', \n    current_timestamp::\n    timestamp_ntz\n\n)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as cldr_year_end_dt,\n        cast(\n    date_trunc('week', \n    current_timestamp::\n    timestamp_ntz\n\n)\n as date) as week_start_date,\n        cast(\n  cast(\n        \n  \n\n    dateadd(\n        day,\n        -1,\n        \n  \n\n    dateadd(\n        week,\n        1,\n        \n    date_trunc('week', \n    current_timestamp::\n    timestamp_ntz\n\n)\n\n        )\n\n\n\n        )\n\n\n\n        as date)\n as date) as week_end_date,\n        to_char(\n    current_timestamp::\n    timestamp_ntz\n\n, 'Dy') as day_name,\n\t    to_char(\n    current_timestamp::\n    timestamp_ntz\n\n, 'MON') as month_name,\n    \t\n    current_timestamp::\n    timestamp_ntz\n\n as DW_INS_UPD_DTS,\n    \t'D_CALENDAR_DIM_LOAD' as DW_SESSION_NM\n        cast(date_part('day', \n    current_timestamp::\n    timestamp_ntz\n\n) as \n    int\n) as cldr_day_num,\n        cast(date_part('week', \n    current_timestamp::\n    timestamp_ntz\n\n) as \n    int\n) as cldr_week_num,\n        cast(date_part('quarter', \n    current_timestamp::\n    timestamp_ntz\n\n) as \n    int\n) as cldr_qtr_num\n       from source\n    )\nselect * from test\nlimit 100", 'tags': None}, None)
2020-12-02 17:58:01.398386 (Thread-137): handling poll request
2020-12-02 17:58:01.398890 (Thread-137): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e4f54a8>]}
2020-12-02 17:58:01.399866 (Thread-137): sending response (<Response 25803 bytes [200 OK]>) to 10.0.32.18
2020-12-02 17:58:36.130122 (Thread-138): handling status request
2020-12-02 17:58:36.130651 (Thread-138): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e4f5278>]}
2020-12-02 17:58:36.131828 (Thread-138): sending response (<Response 1237 bytes [200 OK]>) to 10.0.8.143
2020-12-02 17:58:36.664733 (Thread-139): handling run_sql request
2020-12-02 17:58:36.665205 (Thread-139): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e4ff4a8>]}
2020-12-02 17:58:37.704654 (Thread-139): sending response (<Response 137 bytes [200 OK]>) to 10.0.34.197
2020-12-02 17:58:37.732206 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:58:37.795615 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 17:58:37.796111 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:58:37.796247 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 17:58:37.826906 (Thread-1): finished collecting timing info
2020-12-02 17:58:37.828910 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 17:58:37.828998 (Thread-1): On rpc.sales_dataflo.request: WITH source AS (
    select * from salesforce.opportunity
    ),
    test as (
        select
        cast(
    current_timestamp::
    timestamp_ntz

 as date)  as cldr_date,
        cast(
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as date) as cldr_mnth_strt_dt,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)

        )



        )



        as date)
 as date) as cldr_mnth_end_dt,
        cast(
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as date) as cldr_qtr_strt_dt,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        quarter,
        1,
        
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)

        )



        )



        as date)
 as date) as cldr_qtr_end_dt,
        cast(
    date_trunc('year', 
    current_timestamp::
    timestamp_ntz

)
 as date) as cldr_year_start_dt,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        year,
        1,
        
    date_trunc('year', 
    current_timestamp::
    timestamp_ntz

)

        )



        )



        as date)
 as date) as cldr_year_end_dt,
        cast(
    date_trunc('week', 
    current_timestamp::
    timestamp_ntz

)
 as date) as week_start_date,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', 
    current_timestamp::
    timestamp_ntz

)

        )



        )



        as date)
 as date) as week_end_date,
        to_char(
    current_timestamp::
    timestamp_ntz

, 'Dy') as day_name,
	    to_char(
    current_timestamp::
    timestamp_ntz

, 'MON') as month_name,
    	
    current_timestamp::
    timestamp_ntz

 as DW_INS_UPD_DTS,
    	'D_CALENDAR_DIM_LOAD' as DW_SESSION_NM,
        cast(date_part('day', 
    current_timestamp::
    timestamp_ntz

) as 
    int
) as cldr_day_num,
        cast(date_part('week', 
    current_timestamp::
    timestamp_ntz

) as 
    int
) as cldr_week_num,
        cast(date_part('quarter', 
    current_timestamp::
    timestamp_ntz

) as 
    int
) as cldr_qtr_num
       from source
    )
select * from test
limit 100
2020-12-02 17:58:37.829061 (Thread-1): Opening a new connection, currently in state init
2020-12-02 17:58:38.022736 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 17:58:38.354386 (Thread-140): handling poll request
2020-12-02 17:58:38.355223 (Thread-140): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e4ff4a8>]}
2020-12-02 17:58:38.357565 (Thread-140): sending response (<Response 5439 bytes [200 OK]>) to 10.0.16.71
2020-12-02 17:58:38.706140 (Thread-1): SQL status: SUCCESS 31 in 0.88 seconds
2020-12-02 17:58:38.710688 (Thread-1): finished collecting timing info
2020-12-02 17:58:38.711206 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 17:58:40.625486 (Thread-141): handling poll request
2020-12-02 17:58:40.625967 (Thread-141): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e544400>]}
2020-12-02 17:58:40.631381 (Thread-141): sending response (<Response 21416 bytes [200 OK]>) to 10.0.15.0
2020-12-02 18:03:31.447017 (Thread-142): handling status request
2020-12-02 18:03:31.449205 (Thread-142): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e506048>]}
2020-12-02 18:03:31.450725 (Thread-142): sending response (<Response 1237 bytes [200 OK]>) to 10.0.42.75
2020-12-02 18:03:32.293101 (Thread-143): handling run_sql request
2020-12-02 18:03:32.293770 (Thread-143): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e4ff390>]}
2020-12-02 18:03:34.087342 (Thread-143): sending response (<Response 137 bytes [200 OK]>) to 10.0.13.116
2020-12-02 18:03:34.197155 (MainThread): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 18:03:34.364786 (MainThread): Found 2 models, 0 tests, 0 snapshots, 0 analyses, 310 macros, 0 operations, 0 seed files, 0 sources
2020-12-02 18:03:34.372955 (Thread-1): Acquiring new snowflake connection "rpc.sales_dataflo.request".
2020-12-02 18:03:34.373184 (Thread-1): Compiling rpc.sales_dataflo.request
2020-12-02 18:03:34.487327 (Thread-1): finished collecting timing info
2020-12-02 18:03:34.491830 (Thread-1): Using snowflake connection "rpc.sales_dataflo.request".
2020-12-02 18:03:34.491996 (Thread-1): On rpc.sales_dataflo.request: WITH source AS (
    select * from salesforce.opportunity
    ),
    test as (
        select
        cast(
    current_timestamp::
    timestamp_ntz

 as date)  as cldr_date,
        cast(
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)
 as date) as cldr_mnth_strt_dt,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        month,
        1,
        
    date_trunc('month', 
    current_timestamp::
    timestamp_ntz

)

        )



        )



        as date)
 as date) as cldr_mnth_end_dt,
        cast(
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)
 as date) as cldr_qtr_strt_dt,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        quarter,
        1,
        
    date_trunc('quarter', 
    current_timestamp::
    timestamp_ntz

)

        )



        )



        as date)
 as date) as cldr_qtr_end_dt,
        cast(
    date_trunc('year', 
    current_timestamp::
    timestamp_ntz

)
 as date) as cldr_year_start_dt,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        year,
        1,
        
    date_trunc('year', 
    current_timestamp::
    timestamp_ntz

)

        )



        )



        as date)
 as date) as cldr_year_end_dt,
        cast(
    date_trunc('week', 
    current_timestamp::
    timestamp_ntz

)
 as date) as week_start_date,
        cast(
  cast(
        
  

    dateadd(
        day,
        -1,
        
  

    dateadd(
        week,
        1,
        
    date_trunc('week', 
    current_timestamp::
    timestamp_ntz

)

        )



        )



        as date)
 as date) as week_end_date,
        to_char(
    current_timestamp::
    timestamp_ntz

, 'Dy') as day_name,
	    to_char(
    current_timestamp::
    timestamp_ntz

, 'MON') as month_name,
        cast(date_part('day', 
    current_timestamp::
    timestamp_ntz

) as 
    int
) as cldr_day_num,
        cast(date_part('week', 
    current_timestamp::
    timestamp_ntz

) as 
    int
) as cldr_week_num,
        cast(date_part('quarter', 
    current_timestamp::
    timestamp_ntz

) as 
    int
) as cldr_qtr_num,
        cast(date_part('year', 
    current_timestamp::
    timestamp_ntz

) as 
    int
) as year,
        
    current_timestamp::
    timestamp_ntz

 as DW_INS_UPD_DTS,
    	'D_CALENDAR_DIM_LOAD' as DW_SESSION_NM
       from source
    )
select * from test
limit 100
2020-12-02 18:03:34.492245 (Thread-1): Opening a new connection, currently in state init
2020-12-02 18:03:34.847591 (Thread-144): handling poll request
2020-12-02 18:03:34.848351 (Thread-144): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e4ff390>]}
2020-12-02 18:03:34.852004 (Thread-144): sending response (<Response 5548 bytes [200 OK]>) to 10.0.32.18
2020-12-02 18:03:34.929136 (Thread-1): unclosed file <_io.BufferedReader name='/usr/local/lib/python3.6/dist-packages/certifi/cacert.pem'>
2020-12-02 18:03:35.980249 (Thread-1): SQL status: SUCCESS 31 in 1.49 seconds
2020-12-02 18:03:35.987922 (Thread-1): finished collecting timing info
2020-12-02 18:03:35.988671 (Thread-1): On rpc.sales_dataflo.request: Close
2020-12-02 18:03:36.564584 (Thread-145): handling poll request
2020-12-02 18:03:36.565307 (Thread-145): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e51a518>]}
2020-12-02 18:03:36.575892 (Thread-145): sending response (<Response 22243 bytes [200 OK]>) to 10.0.15.0
2020-12-02 18:13:39.431952 (Thread-146): handling status request
2020-12-02 18:13:39.434428 (Thread-146): Sending event: {'category': 'dbt', 'action': 'rpc_request', 'label': '09693f1f-4744-41e6-8729-5ffa8e25e349', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fce5e52f240>]}
2020-12-02 18:13:39.435658 (Thread-146): sending response (<Response 1237 bytes [200 OK]>) to 10.0.21.144
